!function(){"use strict";const e={MODULE_NAME:"one-journal-handouts",MODULE_TITLE:"One Journal Handouts"};e.PATH=`modules/${e.MODULE_NAME}/`;const n="gm-journal",t="players-journal",s="open-page",a=()=>{const e={};for(const[n,t]of game.journal.entries())e[n]=t.name;return e},o="open-page",i=(n,t)=>{game.socket.emit(`module.${e.MODULE_NAME}`,{event:o,journalId:n.id,pageId:t}),game.settings.get(e.MODULE_NAME,s)&&n.sheet.render(!0,{pageId:t,sheetMode:JournalSheet.VIEW_MODES.SINGLE})};new class{constructor(){this.init()}init(){Hooks.once("init",(()=>{console.log(`${e.MODULE_TITLE} | Initializing module`),game.settings.register(e.MODULE_NAME,n,{name:game.i18n.localize(`${e.MODULE_NAME}.settings.${n}-name`),hint:game.i18n.localize(`${e.MODULE_NAME}.settings.${n}-hint`),scope:"world",config:!0,default:null,type:String,choices:a}),game.settings.register(e.MODULE_NAME,t,{name:game.i18n.localize(`${e.MODULE_NAME}.settings.${t}-name`),hint:game.i18n.localize(`${e.MODULE_NAME}.settings.${t}-hint`),scope:"world",config:!0,default:null,type:String,choices:a}),game.settings.register(e.MODULE_NAME,s,{name:game.i18n.localize(`${e.MODULE_NAME}.settings.${s}-name`),hint:game.i18n.localize(`${e.MODULE_NAME}.settings.${s}-hint`),scope:"world",config:!0,default:!0,type:Boolean}),game.socket.on(`module.${e.MODULE_NAME}`,(({event:e,journalId:n,pageId:t})=>{if(e!==o)return;const s=game.journal.get(n);s&&s.sheet.render(!0,{pageId:t,sheetMode:JournalSheet.VIEW_MODES.SINGLE})})),Hooks.on("getJournalSheetHeaderButtons",((s,a)=>{if(!game.users.current.isGM)return;const o=game.settings.get(e.MODULE_NAME,n),r=game.settings.get(e.MODULE_NAME,t);if(o&&r&&!a.find((n=>n.class===e.MODULE_NAME))&&s instanceof DocumentSheet){if(s.document.id!==o)return;a.unshift({icon:"fas fa-square-share-nodes fa-fw",label:`${e.MODULE_NAME}.share-with-players`,class:e.MODULE_NAME,onclick:async()=>{const n=game.journal.get(r);if(!n)return ui.notifications.error(game.i18n.localize(`${e.MODULE_NAME}.no-players-journal`));const t=s.pagesInView[0]?.dataset?.pageId;if(!t)return;const a=n.pages.find((n=>n.flags?.[e.MODULE_NAME]===t));if(a)i(n,a.id);else{const a=await(async(n,t,s)=>{const a=Object.assign({},n.document.pages.find((e=>e.id===t)).toObject());foundry.utils.setProperty(a,`flags.${e.MODULE_NAME}`,t);const o=s.pages.map((e=>e.sort)),i=o.length?Math.max(...o):0;a.sort=i+1e4;const[r]=await s.createEmbeddedDocuments("JournalEntryPage",[a]);return r})(s,t,n);i(n,a.id)}ui.notifications.info(game.i18n.localize(`${e.MODULE_NAME}.successful`))}})}}))}))}}}();