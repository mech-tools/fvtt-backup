{"version":3,"file":"main.js","mappings":"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","sources":["webpack:///./libs/bezier.js","webpack:///../common/Settings.ts","webpack:///./src/CurvyWallToolManager.ts","webpack:///./src/CurvyWallsToolBar.ts","webpack:///./src/tools/BezierTool.ts","webpack:///./src/tools/CircleTool.ts","webpack:///./src/tools/CubicTool.ts","webpack:///./src/tools/PointMapper.ts","webpack:///./src/tools/QuadTool.ts","webpack:///./src/tools/RectangleTool.ts","webpack:///./src/tools/ToolInputHandler.ts","webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///./src/df-curvy-walls.ts"],"sourcesContent":["// math-inlining.\nconst { abs, cos, sin, acos, atan2, sqrt, pow } = Math;\n\n// cube root function yielding real roots\nfunction crt(v) {\n\treturn v < 0 ? -pow(-v, 1 / 3) : pow(v, 1 / 3);\n}\n\n// trig constants\nconst pi = Math.PI,\n\ttau = 2 * pi,\n\tquart = pi / 2,\n\t// float precision significant decimal\n\tepsilon = 0.000001,\n\t// extremas used in bbox calculation and similar algorithms\n\tnMax = Number.MAX_SAFE_INTEGER || 9007199254740991,\n\tnMin = Number.MIN_SAFE_INTEGER || -9007199254740991,\n\t// a zero coordinate, which is surprisingly useful\n\tZERO = { x: 0, y: 0, z: 0 };\n\n// Bezier utility functions\nconst utils = {\n\t// Legendre-Gauss abscissae with n=24 (x_i values, defined at i=n as the roots of the nth order Legendre polynomial Pn(x))\n\tTvalues: [\n\t\t-0.0640568928626056260850430826247450385909,\n\t\t0.0640568928626056260850430826247450385909,\n\t\t-0.1911188674736163091586398207570696318404,\n\t\t0.1911188674736163091586398207570696318404,\n\t\t-0.3150426796961633743867932913198102407864,\n\t\t0.3150426796961633743867932913198102407864,\n\t\t-0.4337935076260451384870842319133497124524,\n\t\t0.4337935076260451384870842319133497124524,\n\t\t-0.5454214713888395356583756172183723700107,\n\t\t0.5454214713888395356583756172183723700107,\n\t\t-0.6480936519369755692524957869107476266696,\n\t\t0.6480936519369755692524957869107476266696,\n\t\t-0.7401241915785543642438281030999784255232,\n\t\t0.7401241915785543642438281030999784255232,\n\t\t-0.8200019859739029219539498726697452080761,\n\t\t0.8200019859739029219539498726697452080761,\n\t\t-0.8864155270044010342131543419821967550873,\n\t\t0.8864155270044010342131543419821967550873,\n\t\t-0.9382745520027327585236490017087214496548,\n\t\t0.9382745520027327585236490017087214496548,\n\t\t-0.9747285559713094981983919930081690617411,\n\t\t0.9747285559713094981983919930081690617411,\n\t\t-0.9951872199970213601799974097007368118745,\n\t\t0.9951872199970213601799974097007368118745,\n\t],\n\n\t// Legendre-Gauss weights with n=24 (w_i values, defined by a function linked to in the Bezier primer article)\n\tCvalues: [\n\t\t0.1279381953467521569740561652246953718517,\n\t\t0.1279381953467521569740561652246953718517,\n\t\t0.1258374563468282961213753825111836887264,\n\t\t0.1258374563468282961213753825111836887264,\n\t\t0.121670472927803391204463153476262425607,\n\t\t0.121670472927803391204463153476262425607,\n\t\t0.1155056680537256013533444839067835598622,\n\t\t0.1155056680537256013533444839067835598622,\n\t\t0.1074442701159656347825773424466062227946,\n\t\t0.1074442701159656347825773424466062227946,\n\t\t0.0976186521041138882698806644642471544279,\n\t\t0.0976186521041138882698806644642471544279,\n\t\t0.086190161531953275917185202983742667185,\n\t\t0.086190161531953275917185202983742667185,\n\t\t0.0733464814110803057340336152531165181193,\n\t\t0.0733464814110803057340336152531165181193,\n\t\t0.0592985849154367807463677585001085845412,\n\t\t0.0592985849154367807463677585001085845412,\n\t\t0.0442774388174198061686027482113382288593,\n\t\t0.0442774388174198061686027482113382288593,\n\t\t0.0285313886289336631813078159518782864491,\n\t\t0.0285313886289336631813078159518782864491,\n\t\t0.0123412297999871995468056670700372915759,\n\t\t0.0123412297999871995468056670700372915759,\n\t],\n\n\tarcfn: function (t, derivativeFn) {\n\t\tconst d = derivativeFn(t);\n\t\tlet l = d.x * d.x + d.y * d.y;\n\t\tif (typeof d.z !== \"undefined\") {\n\t\t\tl += d.z * d.z;\n\t\t}\n\t\treturn sqrt(l);\n\t},\n\n\tcompute: function (t, points, _3d) {\n\t\t// shortcuts\n\t\tif (t === 0) {\n\t\t\tpoints[0].t = 0;\n\t\t\treturn points[0];\n\t\t}\n\n\t\tconst order = points.length - 1;\n\n\t\tif (t === 1) {\n\t\t\tpoints[order].t = 1;\n\t\t\treturn points[order];\n\t\t}\n\n\t\tconst mt = 1 - t;\n\t\tlet p = points;\n\n\t\t// constant?\n\t\tif (order === 0) {\n\t\t\tpoints[0].t = t;\n\t\t\treturn points[0];\n\t\t}\n\n\t\t// linear?\n\t\tif (order === 1) {\n\t\t\tconst ret = {\n\t\t\t\tx: mt * p[0].x + t * p[1].x,\n\t\t\t\ty: mt * p[0].y + t * p[1].y,\n\t\t\t\tt: t,\n\t\t\t};\n\t\t\tif (_3d) {\n\t\t\t\tret.z = mt * p[0].z + t * p[1].z;\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\t// quadratic/cubic curve?\n\t\tif (order < 4) {\n\t\t\tlet mt2 = mt * mt,\n\t\t\t\tt2 = t * t,\n\t\t\t\ta,\n\t\t\t\tb,\n\t\t\t\tc,\n\t\t\t\td = 0;\n\t\t\tif (order === 2) {\n\t\t\t\tp = [p[0], p[1], p[2], ZERO];\n\t\t\t\ta = mt2;\n\t\t\t\tb = mt * t * 2;\n\t\t\t\tc = t2;\n\t\t\t} else if (order === 3) {\n\t\t\t\ta = mt2 * mt;\n\t\t\t\tb = mt2 * t * 3;\n\t\t\t\tc = mt * t2 * 3;\n\t\t\t\td = t * t2;\n\t\t\t}\n\t\t\tconst ret = {\n\t\t\t\tx: a * p[0].x + b * p[1].x + c * p[2].x + d * p[3].x,\n\t\t\t\ty: a * p[0].y + b * p[1].y + c * p[2].y + d * p[3].y,\n\t\t\t\tt: t,\n\t\t\t};\n\t\t\tif (_3d) {\n\t\t\t\tret.z = a * p[0].z + b * p[1].z + c * p[2].z + d * p[3].z;\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\t// higher order curves: use de Casteljau's computation\n\t\tconst dCpts = JSON.parse(JSON.stringify(points));\n\t\twhile (dCpts.length > 1) {\n\t\t\tfor (let i = 0; i < dCpts.length - 1; i++) {\n\t\t\t\tdCpts[i] = {\n\t\t\t\t\tx: dCpts[i].x + (dCpts[i + 1].x - dCpts[i].x) * t,\n\t\t\t\t\ty: dCpts[i].y + (dCpts[i + 1].y - dCpts[i].y) * t,\n\t\t\t\t};\n\t\t\t\tif (typeof dCpts[i].z !== \"undefined\") {\n\t\t\t\t\tdCpts[i] = dCpts[i].z + (dCpts[i + 1].z - dCpts[i].z) * t;\n\t\t\t\t}\n\t\t\t}\n\t\t\tdCpts.splice(dCpts.length - 1, 1);\n\t\t}\n\t\tdCpts[0].t = t;\n\t\treturn dCpts[0];\n\t},\n\n\tcomputeWithRatios: function (t, points, ratios, _3d) {\n\t\tconst mt = 1 - t,\n\t\t\tr = ratios,\n\t\t\tp = points;\n\n\t\tlet f1 = r[0],\n\t\t\tf2 = r[1],\n\t\t\tf3 = r[2],\n\t\t\tf4 = r[3],\n\t\t\td;\n\n\t\t// spec for linear\n\t\tf1 *= mt;\n\t\tf2 *= t;\n\n\t\tif (p.length === 2) {\n\t\t\td = f1 + f2;\n\t\t\treturn {\n\t\t\t\tx: (f1 * p[0].x + f2 * p[1].x) / d,\n\t\t\t\ty: (f1 * p[0].y + f2 * p[1].y) / d,\n\t\t\t\tz: !_3d ? false : (f1 * p[0].z + f2 * p[1].z) / d,\n\t\t\t\tt: t,\n\t\t\t};\n\t\t}\n\n\t\t// upgrade to quadratic\n\t\tf1 *= mt;\n\t\tf2 *= 2 * mt;\n\t\tf3 *= t * t;\n\n\t\tif (p.length === 3) {\n\t\t\td = f1 + f2 + f3;\n\t\t\treturn {\n\t\t\t\tx: (f1 * p[0].x + f2 * p[1].x + f3 * p[2].x) / d,\n\t\t\t\ty: (f1 * p[0].y + f2 * p[1].y + f3 * p[2].y) / d,\n\t\t\t\tz: !_3d ? false : (f1 * p[0].z + f2 * p[1].z + f3 * p[2].z) / d,\n\t\t\t\tt: t,\n\t\t\t};\n\t\t}\n\n\t\t// upgrade to cubic\n\t\tf1 *= mt;\n\t\tf2 *= 1.5 * mt;\n\t\tf3 *= 3 * mt;\n\t\tf4 *= t * t * t;\n\n\t\tif (p.length === 4) {\n\t\t\td = f1 + f2 + f3 + f4;\n\t\t\treturn {\n\t\t\t\tx: (f1 * p[0].x + f2 * p[1].x + f3 * p[2].x + f4 * p[3].x) / d,\n\t\t\t\ty: (f1 * p[0].y + f2 * p[1].y + f3 * p[2].y + f4 * p[3].y) / d,\n\t\t\t\tz: !_3d\n\t\t\t\t\t? false\n\t\t\t\t\t: (f1 * p[0].z + f2 * p[1].z + f3 * p[2].z + f4 * p[3].z) / d,\n\t\t\t\tt: t,\n\t\t\t};\n\t\t}\n\t},\n\n\tderive: function (points, _3d) {\n\t\tconst dpoints = [];\n\t\tfor (let p = points, d = p.length, c = d - 1; d > 1; d--, c--) {\n\t\t\tconst list = [];\n\t\t\tfor (let j = 0, dpt; j < c; j++) {\n\t\t\t\tdpt = {\n\t\t\t\t\tx: c * (p[j + 1].x - p[j].x),\n\t\t\t\t\ty: c * (p[j + 1].y - p[j].y),\n\t\t\t\t};\n\t\t\t\tif (_3d) {\n\t\t\t\t\tdpt.z = c * (p[j + 1].z - p[j].z);\n\t\t\t\t}\n\t\t\t\tlist.push(dpt);\n\t\t\t}\n\t\t\tdpoints.push(list);\n\t\t\tp = list;\n\t\t}\n\t\treturn dpoints;\n\t},\n\n\tbetween: function (v, m, M) {\n\t\treturn (\n\t\t\t(m <= v && v <= M) ||\n\t\t\tutils.approximately(v, m) ||\n\t\t\tutils.approximately(v, M)\n\t\t);\n\t},\n\n\tapproximately: function (a, b, precision) {\n\t\treturn abs(a - b) <= (precision || epsilon);\n\t},\n\n\tlength: function (derivativeFn) {\n\t\tconst z = 0.5,\n\t\t\tlen = utils.Tvalues.length;\n\n\t\tlet sum = 0;\n\n\t\tfor (let i = 0, t; i < len; i++) {\n\t\t\tt = z * utils.Tvalues[i] + z;\n\t\t\tsum += utils.Cvalues[i] * utils.arcfn(t, derivativeFn);\n\t\t}\n\t\treturn z * sum;\n\t},\n\n\tmap: function (v, ds, de, ts, te) {\n\t\tconst d1 = de - ds,\n\t\t\td2 = te - ts,\n\t\t\tv2 = v - ds,\n\t\t\tr = v2 / d1;\n\t\treturn ts + d2 * r;\n\t},\n\n\tlerp: function (r, v1, v2) {\n\t\tconst ret = {\n\t\t\tx: v1.x + r * (v2.x - v1.x),\n\t\t\ty: v1.y + r * (v2.y - v1.y),\n\t\t};\n\t\tif (!!v1.z && !!v2.z) {\n\t\t\tret.z = v1.z + r * (v2.z - v1.z);\n\t\t}\n\t\treturn ret;\n\t},\n\n\tpointToString: function (p) {\n\t\tlet s = p.x + \"/\" + p.y;\n\t\tif (typeof p.z !== \"undefined\") {\n\t\t\ts += \"/\" + p.z;\n\t\t}\n\t\treturn s;\n\t},\n\n\tpointsToString: function (points) {\n\t\treturn \"[\" + points.map(utils.pointToString).join(\", \") + \"]\";\n\t},\n\n\tcopy: function (obj) {\n\t\treturn JSON.parse(JSON.stringify(obj));\n\t},\n\n\tangle: function (o, v1, v2) {\n\t\tconst dx1 = v1.x - o.x,\n\t\t\tdy1 = v1.y - o.y,\n\t\t\tdx2 = v2.x - o.x,\n\t\t\tdy2 = v2.y - o.y,\n\t\t\tcross = dx1 * dy2 - dy1 * dx2,\n\t\t\tdot = dx1 * dx2 + dy1 * dy2;\n\t\treturn atan2(cross, dot);\n\t},\n\n\t// round as string, to avoid rounding errors\n\tround: function (v, d) {\n\t\tconst s = \"\" + v;\n\t\tconst pos = s.indexOf(\".\");\n\t\treturn parseFloat(s.substring(0, pos + 1 + d));\n\t},\n\n\tdist: function (p1, p2) {\n\t\tconst dx = p1.x - p2.x,\n\t\t\tdy = p1.y - p2.y;\n\t\treturn sqrt(dx * dx + dy * dy);\n\t},\n\n\tclosest: function (LUT, point) {\n\t\tlet mdist = pow(2, 63),\n\t\t\tmpos,\n\t\t\td;\n\t\tLUT.forEach(function (p, idx) {\n\t\t\td = utils.dist(point, p);\n\t\t\tif (d < mdist) {\n\t\t\t\tmdist = d;\n\t\t\t\tmpos = idx;\n\t\t\t}\n\t\t});\n\t\treturn { mdist: mdist, mpos: mpos };\n\t},\n\n\tabcratio: function (t, n) {\n\t\t// see ratio(t) note on http://pomax.github.io/bezierinfo/#abc\n\t\tif (n !== 2 && n !== 3) {\n\t\t\treturn false;\n\t\t}\n\t\tif (typeof t === \"undefined\") {\n\t\t\tt = 0.5;\n\t\t} else if (t === 0 || t === 1) {\n\t\t\treturn t;\n\t\t}\n\t\tconst bottom = pow(t, n) + pow(1 - t, n),\n\t\t\ttop = bottom - 1;\n\t\treturn abs(top / bottom);\n\t},\n\n\tprojectionratio: function (t, n) {\n\t\t// see u(t) note on http://pomax.github.io/bezierinfo/#abc\n\t\tif (n !== 2 && n !== 3) {\n\t\t\treturn false;\n\t\t}\n\t\tif (typeof t === \"undefined\") {\n\t\t\tt = 0.5;\n\t\t} else if (t === 0 || t === 1) {\n\t\t\treturn t;\n\t\t}\n\t\tconst top = pow(1 - t, n),\n\t\t\tbottom = pow(t, n) + top;\n\t\treturn top / bottom;\n\t},\n\n\tlli8: function (x1, y1, x2, y2, x3, y3, x4, y4) {\n\t\tconst nx =\n\t\t\t(x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4),\n\t\t\tny = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4),\n\t\t\td = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);\n\t\tif (d == 0) {\n\t\t\treturn false;\n\t\t}\n\t\treturn { x: nx / d, y: ny / d };\n\t},\n\n\tlli4: function (p1, p2, p3, p4) {\n\t\tconst x1 = p1.x,\n\t\t\ty1 = p1.y,\n\t\t\tx2 = p2.x,\n\t\t\ty2 = p2.y,\n\t\t\tx3 = p3.x,\n\t\t\ty3 = p3.y,\n\t\t\tx4 = p4.x,\n\t\t\ty4 = p4.y;\n\t\treturn utils.lli8(x1, y1, x2, y2, x3, y3, x4, y4);\n\t},\n\n\tlli: function (v1, v2) {\n\t\treturn utils.lli4(v1, v1.c, v2, v2.c);\n\t},\n\n\tmakeline: function (p1, p2) {\n\t\tconst x1 = p1.x,\n\t\t\ty1 = p1.y,\n\t\t\tx2 = p2.x,\n\t\t\ty2 = p2.y,\n\t\t\tdx = (x2 - x1) / 3,\n\t\t\tdy = (y2 - y1) / 3;\n\t\treturn new Bezier(\n\t\t\tx1,\n\t\t\ty1,\n\t\t\tx1 + dx,\n\t\t\ty1 + dy,\n\t\t\tx1 + 2 * dx,\n\t\t\ty1 + 2 * dy,\n\t\t\tx2,\n\t\t\ty2\n\t\t);\n\t},\n\n\tfindbbox: function (sections) {\n\t\tlet mx = nMax,\n\t\t\tmy = nMax,\n\t\t\tMX = nMin,\n\t\t\tMY = nMin;\n\t\tsections.forEach(function (s) {\n\t\t\tconst bbox = s.bbox();\n\t\t\tif (mx > bbox.x.min) mx = bbox.x.min;\n\t\t\tif (my > bbox.y.min) my = bbox.y.min;\n\t\t\tif (MX < bbox.x.max) MX = bbox.x.max;\n\t\t\tif (MY < bbox.y.max) MY = bbox.y.max;\n\t\t});\n\t\treturn {\n\t\t\tx: { min: mx, mid: (mx + MX) / 2, max: MX, size: MX - mx },\n\t\t\ty: { min: my, mid: (my + MY) / 2, max: MY, size: MY - my },\n\t\t};\n\t},\n\n\tshapeintersections: function (\n\t\ts1,\n\t\tbbox1,\n\t\ts2,\n\t\tbbox2,\n\t\tcurveIntersectionThreshold\n\t) {\n\t\tif (!utils.bboxoverlap(bbox1, bbox2)) return [];\n\t\tconst intersections = [];\n\t\tconst a1 = [s1.startcap, s1.forward, s1.back, s1.endcap];\n\t\tconst a2 = [s2.startcap, s2.forward, s2.back, s2.endcap];\n\t\ta1.forEach(function (l1) {\n\t\t\tif (l1.virtual) return;\n\t\t\ta2.forEach(function (l2) {\n\t\t\t\tif (l2.virtual) return;\n\t\t\t\tconst iss = l1.intersects(l2, curveIntersectionThreshold);\n\t\t\t\tif (iss.length > 0) {\n\t\t\t\t\tiss.c1 = l1;\n\t\t\t\t\tiss.c2 = l2;\n\t\t\t\t\tiss.s1 = s1;\n\t\t\t\t\tiss.s2 = s2;\n\t\t\t\t\tintersections.push(iss);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\treturn intersections;\n\t},\n\n\tmakeshape: function (forward, back, curveIntersectionThreshold) {\n\t\tconst bpl = back.points.length;\n\t\tconst fpl = forward.points.length;\n\t\tconst start = utils.makeline(back.points[bpl - 1], forward.points[0]);\n\t\tconst end = utils.makeline(forward.points[fpl - 1], back.points[0]);\n\t\tconst shape = {\n\t\t\tstartcap: start,\n\t\t\tforward: forward,\n\t\t\tback: back,\n\t\t\tendcap: end,\n\t\t\tbbox: utils.findbbox([start, forward, back, end]),\n\t\t};\n\t\tshape.intersections = function (s2) {\n\t\t\treturn utils.shapeintersections(\n\t\t\t\tshape,\n\t\t\t\tshape.bbox,\n\t\t\t\ts2,\n\t\t\t\ts2.bbox,\n\t\t\t\tcurveIntersectionThreshold\n\t\t\t);\n\t\t};\n\t\treturn shape;\n\t},\n\n\tgetminmax: function (curve, d, list) {\n\t\tif (!list) return { min: 0, max: 0 };\n\t\tlet min = nMax,\n\t\t\tmax = nMin,\n\t\t\tt,\n\t\t\tc;\n\t\tif (list.indexOf(0) === -1) {\n\t\t\tlist = [0].concat(list);\n\t\t}\n\t\tif (list.indexOf(1) === -1) {\n\t\t\tlist.push(1);\n\t\t}\n\t\tfor (let i = 0, len = list.length; i < len; i++) {\n\t\t\tt = list[i];\n\t\t\tc = curve.get(t);\n\t\t\tif (c[d] < min) {\n\t\t\t\tmin = c[d];\n\t\t\t}\n\t\t\tif (c[d] > max) {\n\t\t\t\tmax = c[d];\n\t\t\t}\n\t\t}\n\t\treturn { min: min, mid: (min + max) / 2, max: max, size: max - min };\n\t},\n\n\talign: function (points, line) {\n\t\tconst tx = line.p1.x,\n\t\t\tty = line.p1.y,\n\t\t\ta = -atan2(line.p2.y - ty, line.p2.x - tx),\n\t\t\td = function (v) {\n\t\t\t\treturn {\n\t\t\t\t\tx: (v.x - tx) * cos(a) - (v.y - ty) * sin(a),\n\t\t\t\t\ty: (v.x - tx) * sin(a) + (v.y - ty) * cos(a),\n\t\t\t\t};\n\t\t\t};\n\t\treturn points.map(d);\n\t},\n\n\troots: function (points, line) {\n\t\tline = line || { p1: { x: 0, y: 0 }, p2: { x: 1, y: 0 } };\n\n\t\tconst order = points.length - 1;\n\t\tconst aligned = utils.align(points, line);\n\t\tconst reduce = function (t) {\n\t\t\treturn 0 <= t && t <= 1;\n\t\t};\n\n\t\tif (order === 2) {\n\t\t\tconst a = aligned[0].y,\n\t\t\t\tb = aligned[1].y,\n\t\t\t\tc = aligned[2].y,\n\t\t\t\td = a - 2 * b + c;\n\t\t\tif (d !== 0) {\n\t\t\t\tconst m1 = -sqrt(b * b - a * c),\n\t\t\t\t\tm2 = -a + b,\n\t\t\t\t\tv1 = -(m1 + m2) / d,\n\t\t\t\t\tv2 = -(-m1 + m2) / d;\n\t\t\t\treturn [v1, v2].filter(reduce);\n\t\t\t} else if (b !== c && d === 0) {\n\t\t\t\treturn [(2 * b - c) / (2 * b - 2 * c)].filter(reduce);\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\t// see http://www.trans4mind.com/personal_development/mathematics/polynomials/cubicAlgebra.htm\n\t\tconst pa = aligned[0].y,\n\t\t\tpb = aligned[1].y,\n\t\t\tpc = aligned[2].y,\n\t\t\tpd = aligned[3].y;\n\n\t\tlet d = -pa + 3 * pb - 3 * pc + pd,\n\t\t\ta = 3 * pa - 6 * pb + 3 * pc,\n\t\t\tb = -3 * pa + 3 * pb,\n\t\t\tc = pa;\n\n\t\tif (utils.approximately(d, 0)) {\n\t\t\t// this is not a cubic curve.\n\t\t\tif (utils.approximately(a, 0)) {\n\t\t\t\t// in fact, this is not a quadratic curve either.\n\t\t\t\tif (utils.approximately(b, 0)) {\n\t\t\t\t\t// in fact in fact, there are no solutions.\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\t\t\t\t// linear solution:\n\t\t\t\treturn [-c / b].filter(reduce);\n\t\t\t}\n\t\t\t// quadratic solution:\n\t\t\tconst q = sqrt(b * b - 4 * a * c),\n\t\t\t\ta2 = 2 * a;\n\t\t\treturn [(q - b) / a2, (-b - q) / a2].filter(reduce);\n\t\t}\n\n\t\t// at this point, we know we need a cubic solution:\n\n\t\ta /= d;\n\t\tb /= d;\n\t\tc /= d;\n\n\t\tconst p = (3 * b - a * a) / 3,\n\t\t\tp3 = p / 3,\n\t\t\tq = (2 * a * a * a - 9 * a * b + 27 * c) / 27,\n\t\t\tq2 = q / 2,\n\t\t\tdiscriminant = q2 * q2 + p3 * p3 * p3;\n\n\t\tlet u1, v1, x1, x2, x3;\n\t\tif (discriminant < 0) {\n\t\t\tconst mp3 = -p / 3,\n\t\t\t\tmp33 = mp3 * mp3 * mp3,\n\t\t\t\tr = sqrt(mp33),\n\t\t\t\tt = -q / (2 * r),\n\t\t\t\tcosphi = t < -1 ? -1 : t > 1 ? 1 : t,\n\t\t\t\tphi = acos(cosphi),\n\t\t\t\tcrtr = crt(r),\n\t\t\t\tt1 = 2 * crtr;\n\t\t\tx1 = t1 * cos(phi / 3) - a / 3;\n\t\t\tx2 = t1 * cos((phi + tau) / 3) - a / 3;\n\t\t\tx3 = t1 * cos((phi + 2 * tau) / 3) - a / 3;\n\t\t\treturn [x1, x2, x3].filter(reduce);\n\t\t} else if (discriminant === 0) {\n\t\t\tu1 = q2 < 0 ? crt(-q2) : -crt(q2);\n\t\t\tx1 = 2 * u1 - a / 3;\n\t\t\tx2 = -u1 - a / 3;\n\t\t\treturn [x1, x2].filter(reduce);\n\t\t} else {\n\t\t\tconst sd = sqrt(discriminant);\n\t\t\tu1 = crt(-q2 + sd);\n\t\t\tv1 = crt(q2 + sd);\n\t\t\treturn [u1 - v1 - a / 3].filter(reduce);\n\t\t}\n\t},\n\n\tdroots: function (p) {\n\t\t// quadratic roots are easy\n\t\tif (p.length === 3) {\n\t\t\tconst a = p[0],\n\t\t\t\tb = p[1],\n\t\t\t\tc = p[2],\n\t\t\t\td = a - 2 * b + c;\n\t\t\tif (d !== 0) {\n\t\t\t\tconst m1 = -sqrt(b * b - a * c),\n\t\t\t\t\tm2 = -a + b,\n\t\t\t\t\tv1 = -(m1 + m2) / d,\n\t\t\t\t\tv2 = -(-m1 + m2) / d;\n\t\t\t\treturn [v1, v2];\n\t\t\t} else if (b !== c && d === 0) {\n\t\t\t\treturn [(2 * b - c) / (2 * (b - c))];\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\t// linear roots are even easier\n\t\tif (p.length === 2) {\n\t\t\tconst a = p[0],\n\t\t\t\tb = p[1];\n\t\t\tif (a !== b) {\n\t\t\t\treturn [a / (a - b)];\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\treturn [];\n\t},\n\n\tcurvature: function (t, d1, d2, _3d, kOnly) {\n\t\tlet num,\n\t\t\tdnm,\n\t\t\tadk,\n\t\t\tdk,\n\t\t\tk = 0,\n\t\t\tr = 0;\n\n\t\t//\n\t\t// We're using the following formula for curvature:\n\t\t//\n\t\t//              x'y\" - y'x\"\n\t\t//   k(t) = ------------------\n\t\t//           (x' + y')^(3/2)\n\t\t//\n\t\t// from https://en.wikipedia.org/wiki/Radius_of_curvature#Definition\n\t\t//\n\t\t// With it corresponding 3D counterpart:\n\t\t//\n\t\t//          sqrt( (y'z\" - y\"z') + (z'x\" - z\"x') + (x'y\" - x\"y'))\n\t\t//   k(t) = -------------------------------------------------------\n\t\t//                     (x' + y' + z')^(3/2)\n\t\t//\n\n\t\tconst d = utils.compute(t, d1);\n\t\tconst dd = utils.compute(t, d2);\n\t\tconst qdsum = d.x * d.x + d.y * d.y;\n\n\t\tif (_3d) {\n\t\t\tnum = sqrt(\n\t\t\t\tpow(d.y * dd.z - dd.y * d.z, 2) +\n\t\t\t\tpow(d.z * dd.x - dd.z * d.x, 2) +\n\t\t\t\tpow(d.x * dd.y - dd.x * d.y, 2)\n\t\t\t);\n\t\t\tdnm = pow(qdsum + d.z * d.z, 3 / 2);\n\t\t} else {\n\t\t\tnum = d.x * dd.y - d.y * dd.x;\n\t\t\tdnm = pow(qdsum, 3 / 2);\n\t\t}\n\n\t\tif (num === 0 || dnm === 0) {\n\t\t\treturn { k: 0, r: 0 };\n\t\t}\n\n\t\tk = num / dnm;\n\t\tr = dnm / num;\n\n\t\t// We're also computing the derivative of kappa, because\n\t\t// there is value in knowing the rate of change for the\n\t\t// curvature along the curve. And we're just going to\n\t\t// ballpark it based on an epsilon.\n\t\tif (!kOnly) {\n\t\t\t// compute k'(t) based on the interval before, and after it,\n\t\t\t// to at least try to not introduce forward/backward pass bias.\n\t\t\tconst pk = utils.curvature(t - 0.001, d1, d2, _3d, true).k;\n\t\t\tconst nk = utils.curvature(t + 0.001, d1, d2, _3d, true).k;\n\t\t\tdk = (nk - k + (k - pk)) / 2;\n\t\t\tadk = (abs(nk - k) + abs(k - pk)) / 2;\n\t\t}\n\n\t\treturn { k: k, r: r, dk: dk, adk: adk };\n\t},\n\n\tinflections: function (points) {\n\t\tif (points.length < 4) return [];\n\n\t\t// FIXME: TODO: add in inflection abstraction for quartic+ curves?\n\n\t\tconst p = utils.align(points, { p1: points[0], p2: points.slice(-1)[0] }),\n\t\t\ta = p[2].x * p[1].y,\n\t\t\tb = p[3].x * p[1].y,\n\t\t\tc = p[1].x * p[2].y,\n\t\t\td = p[3].x * p[2].y,\n\t\t\tv1 = 18 * (-3 * a + 2 * b + 3 * c - d),\n\t\t\tv2 = 18 * (3 * a - b - 3 * c),\n\t\t\tv3 = 18 * (c - a);\n\n\t\tif (utils.approximately(v1, 0)) {\n\t\t\tif (!utils.approximately(v2, 0)) {\n\t\t\t\tlet t = -v3 / v2;\n\t\t\t\tif (0 <= t && t <= 1) return [t];\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\tconst trm = v2 * v2 - 4 * v1 * v3,\n\t\t\tsq = Math.sqrt(trm),\n\t\t\td2 = 2 * v1;\n\n\t\tif (utils.approximately(d2, 0)) return [];\n\n\t\treturn [(sq - v2) / d2, -(v2 + sq) / d2].filter(function (r) {\n\t\t\treturn 0 <= r && r <= 1;\n\t\t});\n\t},\n\n\tbboxoverlap: function (b1, b2) {\n\t\tconst dims = [\"x\", \"y\"],\n\t\t\tlen = dims.length;\n\n\t\tfor (let i = 0, dim, l, t, d; i < len; i++) {\n\t\t\tdim = dims[i];\n\t\t\tl = b1[dim].mid;\n\t\t\tt = b2[dim].mid;\n\t\t\td = (b1[dim].size + b2[dim].size) / 2;\n\t\t\tif (abs(l - t) >= d) return false;\n\t\t}\n\t\treturn true;\n\t},\n\n\texpandbox: function (bbox, _bbox) {\n\t\tif (_bbox.x.min < bbox.x.min) {\n\t\t\tbbox.x.min = _bbox.x.min;\n\t\t}\n\t\tif (_bbox.y.min < bbox.y.min) {\n\t\t\tbbox.y.min = _bbox.y.min;\n\t\t}\n\t\tif (_bbox.z && _bbox.z.min < bbox.z.min) {\n\t\t\tbbox.z.min = _bbox.z.min;\n\t\t}\n\t\tif (_bbox.x.max > bbox.x.max) {\n\t\t\tbbox.x.max = _bbox.x.max;\n\t\t}\n\t\tif (_bbox.y.max > bbox.y.max) {\n\t\t\tbbox.y.max = _bbox.y.max;\n\t\t}\n\t\tif (_bbox.z && _bbox.z.max > bbox.z.max) {\n\t\t\tbbox.z.max = _bbox.z.max;\n\t\t}\n\t\tbbox.x.mid = (bbox.x.min + bbox.x.max) / 2;\n\t\tbbox.y.mid = (bbox.y.min + bbox.y.max) / 2;\n\t\tif (bbox.z) {\n\t\t\tbbox.z.mid = (bbox.z.min + bbox.z.max) / 2;\n\t\t}\n\t\tbbox.x.size = bbox.x.max - bbox.x.min;\n\t\tbbox.y.size = bbox.y.max - bbox.y.min;\n\t\tif (bbox.z) {\n\t\t\tbbox.z.size = bbox.z.max - bbox.z.min;\n\t\t}\n\t},\n\n\tpairiteration: function (c1, c2, curveIntersectionThreshold) {\n\t\tconst c1b = c1.bbox(),\n\t\t\tc2b = c2.bbox(),\n\t\t\tr = 100000,\n\t\t\tthreshold = curveIntersectionThreshold || 0.5;\n\n\t\tif (\n\t\t\tc1b.x.size + c1b.y.size < threshold &&\n\t\t\tc2b.x.size + c2b.y.size < threshold\n\t\t) {\n\t\t\treturn [\n\t\t\t\t(((r * (c1._t1 + c1._t2)) / 2) | 0) / r +\n\t\t\t\t\"/\" +\n\t\t\t\t(((r * (c2._t1 + c2._t2)) / 2) | 0) / r,\n\t\t\t];\n\t\t}\n\n\t\tlet cc1 = c1.split(0.5),\n\t\t\tcc2 = c2.split(0.5),\n\t\t\tpairs = [\n\t\t\t\t{ left: cc1.left, right: cc2.left },\n\t\t\t\t{ left: cc1.left, right: cc2.right },\n\t\t\t\t{ left: cc1.right, right: cc2.right },\n\t\t\t\t{ left: cc1.right, right: cc2.left },\n\t\t\t];\n\n\t\tpairs = pairs.filter(function (pair) {\n\t\t\treturn utils.bboxoverlap(pair.left.bbox(), pair.right.bbox());\n\t\t});\n\n\t\tlet results = [];\n\n\t\tif (pairs.length === 0) return results;\n\n\t\tpairs.forEach(function (pair) {\n\t\t\tresults = results.concat(\n\t\t\t\tutils.pairiteration(pair.left, pair.right, threshold)\n\t\t\t);\n\t\t});\n\n\t\tresults = results.filter(function (v, i) {\n\t\t\treturn results.indexOf(v) === i;\n\t\t});\n\n\t\treturn results;\n\t},\n\n\tgetccenter: function (p1, p2, p3) {\n\t\tconst dx1 = p2.x - p1.x,\n\t\t\tdy1 = p2.y - p1.y,\n\t\t\tdx2 = p3.x - p2.x,\n\t\t\tdy2 = p3.y - p2.y,\n\t\t\tdx1p = dx1 * cos(quart) - dy1 * sin(quart),\n\t\t\tdy1p = dx1 * sin(quart) + dy1 * cos(quart),\n\t\t\tdx2p = dx2 * cos(quart) - dy2 * sin(quart),\n\t\t\tdy2p = dx2 * sin(quart) + dy2 * cos(quart),\n\t\t\t// chord midpoints\n\t\t\tmx1 = (p1.x + p2.x) / 2,\n\t\t\tmy1 = (p1.y + p2.y) / 2,\n\t\t\tmx2 = (p2.x + p3.x) / 2,\n\t\t\tmy2 = (p2.y + p3.y) / 2,\n\t\t\t// midpoint offsets\n\t\t\tmx1n = mx1 + dx1p,\n\t\t\tmy1n = my1 + dy1p,\n\t\t\tmx2n = mx2 + dx2p,\n\t\t\tmy2n = my2 + dy2p,\n\t\t\t// intersection of these lines:\n\t\t\tarc = utils.lli8(mx1, my1, mx1n, my1n, mx2, my2, mx2n, my2n),\n\t\t\tr = utils.dist(arc, p1);\n\n\t\t// arc start/end values, over mid point:\n\t\tlet s = atan2(p1.y - arc.y, p1.x - arc.x),\n\t\t\tm = atan2(p2.y - arc.y, p2.x - arc.x),\n\t\t\te = atan2(p3.y - arc.y, p3.x - arc.x),\n\t\t\t_;\n\n\t\t// determine arc direction (cw/ccw correction)\n\t\tif (s < e) {\n\t\t\t// if s<m<e, arc(s, e)\n\t\t\t// if m<s<e, arc(e, s + tau)\n\t\t\t// if s<e<m, arc(e, s + tau)\n\t\t\tif (s > m || m > e) {\n\t\t\t\ts += tau;\n\t\t\t}\n\t\t\tif (s > e) {\n\t\t\t\t_ = e;\n\t\t\t\te = s;\n\t\t\t\ts = _;\n\t\t\t}\n\t\t} else {\n\t\t\t// if e<m<s, arc(e, s)\n\t\t\t// if m<e<s, arc(s, e + tau)\n\t\t\t// if e<s<m, arc(s, e + tau)\n\t\t\tif (e < m && m < s) {\n\t\t\t\t_ = e;\n\t\t\t\te = s;\n\t\t\t\ts = _;\n\t\t\t} else {\n\t\t\t\te += tau;\n\t\t\t}\n\t\t}\n\t\t// assign and done.\n\t\tarc.s = s;\n\t\tarc.e = e;\n\t\tarc.r = r;\n\t\treturn arc;\n\t},\n\n\tnumberSort: function (a, b) {\n\t\treturn a - b;\n\t},\n};\n\n/**\n * Poly Bezier\n * @param {[type]} curves [description]\n */\nclass PolyBezier {\n\tconstructor(curves) {\n\t\tthis.curves = [];\n\t\tthis._3d = false;\n\t\tif (!!curves) {\n\t\t\tthis.curves = curves;\n\t\t\tthis._3d = this.curves[0]._3d;\n\t\t}\n\t}\n\n\tvalueOf() {\n\t\treturn this.toString();\n\t}\n\n\ttoString() {\n\t\treturn (\n\t\t\t\"[\" +\n\t\t\tthis.curves\n\t\t\t\t.map(function (curve) {\n\t\t\t\t\treturn utils.pointsToString(curve.points);\n\t\t\t\t})\n\t\t\t\t.join(\", \") +\n\t\t\t\"]\"\n\t\t);\n\t}\n\n\taddCurve(curve) {\n\t\tthis.curves.push(curve);\n\t\tthis._3d = this._3d || curve._3d;\n\t}\n\n\tlength() {\n\t\treturn this.curves\n\t\t\t.map(function (v) {\n\t\t\t\treturn v.length();\n\t\t\t})\n\t\t\t.reduce(function (a, b) {\n\t\t\t\treturn a + b;\n\t\t\t});\n\t}\n\n\tcurve(idx) {\n\t\treturn this.curves[idx];\n\t}\n\n\tbbox() {\n\t\tconst c = this.curves;\n\t\tvar bbox = c[0].bbox();\n\t\tfor (var i = 1; i < c.length; i++) {\n\t\t\tutils.expandbox(bbox, c[i].bbox());\n\t\t}\n\t\treturn bbox;\n\t}\n\n\toffset(d) {\n\t\tconst offset = [];\n\t\tthis.curves.forEach(function (v) {\n\t\t\toffset.push(...v.offset(d));\n\t\t});\n\t\treturn new PolyBezier(offset);\n\t}\n}\n\n/**\n  A javascript Bezier curve library by Pomax.\n\n  Based on http://pomax.github.io/bezierinfo\n\n  This code is MIT licensed.\n**/\n\n// math-inlining.\nconst { abs: abs$1, min, max, cos: cos$1, sin: sin$1, acos: acos$1, sqrt: sqrt$1 } = Math;\nconst pi$1 = Math.PI;\n\n/**\n * Bezier curve constructor.\n *\n * ...docs pending...\n */\nclass Bezier {\n\tconstructor(coords) {\n\t\tlet args =\n\t\t\tcoords && coords.forEach ? coords : Array.from(arguments).slice();\n\t\tlet coordlen = false;\n\n\t\tif (typeof args[0] === \"object\") {\n\t\t\tcoordlen = args.length;\n\t\t\tconst newargs = [];\n\t\t\targs.forEach(function (point) {\n\t\t\t\t[\"x\", \"y\", \"z\"].forEach(function (d) {\n\t\t\t\t\tif (typeof point[d] !== \"undefined\") {\n\t\t\t\t\t\tnewargs.push(point[d]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\targs = newargs;\n\t\t}\n\n\t\tlet higher = false;\n\t\tconst len = args.length;\n\n\t\tif (coordlen) {\n\t\t\tif (coordlen > 4) {\n\t\t\t\tif (arguments.length !== 1) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\"Only new Bezier(point[]) is accepted for 4th and higher order curves\"\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\thigher = true;\n\t\t\t}\n\t\t} else {\n\t\t\tif (len !== 6 && len !== 8 && len !== 9 && len !== 12) {\n\t\t\t\tif (arguments.length !== 1) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\"Only new Bezier(point[]) is accepted for 4th and higher order curves\"\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst _3d = (this._3d =\n\t\t\t(!higher && (len === 9 || len === 12)) ||\n\t\t\t(coords && coords[0] && typeof coords[0].z !== \"undefined\"));\n\n\t\tconst points = (this.points = []);\n\t\tfor (let idx = 0, step = _3d ? 3 : 2; idx < len; idx += step) {\n\t\t\tvar point = {\n\t\t\t\tx: args[idx],\n\t\t\t\ty: args[idx + 1],\n\t\t\t};\n\t\t\tif (_3d) {\n\t\t\t\tpoint.z = args[idx + 2];\n\t\t\t}\n\t\t\tpoints.push(point);\n\t\t}\n\t\tconst order = (this.order = points.length - 1);\n\n\t\tconst dims = (this.dims = [\"x\", \"y\"]);\n\t\tif (_3d) dims.push(\"z\");\n\t\tthis.dimlen = dims.length;\n\n\t\tconst aligned = utils.align(points, { p1: points[0], p2: points[order] });\n\t\tthis._linear = !aligned.some((p) => abs$1(p.y) > 0.0001);\n\n\t\tthis._lut = [];\n\n\t\tthis._t1 = 0;\n\t\tthis._t2 = 1;\n\t\tthis.update();\n\t}\n\n\tstatic quadraticFromPoints(p1, p2, p3, t) {\n\t\tif (typeof t === \"undefined\") {\n\t\t\tt = 0.5;\n\t\t}\n\t\t// shortcuts, although they're really dumb\n\t\tif (t === 0) {\n\t\t\treturn new Bezier(p2, p2, p3);\n\t\t}\n\t\tif (t === 1) {\n\t\t\treturn new Bezier(p1, p2, p2);\n\t\t}\n\t\t// real fitting.\n\t\tconst abc = Bezier.getABC(2, p1, p2, p3, t);\n\t\treturn new Bezier(p1, abc.A, p3);\n\t}\n\n\tstatic cubicFromPoints(S, B, E, t, d1) {\n\t\tif (typeof t === \"undefined\") {\n\t\t\tt = 0.5;\n\t\t}\n\t\tconst abc = Bezier.getABC(3, S, B, E, t);\n\t\tif (typeof d1 === \"undefined\") {\n\t\t\td1 = utils.dist(B, abc.C);\n\t\t}\n\t\tconst d2 = (d1 * (1 - t)) / t;\n\n\t\tconst selen = utils.dist(S, E),\n\t\t\tlx = (E.x - S.x) / selen,\n\t\t\tly = (E.y - S.y) / selen,\n\t\t\tbx1 = d1 * lx,\n\t\t\tby1 = d1 * ly,\n\t\t\tbx2 = d2 * lx,\n\t\t\tby2 = d2 * ly;\n\t\t// derivation of new hull coordinates\n\t\tconst e1 = { x: B.x - bx1, y: B.y - by1 },\n\t\t\te2 = { x: B.x + bx2, y: B.y + by2 },\n\t\t\tA = abc.A,\n\t\t\tv1 = { x: A.x + (e1.x - A.x) / (1 - t), y: A.y + (e1.y - A.y) / (1 - t) },\n\t\t\tv2 = { x: A.x + (e2.x - A.x) / t, y: A.y + (e2.y - A.y) / t },\n\t\t\tnc1 = { x: S.x + (v1.x - S.x) / t, y: S.y + (v1.y - S.y) / t },\n\t\t\tnc2 = {\n\t\t\t\tx: E.x + (v2.x - E.x) / (1 - t),\n\t\t\t\ty: E.y + (v2.y - E.y) / (1 - t),\n\t\t\t};\n\t\t// ...done\n\t\treturn new Bezier(S, nc1, nc2, E);\n\t}\n\n\tstatic getUtils() {\n\t\treturn utils;\n\t}\n\n\tgetUtils() {\n\t\treturn Bezier.getUtils();\n\t}\n\n\tstatic get PolyBezier() {\n\t\treturn PolyBezier;\n\t}\n\n\tvalueOf() {\n\t\treturn this.toString();\n\t}\n\n\ttoString() {\n\t\treturn utils.pointsToString(this.points);\n\t}\n\n\ttoSVG() {\n\t\tif (this._3d) return false;\n\t\tconst p = this.points,\n\t\t\tx = p[0].x,\n\t\t\ty = p[0].y,\n\t\t\ts = [\"M\", x, y, this.order === 2 ? \"Q\" : \"C\"];\n\t\tfor (let i = 1, last = p.length; i < last; i++) {\n\t\t\ts.push(p[i].x);\n\t\t\ts.push(p[i].y);\n\t\t}\n\t\treturn s.join(\" \");\n\t}\n\n\tsetRatios(ratios) {\n\t\tif (ratios.length !== this.points.length) {\n\t\t\tthrow new Error(\"incorrect number of ratio values\");\n\t\t}\n\t\tthis.ratios = ratios;\n\t\tthis._lut = []; //  invalidate any precomputed LUT\n\t}\n\n\tverify() {\n\t\tconst print = this.coordDigest();\n\t\tif (print !== this._print) {\n\t\t\tthis._print = print;\n\t\t\tthis.update();\n\t\t}\n\t}\n\n\tcoordDigest() {\n\t\treturn this.points\n\t\t\t.map(function (c, pos) {\n\t\t\t\treturn \"\" + pos + c.x + c.y + (c.z ? c.z : 0);\n\t\t\t})\n\t\t\t.join(\"\");\n\t}\n\n\tupdate() {\n\t\t// invalidate any precomputed LUT\n\t\tthis._lut = [];\n\t\tthis.dpoints = utils.derive(this.points, this._3d);\n\t\tthis.computedirection();\n\t}\n\n\tcomputedirection() {\n\t\tconst points = this.points;\n\t\tconst angle = utils.angle(points[0], points[this.order], points[1]);\n\t\tthis.clockwise = angle > 0;\n\t}\n\n\tlength() {\n\t\treturn utils.length(this.derivative.bind(this));\n\t}\n\n\tstatic getABC(order = 2, S, B, E, t = 0.5) {\n\t\tconst u = utils.projectionratio(t, order),\n\t\t\tum = 1 - u,\n\t\t\tC = {\n\t\t\t\tx: u * S.x + um * E.x,\n\t\t\t\ty: u * S.y + um * E.y,\n\t\t\t},\n\t\t\ts = utils.abcratio(t, order),\n\t\t\tA = {\n\t\t\t\tx: B.x + (B.x - C.x) / s,\n\t\t\t\ty: B.y + (B.y - C.y) / s,\n\t\t\t};\n\t\treturn { A, B, C, S, E };\n\t}\n\n\tgetABC(t, B) {\n\t\tB = B || this.get(t);\n\t\tlet S = this.points[0];\n\t\tlet E = this.points[this.order];\n\t\treturn Bezier.getABC(this.order, S, B, E, t);\n\t}\n\n\tgetLUT(steps) {\n\t\tthis.verify();\n\t\tsteps = steps || 100;\n\t\tif (this._lut.length === steps) {\n\t\t\treturn this._lut;\n\t\t}\n\t\tthis._lut = [];\n\t\t// We want a range from 0 to 1 inclusive, so\n\t\t// we decrement and then use <= rather than <:\n\t\tsteps--;\n\t\tfor (let i = 0, p, t; i < steps; i++) {\n\t\t\tt = i / (steps - 1);\n\t\t\tp = this.compute(t);\n\t\t\tp.t = t;\n\t\t\tthis._lut.push(p);\n\t\t}\n\t\treturn this._lut;\n\t}\n\n\ton(point, error) {\n\t\terror = error || 5;\n\t\tconst lut = this.getLUT(),\n\t\t\thits = [];\n\t\tfor (let i = 0, c, t = 0; i < lut.length; i++) {\n\t\t\tc = lut[i];\n\t\t\tif (utils.dist(c, point) < error) {\n\t\t\t\thits.push(c);\n\t\t\t\tt += i / lut.length;\n\t\t\t}\n\t\t}\n\t\tif (!hits.length) return false;\n\t\treturn (t /= hits.length);\n\t}\n\n\tproject(point) {\n\t\t// step 1: coarse check\n\t\tconst LUT = this.getLUT(),\n\t\t\tl = LUT.length - 1,\n\t\t\tclosest = utils.closest(LUT, point),\n\t\t\tmpos = closest.mpos,\n\t\t\tt1 = (mpos - 1) / l,\n\t\t\tt2 = (mpos + 1) / l,\n\t\t\tstep = 0.1 / l;\n\n\t\t// step 2: fine check\n\t\tlet mdist = closest.mdist,\n\t\t\tt = t1,\n\t\t\tft = t,\n\t\t\tp;\n\t\tmdist += 1;\n\t\tfor (let d; t < t2 + step; t += step) {\n\t\t\tp = this.compute(t);\n\t\t\td = utils.dist(point, p);\n\t\t\tif (d < mdist) {\n\t\t\t\tmdist = d;\n\t\t\t\tft = t;\n\t\t\t}\n\t\t}\n\t\tft = ft < 0 ? 0 : ft > 1 ? 1 : ft;\n\t\tp = this.compute(ft);\n\t\tp.t = ft;\n\t\tp.d = mdist;\n\t\treturn p;\n\t}\n\n\tget(t) {\n\t\treturn this.compute(t);\n\t}\n\n\tpoint(idx) {\n\t\treturn this.points[idx];\n\t}\n\n\tcompute(t) {\n\t\tif (this.ratios) {\n\t\t\treturn utils.computeWithRatios(t, this.points, this.ratios, this._3d);\n\t\t}\n\t\treturn utils.compute(t, this.points, this._3d, this.ratios);\n\t}\n\n\traise() {\n\t\tconst p = this.points,\n\t\t\tnp = [p[0]],\n\t\t\tk = p.length;\n\t\tfor (let i = 1, pi, pim; i < k; i++) {\n\t\t\tpi = p[i];\n\t\t\tpim = p[i - 1];\n\t\t\tnp[i] = {\n\t\t\t\tx: ((k - i) / k) * pi.x + (i / k) * pim.x,\n\t\t\t\ty: ((k - i) / k) * pi.y + (i / k) * pim.y,\n\t\t\t};\n\t\t}\n\t\tnp[k] = p[k - 1];\n\t\treturn new Bezier(np);\n\t}\n\n\tderivative(t) {\n\t\treturn utils.compute(t, this.dpoints[0]);\n\t}\n\n\tdderivative(t) {\n\t\treturn utils.compute(t, this.dpoints[1]);\n\t}\n\n\talign() {\n\t\tlet p = this.points;\n\t\treturn new Bezier(utils.align(p, { p1: p[0], p2: p[p.length - 1] }));\n\t}\n\n\tcurvature(t) {\n\t\treturn utils.curvature(t, this.dpoints[0], this.dpoints[1], this._3d);\n\t}\n\n\tinflections() {\n\t\treturn utils.inflections(this.points);\n\t}\n\n\tnormal(t) {\n\t\treturn this._3d ? this.__normal3(t) : this.__normal2(t);\n\t}\n\n\t__normal2(t) {\n\t\tconst d = this.derivative(t);\n\t\tconst q = sqrt$1(d.x * d.x + d.y * d.y);\n\t\treturn { x: -d.y / q, y: d.x / q };\n\t}\n\n\t__normal3(t) {\n\t\t// see http://stackoverflow.com/questions/25453159\n\t\tconst r1 = this.derivative(t),\n\t\t\tr2 = this.derivative(t + 0.01),\n\t\t\tq1 = sqrt$1(r1.x * r1.x + r1.y * r1.y + r1.z * r1.z),\n\t\t\tq2 = sqrt$1(r2.x * r2.x + r2.y * r2.y + r2.z * r2.z);\n\t\tr1.x /= q1;\n\t\tr1.y /= q1;\n\t\tr1.z /= q1;\n\t\tr2.x /= q2;\n\t\tr2.y /= q2;\n\t\tr2.z /= q2;\n\t\t// cross product\n\t\tconst c = {\n\t\t\tx: r2.y * r1.z - r2.z * r1.y,\n\t\t\ty: r2.z * r1.x - r2.x * r1.z,\n\t\t\tz: r2.x * r1.y - r2.y * r1.x,\n\t\t};\n\t\tconst m = sqrt$1(c.x * c.x + c.y * c.y + c.z * c.z);\n\t\tc.x /= m;\n\t\tc.y /= m;\n\t\tc.z /= m;\n\t\t// rotation matrix\n\t\tconst R = [\n\t\t\tc.x * c.x,\n\t\t\tc.x * c.y - c.z,\n\t\t\tc.x * c.z + c.y,\n\t\t\tc.x * c.y + c.z,\n\t\t\tc.y * c.y,\n\t\t\tc.y * c.z - c.x,\n\t\t\tc.x * c.z - c.y,\n\t\t\tc.y * c.z + c.x,\n\t\t\tc.z * c.z,\n\t\t];\n\t\t// normal vector:\n\t\tconst n = {\n\t\t\tx: R[0] * r1.x + R[1] * r1.y + R[2] * r1.z,\n\t\t\ty: R[3] * r1.x + R[4] * r1.y + R[5] * r1.z,\n\t\t\tz: R[6] * r1.x + R[7] * r1.y + R[8] * r1.z,\n\t\t};\n\t\treturn n;\n\t}\n\n\thull(t) {\n\t\tlet p = this.points,\n\t\t\t_p = [],\n\t\t\tq = [],\n\t\t\tidx = 0;\n\t\tq[idx++] = p[0];\n\t\tq[idx++] = p[1];\n\t\tq[idx++] = p[2];\n\t\tif (this.order === 3) {\n\t\t\tq[idx++] = p[3];\n\t\t}\n\t\t// we lerp between all points at each iteration, until we have 1 point left.\n\t\twhile (p.length > 1) {\n\t\t\t_p = [];\n\t\t\tfor (let i = 0, pt, l = p.length - 1; i < l; i++) {\n\t\t\t\tpt = utils.lerp(t, p[i], p[i + 1]);\n\t\t\t\tq[idx++] = pt;\n\t\t\t\t_p.push(pt);\n\t\t\t}\n\t\t\tp = _p;\n\t\t}\n\t\treturn q;\n\t}\n\n\tsplit(t1, t2) {\n\t\t// shortcuts\n\t\tif (t1 === 0 && !!t2) {\n\t\t\treturn this.split(t2).left;\n\t\t}\n\t\tif (t2 === 1) {\n\t\t\treturn this.split(t1).right;\n\t\t}\n\n\t\t// no shortcut: use \"de Casteljau\" iteration.\n\t\tconst q = this.hull(t1);\n\t\tconst result = {\n\t\t\tleft:\n\t\t\t\tthis.order === 2\n\t\t\t\t\t? new Bezier([q[0], q[3], q[5]])\n\t\t\t\t\t: new Bezier([q[0], q[4], q[7], q[9]]),\n\t\t\tright:\n\t\t\t\tthis.order === 2\n\t\t\t\t\t? new Bezier([q[5], q[4], q[2]])\n\t\t\t\t\t: new Bezier([q[9], q[8], q[6], q[3]]),\n\t\t\tspan: q,\n\t\t};\n\n\t\t// make sure we bind _t1/_t2 information!\n\t\tresult.left._t1 = utils.map(0, 0, 1, this._t1, this._t2);\n\t\tresult.left._t2 = utils.map(t1, 0, 1, this._t1, this._t2);\n\t\tresult.right._t1 = utils.map(t1, 0, 1, this._t1, this._t2);\n\t\tresult.right._t2 = utils.map(1, 0, 1, this._t1, this._t2);\n\n\t\t// if we have no t2, we're done\n\t\tif (!t2) {\n\t\t\treturn result;\n\t\t}\n\n\t\t// if we have a t2, split again:\n\t\tt2 = utils.map(t2, t1, 1, 0, 1);\n\t\treturn result.right.split(t2).left;\n\t}\n\n\textrema() {\n\t\tconst result = {};\n\t\tlet roots = [];\n\n\t\tthis.dims.forEach(\n\t\t\tfunction (dim) {\n\t\t\t\tlet mfn = function (v) {\n\t\t\t\t\treturn v[dim];\n\t\t\t\t};\n\t\t\t\tlet p = this.dpoints[0].map(mfn);\n\t\t\t\tresult[dim] = utils.droots(p);\n\t\t\t\tif (this.order === 3) {\n\t\t\t\t\tp = this.dpoints[1].map(mfn);\n\t\t\t\t\tresult[dim] = result[dim].concat(utils.droots(p));\n\t\t\t\t}\n\t\t\t\tresult[dim] = result[dim].filter(function (t) {\n\t\t\t\t\treturn t >= 0 && t <= 1;\n\t\t\t\t});\n\t\t\t\troots = roots.concat(result[dim].sort(utils.numberSort));\n\t\t\t}.bind(this)\n\t\t);\n\n\t\tresult.values = roots.sort(utils.numberSort).filter(function (v, idx) {\n\t\t\treturn roots.indexOf(v) === idx;\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tbbox() {\n\t\tconst extrema = this.extrema(),\n\t\t\tresult = {};\n\t\tthis.dims.forEach(\n\t\t\tfunction (d) {\n\t\t\t\tresult[d] = utils.getminmax(this, d, extrema[d]);\n\t\t\t}.bind(this)\n\t\t);\n\t\treturn result;\n\t}\n\n\toverlaps(curve) {\n\t\tconst lbbox = this.bbox(),\n\t\t\ttbbox = curve.bbox();\n\t\treturn utils.bboxoverlap(lbbox, tbbox);\n\t}\n\n\toffset(t, d) {\n\t\tif (typeof d !== \"undefined\") {\n\t\t\tconst c = this.get(t),\n\t\t\t\tn = this.normal(t);\n\t\t\tconst ret = {\n\t\t\t\tc: c,\n\t\t\t\tn: n,\n\t\t\t\tx: c.x + n.x * d,\n\t\t\t\ty: c.y + n.y * d,\n\t\t\t};\n\t\t\tif (this._3d) {\n\t\t\t\tret.z = c.z + n.z * d;\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\t\tif (this._linear) {\n\t\t\tconst nv = this.normal(0),\n\t\t\t\tcoords = this.points.map(function (p) {\n\t\t\t\t\tconst ret = {\n\t\t\t\t\t\tx: p.x + t * nv.x,\n\t\t\t\t\t\ty: p.y + t * nv.y,\n\t\t\t\t\t};\n\t\t\t\t\tif (p.z && nv.z) {\n\t\t\t\t\t\tret.z = p.z + t * nv.z;\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\t});\n\t\t\treturn [new Bezier(coords)];\n\t\t}\n\t\treturn this.reduce().map(function (s) {\n\t\t\tif (s._linear) {\n\t\t\t\treturn s.offset(t)[0];\n\t\t\t}\n\t\t\treturn s.scale(t);\n\t\t});\n\t}\n\n\tsimple() {\n\t\tif (this.order === 3) {\n\t\t\tconst a1 = utils.angle(this.points[0], this.points[3], this.points[1]);\n\t\t\tconst a2 = utils.angle(this.points[0], this.points[3], this.points[2]);\n\t\t\tif ((a1 > 0 && a2 < 0) || (a1 < 0 && a2 > 0)) return false;\n\t\t}\n\t\tconst n1 = this.normal(0);\n\t\tconst n2 = this.normal(1);\n\t\tlet s = n1.x * n2.x + n1.y * n2.y;\n\t\tif (this._3d) {\n\t\t\ts += n1.z * n2.z;\n\t\t}\n\t\treturn abs$1(acos$1(s)) < pi$1 / 3;\n\t}\n\n\treduce() {\n\t\t// TODO: examine these var types in more detail...\n\t\tlet i,\n\t\t\tt1 = 0,\n\t\t\tt2 = 0,\n\t\t\tstep = 0.01,\n\t\t\tsegment,\n\t\t\tpass1 = [],\n\t\t\tpass2 = [];\n\t\t// first pass: split on extrema\n\t\tlet extrema = this.extrema().values;\n\t\tif (extrema.indexOf(0) === -1) {\n\t\t\textrema = [0].concat(extrema);\n\t\t}\n\t\tif (extrema.indexOf(1) === -1) {\n\t\t\textrema.push(1);\n\t\t}\n\n\t\tfor (t1 = extrema[0], i = 1; i < extrema.length; i++) {\n\t\t\tt2 = extrema[i];\n\t\t\tsegment = this.split(t1, t2);\n\t\t\tsegment._t1 = t1;\n\t\t\tsegment._t2 = t2;\n\t\t\tpass1.push(segment);\n\t\t\tt1 = t2;\n\t\t}\n\n\t\t// second pass: further reduce these segments to simple segments\n\t\tpass1.forEach(function (p1) {\n\t\t\tt1 = 0;\n\t\t\tt2 = 0;\n\t\t\twhile (t2 <= 1) {\n\t\t\t\tfor (t2 = t1 + step; t2 <= 1 + step; t2 += step) {\n\t\t\t\t\tsegment = p1.split(t1, t2);\n\t\t\t\t\tif (!segment.simple()) {\n\t\t\t\t\t\tt2 -= step;\n\t\t\t\t\t\tif (abs$1(t1 - t2) < step) {\n\t\t\t\t\t\t\t// we can never form a reduction\n\t\t\t\t\t\t\treturn [];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsegment = p1.split(t1, t2);\n\t\t\t\t\t\tsegment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);\n\t\t\t\t\t\tsegment._t2 = utils.map(t2, 0, 1, p1._t1, p1._t2);\n\t\t\t\t\t\tpass2.push(segment);\n\t\t\t\t\t\tt1 = t2;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (t1 < 1) {\n\t\t\t\tsegment = p1.split(t1, 1);\n\t\t\t\tsegment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);\n\t\t\t\tsegment._t2 = p1._t2;\n\t\t\t\tpass2.push(segment);\n\t\t\t}\n\t\t});\n\t\treturn pass2;\n\t}\n\n\tscale(d) {\n\t\tconst order = this.order;\n\t\tlet distanceFn = false;\n\t\tif (typeof d === \"function\") {\n\t\t\tdistanceFn = d;\n\t\t}\n\t\tif (distanceFn && order === 2) {\n\t\t\treturn this.raise().scale(distanceFn);\n\t\t}\n\n\t\t// TODO: add special handling for degenerate (=linear) curves.\n\t\tconst clockwise = this.clockwise;\n\t\tconst r1 = distanceFn ? distanceFn(0) : d;\n\t\tconst r2 = distanceFn ? distanceFn(1) : d;\n\t\tconst v = [this.offset(0, 10), this.offset(1, 10)];\n\t\tconst points = this.points;\n\t\tconst np = [];\n\t\tconst o = utils.lli4(v[0], v[0].c, v[1], v[1].c);\n\n\t\tif (!o) {\n\t\t\tthrow new Error(\"cannot scale this curve. Try reducing it first.\");\n\t\t}\n\t\t// move all points by distance 'd' wrt the origin 'o'\n\n\t\t// move end points by fixed distance along normal.\n\t\t[0, 1].forEach(function (t) {\n\t\t\tconst p = (np[t * order] = utils.copy(points[t * order]));\n\t\t\tp.x += (t ? r2 : r1) * v[t].n.x;\n\t\t\tp.y += (t ? r2 : r1) * v[t].n.y;\n\t\t});\n\n\t\tif (!distanceFn) {\n\t\t\t// move control points to lie on the intersection of the offset\n\t\t\t// derivative vector, and the origin-through-control vector\n\t\t\t[0, 1].forEach((t) => {\n\t\t\t\tif (order === 2 && !!t) return;\n\t\t\t\tconst p = np[t * order];\n\t\t\t\tconst d = this.derivative(t);\n\t\t\t\tconst p2 = { x: p.x + d.x, y: p.y + d.y };\n\t\t\t\tnp[t + 1] = utils.lli4(p, p2, o, points[t + 1]);\n\t\t\t});\n\t\t\treturn new Bezier(np);\n\t\t}\n\n\t\t// move control points by \"however much necessary to\n\t\t// ensure the correct tangent to endpoint\".\n\t\t[0, 1].forEach(function (t) {\n\t\t\tif (order === 2 && !!t) return;\n\t\t\tvar p = points[t + 1];\n\t\t\tvar ov = {\n\t\t\t\tx: p.x - o.x,\n\t\t\t\ty: p.y - o.y,\n\t\t\t};\n\t\t\tvar rc = distanceFn ? distanceFn((t + 1) / order) : d;\n\t\t\tif (distanceFn && !clockwise) rc = -rc;\n\t\t\tvar m = sqrt$1(ov.x * ov.x + ov.y * ov.y);\n\t\t\tov.x /= m;\n\t\t\tov.y /= m;\n\t\t\tnp[t + 1] = {\n\t\t\t\tx: p.x + rc * ov.x,\n\t\t\t\ty: p.y + rc * ov.y,\n\t\t\t};\n\t\t});\n\t\treturn new Bezier(np);\n\t}\n\n\toutline(d1, d2, d3, d4) {\n\t\td2 = typeof d2 === \"undefined\" ? d1 : d2;\n\t\tconst reduced = this.reduce(),\n\t\t\tlen = reduced.length,\n\t\t\tfcurves = [];\n\n\t\tlet bcurves = [],\n\t\t\tp,\n\t\t\talen = 0,\n\t\t\ttlen = this.length();\n\n\t\tconst graduated = typeof d3 !== \"undefined\" && typeof d4 !== \"undefined\";\n\n\t\tfunction linearDistanceFunction(s, e, tlen, alen, slen) {\n\t\t\treturn function (v) {\n\t\t\t\tconst f1 = alen / tlen,\n\t\t\t\t\tf2 = (alen + slen) / tlen,\n\t\t\t\t\td = e - s;\n\t\t\t\treturn utils.map(v, 0, 1, s + f1 * d, s + f2 * d);\n\t\t\t};\n\t\t}\n\n\t\t// form curve oulines\n\t\treduced.forEach(function (segment) {\n\t\t\tconst slen = segment.length();\n\t\t\tif (graduated) {\n\t\t\t\tfcurves.push(\n\t\t\t\t\tsegment.scale(linearDistanceFunction(d1, d3, tlen, alen, slen))\n\t\t\t\t);\n\t\t\t\tbcurves.push(\n\t\t\t\t\tsegment.scale(linearDistanceFunction(-d2, -d4, tlen, alen, slen))\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tfcurves.push(segment.scale(d1));\n\t\t\t\tbcurves.push(segment.scale(-d2));\n\t\t\t}\n\t\t\talen += slen;\n\t\t});\n\n\t\t// reverse the \"return\" outline\n\t\tbcurves = bcurves\n\t\t\t.map(function (s) {\n\t\t\t\tp = s.points;\n\t\t\t\tif (p[3]) {\n\t\t\t\t\ts.points = [p[3], p[2], p[1], p[0]];\n\t\t\t\t} else {\n\t\t\t\t\ts.points = [p[2], p[1], p[0]];\n\t\t\t\t}\n\t\t\t\treturn s;\n\t\t\t})\n\t\t\t.reverse();\n\n\t\t// form the endcaps as lines\n\t\tconst fs = fcurves[0].points[0],\n\t\t\tfe = fcurves[len - 1].points[fcurves[len - 1].points.length - 1],\n\t\t\tbs = bcurves[len - 1].points[bcurves[len - 1].points.length - 1],\n\t\t\tbe = bcurves[0].points[0],\n\t\t\tls = utils.makeline(bs, fs),\n\t\t\tle = utils.makeline(fe, be),\n\t\t\tsegments = [ls].concat(fcurves).concat([le]).concat(bcurves);\n\n\t\treturn new PolyBezier(segments);\n\t}\n\n\toutlineshapes(d1, d2, curveIntersectionThreshold) {\n\t\td2 = d2 || d1;\n\t\tconst outline = this.outline(d1, d2).curves;\n\t\tconst shapes = [];\n\t\tfor (let i = 1, len = outline.length; i < len / 2; i++) {\n\t\t\tconst shape = utils.makeshape(\n\t\t\t\toutline[i],\n\t\t\t\toutline[len - i],\n\t\t\t\tcurveIntersectionThreshold\n\t\t\t);\n\t\t\tshape.startcap.virtual = i > 1;\n\t\t\tshape.endcap.virtual = i < len / 2 - 1;\n\t\t\tshapes.push(shape);\n\t\t}\n\t\treturn shapes;\n\t}\n\n\tintersects(curve, curveIntersectionThreshold) {\n\t\tif (!curve) return this.selfintersects(curveIntersectionThreshold);\n\t\tif (curve.p1 && curve.p2) {\n\t\t\treturn this.lineIntersects(curve);\n\t\t}\n\t\tif (curve instanceof Bezier) {\n\t\t\tcurve = curve.reduce();\n\t\t}\n\t\treturn this.curveintersects(\n\t\t\tthis.reduce(),\n\t\t\tcurve,\n\t\t\tcurveIntersectionThreshold\n\t\t);\n\t}\n\n\tlineIntersects(line) {\n\t\tconst mx = min(line.p1.x, line.p2.x),\n\t\t\tmy = min(line.p1.y, line.p2.y),\n\t\t\tMX = max(line.p1.x, line.p2.x),\n\t\t\tMY = max(line.p1.y, line.p2.y);\n\t\treturn utils.roots(this.points, line).filter((t) => {\n\t\t\tvar p = this.get(t);\n\t\t\treturn utils.between(p.x, mx, MX) && utils.between(p.y, my, MY);\n\t\t});\n\t}\n\n\tselfintersects(curveIntersectionThreshold) {\n\t\t// \"simple\" curves cannot intersect with their direct\n\t\t// neighbour, so for each segment X we check whether\n\t\t// it intersects [0:x-2][x+2:last].\n\n\t\tconst reduced = this.reduce(),\n\t\t\tlen = reduced.length - 2,\n\t\t\tresults = [];\n\n\t\tfor (let i = 0, result, left, right; i < len; i++) {\n\t\t\tleft = reduced.slice(i, i + 1);\n\t\t\tright = reduced.slice(i + 2);\n\t\t\tresult = this.curveintersects(left, right, curveIntersectionThreshold);\n\t\t\tresults.push(...result);\n\t\t}\n\t\treturn results;\n\t}\n\n\tcurveintersects(c1, c2, curveIntersectionThreshold) {\n\t\tconst pairs = [];\n\t\t// step 1: pair off any overlapping segments\n\t\tc1.forEach(function (l) {\n\t\t\tc2.forEach(function (r) {\n\t\t\t\tif (l.overlaps(r)) {\n\t\t\t\t\tpairs.push({ left: l, right: r });\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\t// step 2: for each pairing, run through the convergence algorithm.\n\t\tlet intersections = [];\n\t\tpairs.forEach(function (pair) {\n\t\t\tconst result = utils.pairiteration(\n\t\t\t\tpair.left,\n\t\t\t\tpair.right,\n\t\t\t\tcurveIntersectionThreshold\n\t\t\t);\n\t\t\tif (result.length > 0) {\n\t\t\t\tintersections = intersections.concat(result);\n\t\t\t}\n\t\t});\n\t\treturn intersections;\n\t}\n\n\tarcs(errorThreshold) {\n\t\terrorThreshold = errorThreshold || 0.5;\n\t\treturn this._iterate(errorThreshold, []);\n\t}\n\n\t_error(pc, np1, s, e) {\n\t\tconst q = (e - s) / 4,\n\t\t\tc1 = this.get(s + q),\n\t\t\tc2 = this.get(e - q),\n\t\t\tref = utils.dist(pc, np1),\n\t\t\td1 = utils.dist(pc, c1),\n\t\t\td2 = utils.dist(pc, c2);\n\t\treturn abs$1(d1 - ref) + abs$1(d2 - ref);\n\t}\n\n\t_iterate(errorThreshold, circles) {\n\t\tlet t_s = 0,\n\t\t\tt_e = 1,\n\t\t\tsafety;\n\t\t// we do a binary search to find the \"good `t` closest to no-longer-good\"\n\t\tdo {\n\t\t\tsafety = 0;\n\n\t\t\t// step 1: start with the maximum possible arc\n\t\t\tt_e = 1;\n\n\t\t\t// points:\n\t\t\tlet np1 = this.get(t_s),\n\t\t\t\tnp2,\n\t\t\t\tnp3,\n\t\t\t\tarc,\n\t\t\t\tprev_arc;\n\n\t\t\t// booleans:\n\t\t\tlet curr_good = false,\n\t\t\t\tprev_good = false,\n\t\t\t\tdone;\n\n\t\t\t// numbers:\n\t\t\tlet t_m = t_e,\n\t\t\t\tprev_e = 1;\n\n\t\t\t// step 2: find the best possible arc\n\t\t\tdo {\n\t\t\t\tprev_good = curr_good;\n\t\t\t\tprev_arc = arc;\n\t\t\t\tt_m = (t_s + t_e) / 2;\n\n\t\t\t\tnp2 = this.get(t_m);\n\t\t\t\tnp3 = this.get(t_e);\n\n\t\t\t\tarc = utils.getccenter(np1, np2, np3);\n\n\t\t\t\t//also save the t values\n\t\t\t\tarc.interval = {\n\t\t\t\t\tstart: t_s,\n\t\t\t\t\tend: t_e,\n\t\t\t\t};\n\n\t\t\t\tlet error = this._error(arc, np1, t_s, t_e);\n\t\t\t\tcurr_good = error <= errorThreshold;\n\n\t\t\t\tdone = prev_good && !curr_good;\n\t\t\t\tif (!done) prev_e = t_e;\n\n\t\t\t\t// this arc is fine: we can move 'e' up to see if we can find a wider arc\n\t\t\t\tif (curr_good) {\n\t\t\t\t\t// if e is already at max, then we're done for this arc.\n\t\t\t\t\tif (t_e >= 1) {\n\t\t\t\t\t\t// make sure we cap at t=1\n\t\t\t\t\t\tarc.interval.end = prev_e = 1;\n\t\t\t\t\t\tprev_arc = arc;\n\t\t\t\t\t\t// if we capped the arc segment to t=1 we also need to make sure that\n\t\t\t\t\t\t// the arc's end angle is correct with respect to the bezier end point.\n\t\t\t\t\t\tif (t_e > 1) {\n\t\t\t\t\t\t\tlet d = {\n\t\t\t\t\t\t\t\tx: arc.x + arc.r * cos$1(arc.e),\n\t\t\t\t\t\t\t\ty: arc.y + arc.r * sin$1(arc.e),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tarc.e += utils.angle({ x: arc.x, y: arc.y }, d, this.get(1));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t// if not, move it up by half the iteration distance\n\t\t\t\t\tt_e = t_e + (t_e - t_s) / 2;\n\t\t\t\t} else {\n\t\t\t\t\t// this is a bad arc: we need to move 'e' down to find a good arc\n\t\t\t\t\tt_e = t_m;\n\t\t\t\t}\n\t\t\t} while (!done && safety++ < 100);\n\n\t\t\tif (safety >= 100) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// console.log(\"L835: [F] arc found\", t_s, prev_e, prev_arc.x, prev_arc.y, prev_arc.s, prev_arc.e);\n\n\t\t\tprev_arc = prev_arc ? prev_arc : arc;\n\t\t\tcircles.push(prev_arc);\n\t\t\tt_s = prev_e;\n\t\t} while (t_e < 1);\n\t\treturn circles;\n\t}\n}\n\nexport { Bezier };","\ndeclare global {\n\tinterface LenientGlobalVariableTypes {\n\t\tgame: never;\n\t\tcanvas: never;\n\t}\n\tinterface String {\n\t\t/** Localizes the string via the global `game.i18n.localize()` function. */\n\t\tlocalize(): string\n\t}\n\ttype AnyFunction = (...args: any) => any;\n}\n\nexport default class SETTINGS {\n\tstatic MOD_NAME: string;\n\tstatic init(moduleName: string) {\n\t\tthis.MOD_NAME = moduleName;\n\t\tif (!String.prototype.localize) {\n\t\t\tString.prototype.localize = function () {\n\t\t\t\treturn game.i18n.localize(this.valueOf());\n\t\t\t};\n\t\t}\n\t}\n\tstatic register<T>(key: string, config: ClientSettings.PartialSettingConfig<T>) { game.settings.register(SETTINGS.MOD_NAME, key, config); }\n\tstatic registerMenu(key: string, config: ClientSettings.PartialSettingSubmenuConfig) { game.settings.registerMenu(SETTINGS.MOD_NAME, key, config); }\n\tstatic get<T>(key: string): T { return <T>game.settings.get(SETTINGS.MOD_NAME, key); }\n\tstatic async set<T>(key: string, value: T): Promise<T> { return await game.settings.set(SETTINGS.MOD_NAME, key, value); }\n\tstatic default<T>(key: string): T { return <T>game.settings.settings.get(SETTINGS.MOD_NAME + '.' + key).default; }\n\t/** helper for referencing a Typed constructor for the `type` field of a setting { type: SETTINGS.typeOf<MyClass>() } */\n\tstatic typeOf<T>(): ConstructorOf<T> { return Object as any; }\n}\n","import { BezierTool, ToolMode } from './tools/BezierTool';\nimport CircleTool from './tools/CircleTool';\nimport RectangleTool from './tools/RectangleTool';\nimport CubicTool from './tools/CubicTool';\nimport QuadTool from './tools/QuadTool';\nimport { InputHandler } from './tools/ToolInputHandler';\nimport PointMapper from './tools/PointMapper';\nimport SETTINGS from \"../../common/Settings\";\nimport { WallData } from '@league-of-foundry-developers/foundry-vtt-types/src/foundry/common/data/data.mjs';\n\ndeclare global {\n\tnamespace PIXI {\n\t\tinterface InteractionData {\n\t\t\torigin: PIXI.Point;\n\t\t\tdestination: PIXI.Point;\n\t\t}\n\t}\n}\n\nexport enum Mode {\n\tNone,\n\tCube,\n\tQuad,\n\tCirc,\n\tRect\n}\n\nconst MODE_NAMES: { [key: number]: string } = {};\nMODE_NAMES[Mode.None] = 'undefined';\nMODE_NAMES[Mode.Cube] = 'beziercube';\nMODE_NAMES[Mode.Quad] = 'bezierquad';\nMODE_NAMES[Mode.Circ] = 'beziercirc';\nMODE_NAMES[Mode.Rect] = 'bezierrect';\nclass WallPool {\n\tstatic readonly walls: Wall[] = [];\n\tstatic acquire(wallData: WallData): Wall {\n\t\tconst result = this.walls.pop() ?? new Wall(new WallDocument(wallData, { parent: canvas.scene }));\n\t\twallData = deepClone(wallData);\n\t\tdelete wallData._id;\n\t\tresult.document = <WallDocument><any>mergeObject(result.document, wallData);\n\t\treturn result;\n\t}\n\tstatic release(wall: Wall) { this.walls.push(wall); }\n}\n\nexport class CurvyWallToolManager {\n\tstatic readonly PREF_DROP_KEY = 'drop-key';\n\tprivate static _instance: CurvyWallToolManager;\n\tprivate _mode = Mode.None;\n\tprivate wallsLayer: WallsLayer;\n\tprivate walls: Wall[] = [];\n\tprivate currentHandler?: InputHandler = null;\n\tprivate _activeTool?: BezierTool = null;\n\tprivate _modeListener: (mode: Mode, toolMode: ToolMode | null) => void = null;\n\tprivate _ignoreNextToolModeChange = false;\n\tprivate _previousToolData = new Map<Mode, object>([\n\t\t[Mode.Cube, { l1: [-100, 0], l2: [100, 0], c1: [-100, -132], c2: [100, -132] }],\n\t\t[Mode.Quad, { l1: [-100, 0], l2: [100, 0], c: [0, -132] }],\n\t\t[Mode.Circ, { l1: [-100, -100], l2: [100, 100], a1: 0, a2: 0 }],\n\t\t[Mode.Rect, { l1: [-100, -100], l2: [100, 100], t: 1, r: 1, b: 1, l: 1 }],\n\t]);\n\tprivate _pointMapper = new PointMapper();\n\n\tget segments(): number { return this._activeTool.segments; }\n\tset segments(value: number) {\n\t\tthis._activeTool.segments = Math.clamped(value, 1, 64);\n\t\tif (this.mode != Mode.None)\n\t\t\tthis.render();\n\t}\n\tget activeTool(): BezierTool | null { return this._activeTool; }\n\n\tprivate _inPointMapMode = false;\n\tget currentlyMappingPoints(): boolean { return this._inPointMapMode; }\n\n\t// eslint-disable-next-line @typescript-eslint/no-empty-function\n\tprivate constructor() { }\n\tpublic static get instance(): CurvyWallToolManager {\n\t\treturn this._instance || (this._instance = new this());\n\t}\n\n\tget mode(): Mode { return this._mode; }\n\tset mode(value: Mode) {\n\t\tif (this._mode === value) return;\n\t\tthis._ignoreNextToolModeChange = this.activeTool?.mode !== ToolMode.NotPlaced;\n\t\tthis.clearTool();\n\t\tif (this._inPointMapMode)\n\t\t\tthis.togglePointMapping();\n\t\tthis._mode = value;\n\t\tif (this._inPointMapMode)\n\t\t\tthis._pointMapper.points = [];\n\t\tswitch (value) {\n\t\t\tcase Mode.None:\n\t\t\t\tthis._activeTool = null;\n\t\t\t\tbreak;\n\t\t\tcase Mode.Cube:\n\t\t\t\tthis._activeTool = new CubicTool();\n\t\t\t\tbreak;\n\t\t\tcase Mode.Quad:\n\t\t\t\tthis._activeTool = new QuadTool();\n\t\t\t\tbreak;\n\t\t\tcase Mode.Circ:\n\t\t\t\tthis._activeTool = new CircleTool();\n\t\t\t\tbreak;\n\t\t\tcase Mode.Rect:\n\t\t\t\tthis._activeTool = new RectangleTool();\n\t\t\t\tbreak;\n\t\t}\n\t\tthis._activeTool?.setModeListener((toolMode: ToolMode) => {\n\t\t\tif (this._ignoreNextToolModeChange) {\n\t\t\t\tthis._ignoreNextToolModeChange = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this._modeListener !== null)\n\t\t\t\tthis._modeListener(this._mode, toolMode);\n\t\t});\n\t\tif (this._modeListener !== null)\n\t\t\tthis._modeListener(value, this.activeTool?.mode);\n\t}\n\tsetModeListener(listener: (mode: Mode, toolMode: ToolMode | null) => void) {\n\t\tthis._modeListener = listener;\n\t}\n\n\tasync apply() {\n\t\tif (!this.activeTool || this.activeTool.mode != ToolMode.Placed) return;\n\t\tawait game.scenes.viewed.createEmbeddedDocuments(\"Wall\", this._getCurrentWallData());\n\t\tthis.clearTool();\n\t}\n\n\tclearTool() {\n\t\tif (!this._activeTool) {\n\t\t\tthis._ignoreNextToolModeChange = false;\n\t\t\treturn;\n\t\t}\n\t\tthis._activeTool.clearTool();\n\t\tthis.walls = [];\n\t\tthis.wallsLayer.preview.removeChildren();\n\t\tthis.render();\n\t}\n\n\ttogglePointMapping() {\n\t\tthis._inPointMapMode = !this._inPointMapMode;\n\t\tif (this._inPointMapMode) {\n\t\t\tthis._pointMapper.points = [];\n\t\t\tui.notifications.info(game.i18n.localize(this._pointMapper.getTooltipMessage()), { permanent: true });\n\t\t} else {\n\t\t\tui.notifications.active.forEach(x => x.remove());\n\t\t\tui.notifications.active = [];\n\t\t}\n\t\tthis.render();\n\t}\n\tget canApplyPointMapping(): boolean {\n\t\treturn this._pointMapper.hasEnoughData();\n\t}\n\tapplyPointMapping() {\n\t\tif (!this._inPointMapMode) return;\n\t\tthis._inPointMapMode = false;\n\t\tthis._pointMapper.bindData(this._activeTool);\n\t\t(<any>this._activeTool).setMode(ToolMode.Placed);\n\t\tui.notifications.active.forEach(x => x.remove());\n\t\tui.notifications.active = [];\n\t\tthis.render();\n\t}\n\n\tstatic _onClickLeft(wrapped: AnyFunction, event: PIXI.InteractionEvent) {\n\t\tconst self = CurvyWallToolManager.instance;\n\t\tif (self._inPointMapMode) {\n\t\t\tif (!self._pointMapper.checkPointForClick(event.data.origin, event))\n\t\t\t\treturn;\n\t\t\tif (self._pointMapper.hasEnoughData())\n\t\t\t\tself._modeListener(self.mode, ToolMode.NotPlaced);\n\t\t\tself.render();\n\t\t\treturn;\n\t\t}\n\n\t\tif (self.mode == Mode.None || self.activeTool == null) return wrapped(event);\n\t\tif (self.activeTool.checkPointForClick(event.data.origin, event)) {\n\t\t\tself.render();\n\t\t\treturn;\n\t\t}\n\t\tif (event.data.originalEvent.ctrlKey) {\n\t\t\tself.activeTool.startedWithCtrlHeld = true;\n\t\t}\n\t\tif (SETTINGS.get(CurvyWallToolManager.PREF_DROP_KEY) === 'ctrl' && !event.data.originalEvent.ctrlKey) return;\n\t\tif (SETTINGS.get(CurvyWallToolManager.PREF_DROP_KEY) === 'alt' && !event.data.originalEvent.altKey) return;\n\t\tself.activeTool.placeTool(event.data.origin, self._previousToolData.get(self._mode));\n\t\tself.render();\n\t}\n\tstatic _onDragLeftStart(wrapped: AnyFunction, event: PIXI.InteractionEvent) {\n\t\tconst self = CurvyWallToolManager.instance;\n\t\tif (self._inPointMapMode) {\n\t\t\tself.currentHandler = self._pointMapper.checkPointForDrag(event.data.origin);\n\t\t\tif (self.currentHandler == null) return;\n\t\t\tself.currentHandler.start(event.data.origin, event.data.destination, event);\n\t\t\tself.render();\n\t\t\treturn;\n\t\t}\n\t\tif (self.mode == Mode.None || self.activeTool == null) return wrapped(event);\n\t\tself.currentHandler = self.activeTool.checkPointForDrag(event.data.origin);\n\t\tif (self.currentHandler == null) return;\n\t\tself.currentHandler.start(event.data.origin, event.data.destination, event);\n\t\tself.render();\n\t}\n\tstatic _onDragLeftMove(wrapped: AnyFunction, event: PIXI.InteractionEvent) {\n\t\tconst self = CurvyWallToolManager.instance;\n\t\tif (self.mode == Mode.None || !self.currentHandler) return wrapped(event);\n\t\tif (self.activeTool.startedWithCtrlHeld && !event.data.originalEvent.ctrlKey) {\n\t\t\tself.activeTool.startedWithCtrlHeld = false;\n\t\t}\n\t\tself.currentHandler.move(event.data.origin, event.data.destination, event);\n\t\tself.render();\n\t}\n\tstatic _onDragLeftDrop(wrapped: AnyFunction, event: PIXI.InteractionEvent) {\n\t\tconst self = CurvyWallToolManager.instance;\n\t\tif (self.mode == Mode.None || !self.currentHandler) return wrapped(event);\n\t\tself.activeTool.startedWithCtrlHeld = false;\n\t\tself.currentHandler.stop(event.data.origin, event.data.destination, event);\n\t\tself.currentHandler = null;\n\t\tself.render();\n\t}\n\tstatic _onDragLeftCancel(wrapped: AnyFunction, event: PIXI.InteractionEvent) {\n\t\tconst self = CurvyWallToolManager.instance;\n\t\tif (self.mode == Mode.None) return wrapped(event);\n\t\telse if (!self.currentHandler) return;\n\t\tself.currentHandler.cancel();\n\t\tself.currentHandler = null;\n\t\tself.render();\n\t}\n\tstatic _onClickRight(wrapped: AnyFunction, event: PIXI.InteractionEvent) {\n\t\tconst self = CurvyWallToolManager.instance;\n\t\tif (!event.data.originalEvent.ctrlKey || self.mode == Mode.None) return wrapped(event);\n\t\tself.mode = Mode.None;\n\t\tself.render();\n\t}\n\n\tprivate graphicsContext = new PIXI.Graphics(null);\n\trender() {\n\t\tthis.wallsLayer.preview.removeChildren();\n\t\tif (this.currentlyMappingPoints) {\n\t\t\tthis._pointMapper.clearContext(this.graphicsContext);\n\t\t\tthis.graphicsContext.clear();\n\t\t\tthis.graphicsContext.removeChildren();\n\t\t\tthis.wallsLayer.preview.addChild(this.graphicsContext);\n\t\t\tthis._pointMapper.drawHandles(this.graphicsContext);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.activeTool == null) return;\n\t\tconst pointData = this.activeTool?.getSegments(this.segments);\n\t\tif (pointData.length == 0) return;\n\t\tthis.walls.length;\n\t\tconst wallData = (<any>this.wallsLayer)._getWallDataFromActiveTool(game.activeTool) as WallData;\n\n\t\twhile (this.walls.length > pointData.length - 1) {\n\t\t\tconst wall = this.walls.pop();\n\t\t\tWallPool.release(wall);\n\t\t\tthis.wallsLayer.preview.removeChild(wall);\n\t\t}\n\t\tif ((<PIXI.Point>pointData[0]).x !== undefined) {\n\t\t\tconst points = pointData as PIXI.Point[];\n\t\t\tfor (let c = 0; c < points.length - 1; c++) {\n\t\t\t\tconst data = duplicate(wallData) as WallData;\n\t\t\t\tdelete data._id;\n\t\t\t\tdata.c = [points[c].x, points[c].y, points[c + 1].x, points[c + 1].y];\n\t\t\t\tif (c == this.walls.length) {\n\t\t\t\t\tthis.walls.push(WallPool.acquire(data));\n\t\t\t\t\tthis.wallsLayer.preview.addChild(this.walls[c]);\n\t\t\t\t\tthis.walls[c].draw();\n\t\t\t\t} else {\n\t\t\t\t\tthis.walls[c].document = <WallDocument><any>mergeObject(this.walls[c].document, data);\n\t\t\t\t\tthis.wallsLayer.preview.addChild(this.walls[c]);\n\t\t\t\t\tthis.walls[c].refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if ((<PIXI.Point>(<PIXI.Point[]>pointData[0])[0]).x !== undefined) {\n\t\t\tconst points = pointData as PIXI.Point[][];\n\t\t\tif (this.walls.length > points.length) {\n\t\t\t\tconst wall = this.walls.pop();\n\t\t\t\tWallPool.release(wall);\n\t\t\t\tthis.wallsLayer.preview.removeChild(wall);\n\t\t\t}\n\t\t\tfor (let c = 0; c < points.length; c++) {\n\t\t\t\tconst data = duplicate(wallData) as WallData;\n\t\t\t\tdelete data._id;\n\t\t\t\tdata.c = [points[c][0].x, points[c][0].y, points[c][1].x, points[c][1].y];\n\t\t\t\tif (c == this.walls.length) {\n\t\t\t\t\tthis.walls.push(WallPool.acquire(data));\n\t\t\t\t\tthis.wallsLayer.preview.addChild(this.walls[c]);\n\t\t\t\t\tthis.walls[c].draw();\n\t\t\t\t} else {\n\t\t\t\t\tthis.walls[c].document = <WallDocument><any>mergeObject(this.walls[c].document, data);\n\t\t\t\t\tthis.wallsLayer.preview.addChild(this.walls[c]);\n\t\t\t\t\tthis.walls[c].refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.activeTool.clearContext(this.graphicsContext);\n\t\tthis.graphicsContext.removeChildren().forEach(x => x.destroy());\n\t\tthis.graphicsContext.clear();\n\t\tthis.graphicsContext.visible = true;\n\t\tthis.wallsLayer.preview.addChild(this.graphicsContext);\n\t\tthis.activeTool.drawHandles(this.graphicsContext);\n\t\tthis._previousToolData.set(this._mode, this.activeTool.getData());\n\t}\n\n\tinit() {\n\t\tlibWrapper.register(SETTINGS.MOD_NAME, 'Wall.prototype._onDragLeftStart', (wrapper: any, ...args: any) => {\n\t\t\tthis.clearTool();\n\t\t\twrapper(...args);\n\t\t}, 'WRAPPER');\n\t}\n\n\tpatchWallsLayer() {\n\t\tthis.wallsLayer = canvas.walls;\n\t\tlibWrapper.register(SETTINGS.MOD_NAME, 'WallsLayer.prototype._onClickLeft', CurvyWallToolManager._onClickLeft, 'MIXED');\n\t\tlibWrapper.register(SETTINGS.MOD_NAME, 'WallsLayer.prototype._onDragLeftStart', CurvyWallToolManager._onDragLeftStart, 'MIXED');\n\t\tlibWrapper.register(SETTINGS.MOD_NAME, 'WallsLayer.prototype._onDragLeftMove', CurvyWallToolManager._onDragLeftMove, 'MIXED');\n\t\tlibWrapper.register(SETTINGS.MOD_NAME, 'WallsLayer.prototype._onDragLeftDrop', CurvyWallToolManager._onDragLeftDrop, 'MIXED');\n\t\tlibWrapper.register(SETTINGS.MOD_NAME, 'WallsLayer.prototype._onDragLeftCancel', CurvyWallToolManager._onDragLeftCancel, 'MIXED');\n\t\tlibWrapper.register(SETTINGS.MOD_NAME, 'WallsLayer.prototype._onClickRight', CurvyWallToolManager._onClickRight, 'MIXED');\n\t\tHooks.on('requestCurvyWallsRedraw', () => this.render());\n\t}\n\n\tprivate _getCurrentWallData(): Record<string, unknown>[] {\n\t\treturn <Record<string, unknown>[]>this.walls\n\t\t\t.map((x: any) => ({\n\t\t\t\tc: x.document.c,\n\t\t\t\tlight: x.document.light,\n\t\t\t\tmove: x.document.move,\n\t\t\t\tsight: x.document.sight,\n\t\t\t\tsound: x.document.sound,\n\t\t\t\tdir: x.document.dir,\n\t\t\t\tdoor: x.document.door,\n\t\t\t\tds: x.document.ds,\n\t\t\t\tflags: x.document.flags\n\t\t\t}));\n\t}\n}\n/*\n   c: [x0: number, y0: number, x1: number, y1: number];\n   light: foundry.CONST.WALL_SENSE_TYPES;\n   move: foundry.CONST.WALL_MOVEMENT_TYPES;\n   sight: foundry.CONST.WALL_SENSE_TYPES;\n   sound: foundry.CONST.WALL_SENSE_TYPES;\n   dir: foundry.CONST.WALL_DIRECTIONS;\n   door: foundry.CONST.WALL_DOOR_TYPES;\n   ds: foundry.CONST.WALL_DOOR_STATES;\n   flags: ConfiguredFlags<'Wall'>;\n*/","\nimport { CurvyWallToolManager, Mode } from './CurvyWallToolManager';\nimport SETTINGS from \"../../common/Settings\";\nimport { ToolMode } from './tools/BezierTool';\n\nexport interface CurvyWallControl {\n\ttitle: string;\n\ticon: string;\n\ttoggleable?: boolean;\n\tclass?: string;\n\tisActive?: () => boolean;\n\tonClick: (enabled?: boolean) => void;\n}\ninterface CurvyWallControlUI {\n\tname: string;\n\ttitle: string;\n\ticon: string;\n\ttoggleable?: boolean;\n\tclass?: string;\n\tisActive?: boolean;\n}\ninterface CurvyWallsToolsOptions {\n\ttools: CurvyWallControlUI[];\n\tgeneral: CurvyWallControlUI[];\n\tcontrols: CurvyWallControlUI[];\n}\n\nexport class CurvyWallsToolBar extends Application {\n\tstatic init() {\n\t\tHooks.on('getModuleToolGroups', (controlManager: ControlManager, groups: ToolGroup[]) => {\n\t\t\tgroups.push(\n\t\t\t\t{\n\t\t\t\t\tname: SETTINGS.MOD_NAME,\n\t\t\t\t\ticon: '<i class=\"fas fa-bezier-curve\"></i>',\n\t\t\t\t\ttitle: 'Curvy Walls Tools',\n\t\t\t\t\tvisible: () => {\n\t\t\t\t\t\treturn ui.controls.activeControl === 'walls';\n\t\t\t\t\t},\n\t\t\t\t\ttools: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: 'cubic',\n\t\t\t\t\t\t\ttitle: \"df-curvy-walls.cubic\",\n\t\t\t\t\t\t\ticon: '<i class=\"fas fa-bezier-curve\"></i>',\n\t\t\t\t\t\t\ttoggle: true,\n\t\t\t\t\t\t\tisActive: () => CurvyWallToolManager.instance.mode === Mode.Cube,\n\t\t\t\t\t\t\tonClick: active => { CurvyWallToolManager.instance.mode = active ? Mode.Cube : Mode.None; }\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: 'quadratic',\n\t\t\t\t\t\t\ttitle: \"df-curvy-walls.quadratic\",\n\t\t\t\t\t\t\ticon: '<i class=\"fas fa-project-diagram\"></i>',\n\t\t\t\t\t\t\ttoggle: true,\n\t\t\t\t\t\t\tisActive: () => CurvyWallToolManager.instance.mode === Mode.Quad,\n\t\t\t\t\t\t\tonClick: active => { CurvyWallToolManager.instance.mode = active ? Mode.Quad : Mode.None; }\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: 'circle',\n\t\t\t\t\t\t\ttitle: \"df-curvy-walls.circle\",\n\t\t\t\t\t\t\ticon: '<i class=\"fas fa-circle\"></i>',\n\t\t\t\t\t\t\ttoggle: true,\n\t\t\t\t\t\t\tisActive: () => CurvyWallToolManager.instance.mode === Mode.Circ,\n\t\t\t\t\t\t\tonClick: active => { CurvyWallToolManager.instance.mode = active ? Mode.Circ : Mode.None; }\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: 'rectangle',\n\t\t\t\t\t\t\ttitle: \"df-curvy-walls.rectangle\",\n\t\t\t\t\t\t\ticon: '<i class=\"fas fa-vector-square\"></i>',\n\t\t\t\t\t\t\ttoggle: true,\n\t\t\t\t\t\t\tisActive: () => CurvyWallToolManager.instance.mode === Mode.Rect,\n\t\t\t\t\t\t\tonClick: active => { CurvyWallToolManager.instance.mode = active ? Mode.Rect : Mode.None; }\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tstatic readonly PREF_PRESERVE = 'preserve-tool';\n\n\tstatic get defaultOptions(): ApplicationOptions {\n\t\treturn mergeObject(super.defaultOptions, {\n\t\t\tpopOut: false,\n\t\t\ttemplate: 'modules/df-curvy-walls/templates/curvy-walls-controls.hbs'\n\t\t});\n\t}\n\n\tprivate _closing = false;\n\n\tprivate _tools: Record<string, CurvyWallControl> = {\n\t\tbeziercube: {\n\t\t\ttitle: \"df-curvy-walls.cubic\",\n\t\t\ticon: \"fas fa-bezier-curve\",\n\t\t\tisActive: function () { return CurvyWallToolManager.instance.mode == Mode.Cube; },\n\t\t\tonClick: function () { return CurvyWallToolManager.instance.mode = this.isActive() ? Mode.None : Mode.Cube; }\n\t\t},\n\t\tbezierquad: {\n\t\t\ttitle: \"df-curvy-walls.quadratic\",\n\t\t\ticon: \"fas fa-project-diagram\",\n\t\t\tisActive: function () { return CurvyWallToolManager.instance.mode == Mode.Quad; },\n\t\t\tonClick: function () { return CurvyWallToolManager.instance.mode = this.isActive() ? Mode.None : Mode.Quad; }\n\t\t},\n\t\tbeziercirc: {\n\t\t\ttitle: \"df-curvy-walls.circle\",\n\t\t\ticon: \"fas fa-circle\",\n\t\t\tisActive: function () { return CurvyWallToolManager.instance.mode == Mode.Circ; },\n\t\t\tonClick: function () { return CurvyWallToolManager.instance.mode = this.isActive() ? Mode.None : Mode.Circ; }\n\t\t},\n\t\tbezierrect: {\n\t\t\ttitle: \"df-curvy-walls.rectangle\",\n\t\t\ticon: \"fas fa-vector-square\",\n\t\t\tisActive: function () { return CurvyWallToolManager.instance.mode == Mode.Rect; },\n\t\t\tonClick: function () { return CurvyWallToolManager.instance.mode = this.isActive() ? Mode.None : Mode.Rect; }\n\t\t}\n\t};\n\tprivate _generalControls: Record<string, CurvyWallControl> = {\n\t\tincrement: {\n\t\t\ttitle: 'df-curvy-walls.increment',\n\t\t\ticon: 'fas fa-plus',\n\t\t\tonClick: () => CurvyWallToolManager.instance.segments++\n\t\t},\n\t\tdecrement: {\n\t\t\ttitle: 'df-curvy-walls.decrement',\n\t\t\ticon: 'fas fa-minus',\n\t\t\tonClick: () => CurvyWallToolManager.instance.segments--\n\t\t},\n\t\tapply: {\n\t\t\ttitle: 'df-curvy-walls.apply',\n\t\t\ticon: 'fas fa-check',\n\t\t\tclass: 'apply',\n\t\t\tonClick: CurvyWallToolManager.instance.apply.bind(CurvyWallToolManager.instance)\n\t\t},\n\t\tcancel: {\n\t\t\ttitle: 'df-curvy-walls.cancel',\n\t\t\ticon: 'fas fa-times',\n\t\t\tclass: 'cancel',\n\t\t\tonClick: CurvyWallToolManager.instance.clearTool.bind(CurvyWallToolManager.instance)\n\t\t}\n\t};\n\tprivate _placementControls: Record<string, CurvyWallControl> = {\n\t\tpointconstruct: {\n\t\t\ttitle: 'df-curvy-walls.trace_curve_with_points',\n\t\t\ticon: 'fas fa-route',\n\t\t\ttoggleable: true,\n\t\t\tisActive: () => CurvyWallToolManager.instance.currentlyMappingPoints,\n\t\t\tonClick: () => {\n\t\t\t\tCurvyWallToolManager.instance.togglePointMapping();\n\t\t\t\tthis.render(false);\n\t\t\t}\n\t\t},\n\t\tapplyplacement: {\n\t\t\ttitle: 'df-curvy-walls.pointmapapply',\n\t\t\ticon: 'fas fa-check',\n\t\t\tclass: 'apply',\n\t\t\tonClick: () => { CurvyWallToolManager.instance.applyPointMapping(); }\n\t\t}\n\t};\n\n\tconstructor(options?: ApplicationOptions) {\n\t\tsuper(options);\n\t\tCurvyWallToolManager.instance.setModeListener(() => {\n\t\t\tif (this._closing) {\n\t\t\t\tthis._closing = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.render(false);\n\t\t});\n\t}\n\n\tgetData(): CurvyWallsToolsOptions {\n\t\tconst toolIsPlaced = CurvyWallToolManager.instance.mode != Mode.None && CurvyWallToolManager.instance.activeTool.mode != ToolMode.NotPlaced;\n\t\tconst toolControls = CurvyWallToolManager.instance.activeTool?.getTools();\n\t\tconst placementControls: CurvyWallControlUI[] = [{\n\t\t\tname: 'pointconstruct',\n\t\t\ttitle: this._placementControls.pointconstruct.title,\n\t\t\ticon: this._placementControls.pointconstruct.icon,\n\t\t\tclass: this._placementControls.pointconstruct.class,\n\t\t\ttoggleable: true,\n\t\t\tisActive: this._placementControls.pointconstruct.isActive()\n\t\t}];\n\t\tif (CurvyWallToolManager.instance.currentlyMappingPoints && CurvyWallToolManager.instance.canApplyPointMapping)\n\t\t\tplacementControls.push({\n\t\t\t\tname: 'applyplacement',\n\t\t\t\ttitle: this._placementControls.applyplacement.title,\n\t\t\t\ticon: this._placementControls.applyplacement.icon,\n\t\t\t\tclass: this._placementControls.applyplacement.class\n\t\t\t});\n\n\t\tconst data: CurvyWallsToolsOptions = {\n\t\t\ttools: Object.keys(this._tools).map(it => {\n\t\t\t\treturn {\n\t\t\t\t\tname: it,\n\t\t\t\t\ttitle: this._tools[it].title,\n\t\t\t\t\ticon: this._tools[it].icon,\n\t\t\t\t\ttoggleable: true,\n\t\t\t\t\tisActive: this._tools[it].isActive()\n\t\t\t\t};\n\t\t\t}),\n\t\t\tgeneral: toolIsPlaced ? Object.keys(this._generalControls).map(it => {\n\t\t\t\treturn {\n\t\t\t\t\tname: it,\n\t\t\t\t\ttitle: this._generalControls[it].title,\n\t\t\t\t\ticon: this._generalControls[it].icon,\n\t\t\t\t\tclass: this._generalControls[it].class\n\t\t\t\t};\n\t\t\t}) : [Mode.Quad, Mode.Circ, Mode.Rect].includes(CurvyWallToolManager.instance.mode) ? placementControls : [],\n\t\t\tcontrols: toolIsPlaced && !!toolControls ? Object.keys(toolControls).map(it => {\n\t\t\t\treturn {\n\t\t\t\t\tname: it,\n\t\t\t\t\ttitle: toolControls[it].title,\n\t\t\t\t\ticon: toolControls[it].icon,\n\t\t\t\t\tclass: toolControls[it].class,\n\t\t\t\t\ttoggleable: toolControls[it].toggleable,\n\t\t\t\t\tisActive: toolControls[it].toggleable ? toolControls[it].isActive() : undefined\n\t\t\t\t};\n\t\t\t}) : []\n\t\t};\n\n\t\treturn data;\n\t}\n\n\tactivateListeners(html: JQuery<HTMLElement>) {\n\t\tconst toolbarPosition = game.settings.get('lib-df-buttons', 'position');\n\t\tswitch (toolbarPosition) {\n\t\t\tcase 'top':\n\t\t\t\thtml.remove();\n\t\t\t\t$(document.querySelector('#moduleControls')).append(html);\n\t\t\t\thtml.css('position', 'unset');\n\t\t\t\tbreak;\n\t\t\tcase 'left':\n\t\t\t\thtml.remove();\n\t\t\t\t$(document.querySelector('#moduleControls')).append(html);\n\t\t\t\thtml.css('top', '0');\n\t\t\t\thtml.css('left', '46px');\n\t\t\t\tbreak;\n\t\t\tcase 'right':\n\t\t\tcase 'bottom':\n\t\t\t\thtml.remove();\n\t\t\t\t$(document.querySelector('body')).append(html);\n\t\t\t\thtml.css('left', ((ui as any).moduleControls.getLeftWidth() + 5) + 'px');\n\t\t\t\thtml.css('top', (ui as any).moduleControls.getTopHeight(true) + 'px');\n\t\t\t\tbreak;\n\t\t}\n\t\thtml.find('li').on(\"click\", (event: JQuery.ClickEvent) => {\n\t\t\tconst element = $(event.currentTarget);\n\t\t\tconst name = element.attr('data-tool');\n\n\t\t\tconst tool = this._tools[name];\n\t\t\tif (tool !== undefined) {\n\t\t\t\ttool.onClick();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst generalControl = this._generalControls[name];\n\t\t\tif (generalControl !== undefined) generalControl.onClick();\n\n\t\t\tconst placementControl = this._placementControls[name];\n\t\t\tif (placementControl !== undefined) placementControl.onClick();\n\n\t\t\tconst toolControl = CurvyWallToolManager.instance.activeTool?.getTools()[name];\n\t\t\tif (toolControl !== undefined) {\n\t\t\t\tif (!toolControl.toggleable) toolControl.onClick();\n\t\t\t\telse toolControl.onClick(!toolControl.isActive());\n\t\t\t}\n\n\t\t\tthis.render(false);\n\t\t});\n\t}\n\n\tclose(options?: Application.CloseOptions): Promise<void> {\n\t\tif (!SETTINGS.get(CurvyWallsToolBar.PREF_PRESERVE)) {\n\t\t\tthis._closing = true;\n\t\t\tCurvyWallToolManager.instance.mode = Mode.None;\n\t\t}\n\t\treturn super.close(options);\n\t}\n}","import { InputHandler } from \"./ToolInputHandler\";\nimport { CurvyWallControl } from '../CurvyWallsToolBar';\nimport SETTINGS from \"../../../common/Settings\";\n\nexport enum ToolMode {\n\tNotPlaced,\n\tPlacing,\n\tPlaced\n}\n\nexport abstract class BezierTool {\n\tpublic static readonly PREF_SMALL_HANDLES = \"BezierTool.SmallHandles\";\n\tpublic static get HANDLE_RADIUS(): number {\n\t\treturn SETTINGS.get(this.PREF_SMALL_HANDLES) ? 5 : 10;\n\t}\n\tpublic static readonly LINE_SIZE: number = 2;\n\tprivate static readonly TEXT_STYLE_BASE = new PIXI.TextStyle({\n\t\tfontFamily: CONFIG.defaultFontFamily,\n\t\tfontSize: 24,\n\t\tfill: \"#BBBBBB\",\n\t\tstroke: \"#111111\",\n\t\tstrokeThickness: 4,\n\t\tdropShadow: false,\n\t\tdropShadowColor: \"#000000\",\n\t\tdropShadowBlur: Math.max(Math.round(24 / 16), 2),\n\t\tdropShadowAngle: 0,\n\t\tdropShadowDistance: 0,\n\t\tpadding: 1\n\t});\n\t// Define the text style\n\tpublic static get TEXT_STYLE(): PIXI.TextStyle {\n\t\tthis.TEXT_STYLE_BASE.fontSize = SETTINGS.get(this.PREF_SMALL_HANDLES) ? 18 : 24;\n\t\treturn this.TEXT_STYLE_BASE;\n\t}\n\n\tprivate _mode: ToolMode = ToolMode.NotPlaced;\n\tprotected lastSegmentFetch: PIXI.Point[] | PIXI.Point[][] = [];\n\tabstract get handles(): PIXI.Point[]\n\tabstract get bounds(): PIXI.Bounds;\n\tabstract lineA: PIXI.Point;\n\tabstract lineB: PIXI.Point;\n\n\tpublic segments: number = 8;\n\n\tget lineCenter(): PIXI.Point {\n\t\treturn new PIXI.Point(\n\t\t\tthis.lineA.x + ((this.lineB.x - this.lineA.x) / 2),\n\t\t\tthis.lineA.y + ((this.lineB.y - this.lineA.y) / 2));\n\t}\n\n\tprivate _modeListener: (mode: ToolMode) => void = null;\n\tget mode(): ToolMode { return this._mode; }\n\tprotected setMode(value: ToolMode) {\n\t\tif (this._mode === value) return;\n\t\tthis._mode = value;\n\t\tif (this._modeListener !== null)\n\t\t\tthis._modeListener(value);\n\t}\n\n\tstartedWithCtrlHeld: boolean = false;\n\n\tconstructor(segments: number = 10) {\n\t\tthis.segments = segments;\n\t}\n\n\tabstract drawHandles(context: PIXI.Graphics): void;\n\tabstract checkPointForDrag(point: PIXI.Point): InputHandler | null;\n\tabstract getSegments(count: number): PIXI.Point[] | PIXI.Point[][];\n\tabstract placeTool(point: PIXI.Point, data: object): void;\n\tabstract getData(): object;\n\tabstract getTools(): Record<string, CurvyWallControl>\n\n\tcheckPointForClick(_point: PIXI.Point, _event: PIXI.InteractionEvent): boolean { return false; }\n\t// eslint-disable-next-line @typescript-eslint/no-empty-function\n\tclearContext(_context: PIXI.Graphics): void { }\n\tclearTool() {\n\t\tthis.setMode(ToolMode.NotPlaced);\n\t}\n\tsetModeListener(listener: (toolMode: ToolMode) => void) {\n\t\tthis._modeListener = listener;\n\t}\n\n\tprotected static createText(text: string): PreciseText {\n\t\tconst result = new PreciseText(text, BezierTool.TEXT_STYLE);\n\t\tresult.anchor.set(0.5, 0.5);\n\t\treturn result;\n\t}\n\tprotected drawSegmentLabel(context: PIXI.Graphics) {\n\t\tconst text = BezierTool.createText(`${this.lastSegmentFetch.length - 1}`);\n\t\ttext.position = this.lineCenter;\n\t\tcontext.addChild(text);\n\t}\n\tprotected drawBoundingBox(context: PIXI.Graphics) {\n\t\tconst bounds = this.bounds.getRectangle(PIXI.Rectangle.EMPTY);\n\t\tcontext.beginFill(0, 0)\n\t\t\t.lineStyle(BezierTool.LINE_SIZE, 0xE88D2D, 1, 0.5)\n\t\t\t.drawRoundedRect(bounds.left - 20, bounds.top - 20, bounds.width + 40, bounds.height + 40, 20)\n\t\t\t.endFill();\n\t}\n\tprotected drawHandle(context: PIXI.Graphics, fill: number, point: PIXI.Point): PIXI.Graphics {\n\t\treturn context.beginFill(fill, 1)\n\t\t\t.lineStyle(BezierTool.LINE_SIZE, 0x0, 1, 0.5)\n\t\t\t.drawCircle(point.x, point.y, BezierTool.HANDLE_RADIUS)\n\t\t\t.endFill();\n\t}\n\n\tstatic pointNearPoint(a: { x: number, y: number }, b: { x: number, y: number }, threshold: number): boolean {\n\t\tconst x = a.x - b.x;\n\t\tconst y = a.y - b.y;\n\t\treturn ((x * x) + (y * y)) <= (threshold * threshold); // super simple and efficient Squared Length circle collision\n\t}\n}","import { BezierTool, ToolMode } from './BezierTool';\nimport { PointArrayInputHandler, InputHandler, PointInputHandler, InitializerInputHandler } from \"./ToolInputHandler\";\nimport { CurvyWallControl } from '../CurvyWallsToolBar';\n\nconst pointNearPoint = BezierTool.pointNearPoint;\nconst PI2 = Math.PI * 2;\ndeclare type Point = PIXI.Point;\n\n// Helper function log outputs\n// function degrees(radians: number) { return (radians / Math.PI) * 180.0; }\n\nclass InitializerIH extends InitializerInputHandler {\n\tconstructor(tool: CircleTool, success: () => void, fail: () => void) {\n\t\tsuper(tool, true, tool.lineA, tool.lineB, success, fail);\n\t}\n}\n\nexport default class CircleTool extends BezierTool {\n\tstatic readonly ANGLE_SNAP_STEPS = [Math.PI / 4, Math.PI / 6, Math.PI / 12, Math.PI / 24, Math.PI / 48];\n\tstatic snapSetIndex = 2;\n\tstatic finishSliceIfShort = true;\n\tstatic closeLoopIfSliced = false;\n\tlineA = new PIXI.Point();\n\tlineB = new PIXI.Point();\n\tarcHandle = new RotatorHandle(100);\n\tsliceHandle = new RotatorHandle(75, this.arcHandle);\n\n\tget handles(): Point[] { return [this.lineA, this.lineB]; }\n\tget bounds(): PIXI.Bounds {\n\t\tconst b = new PIXI.Bounds();\n\t\tb.addPoint(this.lineA);\n\t\tb.addPoint(this.lineB);\n\t\treturn b;\n\t}\n\tget polygon(): PIXI.Polygon {\n\t\tconst bounds = this.bounds;\n\t\treturn new PIXI.Polygon([\n\t\t\tbounds.minX, bounds.minY,\n\t\t\tbounds.maxX, bounds.minY,\n\t\t\tbounds.minX, bounds.maxY,\n\t\t\tbounds.maxX, bounds.maxY]);\n\t}\n\n\tprivate _tools: Record<string, CurvyWallControl> = {\n\t\tellipseclose: {\n\t\t\ticon: 'fas fa-adjust',\n\t\t\ttitle: 'df-curvy-walls.ellipse_close',\n\t\t\ttoggleable: true,\n\t\t\tisActive: () => CircleTool.closeLoopIfSliced,\n\t\t\tonClick: enabled => {\n\t\t\t\tCircleTool.closeLoopIfSliced = enabled;\n\t\t\t\tHooks.call('requestCurvyWallsRedraw');\n\t\t\t}\n\t\t},\n\t\tellipsefinish: {\n\t\t\ticon: 'fas fa-compress-alt',\n\t\t\ttitle: 'df-curvy-walls.ellipse_finish_slice',\n\t\t\ttoggleable: true,\n\t\t\tisActive: () => CircleTool.finishSliceIfShort,\n\t\t\tonClick: enabled => {\n\t\t\t\tCircleTool.finishSliceIfShort = enabled;\n\t\t\t\tHooks.call('requestCurvyWallsRedraw');\n\t\t\t}\n\t\t},\n\t\tellipseinc: {\n\t\t\ticon: 'dfcw ellipseinc',\n\t\t\ttitle: 'df-curvy-walls.ellipse_increment',\n\t\t\tonClick: () => {\n\t\t\t\tCircleTool.snapSetIndex = Math.clamped(CircleTool.snapSetIndex + 1, 0, CircleTool.ANGLE_SNAP_STEPS.length - 1);\n\t\t\t\tHooks.call('requestCurvyWallsRedraw');\n\t\t\t}\n\t\t},\n\t\tellipsedec: {\n\t\t\ticon: 'dfcw ellipsedec',\n\t\t\ttitle: 'df-curvy-walls.ellipse_decrement',\n\t\t\tonClick: () => {\n\t\t\t\tCircleTool.snapSetIndex = Math.clamped(CircleTool.snapSetIndex - 1, 0, CircleTool.ANGLE_SNAP_STEPS.length - 1);\n\t\t\t\tHooks.call('requestCurvyWallsRedraw');\n\t\t\t}\n\t\t}\n\t};\n\tgetTools(): Record<string, CurvyWallControl> { return this._tools; }\n\tplaceTool(point: PIXI.Point, data: { l1: number[], l2: number[], a1: number, a2: number }) {\n\t\tthis.lineA.set(data.l1[0] + point.x, data.l1[1] + point.y);\n\t\tthis.lineB.set(data.l2[0] + point.x, data.l2[1] + point.y);\n\t\tthis.arcHandle.angle = data.a1;\n\t\tthis.sliceHandle.angle = data.a2;\n\t\tthis.setMode(ToolMode.Placed);\n\t}\n\tgetData() {\n\t\tconst center = this.lineCenter;\n\t\treturn {\n\t\t\tl1: [this.lineA.x - center.x, this.lineA.y - center.y],\n\t\t\tl2: [this.lineB.x - center.x, this.lineB.y - center.y],\n\t\t\ta1: this.arcHandle.angle, a2: this.sliceHandle.angle\n\t\t};\n\t}\n\n\tgetCenter(): PIXI.Point {\n\t\tconst bounds = this.bounds;\n\t\tconst rect = bounds.getRectangle(PIXI.Rectangle.EMPTY);\n\t\tconst halfWidth = rect.width / 2;\n\t\tconst halfHeight = rect.height / 2;\n\t\treturn new PIXI.Point(bounds.minX + halfWidth, bounds.minY + halfHeight);\n\t}\n\n\tprivate createVector(theta: number, magnitude: Point, origin: Point): Point {\n\t\treturn new PIXI.Point(\n\t\t\torigin.x + (Math.cos(theta) * magnitude.x),\n\t\t\torigin.y + (Math.sin(theta) * magnitude.y)\n\t\t);\n\t}\n\n\tgetSegments(count: number): PIXI.Point[] {\n\t\tif (this.mode == ToolMode.NotPlaced) return [];\n\t\tconst bounds = this.bounds;\n\t\tconst rect = bounds.getRectangle(PIXI.Rectangle.EMPTY);\n\t\tconst deltaTheta = Math.PI / count;\n\t\t// Calculate the magnitude per axis based on the scalar of the circle's x,y radius\n\t\tconst magnitude = new PIXI.Point(rect.width / 2, rect.height / 2);\n\t\t// Find the exact middle point of the circle\n\t\tconst origin = new PIXI.Point(bounds.minX + magnitude.x, bounds.minY + magnitude.y);\n\t\t// initialize with the first point\n\t\tconst points: PIXI.Point[] = [];\n\t\t// Start at full rotation and work our way back CCW\n\t\tlet angle = PI2;\n\t\tconst sliceAngle = this.sliceHandle.rawAngle != PI2 ? this.sliceHandle.rawAngle : 0.0;\n\t\t// console.log(`Slice: ${degrees(sliceAngle)}, Arc: ${degrees(this.arcHandle.rawAngle)}`);\n\t\twhile (angle >= sliceAngle) {\n\t\t\tpoints.push(this.createVector(this.arcHandle.rawAngle + angle, magnitude, origin));\n\t\t\tangle -= deltaTheta;\n\t\t\tif (angle < 1e-10 && angle > -1e-10)\n\t\t\t\tangle = 0;\n\t\t}\n\t\t// If we stopped short of the slice handle, add a small step to go the rest of the way\n\t\tif (CircleTool.finishSliceIfShort && angle != sliceAngle && sliceAngle != 0) {\n\t\t\tpoints.push(this.createVector(this.arcHandle.rawAngle + sliceAngle, magnitude, origin));\n\t\t}\n\t\t// Close loop if there is no slice, or if the user has locked loop closing\n\t\tif (CircleTool.closeLoopIfSliced && sliceAngle != 0)\n\t\t\tpoints.push(points[0]);\n\t\treturn (this.lastSegmentFetch = points);\n\t}\n\n\tinitialPoints(): number[] { return [0, 0, 0, 0, 0, 0]; }\n\tdrawHandles(context: PIXI.Graphics): void {\n\t\tif (this.mode == ToolMode.NotPlaced) return;\n\t\tthis.drawBoundingBox(context);\n\t\tconst middle = this.getCenter();\n\t\tconst arc = this.arcHandle.getHandlePoint(middle);\n\t\tconst slice = this.sliceHandle.getHandlePoint(middle);\n\t\tcontext.beginFill(0xffaacc)\n\t\t\t.lineStyle(BezierTool.LINE_SIZE, 0xffaacc, 1, 0.5)\n\t\t\t.moveTo(this.lineA.x, this.lineA.y)\n\t\t\t.lineTo(this.lineB.x, this.lineB.y)\n\t\t\t.moveTo(middle.x, middle.y)\n\t\t\t.lineTo(arc.x, arc.y)\n\t\t\t.moveTo(middle.x, middle.y)\n\t\t\t.lineTo(slice.x, slice.y)\n\t\t\t.endFill();\n\t\tthis.drawSegmentLabel(context);\n\t\tconst snapAngle = Math.toDegrees(CircleTool.ANGLE_SNAP_STEPS[CircleTool.snapSetIndex]).toFixed(2);\n\t\tconst arcLabel = BezierTool.createText(`${snapAngle}   ${180 / parseFloat(snapAngle)}`);\n\t\tarcLabel.position.copyFrom(this.lineCenter);\n\t\tarcLabel.position.y += BezierTool.TEXT_STYLE.fontSize as number + 4;\n\t\tcontext.addChild(arcLabel);\n\t\tthis.drawHandle(context, 0xff4444, this.lineA);\n\t\tthis.drawHandle(context, 0xff4444, this.lineB);\n\t\tthis.drawHandle(context, 0x44ff44, this.arcHandle.getHandlePoint(this.getCenter()));\n\t\tthis.drawHandle(context, 0x4444ff, this.sliceHandle.getHandlePoint(this.getCenter()));\n\t}\n\tprotected drawSegmentLabel(context: PIXI.Graphics) {\n\t\tconst text = BezierTool.createText(`${this.lastSegmentFetch.length - 1}`);\n\t\ttext.position = this.lineCenter;\n\t\tcontext.addChild(text);\n\t}\n\tcheckPointForDrag(point: Point): InputHandler | null {\n\t\tif (this.mode == ToolMode.NotPlaced) {\n\t\t\tthis.setMode(ToolMode.Placing);\n\t\t\treturn new InitializerIH(this, () => this.setMode(ToolMode.Placed), () => this.setMode(ToolMode.NotPlaced));\n\t\t}\n\t\tif (pointNearPoint(point, this.lineA, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.lineA, null, this.lineB);\n\t\telse if (pointNearPoint(point, this.lineB, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.lineB, null, this.lineA);\n\t\telse if (pointNearPoint(point, this.arcHandle.getHandlePoint(this.getCenter()), BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointRotationHandler(this, this.arcHandle, this.getCenter());\n\t\telse if (pointNearPoint(point, this.sliceHandle.getHandlePoint(this.getCenter()), BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointRotationHandler(this, this.sliceHandle, this.getCenter());\n\t\telse if (this.polygon.contains(point.x, point.y))\n\t\t\treturn new PointArrayInputHandler(this, point, this.handles);\n\t\treturn null;\n\t}\n}\n\nclass RotatorHandle {\n\tprivate _angle: number = 0.0;\n\tget rawAngle(): number { return this._angle; }\n\tset rawAngle(value: number) { this._angle = value; }\n\tget angle(): number {\n\t\treturn this.magnet ? this._angle + this.magnet._angle : this._angle;\n\t}\n\tset angle(value: number) {\n\t\tthis._angle = this.magnet ? value - this.magnet._angle : this._angle = value;\n\t}\n\tprivate length: number = 0.0;\n\tmagnet: RotatorHandle;\n\tconstructor(length: number, magnet?: RotatorHandle) {\n\t\tthis.length = length;\n\t\tthis.magnet = magnet;\n\t}\n\tgetHandlePoint(center: PIXI.Point): PIXI.Point {\n\t\tconst magnet = this.magnet ? this.magnet._angle : 0;\n\t\tconst ax = Math.cos(magnet + this._angle) * this.length;\n\t\tconst ay = Math.sin(magnet + this._angle) * this.length;\n\t\treturn new PIXI.Point(center.x + ax, center.y + ay);\n\t}\n}\n\nclass PointRotationHandler extends InputHandler {\n\tprivate original: number;\n\tprivate arcHandle: RotatorHandle;\n\tprivate center: PIXI.Point;\n\tconstructor(tool: BezierTool, arcHandle: RotatorHandle, center: PIXI.Point) {\n\t\tsuper(tool);\n\t\tthis.arcHandle = arcHandle;\n\t\tthis.original = this.arcHandle.angle;\n\t\tthis.center = center;\n\t}\n\n\tsetAngle(to: PIXI.Point, event: PIXI.InteractionEvent) {\n\t\tconst vecX = to.x - this.center.x;\n\t\tconst vecY = to.y - this.center.y;\n\t\t// calculate the reference angle theta bar ()\n\t\tlet angle = Math.atan(vecY / vecX);\n\t\t// If on the -X axis (2nd and 3rd quadrants)\n\t\tif (vecX < 0) angle += Math.PI;\n\t\t// Specifically the +X,-Y quadrant (4th quadrant)\n\t\telse if (vecY < 0) angle += PI2;\n\t\t// Perform snapping if enabled\n\t\tif (this.shouldSnap(event)) {\n\t\t\tconst snapAngle = CircleTool.ANGLE_SNAP_STEPS[CircleTool.snapSetIndex];\n\t\t\t// Whole number of angle snaps\n\t\t\tconst whole = Math.trunc(angle / snapAngle);\n\t\t\t// Round to the nearest whole angle snap\n\t\t\tangle = (angle - (whole * snapAngle)) < (snapAngle / 2)\n\t\t\t\t? whole * snapAngle\n\t\t\t\t: (whole + 1) * snapAngle;\n\t\t}\n\t\tconst magnet = this.arcHandle.magnet ? (PI2 - this.arcHandle.magnet.rawAngle) : 0;\n\t\tthis.arcHandle.rawAngle = (magnet + angle) % PI2;\n\t}\n\n\tstart(_origin: PIXI.Point, destination: PIXI.Point, event: PIXI.InteractionEvent): void {\n\t\tthis.setAngle(destination, event);\n\t}\n\tmove(_origin: PIXI.Point, destination: PIXI.Point, event: PIXI.InteractionEvent): void {\n\t\tthis.setAngle(destination, event);\n\t}\n\tstop(_origin: PIXI.Point, destination: PIXI.Point, event: PIXI.InteractionEvent): void {\n\t\tthis.setAngle(destination, event);\n\t}\n\tcancel(): void {\n\t\tthis.arcHandle.angle = this.original;\n\t}\n}","import { CurvyWallControl } from '../CurvyWallsToolBar';\nimport { Bezier } from '../../libs/bezier';\nimport { BezierTool, ToolMode } from './BezierTool';\nimport { PointArrayInputHandler, InputHandler, PointInputHandler, InitializerInputHandler, MagnetPointInputHandler } from \"./ToolInputHandler\";\n\nconst pointNearPoint = BezierTool.pointNearPoint;\ndeclare type Point = PIXI.Point;\n\nclass InitializerIH extends InitializerInputHandler {\n\tprivate get cubicTool(): CubicTool { return this.tool as CubicTool; }\n\tconstructor(tool: CubicTool, success: () => void, fail: () => void) {\n\t\tsuper(tool, false, tool.lineA, tool.lineB, success, fail);\n\t}\n\tmove(origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tsuper.move(origin, destination, event);\n\t\tlet dx = this.tool.lineB.x - this.tool.lineA.x;\n\t\tlet dy = this.tool.lineB.y - this.tool.lineA.y;\n\t\tconst length = Math.sqrt((dx * dx) + (dy * dy));\n\t\tdx /= length;\n\t\tdy /= length;\n\t\tconst barLength = length * (2 / 3);\n\t\tthis.cubicTool.controlA.set(this.tool.lineA.x + (dy * barLength), this.tool.lineA.y + (-dx * barLength));\n\t\tthis.cubicTool.controlB.set(this.tool.lineB.x + (dy * barLength), this.tool.lineB.y + (-dx * barLength));\n\t}\n}\n\nexport default class CubicTool extends BezierTool {\n\tstatic lockHandles = true;\n\tprivate bezier: Bezier;\n\tlineA = new PIXI.Point();\n\tlineB = new PIXI.Point();\n\tcontrolA = new PIXI.Point();\n\tcontrolB = new PIXI.Point();\n\n\tget handles(): Point[] { return [this.lineA, this.controlA, this.controlB, this.lineB]; }\n\tget bounds(): PIXI.Bounds {\n\t\tconst b = new PIXI.Bounds();\n\t\tb.addPoint(this.lineA);\n\t\tb.addPoint(this.lineB);\n\t\tb.addPoint(this.controlA);\n\t\tb.addPoint(this.controlB);\n\t\treturn b;\n\t}\n\tget polygon(): PIXI.Polygon { return new PIXI.Polygon([this.lineA, this.lineB, this.controlA, this.controlB]); }\n\n\tconstructor(segments: number = 10) {\n\t\tsuper(segments);\n\t\tthis.bezier = new Bezier([0, 0, 0, 0, 0, 0, 0, 0]);\n\t}\n\tgetSegments(count: number): PIXI.Point[] | PIXI.Point[][] {\n\t\tif (this.mode == ToolMode.NotPlaced) return [];\n\t\tthis.bezier.points = this.handles;\n\t\tthis.bezier.update();\n\t\treturn (this.lastSegmentFetch = this.bezier.getLUT(count + 2).map((e: { x: number, y: number }) => new PIXI.Point(e.x, e.y)));\n\t}\n\tdrawHandles(context: PIXI.Graphics): void {\n\t\tif (this.mode == ToolMode.NotPlaced) return;\n\t\tthis.drawBoundingBox(context);\n\t\tcontext.beginFill(0xffaacc)\n\t\t\t.lineStyle(BezierTool.LINE_SIZE, 0xffaacc, 1, 0.5)\n\t\t\t.moveTo(this.lineA.x, this.lineA.y)\n\t\t\t.lineTo(this.controlA.x, this.controlA.y)\n\t\t\t.moveTo(this.lineB.x, this.lineB.y)\n\t\t\t.lineTo(this.controlB.x, this.controlB.y)\n\t\t\t.endFill();\n\t\tsuper.drawSegmentLabel(context);\n\t\tthis.drawHandle(context, 0xff4444, this.lineA);\n\t\tthis.drawHandle(context, 0xff4444, this.lineB);\n\t\tthis.drawHandle(context, 0xaaff44, this.controlA);\n\t\tthis.drawHandle(context, 0xaaff44, this.controlB);\n\t}\n\tcheckPointForDrag(point: Point): InputHandler | null {\n\t\tif (this.mode == ToolMode.NotPlaced) {\n\t\t\tthis.setMode(ToolMode.Placing);\n\t\t\treturn new InitializerIH(this, () => this.setMode(ToolMode.Placed), () => this.setMode(ToolMode.NotPlaced));\n\t\t}\n\t\tif (pointNearPoint(point, this.lineA, BezierTool.HANDLE_RADIUS))\n\t\t\treturn CubicTool.lockHandles\n\t\t\t\t? new MagnetPointInputHandler(this, this.lineA, this.controlA)\n\t\t\t\t: new PointInputHandler(this, this.lineA);\n\t\telse if (pointNearPoint(point, this.lineB, BezierTool.HANDLE_RADIUS))\n\t\t\treturn CubicTool.lockHandles\n\t\t\t\t? new MagnetPointInputHandler(this, this.lineB, this.controlB)\n\t\t\t\t: new PointInputHandler(this, this.lineB);\n\t\telse if (pointNearPoint(point, this.controlA, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.controlA);\n\t\telse if (pointNearPoint(point, this.controlB, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.controlB);\n\t\telse if (this.polygon.contains(point.x, point.y))\n\t\t\treturn new PointArrayInputHandler(this, point, this.handles);\n\t\treturn null;\n\t}\n\n\tgetTools(): Record<string, CurvyWallControl> {\n\t\treturn {\n\t\t\tcubiclock: {\n\t\t\t\ticon: 'fas fa-lock',\n\t\t\t\ttitle: 'df-curvy-walls.cubic_lock_handles',\n\t\t\t\ttoggleable: true,\n\t\t\t\tisActive: () => CubicTool.lockHandles,\n\t\t\t\tonClick: enabled => CubicTool.lockHandles = enabled\n\t\t\t}\n\t\t};\n\t}\n\tplaceTool(point: PIXI.Point, data: { l1: number[], l2: number[], c1: number[], c2: number[] }) {\n\t\tthis.lineA.set(data.l1[0] + point.x, data.l1[1] + point.y);\n\t\tthis.lineB.set(data.l2[0] + point.x, data.l2[1] + point.y);\n\t\tthis.controlA.set(data.c1[0] + point.x, data.c1[1] + point.y);\n\t\tthis.controlB.set(data.c2[0] + point.x, data.c2[1] + point.y);\n\t\tthis.setMode(ToolMode.Placed);\n\t}\n\tgetData() {\n\t\tconst center = this.lineCenter;\n\t\treturn {\n\t\t\tl1: [this.lineA.x - center.x, this.lineA.y - center.y],\n\t\t\tl2: [this.lineB.x - center.x, this.lineB.y - center.y],\n\t\t\tc1: [this.controlA.x - center.x, this.controlA.y - center.y],\n\t\t\tc2: [this.controlB.x - center.x, this.controlB.y - center.y]\n\t\t};\n\t}\n}","import { CurvyWallControl } from \"../CurvyWallsToolBar\";\nimport { CurvyWallToolManager, Mode } from \"../CurvyWallToolManager\";\nimport { Bezier } from \"../../libs/bezier\";\nimport { BezierTool } from \"./BezierTool\";\nimport { InputHandler, PointInputHandler } from \"./ToolInputHandler\";\n\nconst pointNearPoint = BezierTool.pointNearPoint;\n\nexport default class PointMapper extends BezierTool {\n\tget handles(): PIXI.Point[] {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\tget bounds(): PIXI.Bounds {\n\t\tconst b = new PIXI.Bounds();\n\t\tthis.points.forEach(x => b.addPoint(x));\n\t\treturn b;\n\t}\n\tlineA = new PIXI.Point();\n\tlineB = new PIXI.Point();\n\tpoints: PIXI.Point[] = [];\n\n\tdrawHandles(context: PIXI.Graphics): void {\n\t\tthis.drawBoundingBox(context);\n\t\tswitch (CurvyWallToolManager.instance.mode) {\n\t\t\t// case Mode.Cube:\n\t\t\t// \tif (this.points.length < 3) break;\n\t\t\t// \tlet lines = Bezier.cubicFromPoints(this.points[0], this.points[1], this.points[2])\n\t\t\t// \t\t.getLUT().map((p: { x: number, y: number }) => new PIXI.Point(p.x, p.y));\n\t\t\t// \tcontext.beginFill(0, 0).lineStyle(6, 0xffaacc, 1, 0.5)\n\t\t\t// \tcontext.moveTo(lines[0].x, lines[0].y)\n\t\t\t// \tfor (let c = 1; c < lines.length; c++)\n\t\t\t// \t\tcontext.lineTo(lines[c].x, lines[c].y)\n\t\t\t// \tcontext.endFill();\n\t\t\t// \tbreak;\n\t\t\tcase Mode.Quad:\n\t\t\t\tif (this.points.length < 3) break;\n\t\t\t\tconst lines = Bezier.quadraticFromPoints(this.points[0], this.points[1], this.points[2])\n\t\t\t\t\t.getLUT().map((p: { x: number, y: number }) => new PIXI.Point(p.x, p.y));\n\t\t\t\tcontext.beginFill(0, 0).lineStyle(6, 0xffaacc, 1, 0.5);\n\t\t\t\tcontext.moveTo(lines[0].x, lines[0].y);\n\t\t\t\tfor (let c = 1; c < lines.length; c++)\n\t\t\t\t\tcontext.lineTo(lines[c].x, lines[c].y);\n\t\t\t\tcontext.endFill();\n\t\t\t\tbreak;\n\t\t\tcase Mode.Circ:\n\t\t\t\tif (this.points.length < 2) break;\n\t\t\t\tconst dimensions = this._calculateCircle();\n\t\t\t\tcontext.beginFill(0, 0)\n\t\t\t\t\t.lineStyle(6, 0xffaacc, 1, 0.5)\n\t\t\t\t\t.drawEllipse(dimensions.x, dimensions.y, dimensions.w, dimensions.h)\n\t\t\t\t\t.endFill();\n\t\t\t\tbreak;\n\t\t\tcase Mode.Rect:\n\t\t\t\tif (this.points.length == 0) break;\n\t\t\t\tconst bounds = this.bounds;\n\t\t\t\tcontext.beginFill(0, 0)\n\t\t\t\t\t.lineStyle(6, 0xffaacc, 1, 0.5)\n\t\t\t\t\t.drawRect(bounds.minX, bounds.minY, bounds.maxX - bounds.minX, bounds.maxY - bounds.minY)\n\t\t\t\t\t.endFill();\n\t\t\t\tbreak;\n\t\t}\n\t\tconst fill = [0x44ffaa, 0xff4444, 0x4444ff, 0xdd44dd, 0xdddd44];\n\t\tthis.points.forEach((x, idx) => this.drawHandle(context, fill[idx], x));\n\t}\n\tcheckPointForClick(point: PIXI.Point, event: PIXI.InteractionEvent): boolean {\n\t\tconst utility = new PointInputHandler(this, point);\n\t\tconst snap = utility.shouldSnap(event);\n\n\t\tif (event.data.originalEvent.ctrlKey) {\n\t\t\tconst handle = this.points.findIndex(e => pointNearPoint(point, e, BezierTool.HANDLE_RADIUS));\n\t\t\tif (handle < 0) return false;\n\t\t\tthis.points.splice(handle, 1);\n\t\t\treturn true;\n\t\t}\n\t\t// If we are clicking on an already existing point, or we have max points\n\t\tif (this.points.find(e => pointNearPoint(point, e, BezierTool.HANDLE_RADIUS))) return false;\n\n\t\tswitch (CurvyWallToolManager.instance.mode) {\n\t\t\t// case Mode.Cube:\n\t\t\tcase Mode.Quad:\n\t\t\t\tif (this.points.length == 3) return false;\n\t\t\t\tthis.points.push(utility.getWallEndPoint(point, snap));\n\t\t\t\treturn true;\n\t\t\tcase Mode.Circ:\n\t\t\t// if (this.points.length == 4) return false;\n\t\t\t// this.points.push(utility.getWallEndPoint(point, snap));\n\t\t\t// return true;\n\t\t\t\t// fallthrough\n\t\t\tcase Mode.Rect:\n\t\t\t\tif (this.points.length == 4) return false;\n\t\t\t\tthis.points.push(utility.getWallEndPoint(point, snap));\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\tcheckPointForDrag(point: PIXI.Point): InputHandler | null {\n\t\tconst target = this.points.find(x => pointNearPoint(point, x, BezierTool.HANDLE_RADIUS));\n\t\tif (!target) return null;\n\t\treturn new PointInputHandler(this, target);\n\t}\n\n\tgetTooltipMessage(): string {\n\t\tswitch (CurvyWallToolManager.instance.mode) {\n\t\t\t// case Mode.Cube:\n\t\t\t// \treturn \"You need to place 3 points to generate a Bezier Cubic Curve.\";\n\t\t\tcase Mode.Quad: return \"df-curvy-walls.pointmap_quad\";\n\t\t\tcase Mode.Circ: return \"df-curvy-walls.pointmap_circ\";\n\t\t\tcase Mode.Rect: return \"df-curvy-walls.pointmap_rect\";\n\t\t}\n\t\treturn \"\";\n\t}\n\thasEnoughData(): boolean {\n\t\tswitch (CurvyWallToolManager.instance.mode) {\n\t\t\t// case Mode.Cube:\n\t\t\tcase Mode.Quad:\n\t\t\t\treturn this.points.length == 3;\n\t\t\tcase Mode.Circ:\n\t\t\tcase Mode.Rect:\n\t\t\t\treturn this.points.length >= 2;\n\t\t}\n\t\treturn false;\n\t}\n\n\tbindData(tool: BezierTool) {\n\t\tswitch (CurvyWallToolManager.instance.mode) {\n\t\t\t// case Mode.Cube:\n\t\t\t// \tcurve = Bezier.cubicFromPoints(this.points[0], this.points[1], this.points[2]);\n\t\t\t// \ttool.lineA.copyFrom(curve.points[0]);\n\t\t\t// \ttool.lineB.copyFrom(curve.points[3]);\n\t\t\t// \t(<PIXI.Point>(<any>tool).controlA).copyFrom(curve.points[1]);\n\t\t\t// \t(<PIXI.Point>(<any>tool).controlB).copyFrom(curve.points[2]);\n\t\t\t// \tbreak;\n\t\t\tcase Mode.Quad:\n\t\t\t\ttool.lineA.copyFrom(this.points[0]);\n\t\t\t\ttool.lineB.copyFrom(this.points[2]);\n\t\t\t\t(<PIXI.Point>(<any>tool).control).copyFrom(this.points[1]);\n\t\t\t\tbreak;\n\t\t\tcase Mode.Circ:\n\t\t\t\tconst dimens = this._calculateCircle();\n\t\t\t\ttool.lineA.set(dimens.x - dimens.w, dimens.y - dimens.h);\n\t\t\t\ttool.lineB.set(dimens.x + dimens.w, dimens.y + dimens.h);\n\t\t\t\tbreak;\n\t\t\tcase Mode.Rect:\n\t\t\t\tconst bounds = this.bounds;\n\t\t\t\ttool.lineA.set(bounds.minX, bounds.minY);\n\t\t\t\ttool.lineB.set(bounds.maxX, bounds.maxY);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate _calculateCircle(): { x: number, y: number, w: number, h: number } {\n\t\tconst result: { x: number, y: number, w: number, h: number } = { x: 0, y: 0, w: 0, h: 0 };\n\t\tif (this.points.length == 2) {\n\t\t\tresult.x = this.points[0].x;\n\t\t\tresult.y = this.points[0].y;\n\t\t\tconst size = Math.sqrt(Math.pow(this.points[1].x - result.x, 2) + Math.pow(this.points[1].y - result.y, 2));\n\t\t\tresult.w = size;\n\t\t\tresult.h = size;\n\t\t} else if (this.points.length == 3) {\n\t\t\tconst p1 = this.points[0];\n\t\t\tconst p2 = this.points[1];\n\t\t\tconst p3 = this.points[2];\n\t\t\tconst circle = generateCircle(p1, p2, p3);\n\t\t\tresult.x = circle.center.x;\n\t\t\tresult.y = circle.center.y;\n\t\t\tresult.w = circle.radius;\n\t\t\tresult.h = circle.radius;\n\t\t} else if (this.points.length == 4) {\n\t\t\tconst bounds = this.bounds;\n\t\t\tresult.x = (bounds.minX + bounds.maxX) / 2;\n\t\t\tresult.y = (bounds.minY + bounds.maxY) / 2;\n\t\t\tresult.w = (bounds.maxX - bounds.minX) / 2;\n\t\t\tresult.h = (bounds.maxY - bounds.minY) / 2;\n\t\t}\n\t\treturn result;\n\t}\n\n\tgetSegments(_count: number): PIXI.Point[] | PIXI.Point[][] { throw new Error(\"Method not implemented.\"); }\n\tplaceTool(_point: PIXI.Point, _data: object): void { throw new Error(\"Method not implemented.\"); }\n\tgetData(): object { throw new Error(\"Method not implemented.\"); }\n\tgetTools(): Record<string, CurvyWallControl> { throw new Error(\"Method not implemented.\"); }\n}\n\nfunction isPerpendicular(p1: Point, p2: Point, p3: Point): boolean {\n\tconst yDelta_a: number = p2.y - p1.y;\n\tconst xDelta_a: number = p2.x - p1.x;\n\tconst yDelta_b: number = p3.y - p2.y;\n\tconst xDelta_b: number = p3.x - p2.x;\n\t// checking whether the line of the two pts are vertical\n\tif (Math.abs(xDelta_a) <= 0.000000001 && Math.abs(yDelta_b) <= 0.000000001) {\n\t\treturn false;\n\t}\n\tif (Math.abs(yDelta_a) <= 0.0000001) return true;\n\telse if (Math.abs(yDelta_b) <= 0.0000001) return true;\n\telse if (Math.abs(xDelta_a) <= 0.000000001) return true;\n\telse if (Math.abs(xDelta_b) <= 0.000000001) return true;\n\telse return false;\n}\nfunction calcCircle(pt1: Point, pt2: Point, pt3: Point): { center: Point, radius: number } {\n\tconst yDelta_a = pt2.y - pt1.y;\n\tconst xDelta_a = pt2.x - pt1.x;\n\tconst yDelta_b = pt3.y - pt2.y;\n\tconst xDelta_b = pt3.x - pt2.x;\n\tconst center = new PIXI.Point();\n\tlet radius = 0;\n\n\tif (Math.abs(xDelta_a) <= 0.000000001 && Math.abs(yDelta_b) <= 0.000000001) {\n\t\tcenter.x = 0.5 * (pt2.x + pt3.x);\n\t\tcenter.y = 0.5 * (pt1.y + pt2.y);\n\t\tradius = Math.sqrt(Math.pow(pt1.x - center.x, 2) + Math.pow(pt1.y - center.y, 2));\n\t\treturn { center, radius };\n\t}\n\n\t// IsPerpendicular() assure that xDelta(s) are not zero\n\tconst aSlope = yDelta_a / xDelta_a;\n\tconst bSlope = yDelta_b / xDelta_b;\n\tif (Math.abs(aSlope - bSlope) <= 0.000000001) {// checking whether the given points are colinear. \t\n\t\treturn { center, radius: -1 };\n\t}\n\n\t// calc center\n\tcenter.x = (aSlope * bSlope * (pt1.y - pt3.y) + bSlope * (pt1.x + pt2.x) - aSlope * (pt2.x + pt3.x)) / (2 * (bSlope - aSlope));\n\tcenter.y = -1 * (center.x - (pt1.x + pt2.x) / 2) / aSlope + (pt1.y + pt2.y) / 2;\n\n\tradius = Math.sqrt(Math.pow(pt1.x - center.x, 2) + Math.pow(pt1.y - center.y, 2));\n\treturn { center, radius };\n}\n\nfunction generateCircle(pt1: Point, pt2: Point, pt3: Point): { center: Point, radius: number } {\n\tif (!isPerpendicular(pt1, pt2, pt3)) return calcCircle(pt1, pt2, pt3);\n\telse if (!isPerpendicular(pt1, pt3, pt2)) return calcCircle(pt1, pt3, pt2);\n\telse if (!isPerpendicular(pt2, pt1, pt3)) return calcCircle(pt2, pt1, pt3);\n\telse if (!isPerpendicular(pt2, pt3, pt1)) return calcCircle(pt2, pt3, pt1);\n\telse if (!isPerpendicular(pt3, pt2, pt1)) return calcCircle(pt3, pt2, pt1);\n\telse if (!isPerpendicular(pt3, pt1, pt2)) return calcCircle(pt3, pt1, pt2);\n\telse return { center: null, radius: -1 };\n}","\nimport { BezierTool, ToolMode } from './BezierTool';\nimport { PointArrayInputHandler, InputHandler, PointInputHandler, InitializerInputHandler } from \"./ToolInputHandler\";\nimport { CurvyWallControl } from '../CurvyWallsToolBar';\nimport { Bezier } from '../../libs/bezier';\n\nconst pointNearPoint = BezierTool.pointNearPoint;\ndeclare type Point = PIXI.Point;\n\nclass InitializerIH extends InitializerInputHandler {\n\tprivate get quadTool(): QuadTool { return this.tool as QuadTool; }\n\tconstructor(tool: QuadTool, success: () => void, fail: () => void) {\n\t\tsuper(tool, false, tool.lineA, tool.lineB, success, fail);\n\t}\n\tmove(origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tsuper.move(origin, destination, event);\n\t\tconst cX = (this.tool.lineB.x + this.tool.lineA.x) / 2;\n\t\tconst cY = (this.tool.lineB.y + this.tool.lineA.y) / 2;\n\t\tlet nY = -(this.tool.lineB.x - this.tool.lineA.x);\n\t\tlet nX = this.tool.lineB.y - this.tool.lineA.y;\n\t\t// const length = Math.sqrt((nX * nX) + (nY * nY));\n\t\tnX *= 0.25;\n\t\tnY *= 0.25;\n\t\tthis.quadTool.control.set(cX + nX, cY + nY);\n\t}\n}\n\nexport default class QuadTool extends BezierTool {\n\tprivate bezier: Bezier;\n\tlineA = new PIXI.Point();\n\tlineB = new PIXI.Point();\n\tcontrol = new PIXI.Point();\n\n\tget handles(): Point[] { return [this.lineA, this.control, this.lineB]; }\n\tget bounds(): PIXI.Bounds {\n\t\tconst b = new PIXI.Bounds();\n\t\tb.addPoint(this.lineA);\n\t\tb.addPoint(this.lineB);\n\t\tb.addPoint(this.control);\n\t\treturn b;\n\t}\n\tget polygon(): PIXI.Polygon { return new PIXI.Polygon([this.lineA, this.lineB, this.control]); }\n\n\tconstructor(segments: number = 10) {\n\t\tsuper(segments);\n\t\t// this.bezier = new Bezier([0, 0, 0, 0, 0, 0]);\n\t}\n\n\tgetSegments(count: number): PIXI.Point[] | PIXI.Point[][] {\n\t\tif (this.mode == ToolMode.NotPlaced) return [];\n\t\tthis.bezier = Bezier.quadraticFromPoints(this.lineA, this.control, this.lineB);\n\t\t// this.bezier.points = this.handles;\n\t\t// this.bezier.update();\n\t\treturn (this.lastSegmentFetch = this.bezier.getLUT(count + 2).map((e: { x: number, y: number }) => new PIXI.Point(e.x, e.y)));\n\t}\n\tdrawHandles(context: PIXI.Graphics): void {\n\t\tif (this.mode == ToolMode.NotPlaced) return;\n\t\tthis.drawBoundingBox(context);\n\t\t// context.beginFill(0xffaacc)\n\t\t// \t.lineStyle(BezierTool.LINE_SIZE, 0xffaacc, 1, 0.5)\n\t\t// \t.moveTo(this.lineA.x, this.lineA.y)\n\t\t// \t.lineTo(this.control.x, this.control.y)\n\t\t// \t.moveTo(this.lineB.x, this.lineB.y)\n\t\t// \t.lineTo(this.control.x, this.control.y)\n\t\t// \t.endFill();\n\t\tsuper.drawSegmentLabel(context);\n\t\tthis.drawHandle(context, 0xff4444, this.lineA);\n\t\tthis.drawHandle(context, 0xff4444, this.lineB);\n\t\tthis.drawHandle(context, 0xaaff44, this.control);\n\t}\n\tcheckPointForDrag(point: Point): InputHandler | null {\n\t\tif (this.mode == ToolMode.NotPlaced) {\n\t\t\tthis.setMode(ToolMode.Placing);\n\t\t\treturn new InitializerIH(this, () => this.setMode(ToolMode.Placed), () => this.setMode(ToolMode.NotPlaced));\n\t\t}\n\t\tif (pointNearPoint(point, this.lineA, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.lineA);\n\t\telse if (pointNearPoint(point, this.lineB, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.lineB);\n\t\telse if (pointNearPoint(point, this.control, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.control);\n\t\telse if (this.polygon.contains(point.x, point.y))\n\t\t\treturn new PointArrayInputHandler(this, point, this.handles);\n\t\treturn null;\n\t}\n\n\tgetTools(): Record<string, CurvyWallControl> { return {}; }\n\tplaceTool(point: PIXI.Point, data: { l1: number[], l2: number[], c: number[] }) {\n\t\tthis.lineA.set(data.l1[0] + point.x, data.l1[1] + point.y);\n\t\tthis.lineB.set(data.l2[0] + point.x, data.l2[1] + point.y);\n\t\tthis.control.set(data.c[0] + point.x, data.c[1] + point.y);\n\t\tthis.setMode(ToolMode.Placed);\n\t}\n\tgetData() {\n\t\tconst center = this.lineCenter;\n\t\treturn {\n\t\t\tl1: [this.lineA.x - center.x, this.lineA.y - center.y],\n\t\t\tl2: [this.lineB.x - center.x, this.lineB.y - center.y],\n\t\t\tc: [this.control.x - center.x, this.control.y - center.y]\n\t\t};\n\t}\n}","import { CurvyWallControl } from \"../CurvyWallsToolBar\";\nimport { BezierTool, ToolMode } from \"./BezierTool\";\nimport { InitializerInputHandler, InputHandler, PointArrayInputHandler, PointInputHandler } from \"./ToolInputHandler\";\n\nconst pointNearPoint = BezierTool.pointNearPoint;\n\nclass InitializerIH extends InitializerInputHandler {\n\tconstructor(tool: RectangleTool, success: () => void, fail: () => void) {\n\t\tsuper(tool, true, tool.lineA, tool.lineB, success, fail);\n\t}\n}\n\nexport default class RectangleTool extends BezierTool {\n\tlineA = new PIXI.Point();\n\tlineB = new PIXI.Point();\n\tprivate lastCount = 0;\n\tprivate topCount = 0;\n\tprivate rightCount = 0;\n\tprivate bottomCount = 0;\n\tprivate leftCount = 0;\n\tprivate buttonRadius = 50;\n\tprivate buttonOffset = 15;\n\tprivate incTop: PreciseText;\n\tprivate decTop: PreciseText;\n\tprivate incRight: PreciseText;\n\tprivate decRight: PreciseText;\n\tprivate incBottom: PreciseText;\n\tprivate decBottom: PreciseText;\n\tprivate incLeft: PreciseText;\n\tprivate decLeft: PreciseText;\n\tprivate textTop: PreciseText;\n\tprivate textRight: PreciseText;\n\tprivate textBottom: PreciseText;\n\tprivate textLeft: PreciseText;\n\n\tprivate static readonly STYLE = new PIXI.TextStyle({\n\t\tfontFamily: CONFIG.defaultFontFamily,\n\t\tfontSize: 48,\n\t\tfill: \"#BBBBBB\",\n\t\tstroke: \"#111111\",\n\t\tstrokeThickness: 4,\n\t\tdropShadow: true,\n\t\tdropShadowColor: \"#000000\",\n\t\tdropShadowBlur: Math.max(Math.round(24 / 16), 2),\n\t\tdropShadowAngle: 0,\n\t\tdropShadowDistance: 0,\n\t\tpadding: 1\n\t});\n\n\tget handles(): PIXI.Point[] { return [this.lineA, this.lineB]; }\n\tget bounds(): PIXI.Bounds {\n\t\tconst b = new PIXI.Bounds();\n\t\tb.addPoint(this.lineA);\n\t\tb.addPoint(this.lineB);\n\t\treturn b;\n\t}\n\tget rect(): PIXI.Rectangle { return new PIXI.Rectangle(this.lineA.x, this.lineA.y, this.lineB.x, this.lineB.y); }\n\n\tconstructor() {\n\t\tsuper(1);\n\t\tthis.incTop = RectangleTool.createLineLabel('+');\n\t\tthis.decTop = RectangleTool.createLineLabel('-');\n\t\tthis.incRight = RectangleTool.createLineLabel('+');\n\t\tthis.decRight = RectangleTool.createLineLabel('-');\n\t\tthis.incBottom = RectangleTool.createLineLabel('+');\n\t\tthis.decBottom = RectangleTool.createLineLabel('-');\n\t\tthis.incLeft = RectangleTool.createLineLabel('+');\n\t\tthis.decLeft = RectangleTool.createLineLabel('-');\n\t\tthis.textTop = BezierTool.createText('');\n\t\tthis.textRight = BezierTool.createText('');\n\t\tthis.textBottom = BezierTool.createText('');\n\t\tthis.textLeft = BezierTool.createText('');\n\t\tthis.incTop.tint = 0xaaff44;\n\t\tthis.incBottom.tint = 0xaaff44;\n\t\tthis.incRight.tint = 0xaaff44;\n\t\tthis.incLeft.tint = 0xaaff44;\n\t\tthis.decTop.tint = 0xff4444;\n\t\tthis.decBottom.tint = 0xff4444;\n\t\tthis.decRight.tint = 0xff4444;\n\t\tthis.decLeft.tint = 0xff4444;\n\t\tthis.textRight.rotation = Math.PI / 2;\n\t\tthis.textLeft.rotation = -Math.PI / 2;\n\t}\n\n\tprivate static createLineLabel(text: string): PreciseText {\n\t\tconst result = new PreciseText(text, RectangleTool.STYLE);\n\t\tresult.anchor.set(0.5, 0.5);\n\t\treturn result;\n\t}\n\n\tclearContext(context: PIXI.Graphics) {\n\t\tsuper.clearContext(context);\n\t\tcontext.removeChild(this.incTop);\n\t\tcontext.removeChild(this.decTop);\n\t\tcontext.removeChild(this.incRight);\n\t\tcontext.removeChild(this.decRight);\n\t\tcontext.removeChild(this.incBottom);\n\t\tcontext.removeChild(this.decBottom);\n\t\tcontext.removeChild(this.incLeft);\n\t\tcontext.removeChild(this.decLeft);\n\t\tcontext.removeChild(this.textTop);\n\t\tcontext.removeChild(this.textRight);\n\t\tcontext.removeChild(this.textBottom);\n\t\tcontext.removeChild(this.textLeft);\n\t}\n\tdrawHandles(context: PIXI.Graphics) {\n\t\tif (this.mode == ToolMode.NotPlaced) return;\n\t\tthis.drawBoundingBox(context);\n\t\tcontext.beginFill(0xffaacc)\n\t\t\t.lineStyle(BezierTool.LINE_SIZE, 0xffaacc, 1, 0.5)\n\t\t\t.moveTo(this.lineA.x, this.lineA.y)\n\t\t\t.lineTo(this.lineB.x, this.lineB.y)\n\t\t\t.endFill();\n\t\tthis.drawSegmentLabels(context);\n\t\tthis.drawButtons(context);\n\t\tthis.drawHandle(context, 0xff4444, this.lineA);\n\t\tthis.drawHandle(context, 0xaaff44, this.lineB);\n\t}\n\tprotected drawSegmentLabels(context: PIXI.Graphics) {\n\t\tthis.textTop.text = `${Math.trunc(this.topCount + this.lastCount)}`;\n\t\tthis.textRight.text = `${Math.trunc(this.rightCount + this.lastCount)}`;\n\t\tthis.textBottom.text = `${Math.trunc(this.bottomCount + this.lastCount)}`;\n\t\tthis.textLeft.text = `${Math.trunc(this.leftCount + this.lastCount)}`;\n\t\tconst offset = 25;\n\t\tconst bounds = this.bounds;\n\t\tthis.textTop.position = new PIXI.Point(this.lineCenter.x, bounds.minY - offset);\n\t\tthis.textBottom.position = new PIXI.Point(this.lineCenter.x, bounds.maxY + offset);\n\t\tthis.textLeft.position = new PIXI.Point(bounds.minX - offset, this.lineCenter.y);\n\t\tthis.textRight.position = new PIXI.Point(bounds.maxX + offset, this.lineCenter.y);\n\t\tcontext.addChild(this.textTop, this.textRight, this.textBottom, this.textLeft);\n\t}\n\tprotected drawButtons(context: PIXI.Graphics) {\n\t\t// Add buttons to each side for inc/dec segment count on that side.\n\t\tconst center = this.lineCenter;\n\n\t\tthis.incTop.position = new PIXI.Point(center.x + this.buttonOffset, center.y - this.buttonRadius);\n\t\tthis.decTop.position = new PIXI.Point(center.x - this.buttonOffset, center.y - this.buttonRadius);\n\t\tthis.incBottom.position = new PIXI.Point(center.x + this.buttonOffset, center.y + this.buttonRadius);\n\t\tthis.decBottom.position = new PIXI.Point(center.x - this.buttonOffset, center.y + this.buttonRadius);\n\t\tthis.incLeft.position = new PIXI.Point(center.x - this.buttonRadius, center.y - this.buttonOffset);\n\t\tthis.decLeft.position = new PIXI.Point(center.x - this.buttonRadius, center.y + this.buttonOffset);\n\t\tthis.incRight.position = new PIXI.Point(center.x + this.buttonRadius, center.y - this.buttonOffset);\n\t\tthis.decRight.position = new PIXI.Point(center.x + this.buttonRadius, center.y + this.buttonOffset);\n\n\t\tcontext.addChild(this.incTop, this.decTop, this.incRight, this.decRight,\n\t\t\tthis.incBottom, this.decBottom, this.incLeft, this.decLeft);\n\t}\n\tgetSegments(count: number): PIXI.Point[] | PIXI.Point[][] {\n\t\tif (this.mode == ToolMode.NotPlaced) return [];\n\t\tthis.lastCount = count;\n\t\tconst bounds = this.bounds;\n\n\t\tconst width = bounds.maxX - bounds.minX;\n\t\tconst height = bounds.maxY - bounds.minY;\n\t\tconst points: PIXI.Point[][] = [];\n\t\t// top\n\t\tlet size = width / (count + this.topCount);\n\t\tfor (let c = 0; c < count + this.topCount; c++) {\n\t\t\tpoints.push([\n\t\t\t\tnew PIXI.Point(bounds.minX + (c * size), bounds.minY),\n\t\t\t\tnew PIXI.Point(bounds.minX + ((c + 1) * size), bounds.minY)\n\t\t\t]);\n\t\t}\n\t\t// right\n\t\tsize = height / (count + this.rightCount);\n\t\tfor (let c = 0; c < count + this.rightCount; c++) {\n\t\t\tpoints.push([\n\t\t\t\tnew PIXI.Point(bounds.maxX, bounds.minY + (c * size)),\n\t\t\t\tnew PIXI.Point(bounds.maxX, bounds.minY + ((c + 1) * size))\n\t\t\t]);\n\t\t}\n\t\t// bottom\n\t\tsize = width / (count + this.bottomCount);\n\t\tfor (let c = 0; c < count + this.bottomCount; c++) {\n\t\t\tpoints.push([\n\t\t\t\tnew PIXI.Point(bounds.maxX - (c * size), bounds.maxY),\n\t\t\t\tnew PIXI.Point(bounds.maxX - ((c + 1) * size), bounds.maxY)\n\t\t\t]);\n\t\t}\n\t\t// left\n\t\tsize = height / (count + this.leftCount);\n\t\tfor (let c = 0; c < count + this.leftCount; c++) {\n\t\t\tpoints.push([\n\t\t\t\tnew PIXI.Point(bounds.minX, bounds.maxY - (c * size)),\n\t\t\t\tnew PIXI.Point(bounds.minX, bounds.maxY - ((c + 1) * size))\n\t\t\t]);\n\t\t}\n\t\treturn (this.lastSegmentFetch = points);\n\t}\n\tcheckPointForDrag(point: PIXI.Point): InputHandler | null {\n\t\tif (this.mode == ToolMode.NotPlaced) {\n\t\t\tthis.setMode(ToolMode.Placing);\n\t\t\treturn new InitializerIH(this, () => this.setMode(ToolMode.Placed), () => this.setMode(ToolMode.NotPlaced));\n\t\t}\n\t\tif (pointNearPoint(point, this.lineA, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.lineA, null, this.lineB);\n\t\telse if (pointNearPoint(point, this.lineB, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.lineB, null, this.lineA);\n\t\telse if (this.rect.contains(point.x, point.y))\n\t\t\treturn new PointArrayInputHandler(this, point, this.handles);\n\t\treturn null;\n\t}\n\n\tcheckPointForClick(point: PIXI.Point): boolean {\n\t\tif (pointNearPoint(point, this.incTop.position, BezierTool.HANDLE_RADIUS * 2)) {\n\t\t\tthis.topCount = Math.clamped(this.topCount + 1, -64, 64);\n\t\t\treturn true;\n\t\t}\n\t\tif (pointNearPoint(point, this.decTop.position, BezierTool.HANDLE_RADIUS * 2)) {\n\t\t\tthis.topCount = Math.clamped(this.topCount - 1, -64, 64);\n\t\t\treturn true;\n\t\t}\n\t\tif (pointNearPoint(point, this.incRight.position, BezierTool.HANDLE_RADIUS * 2)) {\n\t\t\tthis.rightCount = Math.clamped(this.rightCount + 1, -64, 64);\n\t\t\treturn true;\n\t\t}\n\t\tif (pointNearPoint(point, this.decRight.position, BezierTool.HANDLE_RADIUS * 2)) {\n\t\t\tthis.rightCount = Math.clamped(this.rightCount - 1, -64, 64);\n\t\t\treturn true;\n\t\t}\n\t\tif (pointNearPoint(point, this.incBottom.position, BezierTool.HANDLE_RADIUS * 2)) {\n\t\t\tthis.bottomCount = Math.clamped(this.bottomCount + 1, -64, 64);\n\t\t\treturn true;\n\t\t}\n\t\tif (pointNearPoint(point, this.decBottom.position, BezierTool.HANDLE_RADIUS * 2)) {\n\t\t\tthis.bottomCount = Math.clamped(this.bottomCount - 1, -64, 64);\n\t\t\treturn true;\n\t\t}\n\t\tif (pointNearPoint(point, this.incLeft.position, BezierTool.HANDLE_RADIUS * 2)) {\n\t\t\tthis.leftCount = Math.clamped(this.leftCount + 1, -64, 64);\n\t\t\treturn true;\n\t\t}\n\t\tif (pointNearPoint(point, this.decLeft.position, BezierTool.HANDLE_RADIUS * 2)) {\n\t\t\tthis.leftCount = Math.clamped(this.leftCount - 1, -64, 64);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetTools(): Record<string, CurvyWallControl> { return {}; }\n\tplaceTool(point: PIXI.Point, data: { l1: number[], l2: number[], t: number, r: number, b: number, l: number }) {\n\t\tthis.lineA.set(data.l1[0] + point.x, data.l1[1] + point.y);\n\t\tthis.lineB.set(data.l2[0] + point.x, data.l2[1] + point.y);\n\t\tthis.topCount = data.t;\n\t\tthis.rightCount = data.r;\n\t\tthis.bottomCount = data.b;\n\t\tthis.leftCount = data.l;\n\t\tthis.setMode(ToolMode.Placed);\n\t}\n\tgetData() {\n\t\tconst center = this.lineCenter;\n\t\treturn {\n\t\t\tl1: [this.lineA.x - center.x, this.lineA.y - center.y],\n\t\t\tl2: [this.lineB.x - center.x, this.lineB.y - center.y],\n\t\t\tt: this.topCount,\n\t\t\tr: this.rightCount,\n\t\t\tb: this.bottomCount,\n\t\t\tl: this.leftCount\n\t\t};\n\t}\n\tinitialPoints(): number[] { return [0, 0, 0, 0, 0, 0]; }\n}","import { BezierTool } from \"./BezierTool\";\n\ndeclare type Point = PIXI.Point;\nexport abstract class InputHandler {\n\tprivate _tool: BezierTool;\n\tget tool(): BezierTool { return this._tool; }\n\tconstructor(tool: BezierTool) {\n\t\tthis._tool = tool;\n\t}\n\n\tabstract start(origin: Point, destination: Point, event: PIXI.InteractionEvent): void;\n\tabstract move(origin: Point, destination: Point, event: PIXI.InteractionEvent): void;\n\tabstract stop(origin: Point, destination: Point, event: PIXI.InteractionEvent): void;\n\tabstract cancel(): void;\n\tstatic finalPoint(point: Point, snap: boolean = true) {\n\t\treturn (<any>(<Canvas>canvas).walls)._getWallEndpointCoordinates(point, { snap: snap });\n\t}\n\n\tprotected get walls(): WallsLayer { return (canvas as any).walls as WallsLayer; }\n\n\tshouldSnap(event: PIXI.InteractionEvent) {\n\t\tconst { originalEvent } = event.data;\n\t\treturn (<any>this.walls)._forceSnap || !originalEvent.shiftKey;\n\t}\n\n\tgetWallEndPoint(origin: PIXI.Point, snap: boolean): PIXI.Point {\n\t\t// Determine the starting coordinates\n\t\treturn new PIXI.Point(...(<any>this.walls)._getWallEndpointCoordinates(origin, { snap }));\n\t}\n\n\tstatic squarePoint(origin: Point, destination: Point): PIXI.Point {\n\t\t/*\t\n\t\t\t 4  1 \n\t\t\t\n\t\t\t 3  2 \n\t\t\t\t*/\n\t\tconst min = Math.max(Math.abs(destination.x - origin.x), Math.abs(destination.y - origin.y));\n\t\tif (destination.x > origin.x) {\n\t\t\t// Quadrant 1\n\t\t\tif (destination.y < origin.y)\n\t\t\t\treturn new PIXI.Point(origin.x + min, origin.y - min);\n\t\t\t// Quadrant 2\n\t\t\telse return new PIXI.Point(origin.x + min, origin.y + min);\n\t\t}\n\t\t// Quadrant 3\n\t\telse if (destination.y > origin.y)\n\t\t\treturn new PIXI.Point(origin.x - min, origin.y + min);\n\t\t// Quadrant 4\n\t\telse return new PIXI.Point(origin.x - min, origin.y - min);\n\t}\n}\n\nexport abstract class InitializerInputHandler extends InputHandler {\n\tlineA: Point;\n\tlineB: Point;\n\tprotected squaring: boolean;\n\tprotected success: () => void;\n\tprotected fail: () => void;\n\tconstructor(tool: BezierTool, squaring: boolean, lineA: Point, lineB: Point, success: () => void, fail: () => void) {\n\t\tsuper(tool);\n\t\tthis.lineA = lineA;\n\t\tthis.lineB = lineB;\n\t\tthis.squaring = squaring;\n\t\tthis.success = success;\n\t\tthis.fail = fail;\n\t}\n\tstart(origin: Point, destination: Point, event: PIXI.InteractionEvent) {\n\t\tconst snap = this.shouldSnap(event);\n\t\tthis.lineA.copyFrom(this.getWallEndPoint(origin, snap) as PIXI.Point);\n\t\tthis.lineB.copyFrom(this.getWallEndPoint(destination, snap) as PIXI.Point);\n\t}\n\tmove(origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tconst snap = this.shouldSnap(event);\n\t\tconst destPoint = this.squaring && event.data.originalEvent.altKey ? InputHandler.squarePoint(origin, destination) : destination;\n\t\tconst origPoint = !this.tool.startedWithCtrlHeld && event.data.originalEvent.ctrlKey ? new PIXI.Point(origin.x - (destPoint.x - origin.x), origin.y - (destPoint.y - origin.y)) : origin;\n\t\tthis.lineA.copyFrom(this.getWallEndPoint(origPoint, snap) as PIXI.Point);\n\t\tthis.lineB.copyFrom(this.getWallEndPoint(destPoint, snap) as PIXI.Point);\n\t}\n\tstop(origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tconst snap = this.shouldSnap(event);\n\t\tif (this.squaring && event.data.originalEvent.altKey)\n\t\t\tthis.lineB.copyFrom(this.getWallEndPoint(InputHandler.squarePoint(origin, destination), snap) as PIXI.Point);\n\t\telse\n\t\t\tthis.lineB.copyFrom(this.getWallEndPoint(destination, snap) as PIXI.Point);\n\t\tthis.success();\n\t}\n\tcancel() {\n\t\tthis.fail();\n\t}\n}\n\nexport class PointInputHandler extends InputHandler {\n\tprivate _origin: Point;\n\tprivate _originalPoint = new PIXI.Point(0, 0);\n\tpoint: Point;\n\tcompletion?: (sender: PointInputHandler) => void = null;\n\tconstructor(tool: BezierTool, destination: Point, completion: (sender: PointInputHandler) => void = null, origin?: Point) {\n\t\tsuper(tool);\n\t\tthis._originalPoint.copyFrom(destination);\n\t\tthis._origin = origin;\n\t\tthis.point = destination;\n\t\tthis.completion = completion;\n\t}\n\tstart(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tthis.move(null, destination, event);\n\t}\n\tmove(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tif (!!this._origin && event.data.originalEvent.altKey)\n\t\t\tthis.point.copyFrom(this.getWallEndPoint(InputHandler.squarePoint(this._origin, destination), this.shouldSnap(event)) as PIXI.Point);\n\t\telse\n\t\t\tthis.point.copyFrom(this.getWallEndPoint(destination, this.shouldSnap(event)) as PIXI.Point);\n\t}\n\tstop(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tif (!!this._origin && event.data.originalEvent.altKey)\n\t\t\tthis.point.copyFrom(this.getWallEndPoint(InputHandler.squarePoint(this._origin, destination), this.shouldSnap(event)) as PIXI.Point);\n\t\telse\n\t\t\tthis.point.copyFrom(this.getWallEndPoint(destination, this.shouldSnap(event)) as PIXI.Point);\n\t\tif (this.completion != null)\n\t\t\tthis.completion(this);\n\t}\n\tcancel() {\n\t\tthis.point.copyFrom(this._originalPoint);\n\t\tif (this.completion != null)\n\t\t\tthis.completion(this);\n\t}\n}\n\nexport class PointArrayInputHandler extends InputHandler {\n\tprivate originalPoints: Point[] = [];\n\tpoints: PIXI.Point[];\n\tprivate _start: Point;\n\tcompletion: (sender: PointArrayInputHandler) => void;\n\tconstructor(tool: BezierTool, start: Point, points: Point[], completion: (sender: PointArrayInputHandler) => void = null) {\n\t\tsuper(tool);\n\t\tpoints.forEach(e => this.originalPoints.push(e.clone()));\n\t\tthis.points = points;\n\t\tthis._start = start;\n\t\tthis.completion = completion;\n\t}\n\tprivate moveAll(to: Point, event: PIXI.InteractionEvent) {\n\t\tconst delta = new PIXI.Point(to.x - this._start.x, to.y - this._start.y);\n\t\tconst snap = this.shouldSnap(event);\n\t\tlet o: PIXI.Point;\n\t\tthis.points.forEach((e, i) => {\n\t\t\to = this.originalPoints[i];\n\t\t\te.copyFrom(this.getWallEndPoint(new PIXI.Point(o.x + delta.x, o.y + delta.y), snap));\n\t\t});\n\t}\n\tstart(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tthis.moveAll(destination, event);\n\t}\n\tmove(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tthis.moveAll(destination, event);\n\t}\n\tstop(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tthis.moveAll(destination, event);\n\t\tif (this.completion != null)\n\t\t\tthis.completion(this);\n\t}\n\tcancel() {\n\t\tthis.originalPoints.forEach((e, i) => e.copyTo(this.points[i]));\n\t\tif (this.completion != null)\n\t\t\tthis.completion(this);\n\t}\n}\n\nexport class MagnetPointInputHandler extends InputHandler {\n\tprivate originalPoint = new PIXI.Point(0, 0);\n\tprotected masterPoint: Point;\n\tprotected slavePoint: Point;\n\tprotected offsetX: number;\n\tprotected offsetY: number;\n\tcompletion?: (sender: MagnetPointInputHandler) => void = null;\n\tconstructor(tool: BezierTool, masterPoint: Point, slavePoint: Point, completion: (sender: MagnetPointInputHandler) => void = null) {\n\t\tsuper(tool);\n\t\tthis.originalPoint.copyFrom(masterPoint);\n\t\tthis.masterPoint = masterPoint;\n\t\tthis.slavePoint = slavePoint;\n\t\tthis.offsetX = slavePoint.x - masterPoint.x;\n\t\tthis.offsetY = slavePoint.y - masterPoint.y;\n\t\tthis.completion = completion;\n\t}\n\tstart(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tthis.move(null, destination, event);\n\t}\n\tmove(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tthis.masterPoint.copyFrom(this.getWallEndPoint(destination, this.shouldSnap(event)) as PIXI.Point);\n\t\tthis.slavePoint.set(this.masterPoint.x + this.offsetX, this.masterPoint.y + this.offsetY);\n\t}\n\tstop(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tthis.masterPoint.copyFrom(this.getWallEndPoint(destination, this.shouldSnap(event)) as PIXI.Point);\n\t\tthis.slavePoint.set(this.masterPoint.x + this.offsetX, this.masterPoint.y + this.offsetY);\n\t\tif (this.completion != null)\n\t\t\tthis.completion(this);\n\t}\n\tcancel() {\n\t\tthis.masterPoint.copyFrom(this.originalPoint);\n\t\tthis.slavePoint.set(this.masterPoint.x + this.offsetX, this.masterPoint.y + this.offsetY);\n\t\tif (this.completion != null)\n\t\t\tthis.completion(this);\n\t}\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { CurvyWallsToolBar } from './CurvyWallsToolBar';\nimport { CurvyWallToolManager, Mode } from './CurvyWallToolManager';\nimport SETTINGS from \"../../common/Settings\";\nimport { BezierTool } from './tools/BezierTool';\n\nconst curvyWallApp = new CurvyWallsToolBar();\nSETTINGS.init('df-curvy-walls');\n\nHooks.once('init', function () {\n\tSETTINGS.register(CurvyWallsToolBar.PREF_PRESERVE, {\n\t\tscope: 'world',\n\t\ttype: Boolean,\n\t\tconfig: true,\n\t\tdefault: true,\n\t\tname: 'df-curvy-walls.SettingPreserve_Name',\n\t\thint: 'df-curvy-walls.SettingPreserve_Hint',\n\t});\n\tSETTINGS.register<string>(CurvyWallToolManager.PREF_DROP_KEY, {\n\t\tname: 'df-curvy-walls.SettingDropKey_Name',\n\t\thint: 'df-curvy-walls.SettingDropKey_Hint',\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\tchoices: {\n\t\t\talt: 'df-curvy-walls.SettingDropKey_OptionAlt',\n\t\t\tctrl: 'df-curvy-walls.SettingDropKey_OptionCtrl'\n\t\t},\n\t\tdefault: 'alt',\n\t\ttype: String\n\t});\n\tSETTINGS.register(BezierTool.PREF_SMALL_HANDLES, {\n\t\tname: 'df-curvy-walls.SettingSmallHandlesName',\n\t\thint: 'df-curvy-walls.SettingSmallHandlesHint',\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t});\n\n\tgame.keybindings.register(SETTINGS.MOD_NAME, 'applyTool', {\n\t\tname: 'df-curvy-walls.apply',\n\t\teditable: [{ key: \"Enter\" }],\n\t\tonDown: () => { CurvyWallToolManager.instance.apply(); }\n\t});\n\tgame.keybindings.register(SETTINGS.MOD_NAME, 'cancelTool', {\n\t\tname: 'df-curvy-walls.cancel',\n\t\teditable: [{ key: 'Delete' }],\n\t\tonDown: () => CurvyWallToolManager.instance.clearTool()\n\t});\n\tgame.keybindings.register(SETTINGS.MOD_NAME, 'incrementSegments', {\n\t\tname: 'df-curvy-walls.increment',\n\t\teditable: [{ key: 'Equal' }],\n\t\trepeat: true,\n\t\tonDown: () => { CurvyWallToolManager.instance.segments++; }\n\t});\n\tgame.keybindings.register(SETTINGS.MOD_NAME, 'decrementSegments', {\n\t\tname: 'df-curvy-walls.decrement',\n\t\teditable: [{ key: 'Minus' }],\n\t\trepeat: true,\n\t\tonDown: () => { CurvyWallToolManager.instance.segments--; }\n\t});\n\n\tCurvyWallsToolBar.init();\n\tCurvyWallToolManager.instance.init();\n});\n\nHooks.once(\"ready\", function () {\n\t// Exit if we do not have a canvas\n\tif (game.settings.get('core', 'noCanvas')) return;\n\tif (!game.modules.get('lib-wrapper')?.active) {\n\t\tconsole.error('Missing libWrapper module dependency');\n\t\tif (game.user.isGM)\n\t\t\tui.notifications.error(game.i18n.localize('df-curvy-walls.errorLibWrapperMissing'));\n\t\treturn;\n\t}\n\t// @ts-ignore\n\tcanvas.walls.bezier = CurvyWallToolManager.instance;\n\tCurvyWallToolManager.instance.patchWallsLayer();\n});\n\nlet moduleControls: ControlManager;\n\nHooks.on('renderSceneControls', async (controls: SceneControls) => {\n\t// Exit if we do not have a canvas\n\tif (game.settings.get('core', 'noCanvas')) return;\n\tif (!game.modules.get('lib-wrapper')?.active) return;\n\tif (!game.user.isGM) return;\n\tif (controls.activeControl !== 'walls') {\n\t\tawait curvyWallApp.close();\n\t\tif ((moduleControls as any)._state === 2)\n\t\t\tmoduleControls.refresh();\n\t\treturn;\n\t}\n\telse if ((moduleControls as any)._state === 2)\n\t\tmoduleControls.activateGroupByName(SETTINGS.MOD_NAME);\n\tcurvyWallApp.render(true);\n\tif (CurvyWallToolManager.instance.mode != Mode.None)\n\t\tCurvyWallToolManager.instance.render();\n});\n// Refresh the curvy wall controls when the button bar re-renders\nHooks.on('renderControlManager', () => curvyWallApp.render());\nHooks.on('getModuleToolGroupsPre', (app: ControlManager) => { moduleControls = app; });"],"names":["abs","cos","sin","acos","atan2","sqrt","pow","Math","crt","v","pi","PI","tau","quart","nMax","Number","MAX_SAFE_INTEGER","nMin","MIN_SAFE_INTEGER","ZERO","x","y","z","utils","Tvalues","Cvalues","arcfn","t","derivativeFn","d","l","compute","points","_3d","order","length","mt","p","ret","a","b","c","mt2","t2","dCpts","JSON","parse","stringify","i","splice","computeWithRatios","ratios","r","f1","f2","f3","f4","derive","dpoints","list","dpt","j","push","between","m","M","approximately","precision","len","sum","map","ds","de","ts","te","lerp","v1","v2","pointToString","s","pointsToString","join","copy","obj","angle","o","dx1","dy1","dx2","dy2","round","pos","indexOf","parseFloat","substring","dist","p1","p2","dx","dy","closest","LUT","point","mpos","mdist","forEach","idx","abcratio","n","bottom","projectionratio","top","lli8","x1","y1","x2","y2","x3","y3","x4","y4","lli4","p3","p4","lli","makeline","Bezier","findbbox","sections","mx","my","MX","MY","bbox","min","max","mid","size","shapeintersections","s1","bbox1","s2","bbox2","curveIntersectionThreshold","bboxoverlap","intersections","a1","startcap","forward","back","endcap","a2","l1","virtual","l2","iss","intersects","c1","c2","makeshape","bpl","fpl","start","end","shape","getminmax","curve","concat","get","align","line","tx","ty","roots","aligned","reduce","m1","m2","filter","pa","pb","pc","q","q2","discriminant","u1","mp3","phi","t1","sd","droots","curvature","d1","d2","kOnly","num","dnm","adk","dk","k","dd","qdsum","pk","nk","inflections","slice","v3","trm","sq","b1","b2","dims","dim","expandbox","_bbox","pairiteration","c1b","c2b","threshold","_t1","_t2","cc1","split","cc2","pairs","left","right","pair","results","getccenter","dx1p","dy1p","dx2p","dy2p","mx1","my1","mx2","my2","mx1n","my1n","mx2n","my2n","arc","_","e","numberSort","PolyBezier","constructor","curves","this","valueOf","toString","addCurve","offset","abs$1","cos$1","sin$1","acos$1","sqrt$1","pi$1","coords","args","Array","from","arguments","coordlen","newargs","higher","Error","step","dimlen","_linear","some","_lut","update","static","abc","getABC","A","S","B","E","C","selen","lx","ly","bx1","by1","bx2","by2","e1","e2","nc1","nc2","getUtils","toSVG","last","setRatios","verify","print","coordDigest","_print","computedirection","clockwise","derivative","bind","u","um","getLUT","steps","on","error","lut","hits","project","ft","raise","np","pim","dderivative","normal","__normal3","__normal2","r1","r2","q1","R","hull","_p","pt","result","span","extrema","mfn","sort","values","overlaps","lbbox","tbbox","nv","scale","simple","n1","n2","segment","pass1","pass2","distanceFn","ov","rc","outline","d3","d4","reduced","fcurves","bcurves","alen","tlen","graduated","linearDistanceFunction","slen","reverse","fs","fe","bs","be","ls","le","segments","outlineshapes","shapes","lineIntersects","curveintersects","selfintersects","arcs","errorThreshold","_iterate","_error","np1","ref","circles","safety","t_s","t_e","np2","np3","prev_arc","done","curr_good","prev_good","t_m","prev_e","interval","SETTINGS","moduleName","MOD_NAME","String","prototype","localize","game","i18n","key","config","settings","register","registerMenu","value","set","default","Object","Mode","MODE_NAMES","None","Cube","Quad","Circ","Rect","WallPool","wallData","walls","pop","Wall","WallDocument","parent","canvas","scene","deepClone","_id","document","mergeObject","wall","CurvyWallToolManager","_mode","currentHandler","_activeTool","_modeListener","_ignoreNextToolModeChange","_previousToolData","Map","_pointMapper","_inPointMapMode","graphicsContext","PIXI","Graphics","clamped","mode","render","activeTool","currentlyMappingPoints","instance","_instance","ToolMode","clearTool","togglePointMapping","setModeListener","toolMode","listener","async","scenes","viewed","createEmbeddedDocuments","_getCurrentWallData","wallsLayer","preview","removeChildren","ui","notifications","info","getTooltipMessage","permanent","active","remove","canApplyPointMapping","hasEnoughData","applyPointMapping","bindData","setMode","wrapped","event","self","checkPointForClick","data","origin","originalEvent","ctrlKey","startedWithCtrlHeld","PREF_DROP_KEY","altKey","placeTool","checkPointForDrag","destination","move","stop","cancel","clearContext","clear","addChild","drawHandles","pointData","getSegments","_getWallDataFromActiveTool","release","removeChild","undefined","duplicate","acquire","draw","refresh","destroy","visible","getData","init","libWrapper","wrapper","patchWallsLayer","_onClickLeft","_onDragLeftStart","_onDragLeftMove","_onDragLeftDrop","_onDragLeftCancel","_onClickRight","Hooks","light","sight","sound","dir","door","flags","CurvyWallsToolBar","Application","options","super","_closing","_tools","beziercube","title","icon","isActive","onClick","bezierquad","beziercirc","bezierrect","_generalControls","increment","decrement","apply","class","_placementControls","pointconstruct","toggleable","applyplacement","controlManager","groups","name","controls","activeControl","tools","toggle","defaultOptions","popOut","template","toolIsPlaced","toolControls","getTools","placementControls","keys","it","general","includes","activateListeners","html","$","querySelector","append","css","moduleControls","getLeftWidth","getTopHeight","find","currentTarget","attr","tool","generalControl","placementControl","toolControl","close","PREF_PRESERVE","BezierTool","NotPlaced","lastSegmentFetch","HANDLE_RADIUS","PREF_SMALL_HANDLES","TEXT_STYLE","TEXT_STYLE_BASE","fontSize","lineCenter","Point","lineA","lineB","_point","_event","_context","text","PreciseText","anchor","drawSegmentLabel","context","createText","position","drawBoundingBox","bounds","getRectangle","Rectangle","EMPTY","beginFill","lineStyle","LINE_SIZE","drawRoundedRect","width","height","endFill","drawHandle","fill","drawCircle","TextStyle","fontFamily","CONFIG","defaultFontFamily","stroke","strokeThickness","dropShadow","dropShadowColor","dropShadowBlur","dropShadowAngle","dropShadowDistance","padding","pointNearPoint","PI2","InitializerIH","InitializerInputHandler","success","fail","CircleTool","arcHandle","RotatorHandle","sliceHandle","ellipseclose","closeLoopIfSliced","enabled","call","ellipsefinish","finishSliceIfShort","ellipseinc","snapSetIndex","ANGLE_SNAP_STEPS","ellipsedec","handles","Bounds","addPoint","polygon","Polygon","minX","minY","maxX","maxY","center","getCenter","rect","halfWidth","halfHeight","createVector","theta","magnitude","count","deltaTheta","sliceAngle","rawAngle","initialPoints","middle","getHandlePoint","moveTo","lineTo","snapAngle","toDegrees","toFixed","arcLabel","copyFrom","PointInputHandler","PointRotationHandler","contains","PointArrayInputHandler","magnet","_angle","ax","ay","InputHandler","original","setAngle","to","vecX","vecY","atan","shouldSnap","whole","trunc","_origin","cubicTool","barLength","controlA","controlB","CubicTool","bezier","lockHandles","MagnetPointInputHandler","cubiclock","PointMapper","lines","dimensions","_calculateCircle","drawEllipse","w","h","drawRect","utility","snap","handle","findIndex","getWallEndPoint","target","control","dimens","circle","generateCircle","pt1","pt2","pt3","isPerpendicular","radius","calcCircle","_count","_data","yDelta_a","xDelta_a","yDelta_b","xDelta_b","aSlope","bSlope","quadTool","cX","cY","nY","nX","QuadTool","RectangleTool","lastCount","topCount","rightCount","bottomCount","leftCount","buttonRadius","buttonOffset","incTop","createLineLabel","decTop","incRight","decRight","incBottom","decBottom","incLeft","decLeft","textTop","textRight","textBottom","textLeft","tint","rotation","STYLE","drawSegmentLabels","drawButtons","_tool","_getWallEndpointCoordinates","_forceSnap","shiftKey","squaring","destPoint","squarePoint","origPoint","completion","_originalPoint","originalPoints","clone","_start","moveAll","delta","copyTo","masterPoint","slavePoint","originalPoint","offsetX","offsetY","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","definition","defineProperty","enumerable","prop","hasOwnProperty","Symbol","toStringTag","curvyWallApp","once","scope","type","Boolean","hint","choices","alt","ctrl","keybindings","editable","onDown","repeat","modules","console","user","isGM","_state","activateGroupByName","app"],"sourceRoot":""}