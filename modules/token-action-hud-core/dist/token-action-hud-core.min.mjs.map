{"version":3,"file":"token-action-hud-core.min.mjs","sources":["../module/core/constants.mjs","../module/core/utils.mjs","../module/handlers/data-handler.mjs","../module/managers/migration-manager.mjs","../module/handlers/character-handler.mjs","../module/handlers/layout-handler.mjs","../module/handlers/tooltip-handler.mjs","../module/handlers/group-handler.mjs","../module/managers/hud-manager.mjs","../node_modules/@yaireo/dragsort/dist/dragsort.js","../node_modules/@yaireo/tagify/dist/tagify.esm.js","../module/applications/tagify-app.mjs","../module/applications/tagify-app-helper.mjs","../module/handlers/group-resizer.mjs","../module/applications/token-action-hud.mjs","../module/core/sockets.mjs","../module/handlers/action-handlers/generic-action-handler.mjs","../module/handlers/action-handlers/compendium-action-handler.mjs","../module/handlers/action-handlers/macro-action-handler.mjs","../module/handlers/action-handlers/action-handler.mjs","../module/handlers/action-handlers/action-handler-extender.mjs","../module/handlers/roll-handlers/roll-handler.mjs","../module/handlers/roll-handlers/pre-roll-handler.mjs","../module/handlers/roll-handlers/roll-handler-extender.mjs","../module/applications/custom-style-form.mjs","../module/dialogs/reset-layout.mjs","../module/dialogs/reset-all-layouts.mjs","../module/applications/settings-form.mjs","../module/core/settings.mjs","../module/handlers/action-handlers/item-macro-extender.mjs","../module/managers/system-manager.mjs","../module/core/api.mjs","../module/main.mjs"],"sourcesContent":["/**\n * Module-based constants\n */\nexport const MODULE = {\n  ID: \"token-action-hud-core\",\n  NAME: \"Token Action HUD\"\n};\n\n\n/* -------------------------------------------- */\n\n/**\n * Template directory\n */\nconst TEMPLATE_DIR = `modules/${MODULE.ID}/templates`;\n\n/* -------------------------------------------- */\n\n/**\n * Templates\n */\nexport const TEMPLATE = {\n  action: `${TEMPLATE_DIR}/action.hbs`,\n  customStyleForm: `${TEMPLATE_DIR}/custom-style-form.hbs`,\n  group: `${TEMPLATE_DIR}/group.hbs`,\n  hud: `${TEMPLATE_DIR}/hud.hbs`,\n  listSubgroup: `${TEMPLATE_DIR}/list-subgroup.hbs`,\n  settings: `${TEMPLATE_DIR}/settings.hbs`,\n  tabSubgroup: `${TEMPLATE_DIR}/tab-subgroup.hbs`,\n  tagifyAppHud: `${TEMPLATE_DIR}/tag-dialog-hud.hbs`,\n  tagifyAppGroup: `${TEMPLATE_DIR}/tag-dialog-group.hbs`,\n  tagifyAppSubgroup: `${TEMPLATE_DIR}/tag-dialog-subgroup.hbs`\n};\n\n/* -------------------------------------------- */\n\n/**\n * Delimiter character\n */\nexport const DELIMITER = \"|\";\n\n/* -------------------------------------------- */\n\n/**\n * Action types\n */\nexport const ACTION_TYPE = {\n  compendiumEntry: \"tokenActionHud.compendiumEntry\",\n  compendiumMacro: \"tokenActionHud.compendiumMacro\",\n  compendiumPlaylist: \"tokenActionHud.compendiumPlaylist\",\n  macro: \"tokenActionHud.macro\"\n};\n\n/* -------------------------------------------- */\n\n/**\n * Compendium action types\n */\nexport const COMPENDIUM_ACTION_TYPES = [\"compendiumEntry\", \"compendiumMacro\", \"compendiumPlaylist\", \"macro\"];\n\n/* -------------------------------------------- */\n\n/**\n * Compendium pack types\n */\nexport const COMPENDIUM_PACK_TYPES = [\"JournalEntry\", \"Macro\", \"RollTable\"];\n\n/* -------------------------------------------- */\n\n/**\n * CSS styles\n */\nexport const CSS_STYLE = {\n  foundryVTT: {\n    class: \"tah-style-foundry-vtt-dark\",\n    file: \"tah-foundry-vtt-dark\",\n    moduleId: MODULE.ID,\n    name: \"Foundry VTT Dark\",\n    primaryColor: \"#dddddd\",\n    secondaryColor: \"#dddddd80\",\n    tertiaryColor: \"#ff6400\"\n  },\n  compact: {\n    class: \"tah-style-foundry-vtt\",\n    file: \"tah-foundry-vtt-dark-compact\",\n    moduleId: MODULE.ID,\n    name: \"Foundry VTT Dark Compact\",\n    primaryColor: \"#dddddd\",\n    secondaryColor: \"#dddddd80\",\n    tertiaryColor: \"#ff6400\"\n  },\n  dockedLeft: {\n    class: \"tah-style-docked-left\",\n    file: \"tah-docked-left\",\n    moduleId: MODULE.ID,\n    name: \"Foundry VTT Dark Docked Left\",\n    primaryColor: \"#dddddd\",\n    secondaryColor: \"#dddddd80\",\n    tertiaryColor: \"#ff6400\",\n    isDocked: true,\n    dockPosition: \"left\"\n  },\n  dockedCenterRight: {\n    class: \"tah-style-docked-right\",\n    file: \"tah-docked-right\",\n    moduleId: MODULE.ID,\n    name: \"Foundry VTT Dark Docked Center-Right\",\n    primaryColor: \"#dddddd\",\n    secondaryColor: \"#dddddd80\",\n    tertiaryColor: \"#ff6400\",\n    collapseIcon: \"fa-caret-right\",\n    expandIcon: \"fa-caret-left\",\n    isDocked: true,\n    dockPosition: \"center-right\"\n  },\n  dockedRight: {\n    class: \"tah-style-docked-right\",\n    file: \"tah-docked-right\",\n    moduleId: MODULE.ID,\n    name: \"Foundry VTT Dark Docked Right\",\n    primaryColor: \"#dddddd\",\n    secondaryColor: \"#dddddd80\",\n    tertiaryColor: \"#ff6400\",\n    collapseIcon: \"fa-caret-right\",\n    expandIcon: \"fa-caret-left\",\n    isDocked: true,\n    dockPosition: \"right\"\n  },\n  foundryVttLight: {\n    class: \"tah-style-foundry-vtt-light\",\n    file: \"tah-foundry-vtt-light\",\n    moduleId: MODULE.ID,\n    name: \"Foundry VTT Light\",\n    primaryColor: \"#dddddd\",\n    secondaryColor: \"#dddddd80\",\n    tertiaryColor: \"#ff6400\"\n  },\n  pathfinder: {\n    class: \"tah-style-pathfinder\",\n    file: \"tah-pathfinder\",\n    moduleId: MODULE.ID,\n    name: \"Pathfinder\"\n  },\n  highContrast: {\n    class: \"tah-style-high-contrast\",\n    file: \"tah-high-contrast\",\n    moduleId: MODULE.ID,\n    name: \"High Contrast\",\n    primaryColor: \"#ffff00\",\n    secondaryColor: \"#ffff00\",\n    tertiaryColor: \"#0C7BDC\"\n  },\n  custom: {\n    class: \"tah-style-custom\",\n    file: \"tah-custom\",\n    moduleId: MODULE.ID,\n    name: \"Custom\"\n  }\n};\n\n/* -------------------------------------------- */\n\n/**\n * Custom styles\n */\nexport const CUSTOM_STYLE = {\n  backgroundColor: { cssProperty: \"--tah-background-color\", type: String, default: \"#00000000\" },\n  buttonHeight: { cssProperty: \"--tah-button-height-editable\", type: Number, default: 32 },\n  buttonBackgroundColor: { cssProperty: \"--tah-button-background-color-editable\", type: String, default: \"#000000b3\" },\n  buttonBorderPrimaryColor: { cssProperty: \"--tah-button-border-primary-color-editable\", type: String, default: \"#0C0C0CFF\" },\n  buttonBorderSecondaryColor: { cssProperty: \"--tah-button-border-secondary-color-editable\", type: String, default: \"#060606FF\" },\n  buttonTextColor: { cssProperty: \"--tah-button-text-color-editable\", type: String, default: \"#DDDDDDFF\" },\n  buttonHoverBorderPrimaryColor: { cssProperty: \"--tah-button-hover-border-primary-color-editable\", type: String, default: \"#FF6400FF\" },\n  buttonHoverBorderSecondaryColor: { cssProperty: \"--tah-button-hover-border-secondary-color-editable\", type: String, default: \"#FF0000FF\" },\n  buttonHoverBackgroundColor: { cssProperty: \"--tah-button-hover-background-color-editable\", type: String, default: \"#000000B3\" },\n  buttonHoverTextColor: { cssProperty: \"--tah-button-hover-text-color-editable\", type: String, default: \"#FFFFFFFF\" },\n  buttonToggleActiveBackgroundColor: { cssProperty: \"--tah-button-toggle-active-background-color-editable\", type: String, default: \"#3C0078BF\" },\n  buttonToggleActiveBorderPrimaryColor: { cssProperty: \"--tah-button-toggle-active-border-primary-color-editable\", type: String, default: \"#9B8DFFFF\" },\n  buttonToggleActiveBorderSecondaryColor: { cssProperty: \"--tah-button-toggle-active-border-secondary-color-editable\", type: String, default: \"#9B8DFFFF\" },\n  buttonToggleActiveTextColor: { cssProperty: \"--tah-button-toggle-active-text-color-editable\", type: String, default: \"#FFFFFFFF\" },\n  buttonToggleHoverBackgroundColor: { cssProperty: \"--tah-button-toggle-hover-background-color-editable\", type: String, default: \"#3C0078BF\" },\n  buttonToggleHoverBorderPrimaryColor: { cssProperty: \"--tah-button-toggle-hover-border-primary-color-editable\", type: String, default: \"#9B8DFFFF\" },\n  buttonToggleHoverBorderSecondaryColor: { cssProperty: \"--tah-button-toggle-hover-secondary-color-editable\", type: String, default: \"#9B8DFFFF\" },\n  buttonToggleHoverTextColor: { cssProperty: \"--tah-button-toggle-hover-text-color-editable\", type: String, default: \"#FFFFFFFF\" },\n  textPrimaryColor: { cssProperty: \"--tah-text-primary-color-editable\", type: String, default: \"#DDDDDDFF\" },\n  textSecondaryColor: { cssProperty: \"--tah-text-secondary-color-editable\", type: String, default: \"#DDDDDD80\" },\n  textTertiaryColor: { cssProperty: \"--tah-text-tertiary-color-editable\", type: String, default: \"#FF6400FF\" },\n  textHoverPrimaryColor: { cssProperty: \"--tah-text-hover-primary-color-editable\", type: String, default: \"#DDDDDDFF\" },\n  textHoverSecondaryColor: { cssProperty: \"--tah-text-hover-secondary-color-editable\", type: String, default: \"#DDDDDD80\" },\n  textHoverTertiaryColor: { cssProperty: \"--tah-text-tertiary-color-editable\", type: String, default: \"#FF6400FF\" }\n};\n\n/* -------------------------------------------- */\n\n/**\n * Group types\n */\nexport const GROUP_TYPE = {\n  COMPENDIUM: \"compendium\",\n  CUSTOM: \"custom\",\n  SYSTEM: \"system\",\n  SYSTEM_DERIVED: \"system-derived\"\n};\n\n/* -------------------------------------------- */\n\n/**\n * HUD\n */\nexport const HUD = {\n  DEFAULT_HEIGHT: 200,\n  DEFAULT_WIDTH: 20,\n  DEFAULT_LEFT_POS: 150,\n  DEFAULT_TOP_POS: 80,\n  DEFAULT_SCALE: 1,\n  DEFAULT_ZINDEX: 100\n};\n\n/* -------------------------------------------- */\n\n/**\n * Item Macro icon\n */\nexport const ITEM_MACRO_ICON = {\n  ICON: \"fas fa-sd-card\",\n  TOOLTIP: \"Item Macro\"\n};\n\n/* -------------------------------------------- */\n\n/**\n * Layout settings\n */\nexport const LAYOUT_SETTING = {\n  customLayout: {\n    hint: \"tokenActionHud.settings.customLayout.hint\",\n    name: \"tokenActionHud.settings.customLayout.name\",\n    inputType: \"filePicker\",\n    filePickerType: \"json\",\n    dtype: \"String\",\n    scope: \"world\"\n  },\n  userCustomLayout: {\n    hint: \"tokenActionHud.settings.userCustomLayout.hint\",\n    name: \"tokenActionHud.settings.userCustomLayout.name\",\n    inputType: \"filePicker\",\n    filePickerType: \"json\",\n    dtype: \"String\",\n    scope: \"user\"\n  },\n  exportLayout: {\n    hint: \"tokenActionHud.settings.exportLayout.hint\",\n    label: \"tokenActionHud.settings.exportLayout.label\",\n    name: \"tokenActionHud.settings.exportLayout.name\",\n    inputType: \"button\",\n    icon: \"fa-solid fa-file-export\",\n    action: \"exportLayout\"\n  },\n  resetLayout: {\n    hint: \"tokenActionHud.settings.resetLayout.hint\",\n    label: \"tokenActionHud.settings.resetLayout.label\",\n    name: \"tokenActionHud.settings.resetLayout.name\",\n    inputType: \"button\",\n    icon: \"fa-solid fa-arrow-rotate-left\",\n    action: \"resetLayout\",\n    scope: \"client\"\n  },\n  resetAllLayouts: {\n    hint: \"tokenActionHud.settings.resetAllLayouts.hint\",\n    label: \"tokenActionHud.settings.resetAllLayouts.label\",\n    name: \"tokenActionHud.settings.resetAllLayouts.name\",\n    inputType: \"button\",\n    icon: \"fa-solid fa-bomb\",\n    action: \"resetAllLayouts\",\n    scope: \"world\"\n  }\n};\n\n/* -------------------------------------------- */\n\n/**\n * Settings\n */\nexport const SETTING = {\n  activeCssAsText: { classes: [\"TokenActionHud\"], variable: \"activeCssAsTextSetting\" },\n  allow: { classes: [\"TokenActionHud\"], variable: \"allowSetting\" },\n  alwaysShowHud: { classes: [\"TokenActionHud\"], variable: \"alwaysShowHudSetting\" },\n  backgroundColor: {},\n  buttonBackgroundColor: {},\n  buttonBorderPrimaryColor: {},\n  buttonBorderSecondaryColor: {},\n  buttonHeight: {},\n  buttonHoverBorderPrimaryColor: {},\n  buttonHoverBorderSecondaryColor: {},\n  buttonHoverBackgroundColor: {},\n  buttonHoverTextColor: {},\n  buttonTextColor: {},\n  buttonToggleActiveBackgroundColor: {},\n  buttonToggleActiveBorderPrimaryColor: {},\n  buttonToggleActiveBorderSecondaryColor: {},\n  buttonToggleActiveTextColor: {},\n  buttonToggleHoverBackgroundColor: {},\n  buttonToggleHoverBorderPrimaryColor: {},\n  buttonToggleHoverBorderSecondaryColor: {},\n  buttonToggleHoverTextColor: {},\n  clickOpenCategory: { classes: [\"TokenActionHud\"], variable: \"clickOpenCategorySetting\" },\n  customLayout: { classes: [\"ActionHandler\"], variable: \"customLayoutSetting\" },\n  customStyle: {},\n  debug: { classes: [\"TokenActionHud\"], variable: \"debugSetting\" },\n  direction: { classes: [\"TokenActionHud\"], variable: \"directionSetting\" },\n  displayCharacterName: { classes: [\"TokenActionHud\"], variable: \"displayCharacterName\" },\n  displayIcons: { classes: [\"TokenActionHud\"], variable: \"displayIconsSetting\" },\n  drag: { classes: [\"TokenActionHud\"], variable: \"dragSetting\" },\n  enable: { classes: [\"TokenActionHud\"], variable: \"enableSetting\" },\n  enableCustomization: { classes: [\"ActionHandler\", \"TokenActionHud\"], variable: \"enableCustomizationSetting\" },\n  grid: { classes: [\"TokenActionHud\"], variable: \"gridSetting\" },\n  itemMacro: {},\n  migrationVersion: {},\n  reset: {},\n  renderItemOnRightClick: {},\n  rollHandler: { default: \"core\" },\n  scale: { classes: [\"TokenActionHud\"], variable: \"scaleSetting\" },\n  sortActions: { classes: [\"ActionHandler\"], variable: \"sortActionsSetting\" },\n  startup: {},\n  style: { classes: [\"TokenActionHud\"], variable: \"styleSetting\"},\n  tooltips: { classes: [\"ActionHandler\"], variable: \"tooltipsSetting\" },\n  textPrimaryColor: {},\n  textSecondaryColor: {},\n  textTertiaryColor: {},\n  textHoverPrimaryColor: {},\n  textHoverSecondaryColor: {},\n  textHoverTertiaryColor: {},\n  userCustomLayout: { classes: [\"ActionHandler\"], variable: \"userCustomLayoutFlag\" }\n};\n","import { CSS_STYLE, CUSTOM_STYLE, MODULE } from \"./constants.mjs\";\n\n/**\n * A class responsible for logging messages to the console.\n */\nexport class Logger {\n  /**\n   * Log an info message to the console. If 'notify' is true, also send a notification\n   * @param {string} message The message\n   * @param {boolean} notify Whether to send a notification\n   */\n  static info(message, notify = false) {\n    if (notify) ui.notifications.info(`Token Action HUD | ${message}`);\n    else console.log(`Token Action HUD Info | ${message}`);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Log an error message to the console. If 'notify' is true, also send a notification\n   * @param {string} message The message\n   * @param {boolean} notify Whether to send a notification\n   */\n  static error(message, notify = false) {\n    if (notify) ui.notifications.error(`Token Action HUD | ${message}`, { permanent: true });\n    else console.error(`Token Action HUD Error | ${message}`);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Log a debug message and, optionally, data to the console\n   * @param {string} message   The message\n   * @param {object|null} data The data\n   */\n  static debug(message, data = null) {\n    const isDebug = (game.tokenActionHud) ? game.tokenActionHud.debugSetting : Utils.getSetting(\"debug\");\n    if (isDebug) {\n      if (!data) {\n        console.log(`Token Action HUD Debug | ${message}`);\n        return;\n      }\n      const dataClone = Utils.deepClone(data);\n      console.log(`Token Action HUD Debug | ${message}`, dataClone);\n    }\n  }\n}\n\n/* -------------------------------------------- */\n\n/**\n * A class responsible for setting and aborting timers.\n */\nexport class Timer {\n  constructor(milliseconds) {\n    this.milliseconds = milliseconds;\n    this.timer = null;\n  }\n\n  async start() {\n    if (this.timer) this.abort();\n    return new Promise(resolve => {\n      this.timer = setTimeout(() => { resolve(); }, this.milliseconds ?? 100);\n    });\n  }\n\n  async abort() {\n    clearTimeout(this.timer);\n    this.timer = null;\n  }\n}\n\n/* -------------------------------------------- */\n\n/**\n * A class of helper functions.\n */\nexport class Utils {\n  /**\n   * Whether the user is allowed to use the HUD\n   * @public\n   * @param {number} userRole     The user's role\n   * @param {number} allowSetting The 'allow' setting value\n   * @returns {boolean} Whether the user is allowed to use the HUD\n   */\n  static checkAllow(userRole, allowSetting) {\n    return userRole >= allowSetting;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Capitalize the first letter of every word\n   * @param {string} value The string\n   * @returns {string}     The capitalized string\n   */\n  static capitalize(value) {\n    return value.replace(\n      /\\w\\S*/g,\n      text => text.charAt(0).toUpperCase() + text.substring(1).toLowerCase()\n    );\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Foundry VTT's deepClone function wrapped here to avoid code error highlighting due to missing definition\n   * @public\n   * @param {object} original The original object\n   * @param {object} options  The options\n   * @returns {object}        The cloned object\n   */\n  static deepClone(original, options) {\n    // eslint-disable-next-line no-undef\n    return foundry.utils.deepClone(original, options);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get actor from the token or actor\n   * @public\n   * @param {string} actorId The actor id\n   * @param {string} tokenId The token id\n   * @returns {object}       The actor\n   */\n  static getActor(actorId, tokenId) {\n    let token = null;\n    if (tokenId) token = canvas.tokens.placeables.find(token => token.id === tokenId);\n    if (token) return token.actor;\n    return game.actors.get(actorId);\n  }\n\n  /**\n   * Get closest group to the event target\n   * @param {object} event The event\n   * @returns {object}     The closest group element\n   */\n  static getClosestGroupElement(event) {\n    if (!event) return null;\n    return event.target.closest(\"[data-part=\\\"subgroup\\\"]\") || event.target.closest(\"[data-part=\\\"group\\\"]\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get actors of controlled tokens\n   * @public\n   * @returns {Array} The actors\n   */\n  static getControlledActors() {\n    const tokens = game.canvas.tokens?.controlled ?? [];\n    return tokens.map(token => token.actor);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get status effect from actor based on the status ID\n   * @param {object} actor    The actor\n   * @param {string} statusId The status ID\n   * @returns {object}        The status effect\n   */\n  static getStatusEffect(actor, statusId) {\n    return actor.effects.find(effect => effect.statuses.every(status => status === statusId));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get image from the entity\n   * @public\n   * @param {object} entity       The entity, e.g., actor, item\n   * @param {Array} defaultImages Any default images to exclude\n   * @returns {string}            The image URL\n   */\n  static getImage(entity, defaultImages = []) {\n    defaultImages.push(\"icons/svg/mystery-man.svg\");\n    let result = \"\";\n    if (game.tokenActionHud.displayIconsSetting) {\n      result = (typeof entity === \"string\")\n        ? entity\n        : entity?.img ?? entity?.icon ?? \"\";\n    }\n    return !defaultImages.includes(result) ? result : \"\";\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get item from the actor\n   * @public\n   * @param {object} actor  The actor\n   * @param {string} itemId The item id\n   * @returns {object}      The item\n   */\n  static getItem(actor, itemId) {\n    return actor.items.get(itemId);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get token\n   * @public\n   * @param {string} tokenId The token id\n   * @returns {object}       The token\n   */\n  static getToken(tokenId) {\n    return canvas.tokens.placeables.find(token => token.id === tokenId);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get controlled tokens\n   * @public\n   * @returns {Array} The controlled tokens\n   */\n  static getControlledTokens() {\n    return game.canvas.tokens?.controlled ?? [];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get first controlled tokens\n   * @public\n   * @returns {object|null} The first controlled token\n   */\n  static getFirstControlledToken() {\n    const controlledToken = game.canvas.tokens.controlled[0];\n    if (controlledToken) {\n      return controlledToken;\n    }\n\n    const character = game.user?.character;\n    if (character) {\n      return canvas.tokens.placeables.find(token => token.actor?.id === character.id);\n    }\n\n    return null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get setting value\n   * @public\n   * @param {string} key               The setting key\n   * @param {string=null} defaultValue The setting default value\n   * @returns {*}                      The setting value\n   */\n  static getSetting(key, defaultValue = null) {\n    let value = defaultValue ?? null;\n    try {\n      value = game.settings.get(MODULE.ID, key);\n    } catch{\n      Logger.debug(`Setting '${key}' not found`);\n    }\n    return value;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set setting value\n   * @public\n   * @param {string} key   The setting key\n   * @param {string} value The setting value\n   */\n  static async setSetting(key, value) {\n    if (game.settings.settings.get(`${MODULE.ID}.${key}`)) {\n      await game.settings.set(MODULE.ID, key, value);\n      Logger.debug(`Setting '${key}' set to '${value}'`);\n    } else if (key !== \"debug\") {\n      Logger.debug(`Setting '${key}' not found`);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get module actor flag\n   * @public\n   * @param {string} key The flag key\n   * @returns {*}        The flag value\n   */\n  static getActorFlag(key) {\n    return game.tokenActionHud.actor.getFlag(MODULE.ID, key);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set module actor flag\n   * @public\n   * @param {string} key The flag key\n   * @param {*} value    The flag value\n   */\n  static async setActorFlag(key, value) {\n    await game.tokenActionHud.actor.setFlag(MODULE.ID, key, value);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Unset module actor flag\n   * @public\n   * @param {string} key The flag key\n   */\n  static async unsetActorFlag(key) {\n    await game.tokenActionHud.actor.unsetFlag(MODULE.ID, key);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get module user flag\n   * @public\n   * @param {string} key The flag key\n   * @returns {*}        The flag value\n   */\n  static getUserFlag(key) {\n    return game.user.getFlag(MODULE.ID, key);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set module user flag\n   * @public\n   * @param {string} key The flag key\n   * @param {*} value    The flag value\n   */\n  static async setUserFlag(key, value) {\n    await game.user.setFlag(MODULE.ID, key, value);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Unset module user flag\n   * @public\n   * @param {string} key The flag key\n   */\n  static async unsetUserFlag(key) {\n    await game.user.unsetFlag(MODULE.ID, key);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Language translation\n   * @public\n   * @param {string} toTranslate The value to translate\n   * @returns {string}           The translated value\n   */\n  static i18n(toTranslate) {\n    return game.i18n.localize(toTranslate);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether a GM is active\n   * @public\n   * @returns {boolean} Whether a GM is active\n   */\n  static isGmActive() {\n    return game.users.some(user => user.isGM && user.active);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the given module is active\n   * @public\n   * @param {string} moduleId The module id\n   * @returns {boolean}       Whether the given module is active\n   */\n  static isModuleActive(moduleId) {\n    const module = game.modules.get(moduleId);\n    return module && module.active;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the given module's title\n   * @public\n   * @param {string} moduleId The module id\n   * @returns {string}        The module title\n   */\n  static getModuleTitle(moduleId) {\n    return game.modules.get(moduleId)?.title ?? \"\";\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the given module's version\n   * @public\n   * @param {string} moduleId The module id\n   * @returns {string}        The module version\n   */\n  static getModuleVersion(moduleId) {\n    return game.modules.get(moduleId)?.version ?? \"\";\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Humanize keybinding\n   * @param {object} key The keybinding key\n   * @returns {string}   The humanized keybinding\n   */\n  static humanizeBinding(key) {\n    const binding = game.keybindings.get(MODULE.ID, key);\n    if (!binding) return \"\";\n    const stringParts = binding[0].modifiers.reduce((parts, part) => {\n      if (KeyboardManager.MODIFIER_CODES[part]?.includes(binding[0].key)) return parts;\n      parts.unshift(KeyboardManager.getKeycodeDisplayString(part));\n      return parts;\n    }, [KeyboardManager.getKeycodeDisplayString(binding[0].key)]);\n    return stringParts.join(\" + \");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the median\n   * @public\n   * @param {Array} numbers The array of numbers\n   * @returns {number}      The median\n   */\n  static median(numbers) {\n    const mid = Math.floor(numbers.length / 2);\n    const nums = [...numbers].sort((a, b) => a - b);\n    return numbers.length % 2 !== 0 ? nums[mid] : (nums[mid - 1] + nums[mid]) / 2;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get upper quartile average\n   * @param {Array} numbers The numbers\n   * @returns {number}      The upper quartile average\n   */\n  static getUpperQuartileAverage(numbers) {\n    const sortedNumbers = numbers.slice().sort((a, b) => a - b);\n    const length = sortedNumbers.length;\n    const startIndex = Math.ceil(length * 0.75);\n    const endIndex = length - 1;\n\n    let sum = 0;\n    let count = 0;\n\n    for (let i = startIndex; i <= endIndex; i++) {\n      sum += sortedNumbers[i];\n      count++;\n    }\n\n    const upperQuartileAverage = sum / count;\n\n    return upperQuartileAverage;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get modifier (e.g., +5) from number\n   * @param {number} num The number\n   * @returns {string}   The modifier\n   */\n  static getModifier(num) {\n    if (!num && num !== 0) return \"\";\n    const sign = (num >= 0) ? \"+\" : \"\";\n    return `${sign}${num}`;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Sort items\n   * @public\n   * @param {object} items The items\n   * @returns {object}     The sorted items\n   */\n  static sortItems(items) {\n    return new Map([...items.entries()].sort((a, b) => a[1].sort.localeCompare(b[1].sort)));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Sort items by name\n   * @public\n   * @param {object} items The items\n   * @returns {object}     The sorted items\n   */\n  static sortItemsByName(items) {\n    return new Map([...items.entries()].sort((a, b) => a[1].name.localeCompare(b[1].name)));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Enable stylesheet based on setting and disable all other stylesheets\n   * @public\n   * @param {string} style The 'style' setting value\n   */\n  static switchCSS(style) {\n    const { file, moduleId } = CSS_STYLE[style];\n\n    for (const [key, value] of Object.entries(CSS_STYLE)) {\n      const href = [`modules/${value.moduleId}/`, `${value.file}`];\n      const stylesheet = Object.values(document.styleSheets).find(\n        ss => ss.href?.includes(href[0]) && ss.href?.includes(href[1])\n      );\n\n      if (key === style) {\n        stylesheet.disabled = false;\n      } else if (moduleId !== value.moduleId || file !== value.file) {\n        stylesheet.disabled = true;\n      }\n    }\n\n    if (style === \"custom\") {\n      for (const [key, value] of Object.entries(CUSTOM_STYLE)) {\n        const setting = Utils.getSetting(key);\n        if (setting) {\n          document.querySelector(\":root\").style.setProperty(value.cssProperty, setting);\n        }\n      }\n    }\n\n    const tahElement = document.querySelector(\"#token-action-hud\");\n    if (tahElement) {\n      tahElement.classList.remove(...tahElement.classList);\n      tahElement.classList.add(CSS_STYLE[style].class);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Register Handlebar helpers\n   * @public\n   */\n  static registerHandlebars() {\n    // Capitalise first character\n    Handlebars.registerHelper(\"tokenActionHudCoreCap\", function(string) {\n      if (!string || string.length < 1) return \"\";\n      return string[0].toUpperCase() + string.slice(1);\n    });\n    const reduceOp = function(args, reducer) {\n      args = Array.from(args);\n      args.pop(); // => options\n      const first = args.shift();\n      return args.reduce(reducer, first);\n    };\n\n    // Support operators\n    Handlebars.registerHelper({\n      tokenActionHudCoreTrue: function() { return reduceOp(arguments, a => a); }\n    });\n\n    // Add asterisk to toggleable actions\n    Handlebars.registerHelper(\"tokenActionHudCoreActiveText\", function(block) {\n      if (game.tokenActionHud.activeCssAsTextSetting) {\n        return block.fn(this);\n      }\n      return block.inverse(this);\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the major, minor and patch parts of the module version\n   * @public\n   * @param {string} moduleVersion The module version\n   * @returns {object|null}        The module version parts\n   */\n  static getModuleVersionParts(moduleVersion) {\n    if (!moduleVersion) {\n      Logger.debug(\"Module version not retrieved\", { trigger: \"getModuleVersionParts\" });\n      return null;\n    }\n    const moduleVersionParts = moduleVersion.split(\".\");\n    return {\n      major: moduleVersionParts[0],\n      minor: moduleVersionParts[1],\n      patch: moduleVersionParts[2]\n    };\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the system module is compatible with the core module version\n   * @public\n   * @param {string} requiredCoreModuleVersion The required core module version\n   * @returns {boolean}                        Whether the system module is compatible with the core module version\n   */\n  static isSystemModuleCompatible(requiredCoreModuleVersion) {\n    if (!requiredCoreModuleVersion) return true;\n\n    // Get core module version in parts\n    const requiredCoreModuleVersionParts = this.getModuleVersionParts(requiredCoreModuleVersion);\n    const coreModuleVersionParts = this.getModuleVersionParts(game.modules.get(MODULE.ID).version);\n\n    if (coreModuleVersionParts.major !== requiredCoreModuleVersionParts.major\n      || coreModuleVersionParts.minor !== requiredCoreModuleVersionParts.minor\n      || (requiredCoreModuleVersionParts.patch && coreModuleVersionParts.patch !== requiredCoreModuleVersionParts.patch)\n    ) {\n      const requiredVersion = `${requiredCoreModuleVersionParts.major}.${requiredCoreModuleVersionParts.minor}.${requiredCoreModuleVersionParts.patch ?? \"X\"}`;\n      const installedVersion = game.modules.get(MODULE.ID).version;\n      ui.notifications.error(\n        `The installed Token Action HUD system module requires Token Action HUD Core module version ${requiredVersion}, but version ${installedVersion} is installed. Install Token Action HUD Core module version ${requiredVersion} to continue using Token Action HUD. Earlier versions of Token Action HUD Core are available on the module's package page on the Foundry VTT site.`,\n        { permanent: true }\n      );\n      return false;\n    }\n    return true;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get nested groups by criteria\n   * @public\n   * @param {object} groups The groups\n   * @param {object} data   The search data\n   * @returns {object|null} The nested groups\n   */\n  static getNestedGroups(groups, data = {}) {\n    let order = 0;\n    if (!groups) return null;\n    const groupId = data?.id;\n    const groupType = data?.type;\n    groups = (Array.isArray(groups)) ? groups : Object.values(groups);\n    const foundGroups = {};\n    for (const group of groups) {\n      if ((!groupId || group.id === groupId) && (!groupType || group.type === groupType)) {\n        order++;\n        const level = group.nestId.split(\"_\").length;\n        foundGroups[group.nestId] = { ...group, order, level };\n      }\n      if (group.groups?.length > 0) {\n        const groups = this.getNestedGroups(group.groups, data);\n        if (groups) Object.assign(foundGroups, groups);\n      }\n    }\n    return (Object.keys(foundGroups).length > 0) ? foundGroups : null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get group by nest ID\n   * @public\n   * @param {object} groups The groups\n   * @param {string} data   The search data\n   * @returns {object|null} The group\n   */\n  static async getGroupByNestId(groups, data = {}) {\n    const nestId = (typeof data === \"string\" ? data : data?.nestId);\n    const groupType = data?.type;\n    if (!nestId) return null;\n\n    const parts = nestId.split(\"_\");\n    return await findGroup(groups, parts);\n\n    /* -------------------------------------------- */\n\n    /**\n     * Find group\n     * @param {object} groups The groups\n     * @param {Array} parts   The nestId parts\n     * @returns {object}      The group\n     */\n    async function findGroup(groups, parts) {\n      if (!groups) return null;\n      groups = (Array.isArray(groups)) ? groups : Object.values(groups);\n      for (const group of groups) {\n        if (group.id === parts[0]) {\n          if (parts.length === 1) {\n            if (!group.type || !groupType || group.type === groupType) return group;\n            return;\n          }\n          parts.shift();\n          if (!group.groups) continue;\n          for (const groupStyle of Object.values(group.groups)) {\n            if (groupStyle.length === 0) continue;\n            const foundGroup = await findGroup(groupStyle, parts);\n            if (foundGroup) return foundGroup;\n          }\n        }\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Delete group by nest id\n   * @public\n   * @param {object} groups The groups\n   * @param {string} data   The search data\n   */\n  static async deleteGroupByNestId(groups, data = {}) {\n    const nestId = (typeof data === \"string\" ? data : data?.nestId);\n    if (!nestId) return;\n\n    const parts = nestId.split(\"_\");\n    await findAndDeleteGroup(groups, parts);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Find and delete a group\n   * @param {object} groups The groups\n   * @param {Array} parts   The nestId parts\n   */\n  static async findAndDeleteGroup(groups, parts) {\n    groups = (Array.isArray(groups)) ? groups : Object.values(groups);\n    for (const [index, group] of groups.entries()) {\n      if (group.id === parts[0]) {\n        if (parts.length === 1) {\n          groups.splice(index, 1);\n          return;\n        }\n        if (group.groups.length === 0) return;\n        parts.shift();\n        const foundGroup = await findAndDeleteGroup(group.groups, parts);\n        if (foundGroup) return;\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Delete groups by id\n   * @public\n   * @param {object} groups The groups\n   * @param {string} data   The search data\n   */\n  static async deleteGroupsById(groups, data = {}) {\n    const id = (typeof data === \"string\" ? data : data?.id);\n    if (!id) return;\n\n    for (let i = groups.length - 1; i >= 0; i--) {\n      if (groups[i].id === id) {\n        groups.splice(i, 1);\n      } else if (groups[i].groups?.length > 0) {\n        deleteGroupsById(groups[i].groups, data);\n      }\n    }\n  }\n}\n","import { MODULE } from \"../core/constants.mjs\";\nimport { Logger, Utils } from \"../core/utils.mjs\";\n\n/* -------------------------------------------- */\n\n/**\n * A class responsible for handling data-related activities.\n */\nexport class DataHandler {\n  constructor(socket) {\n    this.socket = socket;\n  }\n\n  /**\n   * Initialise the data handler\n   */\n  async init() {\n    await this.#createDirectories();\n    await Promise.all([\n      this.private = await this.isPrivate(),\n      this.fileMap = await this.getFilePathsAsGm()\n    ]);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether persistent storage can be used\n   * @returns {boolean} Whether persistent storage can be used\n   */\n  get isPersistentStorage() {\n    return (foundry.utils.isNewerVersion(game.version, \"11.305\") && typeof ForgeVTT === \"undefined\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Create directories for storage of files\n   * @private\n   */\n  async #createDirectories() {\n    if (!game.user.isGM || !Utils.getSetting(\"enableCustomization\")) return;\n\n    const DATA_FOLDER = \"data\";\n    const moduleDirectory = (this.isPersistentStorage)\n      ? `modules/${MODULE.ID}/storage`\n      : MODULE.ID;\n\n    const directoriesToCreate = [\n      moduleDirectory,\n      `${moduleDirectory}/${game.world.id}`,\n      `${moduleDirectory}/${game.world.id}/actor`,\n      `${moduleDirectory}/${game.world.id}/user`\n    ];\n\n    for (const directory of directoriesToCreate) {\n      await FilePicker.browse(DATA_FOLDER, directory).catch(async _ => {\n        if (!(await FilePicker.createDirectory(DATA_FOLDER, directory, {}))) {\n          Logger.debug(`Failed to create directory: ${directory}`);\n        }\n      });\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get base path to the layout files\n   * @returns {string} The path\n   */\n  get path() {\n    return (this.isPersistentStorage)\n      ? `modules/${MODULE.ID}/storage/${game.world.id}/`\n      : `${MODULE.ID}/${game.world.id}/`;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get file parts\n   * @param {string} file The file\n   * @returns {object}    The file parts\n   */\n  getFileParts(file) {\n    const parts = file.split(\"/\");\n    const filename = parts.pop();\n    const folder = parts.join(\"/\");\n    const id = filename.split(\".\")[0];\n    return { folder, filename, id };\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the module directory is set to private\n   * @returns {boolean} Whether the module directory is set to private\n   */\n  async isPrivate() {\n    if (game.user.isGM) return false;\n\n    if (game.user.hasPermission(\"FILES_BROWSE\")) {\n      try {\n        await FilePicker.browse(\"data\", this.path);\n        return false;\n      } catch{\n        return true;\n      }\n    }\n    return true;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get file paths as GM\n   * @returns {object} The file paths\n   */\n  async getFilePathsAsGm() {\n    if ((!game.user.hasPermission(\"FILES_BROWSE\") || this.private) && !Utils.isGmActive()) {\n      Logger.info(\"Cannot get file paths without a GM present\", true);\n      return new Map(); // Return an empty map if no permissions and no GM\n    }\n\n    const files = game.user.hasPermission(\"FILES_BROWSE\") && !this.private\n      ? await this.getFilePaths()\n      : await this.socket.executeAsGM(\"getFilePaths\");\n\n    return new Map(files.map(file => {\n      const { id } = this.getFileParts(file);\n      return [id, file];\n    }));\n  }\n\n  /**\n   * Get file paths using socket\n   * @returns {Array} The file paths\n   */\n  static async getFilePathsWithSocket() {\n    return await game.tokenActionHud?.dataHandler?.getFilePaths() ?? [];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get file paths\n   * @returns {Array} The file paths\n   */\n  async getFilePaths() {\n    const [actorFiles, userFiles] = await Promise.all([\n      FilePicker.browse(\"data\", `${this.path}actor/`),\n      FilePicker.browse(\"data\", `${this.path}user/`)\n    ]);\n\n    return [...(actorFiles?.files ?? []), ...(userFiles?.files ?? [])];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the user can save data\n   * @returns {boolean} Whether the user can save data\n   */\n  get canSaveData() {\n    return ((game.user.hasPermission(\"FILES_UPLOAD\") && !this.private) || Utils.isGmActive());\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Save data the GM\n   * @public\n   * @param {string} type The type: actor or user\n   * @param {string} id   The actor or user id\n   * @param {object} data The data\n   */\n  async saveDataAsGm(type, id, data) {\n    if (game.user.hasPermission(\"FILES_UPLOAD\") && !this.private) {\n      await this.saveData(type, id, data);\n    }\n\n    if (!Utils.isGmActive()) {\n      Logger.info(\"Cannot save data without a GM present\", true);\n      return;\n    }\n\n    await this.socket.executeAsGM(\"saveData\", type, id, data);\n  }\n\n  /* -------------------------------------------- */\n\n  static async saveDataWithSocket(type, id, data) {\n    return await game.tokenActionHud.dataHandler.saveData(type, id, data);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Save data\n   * @param {string} type The type: actor or user\n   * @param {string} id   The actor or user id\n   * @param {object} data The data\n   */\n  async saveData(type, id, data) {\n    try {\n      // Get the folder path\n      const folder = `${this.path}${type}`;\n\n      // Generate the system-safe filename\n      const fileName = encodeURI(`${id}.json`);\n\n      // Create the file and contents\n      const file = new File([JSON.stringify(data, null, \"\")], fileName, { type: \"application/json\" });\n\n      // Upload the file\n      const response = await FilePicker.upload(\"data\", folder, file, {}, { notify: false });\n\n      if (response.path) {\n        if (!this.fileMap.has(id)) {\n          this.fileMap.set(id, response.path);\n        }\n      } else {\n        Logger.debug(`Failed to save data to: ${fileName}\\nReason: ${response.error || \"Unknown error\"}`);\n      }\n    } catch(error) {\n      Logger.error(`An error occurred while saving data for ${id}.json: ${error.message}`);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the user can get data\n   * @returns {boolean} Whether the user can get data\n   */\n  get canGetData() {\n    return ((game.user.hasPermission(\"FILES_BROWSE\") && !this.private) || Utils.isGmActive());\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get data as GM\n   * @public\n   * @param {object} options The options: file, type, id\n   * @returns {object}       The data\n   */\n  async getDataAsGm(options) {\n    try {\n      if ((!game.user.hasPermission(\"FILES_BROWSE\") || this.private) && !Utils.isGmActive()) {\n        Logger.info(\"Cannot get data without a GM present\", true);\n        return;\n      }\n\n      const data = (game.user.hasPermission(\"FILES_BROWSE\"))\n        ? await this.getData(options)\n        : await this.socket.executeAsGM(\"getData\", options);\n\n      return data;\n    } catch(error) {\n      Logger.error(`An error occurred while getting data: ${error.message}`);\n      return null;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  static async getDataWithSocket(options) {\n    return await game.tokenActionHud.dataHandler.getData(options);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get data\n   * @param {string} options The options: file, type, id\n   * @returns {object}       The data\n   */\n  async getData(options) {\n    const { id, file } = options;\n\n    // Check if the file is available in the fileMap\n    let foundFile = this.fileMap.get(id) ?? null;\n\n    // If not found, try to browse, otherwise return null\n    if (!foundFile) {\n      if (!file) return null;\n      const { folder, filename } = this.getFileParts(file);\n      const foundFolder = await FilePicker.browse(\"data\", folder);\n      foundFile = foundFolder.files.find(file => file.endsWith(filename));\n      if (!foundFile) return null;\n    }\n\n    try {\n      const ms = Date.now();\n      const response = await fetch(`${foundFile}?ms=${ms}`);\n\n      // Check if the fetch was successful\n      if (response.ok) {\n        const data = await response.json();\n        return data;\n      } else {\n        return null;\n      }\n    } catch(error) {\n      console.error(error);\n      return null;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get data\n   * @param {string} type The type: actor or user\n   * @param {string} id   The actor or user id\n   * @returns {object}    The data\n   */\n  async getDataMigrate(type, id) {\n    const folderPath = `${MODULE.ID}/${game.world.id}/${type}`;\n    const fileName = encodeURI(`${id}.json`);\n    try {\n      const foundFolderPath = await FilePicker.browse(\"data\", folderPath);\n      const foundFilePath = foundFolderPath.files.find(file => file.endsWith(fileName));\n      if (foundFilePath) {\n        const ms = Date.now();\n        return await fetch(`${foundFilePath}?ms=${ms}`)\n          .then(response => {\n            if (response.ok) {\n              return response.json();\n            } else {\n              return null;\n            }\n          })\n          .catch(error => {\n            console.error(error);\n          });\n      } else {\n        return null;\n      }\n    } catch{\n      return null;\n    }\n  }\n}\n","import { MODULE } from \"../core/constants.mjs\";\nimport { Logger, Utils } from \"../core/utils.mjs\";\n\n/**\n * Manages migrations between module versions\n */\nexport class MigrationManager {\n  constructor(dataHandler, socket) {\n    this.dataHandler = dataHandler;\n    this.socket = socket;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Initialise migrations\n   * @public\n   */\n  async init() {\n    if (!game.user.isGM) return;\n\n    const moduleVersion = game.modules.get(MODULE.ID).version;\n    const migrationVersion = Utils.getSetting(\"migrationVersion\");\n    if (moduleVersion === migrationVersion) return;\n\n    let isSuccess = true;\n    isSuccess = (!migrationVersion || foundry.utils.isNewerVersion(\"1.4.10\", migrationVersion))\n      ? await this.#unsetOldFlags()\n      : true;\n    isSuccess = (this.dataHandler.isPersistentStorage && (!migrationVersion || foundry.utils.isNewerVersion(\"1.4.11\", migrationVersion)))\n      ? await this.#migrateFiles()\n      : true;\n\n    if (isSuccess) {\n      Utils.setSetting(\"migrationVersion\", moduleVersion);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Unset old flags\n   * @private\n   * @returns {boolean} Whether the old flags were unset\n   */\n  async #unsetOldFlags() {\n    try {\n      const users = game.users.filter(user => user.getFlag(MODULE.ID, \"categories\"));\n      for (const user of users) {\n        user.unsetFlag(MODULE.ID, \"categories\");\n        user.unsetFlag(MODULE.ID, \"defaults\");\n      }\n\n      const actors = game.actors.filter(actor => actor.getFlag(MODULE.ID, \"categories\"));\n      for (const actor of actors) {\n        actor.unsetFlag(MODULE.ID, \"categories\");\n      }\n\n      const tokens = game.canvas.tokens.objects.children.filter(token => token.actor?.getFlag(MODULE.ID, \"categories\"));\n      for (const token of tokens) {\n        token.actor?.unsetFlag(MODULE.ID, \"categories\");\n      }\n\n      for (const scene of game.scenes) {\n        const tokens = scene.tokens.filter(token => token.actor?.getFlag(MODULE.ID, \"categories\"));\n        for (const token of tokens) {\n          token.actor?.unsetFlag(MODULE.ID, \"categories\");\n        }\n      }\n\n      return true;\n    } catch(err) {\n      Logger.debug(err.message, err);\n\n      return false;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Migrate files to storage\n   * @returns {boolean} Whether the files were migrated to storage\n   */\n  async #migrateFiles() {\n    try {\n      Logger.info(\"Migrating files to persistent storage...\", true);\n      for (const user of game.users) {\n        const data = await this.dataHandler.getDataMigrate(\"user\", user.id);\n        if (data) {\n          await this.dataHandler.saveData(\"user\", user.id, data);\n        }\n      }\n\n      for (const actor of game.actors) {\n        const data = await this.dataHandler.getDataMigrate(\"actor\", actor.id);\n        if (data) {\n          await this.dataHandler.saveData(\"actor\", actor.id, data);\n        }\n      }\n      Logger.info(\"Successfully migrated files to persistent storage\", true);\n      return true;\n    } catch{\n      Logger.info(\"Failed to migrate files to persistent storage\", true);\n      return false;\n    }\n  }\n}\n","import { Utils } from \"../core/utils.mjs\";\n\nexport class CharacterHandler {\n  constructor(hudManager) {\n    this.hudManager = hudManager;\n    this.groupHandler = hudManager.groupHandler;\n    this.actionHandler = hudManager.actionHandler;\n    this.rollHandler = hudManager.rollHandler;\n  }\n\n  /**\n   * Initialise Character Handler\n   */\n  init() {\n    this.previousActorId = this.actor?.id;\n    this.setCharacter();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether there is a character\n   * @returns {boolean} Whether there is a character\n   */\n  get isCharacter() {\n    return this.actor || this.isMultipleTokens;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether there is multiple tokens\n   * @returns {boolean} Whether there is multiple tokens\n   */\n  get isMultipleTokens() {\n    const controlledTokens = Utils.getControlledTokens();\n    return controlledTokens.length > 1 && !this.actor;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the current actor is the same actor\n   * @returns {boolean} Whether the current actor is the same actor\n   */\n  get isSameActor() {\n    return this.previousActorId !== this.actor?.id;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set character based on controlled tokens\n   * @private\n   */\n  setCharacter() {\n    this.resetCharacter();\n    const controlledTokens = Utils.getControlledTokens();\n    if (controlledTokens.length > 1) {\n      this.#handleMultipleTokens(controlledTokens);\n    } else {\n      this.#handleSingleToken(controlledTokens);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset actor and token properties\n   */\n  resetCharacter() {\n    this.token = null;\n    this.actor = null;\n    this.tokens = [];\n    this.actors = [];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle multiple controlled tokens\n   * @param {*} controlledTokens\n   */\n  #handleMultipleTokens(controlledTokens) {\n    this.characterName = game.i18n.localize(\"tokenActionHud.multiple\");\n\n    // Empty singulars\n    this.token = null;\n    this.actor = null;\n\n    // Set multiples\n    this.tokens = controlledTokens;\n    this.actors = Utils.getControlledActors();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle a single controlled token\n   * @private\n   * @param {Array} controlledTokens The controlled tokens\n   */\n  #handleSingleToken(controlledTokens) {\n    const character = { token: null, actor: null };\n\n    if (controlledTokens.length === 1 && this.#isValidCharacter(controlledTokens[0])) {\n      character.token = controlledTokens[0];\n      character.actor = character.token?.actor;\n    } else if (controlledTokens.length === 0 && game.user.character && Utils.getSetting(\"alwaysShowHud\")) {\n      character.actor = game.user.character;\n      character.token = canvas.tokens?.placeables.find(t => t.actor?.id === character.actor.id) ?? null;\n    }\n\n    if (!character.actor) return;\n\n    this.characterName = character.token?.name ?? character.actor.name;\n\n    // Set in this class\n    this.token = character.token;\n    this.actor = character.actor;\n    this.tokens = [character.token];\n    this.actors = [character.actor];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the character is a valid selection for the current user\n   * @private\n   * @param {object} [token = {}] The token\n   * @returns {boolean}           Whether the character is a valid selection for the current user\n   */\n  #isValidCharacter(token = {}) {\n    return game.user.isGM || token.actor?.testUserPermission(game.user, \"OWNER\");\n  }\n\n}\n","import { Utils } from \"../core/utils.mjs\";\n\n/**\n * Handler for the HUD layout.\n */\nexport class LayoutHandler {\n  constructor(systemManager, dataHandler) {\n    this.systemManager = systemManager;\n    this.dataHandler = dataHandler;\n    this.defaultLayout = null;\n    this.customLayout = null;\n  }\n\n  /**\n   * Initialise the HUD layout\n   */\n  async init() {\n    await Promise.all([\n      this.#setDefaultLayout(),\n      this.#setCustomLayout()\n    ]);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Soft reset variables\n   */\n  softReset() {\n    this.defaultLayout = null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Hard reset variables\n   */\n  hardReset() {\n    this.softReset();\n    this.customLayout = null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set the default layout\n   * @private\n   */\n  async #setDefaultLayout() {\n    if (this.defaultLayout) return;\n    const defaultLayout = this.systemManager.defaults?.layout;\n    if (!defaultLayout) { this.defaultLayout = null; return; }\n    this.defaultLayout = await Utils.getNestedGroups(defaultLayout);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set custom layout\n   * @private\n   */\n  async #setCustomLayout() {\n    if (this.customLayout) return;\n    const file = Utils.getUserFlag(\"userCustomLayout\") || Utils.getSetting(\"customLayout\") || null;\n    this.customLayout = (file) ? await this.dataHandler.getDataAsGm({ file }) : null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Export layout to file\n   * @public\n   */\n  async exportLayout() {\n    const data = await this.dataHandler.getDataAsGm({ type: \"user\", id: game.userId }) ?? this.customLayout ?? this.defaultLayout;\n    if (data) {\n      saveDataToFile(JSON.stringify(data, null, 2), \"text/json\", \"token-action-hud-layout.json\");\n    }\n  }\n\n  /**\n   * Get the layout\n   * @returns {object} The layout\n   */\n  get layout() {\n    return this.customLayout ?? this.defaultLayout;\n  }\n}\n","import { Utils } from \"../core/utils.mjs\";\n\n\n/**\n * Get tooltip based on module setting\n * @param {object|string} tooltip The tooltip\n * @param {string} name           The name\n * @returns {object}              The tooltip\n */\nexport function getTooltip(tooltip, name) {\n  const setting = Utils.getSetting(\"tooltips\");\n\n  if (setting === \"none\") return null;\n  if (setting === \"nameOnly\" || !tooltip) return name;\n\n  if (typeof tooltip !== \"object\") {\n    tooltip = { content: tooltip };\n  }\n\n  if (!tooltip.content.includes(\"tah-tooltip-wrapper\")) {\n    tooltip.content = `<div class=\"tah-tooltip-wrapper\">${tooltip.content}</div>`;\n  }\n\n  return tooltip;\n}\n","import { COMPENDIUM_PACK_TYPES, GROUP_TYPE } from \"../core/constants.mjs\";\nimport { Logger, Utils } from \"../core/utils.mjs\";\nimport { getTooltip } from \"../handlers/tooltip-handler.mjs\";\n\n/**\n * Handler for the HUD groups.\n */\nexport class GroupHandler {\n  constructor(hudManager, systemManager, dataHandler, layoutHandler) {\n    this.hudManager = hudManager;\n    this.systemManager = systemManager;\n    this.dataHandler = dataHandler;\n    this.layoutHandler = layoutHandler;\n    this.defaultGroups = {};\n    this.groups = {};\n    this.actorGroups = {};\n    this.userGroups = {};\n  }\n\n  get actor() {\n    return this.hudManager?.actor;\n  }\n\n  get actors() {\n    return this.hudManager?.actors;\n  }\n\n  get token() {\n    return this.hudManager?.token;\n  }\n\n  get tokens() {\n    return this.hudManager?.tokens;\n  }\n\n  /**\n   * Initialise the groups\n   */\n  async init() {\n    this.#setDefaultGroups();\n    await Promise.all([\n      this.#setSavedActorGroups(),\n      this.#setSavedUserGroups()\n    ]);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Soft reset variables\n   */\n  softReset() {\n    this.defaultGroups = {};\n    this.groups = {};\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Hard reset variables\n   */\n  hardReset() {\n    this.softReset();\n    this.actorGroups = {};\n    this.userGroups = {};\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set the default groups\n   * @private\n   */\n  #setDefaultGroups() {\n    const defaultGroups = this.systemManager.defaults?.groups;\n    if (!defaultGroups) return;\n    for (const defaultGroup of defaultGroups) {\n      this.defaultGroups[defaultGroup.id] = defaultGroup;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set the saved groups from the actor flag\n   * @private\n   */\n  async #setSavedActorGroups() {\n    if (!this.actor) return;\n\n    if (!Utils.getSetting(\"enableCustomization\")) {\n      this.actorGroups = {};\n      return;\n    }\n\n    if (this.isSameActor && Object.entries(this.actorGroups).length) return;\n\n    if (!this.dataHandler.canGetData) {\n      this.actorGroups = {};\n      return;\n    }\n\n    Logger.debug(\"Retrieving groups from actor...\", { actor: this.actor });\n    this.actorGroups = {};\n    const actorGroups = await this.dataHandler.getDataAsGm({ type: \"actor\", id: this.actor.id }) ?? null;\n    if (!actorGroups) return;\n    for (const group of Object.entries(actorGroups)) {\n      group[1].nestId = group[0];\n    }\n    this.actorGroups = actorGroups;\n    Logger.debug(\"Groups from actor retrieved\", { actorGroups: this.actorGroups, actor: this.actor });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set the saved groups from the user flag\n   * @private\n   */\n  async #setSavedUserGroups() {\n    const user = game.user;\n    const layout = this.layoutHandler.layout;\n\n    const getUserGroups = data => {\n      const userGroups = Object.keys(data).length ? data : layout;\n      for (const group of Object.entries(userGroups)) {\n        group[1].nestId = group[0];\n      }\n      return userGroups;\n    };\n\n    if (!Utils.getSetting(\"enableCustomization\")) {\n      this.userGroups = getUserGroups(layout);\n      return;\n    }\n\n    if (Object.entries(this.userGroups).length) return;\n\n    if (!this.dataHandler.canGetData) {\n      this.userGroups = getUserGroups(layout);\n      return;\n    }\n\n    Logger.debug(\"Retrieving groups from user...\", { user });\n    this.userGroups = {};\n    const savedUserData = await this.dataHandler.getDataAsGm({ type: \"user\", id: user.id }) ?? {};\n    this.userGroups = getUserGroups(savedUserData);\n    Logger.debug(\"Groups retrieved from user\", { userGroups: this.userGroups, user });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Prepare groups in the HUD.\n   * @param {object} hud The HUD\n   * @returns {object}   The prepared groups\n   */\n  async prepareGroups(hud) {\n    if (Object.keys(this.userGroups).length) {\n      const userGroups = this.getUserGroups();\n      for (const userGroup of userGroups) {\n        if (userGroup.level === 1) {\n          const group = this.createGroup(userGroup);\n          hud.groups.push(group);\n          this.groups[group.nestId] = group;\n        } else {\n          const parentNestId = userGroup.nestId.split(\"_\", userGroup.level - 1).join(\"_\");\n          const parentGroup = await Utils.getGroupByNestId(hud.groups, { nestId: parentNestId });\n          if (parentGroup) {\n            const group = this.createGroup(userGroup);\n            if (group.settings.style === \"tab\") {\n              parentGroup.groups.tabs.push(group);\n            } else {\n              parentGroup.groups.lists.push(group);\n            }\n            this.groups[group.nestId] = group;\n          }\n        }\n      }\n    }\n\n    if (Object.keys(this.actorGroups).length) {\n      const actorGroups = this.getActorGroups();\n\n      for (const actorGroup of actorGroups) {\n        const parentNestId = actorGroup.nestId.split(\"_\", actorGroup.level - 1).join(\"_\");\n        const existingGroup = await Utils.getGroupByNestId(hud.groups, { nestId: actorGroup.nestId });\n        if (existingGroup) {\n          if (actorGroup.actions?.length) {\n            existingGroup.actions = actorGroup.actions;\n          }\n        } else {\n          const parentGroup = await Utils.getGroupByNestId(hud.groups, { nestId: parentNestId });\n\n          if (parentGroup && actorGroup.type === \"system-derived\") {\n            if (!parentGroup.groups) parentGroup.groups = { lists: [], tabs: [] };\n\n            const group = this.createGroup(actorGroup, true);\n\n            if (actorGroup.actions?.length) {\n              group.actions = actorGroup.actions;\n            }\n\n            if (group.settings.style === \"tab\") {\n              parentGroup.groups.tabs.push(group);\n            } else {\n              parentGroup.groups.lists.push(group);\n            }\n\n            this.groups[group.nestId] = group;\n          }\n        }\n      }\n    }\n\n    return this.groups;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get first matching group\n   * @public\n   * @param {object} [data = {}]   The group data\n   * @param {string} [data.nestId] The nested group ID\n   * @param {string} [data.id]     The group ID\n   * @param {number} [data.level]  The group level\n   * @param {string} [data.type]   The group type\n   * @returns {Array}              The group\n   */\n  getGroup({ nestId, id, level, type } = {}) {\n    if (nestId) return this.groups[nestId];\n\n    return Object.values(this.groups).find(group =>\n      (!id || group.id === id)\n      && (!level || group.level === level)\n      && (!type || group.type === type)\n    );\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get matching groups\n   * @public\n   * @param {object}  [data = {}]     The group data\n   * @param {string}  [data.nestId]   The nested group ID\n   * @param {string}  [data.id]       The group ID\n   * @param {number}  [data.level]    The group level\n   * @param {string}  [data.type]     The group type\n   * @param {boolean} [data.selected] Whether the group is selected\n   * @returns {Array}                 The matching groups\n   */\n  getGroups({ nestId, id, level, type, selected } = {}) {\n    return Object.values(this.groups).filter(group =>\n      (!nestId || group.nestId.startsWith(nestId))\n      && (!id || group.id === id)\n      && (!level || group.level === level)\n      && (!type || group.type === type)\n      && (!selected || group.selected === selected)\n    );\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get matching actor-related groups\n   * @public\n   * @param {object}  [data = {}]   The group data\n   * @param {string}  [data.nestId] The nested group ID\n   * @param {string}  [data.id]     The group ID\n   * @param {number}  [data.level]  The group level\n   * @param {string}  [data.type]   The group type\n   * @returns {Array}               The groups\n   */\n  getActorGroups({ nestId, id, level, type } = {}) {\n    return Object.values(this.actorGroups).filter(group =>\n      (!nestId || group.nestId.startsWith(nestId))\n      && (!id || group.id === id)\n      && (!level || group.level === level)\n      && (!type || group.type === type)\n    ).sort((a, b) => (a.level - b.level || a.order - b.order));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get matching user-related groups\n   * @public\n   * @param {object}  [data = {}]   The group data\n   * @param {string}  [data.nestId] The nested group ID\n   * @param {string}  [data.id]     The group ID\n   * @param {number}  [data.level]  The group level\n   * @param {string}  [data.type]   The group type\n   * @returns {Array}               The groups\n   */\n  getUserGroups({ nestId, id, level, type } = {}) {\n    return Object.values(this.userGroups).filter(group =>\n      (!nestId || group.nestId.startsWith(nestId))\n      && (!id || group.id === id)\n      && (!level || group.level === level)\n      && (!type || group.type === type)\n    ).sort((a, b) => (a.level - b.level || a.order - b.order));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get group IDs\n   * @returns {Array} The group IDs\n   */\n  getGroupIds() {\n    return Object.values(this.groups).map(group => group.id);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get group settings\n   * @public\n   * @param {object} [groupData={}] The group data\n   * @returns {object|null}         The group settings\n   */\n  getGroupSettings(groupData = {}) {\n    return this.getGroup(groupData)?.settings ?? null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Create group\n   * @public\n   * @param {object} groupData The group data\n   * @param {boolean} keepData Whether to keep the data\n   * @returns {object}         The group\n   */\n  createGroup(groupData, keepData = false) {\n    const groupDataClone = Utils.deepClone(groupData);\n    const nestIdParts = groupData.nestId.split(\"_\");\n    const level = nestIdParts.length ?? 1;\n\n    const tooltip = getTooltip(groupData?.tooltip, groupDataClone?.name);\n\n    if (!keepData) {\n      groupDataClone.actions = [];\n      groupDataClone.groups = { lists: [], tabs: [] };\n    }\n\n    const defaultSettings = {\n      showTitle: true,\n      style: (level === 1) ? \"tab\" : \"list\"\n    };\n\n    const groupSettings = groupDataClone.settings || {};\n    groupSettings.showTitle ??= defaultSettings.showTitle;\n    groupSettings.style ??= defaultSettings.style;\n\n    groupDataClone.subtitleClass = (groupSettings.showTitle) ? \"\" : \"tah-hidden\";\n\n    const groupSystem = groupDataClone.system || {};\n\n    const commonProps = {\n      actions: groupDataClone.actions,\n      class: groupDataClone.class || groupDataClone.cssClass || \"\",\n      groups: groupDataClone.groups,\n      id: groupDataClone.id,\n      info1: groupDataClone.info1 || \"\",\n      info2: groupDataClone.info2 || \"\",\n      info3: groupDataClone.info3 || \"\",\n      level: groupDataClone.level || level || 1,\n      listName: groupDataClone.listName || groupDataClone.name,\n      name: groupDataClone.name,\n      nestId: groupDataClone.nestId || groupDataClone.id,\n      order: groupDataClone.order,\n      selected: groupDataClone.selected ?? groupDataClone.isSelected ?? groupDataClone.defaultSelected ?? true,\n      settings: groupSettings,\n      system: groupSystem,\n      tooltip,\n      type: groupDataClone.type || GROUP_TYPE.CUSTOM\n    };\n\n    if (level > 1) {\n      commonProps.subtitleClass = groupDataClone.subtitleClass || \"\";\n    }\n\n    return commonProps;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Update groups\n   * @public\n   * @param {Array | object} groupsData         The groups data\n   * @param {object} [parentGroupData = null] The parent group data\n   */\n  updateGroups(groupsData, parentGroupData) {\n    if (!Array.isArray(groupsData)) groupsData = [groupsData];\n\n    const level = (parentGroupData?.level ?? 0) + 1;\n    const childGroupData = { level };\n    if (parentGroupData?.nestId) childGroupData.nestId = parentGroupData.nestId;\n\n    const existingGroups = this.getGroups(childGroupData);\n\n    // Remove any groups that are no longer present\n    for (const existingGroup of existingGroups) {\n      if (existingGroup.type === \"system-derived\") {\n        existingGroup.selected = false;\n        existingGroup.order = 999;\n      } else if (!groupsData.find(groupData => groupData.id === existingGroup.id)) {\n        delete this.groups[existingGroup.nestId];\n      }\n    }\n\n    // Add or update groups\n    let order = 0;\n    for (const groupData of groupsData) {\n      groupData.nestId = (parentGroupData?.nestId)\n        ? `${parentGroupData.nestId}_${groupData.id}`\n        : groupData.id;\n      groupData.selected = groupData.selected ?? true;\n      groupData.order = order;\n\n      const existingGroup = this.getGroup(groupData);\n\n      if (existingGroup) {\n        Object.assign(existingGroup, groupData);\n      } else {\n        const group = this.createGroup(groupData);\n        this.groups[groupData.nestId] = group;\n      }\n      order++;\n    }\n\n    // Update parent group settings\n    if (parentGroupData?.settings) {\n      const existingParentGroup = this.getGroup(parentGroupData);\n      if (existingParentGroup) {\n        existingParentGroup.settings = parentGroupData.settings;\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Save group settings\n   * @public\n   * @param {object} groupData The group data\n   */\n  saveGroupSettings(groupData) {\n    const group = this.getGroup(groupData);\n    group.settings = { ...group.settings, ...groupData.settings };\n    this.saveGroups({ saveActor: true, saveUser: true });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Save groups\n   * @public\n   * @param {object} options The options\n   */\n  async saveGroups(options = { saveActor: false, saveUser: false }) {\n    if (!Utils.getSetting(\"enableCustomization\")) return;\n\n    Logger.debug(\"Saving groups...\");\n\n    if (options?.saveActor) await this.saveActorGroups();\n    if (options?.saveUser) await this.saveUserGroups();\n\n    Logger.debug(\"Groups saved\", { groups: this.groups });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Save actor groups to file\n   * @public\n   */\n  async saveActorGroups() {\n    if (!this.actor || !Object.keys(this.groups).length) return;\n\n    Logger.debug(\"Saving actor groups...\");\n\n    const actorGroups = {};\n    this.actorGroups = {};\n\n    for (const group of Object.values(this.groups)) {\n      this.actorGroups[group.nestId] = group;\n      actorGroups[group.nestId] = this.#getReducedGroupData(group, true);\n    }\n\n    if (this.dataHandler.canSaveData) {\n      await this.dataHandler.saveDataAsGm(\"actor\", this.actor.id, actorGroups);\n\n      Logger.debug(\"Actor groups saved\", { actorGroups });\n    } else {\n      Logger.debug(\"Actor groups not saved as no GM present\");\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Save user groups to file\n   * @public\n   */\n  async saveUserGroups() {\n    if (!Object.keys(this.groups).length) return;\n\n    Logger.debug(\"Saving user groups...\");\n\n    const userGroups = {};\n    this.userGroups = {};\n\n    for (const group of Object.values(this.groups)) {\n      if (group.type !== \"system-derived\") {\n        this.userGroups[group.nestId] = group;\n        userGroups[group.nestId] = this.#getReducedGroupData(group, false);\n      }\n    }\n\n    if (this.dataHandler.canSaveData) {\n      await this.dataHandler.saveDataAsGm(\"user\", game.userId, userGroups);\n      Logger.debug(\"User groups saved\", { userGroups });\n    } else {\n      Logger.debug(\"User groups not saved as no GM present\");\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get reduced groups data for saving to flags\n   * @private\n   * @param {object}  data          The group data\n   * @param {string}  data.id       The group ID\n   * @param {string}  data.name     The group name\n   * @param {string}  data.listName The list name for the group\n   * @param {number}  data.level    The group level\n   * @param {number}  data.order    The order of the group\n   * @param {boolean} data.selected Whether the group is selected\n   * @param {object}  data.settings The group settings\n   * @param {string}  data.type     The group type\n   * @param {Array}   data.actions  The list of actions for the group (if `keepActions` is true)\n   * @param {boolean} keepActions   Whether to keep action data\n   * @returns {object}              The reduced group data\n   */\n  #getReducedGroupData({ id, name, listName, level, order, selected, settings, type, actions }, keepActions = false) {\n    const data = { id, name, listName, level, order, selected, settings, type };\n\n    if (keepActions) {\n      data.actions = actions.map(({ id, isPreset, userSelected }) => { return { id, isPreset, userSelected }; });\n    }\n\n    return data;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get selected groups as Tagify entries\n   * @public\n   * @param {object} groupData The group data\n   * @returns {object}         The selected groups\n   */\n  getSelectedGroupsAsTags(groupData = {}) {\n    groupData.selected = true;\n    groupData.level = (groupData.level || 0) + 1;\n    const groups = this.getGroups(groupData);\n    return groups?.map(group => this.#toTagify(group)) ?? [];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get available groups as Tagify entries\n   * @public\n   * @param {object} groupData The group data\n   * @returns {object}         The groups\n   */\n  async getAvailableGroupAsTags(groupData) {\n    const derivedGroups = await this.#getDerivedGroupsAsTags(groupData);\n    const systemGroups = await this.#getSystemGroupsAsTags();\n    const compendiumGroups = await this.#getCompendiumGroupsAsTags();\n    const macroGroups = await this.#getMacroGroupsAsTags();\n    return [...derivedGroups, ...systemGroups, ...compendiumGroups, ...macroGroups];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get derived groups as Tagify entries\n   * @private\n   * @param {object} data        The group data\n   * @param {object} data.nestId The group nest ID\n   * @returns {object}           The derived groups\n   */\n  #getDerivedGroupsAsTags({ nestId }) {\n    const derivedGroups = this.getGroups({ nestId, type: GROUP_TYPE.SYSTEM_DERIVED });\n    return derivedGroups?.map(group => this.#toTagify(group)) ?? [];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get system groups as Tagify entries\n   * @private\n   * @returns {object} The system groups\n   */\n  #getSystemGroupsAsTags() {\n    return Object.values(this.defaultGroups).map(group => this.#toTagify(group));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get compendium groups as Tagify entries\n   * @private\n   * @returns {object} The compendium groups\n   */\n  #getCompendiumGroupsAsTags() {\n    const packs = game.packs.filter(pack =>\n      COMPENDIUM_PACK_TYPES.includes(pack.documentName)\n            && (foundry.utils.isNewerVersion(game.version, \"10\") ? pack.visible : (!pack.private || game.user.isGM))\n    );\n    const groups = packs.map(pack => {\n      return {\n        id: pack.metadata.id.replace(\".\", \"-\"),\n        listName: `${game.i18n.localize(\"tokenActionHud.group\")}: ${pack.metadata.label}`,\n        name: pack.metadata.label,\n        type: \"core\"\n      };\n    });\n    return groups.map(group => this.#toTagify(group));\n  }\n\n  /**\n   * Get macro groups as Tagify entries\n   * @private\n   * @returns {object} The macro groups\n   */\n  #getMacroGroupsAsTags() {\n    return [this.#toTagify({\n      id: \"macros\",\n      listName: `${game.i18n.localize(\"tokenActionHud.group\")}: ${game.i18n.localize(\"tokenActionHud.macros\")}`,\n      name: game.i18n.localize(\"tokenActionHud.macros\"),\n      type: \"core\"\n    })];\n  }\n\n  /**\n   * Add group to the HUD\n   * @public\n   * @param {object} groupData         The group data\n   * @param {object} parentGroupData   The parent group data\n   * @param {boolean} [update = false] Whether to update an existing group\n   */\n  addGroup(groupData, parentGroupData, update = false) {\n    groupData.type = groupData?.type ?? \"system-derived\";\n    groupData.style = groupData?.style ?? \"list\";\n\n    if (!parentGroupData?.id && !parentGroupData?.nestId) return;\n\n    const parentGroups = this.getGroups(parentGroupData);\n    if (!parentGroups?.length) return;\n\n    for (const parentGroup of parentGroups) {\n      const nestId = `${parentGroup.nestId}_${groupData.id}`;\n      const existingGroups = this.getGroups({ ...groupData, nestId });\n\n      if (existingGroups.length) {\n        if (update) {\n          for (const existingGroup of existingGroups) {\n            // Temporary fix until info1-3 properties are grouped into info object\n            if (groupData.info) {\n              Object.assign(groupData, { ...groupData.info });\n              delete groupData.info;\n            }\n\n            Object.assign(existingGroup, this.createGroup({ ...existingGroup, ...groupData }, true));\n          }\n        } else {\n          for (const existingGroup of existingGroups) {\n            const tooltip = getTooltip(groupData.tooltip, existingGroup.name);\n            Object.assign(existingGroup, { tooltip });\n          }\n        }\n      } else {\n        const group = this.createGroup({ ...groupData, nestId });\n\n        if (!parentGroup.groups) parentGroup.groups = { lists: [], tabs: [] };\n\n        if (group.settings.style === \"tab\") {\n          parentGroup.groups.tabs.push(group);\n        } else {\n          parentGroup.groups.lists.push(group);\n        }\n        this.groups[group.nestId] = group;\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Update group in the HUD\n   * @public\n   * @param {object} groupData                The group data\n   * @param {object} [parentGroupData = null] The parent group data\n   */\n  updateGroup(groupData, parentGroupData = null) {\n    groupData.type = groupData?.type ?? \"system-derived\";\n\n    const updateExistingGroups = existingGroups => {\n      for (const existingGroup of existingGroups) {\n        // Temporary fix until info1-3 properties are grouped into info object\n        if (groupData.info) {\n          Object.assign(groupData, { ...groupData.info });\n          delete groupData.info;\n        }\n\n        Object.assign(existingGroup, this.createGroup({ ...existingGroup, ...groupData }, true));\n      }\n    };\n\n    if (parentGroupData) {\n      const parentGroups = this.getGroups(parentGroupData);\n      for (const parentGroup of parentGroups) {\n        const nestId = `${parentGroup.nestId}_${groupData.id}`;\n        const existingGroups = this.getGroups({ ...groupData, nestId });\n\n        updateExistingGroups(existingGroups);\n      }\n    } else {\n      const existingGroups = this.getGroups(groupData);\n\n      updateExistingGroups(existingGroups);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Remove group from HUD\n   * @public\n   * @param {object} groupData The group data\n   */\n  removeGroup(groupData) {\n    if (!groupData?.nestId && groupData?.id) {\n      Utils.deleteGroupsById(this.hud.groups, groupData.id);\n    }\n\n    const groups = this.getGroups(groupData);\n    if (!groups?.length) return;\n\n    for (const group of groups) {\n      delete this.groups[group.nestId];\n      if (groupData?.nestId) {\n        Utils.deleteGroupByNestId(this.hud.groups, group.nestId);\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add info to group in the HUD\n   * @public\n   * @param {string} groupData The group data\n   */\n  addGroupInfo(groupData) {\n    const groupId = groupData?.id;\n    const groupInfo = groupData?.info;\n\n    if (!groupId || !groupInfo) return;\n\n    const groups = this.getGroups(groupData);\n\n    groups.forEach(group => {\n      group.info1 = groupInfo.info1;\n      group.info2 = groupInfo.info2;\n      group.info3 = groupInfo.info3;\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set property to indicate whether a group has actions within it\n   * @public\n   */\n  setHasActions() {\n    Object.values(this.groups).forEach(group => {\n      if (group.actions.some(action => action.selected)) {\n        group.hasActions = true;\n      } else {\n        group.hasActions = false;\n      }\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Convert a group into a Tagify entry\n   * @private\n   * @param {object} groupData The group data\n   * @returns {object}         The Tagify entry\n   */\n  #toTagify(groupData) {\n    const { id, name, type, listName } = groupData;\n    return { id, name, type, value: listName ?? name };\n  }\n}\n","\nimport { CharacterHandler } from \"../handlers/character-handler.mjs\";\nimport { LayoutHandler } from \"../handlers/layout-handler.mjs\";\nimport { GroupHandler } from \"../handlers/group-handler.mjs\";\nimport { Logger, Utils } from \"../core/utils.mjs\";\n\nexport class HudManager {\n  constructor(tokenActionHud, systemManager, dataHandler, socket) {\n    this.tokenActionHud = tokenActionHud;\n    this.dataHandler = dataHandler;\n    this.socket = socket;\n    this.layoutHandler = new LayoutHandler(systemManager, dataHandler);\n    this.groupHandler = new GroupHandler(this, systemManager, dataHandler, this.layoutHandler);\n    this.actionHandler = systemManager.getActionHandlerCore(this, this.dataHandler, this.groupHandler);\n    this.rollHandler = systemManager.getRollHandlerCore(this);\n    this.characterHandler = new CharacterHandler(this);\n  }\n\n  /**\n   * Initialise the HUD\n   * @param {string} trigger The update trigger\n   * @returns {boolean} Whether the HUD was initialised\n   */\n  async init(trigger) {\n    this.characterHandler.init();\n\n    if ( !this.characterHandler.isCharacter || !this.isHudEnabled) return false;\n\n    const options = (trigger === \"controlToken\" && this.characterHandler.isSameActor) ? { saveActor: true } : {};\n\n    await this.#buildHud(options);\n\n    return true;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Soft reset variables\n   * @public\n   */\n  softResetHud() {\n    this.hud = [];\n    this.groupHandler.softReset();\n    this.layoutHandler.softReset();\n    this.actionHandler.softReset();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Hard reset variables\n   * @public\n   */\n  hardResetHud() {\n    this.softResetHud();\n    this.groupHandler.hardReset();\n    this.layoutHandler.hardReset();\n  }\n\n  /**\n   * Build the HUD\n   * @private\n   * @param {object} options The options\n   * @returns {object}       The HUD\n   */\n  async #buildHud(options) {\n    Logger.debug(\"Building HUD...\", { actor: this.actor, token: this.token });\n\n    if (this.previousActor?.id === this.actor?.id) {\n      this.isSameActor = true;\n    } else {\n      this.previousActor = this.actor;\n      this.isSameActor = false;\n    }\n\n    this.softResetHud();\n\n    await this.layoutHandler.init();\n    await this.groupHandler.init();\n\n    if (!this.dataHandler.canGetData && !this.isGmInactiveUserNotified) {\n      Logger.info(\"Cannot retrieve HUD layout without GM present\", true);\n      this.isGmInactiveUserNotified = true;\n    }\n\n    this.hud = await this.#prepareHud();\n\n    await this.actionHandler.buildActionsCore();\n    this.groupHandler.setHasActions();\n    await this.groupHandler.saveGroups(options);\n\n    Logger.debug(\"HUD built\", { hud: this.hud, actor: this.actor, token: this.token });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Prepare the HUD\n   * @private\n   * @returns {object} The HUD\n   */\n  async #prepareHud() {\n    Logger.debug(\"Preparing HUD...\", { actor: this.actor, token: this.token });\n\n    const name = (Utils.getSetting(\"displayCharacterName\"))\n      ? this.characterHandler.characterName ?? game.i18n.localize(\"tokenActionHud.multiple\")\n      : \"\";\n    const actorId = this.actor?.id ?? \"multi\";\n    const tokenId = this.token?.id ?? \"multi\";\n    const hud = { name, tokenId, actorId, groups: [] };\n\n    const groups = await this.groupHandler.prepareGroups(hud);\n    this.actionHandler.prepareActions(groups);\n\n    Logger.debug(\"HUD prepared\", { hud, actor: this.actor, token: this.token });\n    return hud;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle HUD event\n   * @param {string} eventType The event type\n   * @param {object} event     The event\n   */\n  handleHudEvent(eventType, event) {\n    const group = ([\"groupClick\"].includes(eventType)) ? this.getGroup(event) : null;\n    const action = ([\"clickAction\", \"hoverAction\"].includes(eventType)) ? this.getAction(event) : null;\n\n    this.#registerKeyPresses(event);\n    this.#setIsHover(event);\n\n    try {\n      switch (eventType) {\n        case \"groupClick\":\n          this.rollHandler.handleGroupClickCore(event, group);\n          break;\n        case \"clickAction\":\n          this.rollHandler.handleActionClickCore(event, action, this.actionHandler);\n          break;\n        case \"hoverAction\":\n          this.rollHandler.handleActionHoverCore(event, action);\n      }\n    } catch(error) {\n      Logger.error(event);\n    }\n  }\n\n  /**\n   * Registers key presses\n   * @private\n   * @param {object} event The events\n   */\n  #registerKeyPresses(event) {\n    this.#setIsRightClick(event);\n    this.#setIsAlt(event);\n    this.#setIsCtrl(event);\n    this.#setIsShift(event);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the button was right-clicked\n   * @public\n   * @param {object} event The event\n   */\n  #setIsRightClick(event) {\n    const button = event?.originalEvent?.button || event.button;\n    this.isRightClick = button === 2;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set isAlt based on event\n   * @private\n   * @param {object} event The event\n   */\n  #setIsAlt(event) {\n    const isModiferActive = game.keyboard.isModifierActive(KeyboardManager.MODIFIER_KEYS.ALT);\n    if (event.altKey && !isModiferActive) {\n      Logger.debug(\"Emulating LEFT ALT key press\");\n      KeyboardManager.emulateKeypress(false, \"AltLeft\", { altKey: true, force: true });\n      game.keyboard.downKeys.add(\"AltLeft\");\n      this.isAlt = true;\n    } else {\n      this.isAlt = isModiferActive;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set isCtrl based on event\n   * @private\n   * @param {object} event The event\n   */\n  #setIsCtrl(event) {\n    const isModiferActive = game.keyboard.isModifierActive(KeyboardManager.MODIFIER_KEYS.CONTROL);\n    if (event.ctrlKey && !isModiferActive) {\n      Logger.debug(\"Emulating LEFT CTRL key press\");\n      KeyboardManager.emulateKeypress(false, \"ControlLeft\", { ctrlKey: true, force: true });\n      game.keyboard.downKeys.add(\"ControlLeft\");\n      this.isCtrl = true;\n    } else {\n      this.isCtrl = isModiferActive;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set isShift based on event\n   * @private\n   * @param {object} event The event\n   */\n  #setIsShift(event) {\n    const isModiferActive = game.keyboard.isModifierActive(KeyboardManager.MODIFIER_KEYS.SHIFT);\n    if (event.shiftKey && !isModiferActive) {\n      Logger.debug(\"Emulating LEFT SHIFT key press\");\n      KeyboardManager.emulateKeypress(false, \"ShiftLeft\", { shiftKey: true, force: true });\n      game.keyboard.downKeys.add(\"ShiftLeft\");\n      this.isShift = true;\n    } else {\n      this.isShift = isModiferActive;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set isHover based on event\n   * @private\n   * @param {object} event The event\n   */\n  #setIsHover(event) {\n    this.isHover = [\"mouseenter\", \"mouseover\", \"pointerenter\"].includes(event.type);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the group from the nest ID\n   * @param {object} event The event\n   * @returns {object}     The group\n   */\n  getGroup(event) {\n    const groupElement = Utils.getClosestGroupElement(event);\n    const nestId = groupElement?.dataset?.nestId;\n    return this.groupHandler.getGroup({ nestId }) ?? null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the action from the action ID on the button\n   * @param {object} event  The event\n   * @returns {object}      The action\n   */\n  getAction(event) {\n    if (!event) return {};\n    const actionButtonElement = event.target.closest('[data-part=\"actionButton\"]')\n      ?? event.target.querySelector('[data-part=\"actionButton\"]');\n    const actionId = actionButtonElement?.dataset?.actionId;\n    if (!actionId) return {};\n    return this.actionHandler.availableActions.get(actionId) || {};\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the hud is enabled for the current user\n   * @private\n   * @returns {boolean} Whether the hud is enabled for the current user\n   */\n  get isHudEnabled() {\n    if (!Utils.getSetting(\"enable\")) return false;\n    if (game.user.isGM) return true;\n    return Utils.checkAllow(game.user.role, Utils.getSetting(\"allow\"));\n  }\n\n  /* -------------------------------------------- */\n  /* Shortcuts to CharacterHandler properties     */\n  /* -------------------------------------------- */\n\n  get characterName() {\n    return this.characterHandler?.characterName;\n  }\n\n  get actor() {\n    return this.characterHandler?.actor;\n  }\n\n  set actor(actor) {\n    this.characterHandler.actor = actor;\n  }\n\n  get actors() {\n    return this.characterHandler?.actors;\n  }\n\n  set actors(actors) {\n    this.characterHandler.actors = actors;\n  }\n\n  get token() {\n    return this.characterHandler?.token;\n  }\n\n  set token(token) {\n    this.characterHandler.token = token;\n  }\n\n  get tokens() {\n    return this.characterHandler?.tokens;\n  }\n\n  set tokens(tokens) {\n    this.characterHandler.tokens = tokens;\n  }\n}\n","!function(t,e){var i=i||{};\"function\"==typeof i&&i.amd?i([],e):\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"object\"==typeof exports?exports.DragSort=e():t.DragSort=e()}(this,(function(){var t,e=0,i={},s={},r=(t=window.MutationObserver||window.WebKitMutationObserver,function(e,i){e&&1===e.nodeType&&(t?new t((function(t,e){i(t)})).observe(e,{childList:!0,subtree:!1}):window.addEventListener&&e.addEventListener(\"DOMNodeInserted\",i,!1))});function a(t,e){if(!t)return this;e=e||{},this.parentElm=t,this.uid=e.uid,this.settings={selector:\"*\",callbacks:{}},Object.assign(this.settings,e),this.setup(),r(this.parentElm,this.setup.bind(this)),this.bindEvents()}return a.prototype={namespace:\"dragsort\",setup(){[...this.parentElm.childNodes].forEach((t=>{if(1!=t.nodeType)return t.parentNode.removeChild(t);t.matches(this.settings.selector)&&(t.draggable=!0)})),this.gap=this.getItemsGap(this.parentElm.firstElementChild)},throttle(t,e){var i=!1,s=this;return function(r){i||(t.call(s,r),i=!0,setTimeout((()=>i=!1),e))}},getDraggableElm(t){if(!t.closest)return null;var e=t.closest('[draggable=\"true\"]');return this.uid==i.uid?e:null},dragstart(t,e){i=this;var s,r=this.getDraggableElm(e);r?(this.saveInitialStyles(),this.source=this.getInitialState(),this.target=this.getInitialState(),s=r.getBoundingClientRect(),this.source.elm=r,this.source.idx=this.getNodeIndex(r),this.source.size.width=s.width,this.source.size.height=s.height,t.dataTransfer.effectAllowed=\"move\",this.settings.callbacks.dragStart&&this.settings.callbacks.dragStart(this.source.elm,t),setTimeout(this.afterDragStart.bind(this))):i={}},afterDragStart(){var t=\"vertical\"==this.settings.mode?\"height\":\"width\";this.parentElm.classList.add(`${this.namespace}--dragStart`),this.source.elm.style[t]=this.source.size[t]+\"px\",this.source.elm.classList.add(`${this.namespace}--dragElem`)},dragover(t){t.preventDefault(),t.stopPropagation();var e=t.target;if((e=this.getDraggableElm(e))&&this.target){var i=this.target.elm,s=this.target.hoverDirection;t.dataTransfer.dropEffect=\"move\",this.target.hoverDirection=this.getTargetDirection(t),i==e&&s==this.target.hoverDirection||this.directionAwareDragEnter(t,e)}},dragenter(t,e){(e=this.getDraggableElm(e))&&this.target&&this.isValidElm(e)&&this.source.elm!=e&&this.source.elm&&(this.target.bounding=e.getBoundingClientRect())},directionAwareDragEnter(t,e){var i;t.preventDefault(),t.stopPropagation(),t.dataTransfer.dropEffect=\"none\",this.isValidElm(e)&&this.source.elm!=e&&this.source.elm&&(t.dataTransfer.dropEffect=\"move\",this.cleanupLastTarget(),this.target.elm=e,this.target.idx=this.getNodeIndex(e),e.classList.add(\"over\"),i=Math.abs(this.target.idx-this.source.idx),this.source.elm.classList.toggle(`${this.namespace}--hide`,i>0),\"vertical\"==this.settings.mode?this.target.elm.style[this.target.hoverDirection?\"marginBottom\":\"marginTop\"]=this.source.size.height+this.gap+\"px\":this.target.elm.style[this.target.hoverDirection?\"marginRight\":\"marginLeft\"]=this.source.size.width+this.gap+\"px\")},dragend(t){if(clearTimeout(this.dragoverTimeout),this.dragoverTimeout=null,this.parentElm.classList.remove(`${this.namespace}--dragStart`),!this.isValidElm(this.target.elm))return this.cleanup();var e=this.target.hoverDirection?this.target.elm.nextElementSibling:this.target.elm;return this.source.elm!=this.target.elm&&this.target.elm&&(this.target.elm.classList.add(`${this.namespace}--noAnim`),this.cleanup(),this.parentElm.insertBefore(this.source.elm,e)),this.source.elm&&this.source.elm.classList.remove(`${this.namespace}--dragElem`,`${this.namespace}--hide`),this.settings.callbacks.dragEnd&&this.settings.callbacks.dragEnd(this.source.elm),this},isTargetLastChild(){return this.parentElm.lastElementChild==this.target.elm},getTargetDirection(t){if(this.target.bounding)return\"vertical\"==this.settings.mode?t.pageY>this.target.bounding.top+this.target.bounding.height/2?1:0:t.pageX>this.target.bounding.left+this.target.bounding.width/2?1:0},getNodeIndex(t){for(var e=0;t=t.previousSibling;)3==t.nodeType&&/^\\s*$/.test(t.data)||e++;return e},isValidElm(t){return t&&t.nodeType&&t.parentNode==this.parentElm},saveInitialStyles(){[...this.parentElm.children].forEach((t=>{t.setAttribute(\"dragsort-initial-style\",t.getAttribute(\"style\"))}))},cleanup(){i={},[...this.parentElm.children].forEach((t=>{t.style=t.getAttribute(\"dragsort-initial-style\"),t.removeAttribute(\"dragsort-initial-style\"),setTimeout((()=>{t.classList.remove(`${this.namespace}--over`,`${this.namespace}--noAnim`,`${this.namespace}--dragElem`)}),50)}))},cleanupLastTarget(){const{elm:t}=this.target;t&&(t.classList.remove(`${this.namespace}--hide`,`${this.namespace}--over`),t.style=t.getAttribute(\"dragsort-initial-style\"))},getInitialState:()=>({elm:null,size:{}}),getItemsGap(t){var e=getComputedStyle(t),i=getComputedStyle(t.parentNode),s=\"vertical\"==this.settings.mode,r=parseInt(i.gap)||0;return parseInt(e[\"margin\"+(s?\"Top\":\"Left\")])+parseInt(e[\"margin\"+(s?\"Bottom\":\"Right\")])+r},bindEvents(t){for(var e in this.listeners=this.listeners||{dragstart:t=>this.dragstart(t,t.target),dragenter:t=>this.dragenter(t,t.target),dragend:t=>this.dragend(t,t.target),dragover:this.throttle(this.dragover,350)},this.listeners)this.parentElm[t?\"removeEventListener\":\"addEventListener\"](e,this.listeners[e])},destroy(){this.cleanup(),this.bindEvents(!0),delete s[this.uid]}},function(t,i){return s[++e]=t.DragSort?s[t.DragSort]:new a(t,{...i,uid:e}),t.DragSort=e,s[e]}}));","/*\nTagify v4.31.3 - tags input component\nBy: Yair Even-Or <vsync.design@gmail.com>\nhttps://github.com/yairEO/tagify\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in\r\nall copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\nTHE SOFTWARE.\r\n\r\nThis Software may not be rebranded and sold as a library under any other name\r\nother than \"Tagify\" (by owner) or as part of another library.\n*/\n\nvar t=\"&#8203;\";function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function i(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if(\"undefined\"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t[\"@@iterator\"])return Array.from(t)}(t)||function(t,i){if(!t)return;if(\"string\"==typeof t)return e(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);\"Object\"===n&&t.constructor&&(n=t.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(n);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e(t,i)}(t)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}var n={isEnabled:function(){var t;return null===(t=window.TAGIFY_DEBUG)||void 0===t||t},log:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var s;this.isEnabled()&&(s=console).log.apply(s,[\"[Tagify]:\"].concat(i(e)))},warn:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var s;this.isEnabled()&&(s=console).warn.apply(s,[\"[Tagify]:\"].concat(i(e)))}},s=function(t,e,i,n){return t=\"\"+t,e=\"\"+e,n&&(t=t.trim(),e=e.trim()),i?t==e:t.toLowerCase()==e.toLowerCase()},a=function(t,e){return t&&Array.isArray(t)&&t.map((function(t){return o(t,e)}))};function o(t,e){var i,n={};for(i in t)e.indexOf(i)<0&&(n[i]=t[i]);return n}function r(t){return(new DOMParser).parseFromString(t.trim(),\"text/html\").body.firstElementChild}function l(t,e){for(e=e||\"previous\";t=t[e+\"Sibling\"];)if(3==t.nodeType)return t}function d(t){return\"string\"==typeof t?t.replace(/&/g,\"&amp;\").replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\").replace(/\"/g,\"&quot;\").replace(/`|'/g,\"&#039;\"):t}function c(t){var e=Object.prototype.toString.call(t).split(\" \")[1].slice(0,-1);return t===Object(t)&&\"Array\"!=e&&\"Function\"!=e&&\"RegExp\"!=e&&\"HTMLUnknownElement\"!=e}function u(t,e,i){var n,s;function a(t,e){for(var i in e)if(e.hasOwnProperty(i)){if(c(e[i])){c(t[i])?a(t[i],e[i]):t[i]=Object.assign({},e[i]);continue}if(Array.isArray(e[i])){t[i]=Object.assign([],e[i]);continue}t[i]=e[i]}}return n=t,(null!=(s=Object)&&\"undefined\"!=typeof Symbol&&s[Symbol.hasInstance]?s[Symbol.hasInstance](n):n instanceof s)||(t={}),a(t,e),i&&a(t,i),t}function g(){var t=[],e={},i=!0,n=!1,s=void 0;try{for(var a,o=arguments[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var r=a.value,l=!0,d=!1,u=void 0;try{for(var g,h=r[Symbol.iterator]();!(l=(g=h.next()).done);l=!0){var p=g.value;c(p)?e[p.value]||(t.push(p),e[p.value]=1):t.includes(p)||t.push(p)}}catch(t){d=!0,u=t}finally{try{l||null==h.return||h.return()}finally{if(d)throw u}}}}catch(t){n=!0,s=t}finally{try{i||null==o.return||o.return()}finally{if(n)throw s}}return t}function h(t){return String.prototype.normalize?\"string\"==typeof t?t.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g,\"\"):void 0:t}var p=function(){return/(?=.*chrome)(?=.*android)/i.test(navigator.userAgent)};function f(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(t){return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}))}function m(t){return t&&t.classList&&t.classList.contains(this.settings.classNames.tag)}function v(t){return t&&t.closest(this.settings.classNames.tagSelector)}function b(t,e){var i=window.getSelection();return e=e||i.getRangeAt(0),\"string\"==typeof t&&(t=document.createTextNode(t)),e&&(e.deleteContents(),e.insertNode(t)),t}function w(t,e,i){return t?(e&&(t.__tagifyTagData=i?e:u({},t.__tagifyTagData||{},e)),t.__tagifyTagData):(n.warn(\"tag element doesn't exist\",{tagElm:t,data:e}),e)}function y(t){if(t&&t.parentNode){var e=t,i=window.getSelection(),n=i.getRangeAt(0);i.rangeCount&&(n.setStartAfter(e),n.collapse(!0),i.removeAllRanges(),i.addRange(n))}}function T(t,e){t.forEach((function(t){if(w(t.previousSibling)||!t.previousSibling){var i=document.createTextNode(\"​\");t.before(i),e&&y(i)}}))}var O={delimiters:\",\",pattern:null,tagTextProp:\"value\",maxTags:1/0,callbacks:{},addTagOnBlur:!0,addTagOn:[\"blur\",\"tab\",\"enter\"],onChangeAfterBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,userInput:!0,focusable:!0,keepInvalidTags:!1,createInvalidTags:!0,mixTagsAllowedAfter:/,|\\.|\\:|\\s/,mixTagsInterpolator:[\"[[\",\"]]\"],backspace:!0,skipInvalid:!1,pasteAsTags:!0,editTags:{clicks:2,keepInvalid:!0},transformTag:function(){},trim:!0,a11y:{focusableTags:!1},mixMode:{insertAfterTag:\" \"},autoComplete:{enabled:!0,rightKey:!1,tabKey:!1},classNames:{namespace:\"tagify\",mixMode:\"tagify--mix\",selectMode:\"tagify--select\",input:\"tagify__input\",focus:\"tagify--focus\",tagNoAnimation:\"tagify--noAnim\",tagInvalid:\"tagify--invalid\",tagNotAllowed:\"tagify--notAllowed\",scopeLoading:\"tagify--loading\",hasMaxTags:\"tagify--hasMaxTags\",hasNoTags:\"tagify--noTags\",empty:\"tagify--empty\",inputInvalid:\"tagify__input--invalid\",dropdown:\"tagify__dropdown\",dropdownWrapper:\"tagify__dropdown__wrapper\",dropdownHeader:\"tagify__dropdown__header\",dropdownFooter:\"tagify__dropdown__footer\",dropdownItem:\"tagify__dropdown__item\",dropdownItemActive:\"tagify__dropdown__item--active\",dropdownItemHidden:\"tagify__dropdown__item--hidden\",dropdownItemSelected:\"tagify__dropdown__item--selected\",dropdownInital:\"tagify__dropdown--initial\",tag:\"tagify__tag\",tagText:\"tagify__tag-text\",tagX:\"tagify__tag__removeBtn\",tagLoading:\"tagify__tag--loading\",tagEditing:\"tagify__tag--editable\",tagFlash:\"tagify__tag--flash\",tagHide:\"tagify__tag--hide\"},dropdown:{classname:\"\",enabled:2,maxItems:10,searchKeys:[\"value\",\"searchBy\"],fuzzySearch:!0,caseSensitive:!1,accentedSearch:!0,includeSelectedTags:!1,escapeHTML:!0,highlightFirst:!0,closeOnSelect:!0,clearOnSelect:!0,position:\"all\",appendTarget:null},hooks:{beforeRemoveTag:function(){return Promise.resolve()},beforePaste:function(){return Promise.resolve()},suggestionClick:function(){return Promise.resolve()},beforeKeyDown:function(){return Promise.resolve()}}};function x(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function D(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);\"function\"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),n.forEach((function(e){x(t,e,i[e])}))}return t}function I(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):function(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))})),t}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function E(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function M(t){return function(t){if(Array.isArray(t))return S(t)}(t)||function(t){if(\"undefined\"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t[\"@@iterator\"])return Array.from(t)}(t)||function(t,e){if(!t)return;if(\"string\"==typeof t)return S(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);\"Object\"===i&&t.constructor&&(i=t.constructor.name);if(\"Map\"===i||\"Set\"===i)return Array.from(i);if(\"Arguments\"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return S(t,e)}(t)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function N(){for(var t in this.dropdown={},this._dropdown)this.dropdown[t]=\"function\"==typeof this._dropdown[t]?this._dropdown[t].bind(this):this._dropdown[t];this.dropdown.refs(),this.DOM.dropdown.__tagify=this}var _,A,C=(_=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);\"function\"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),n.forEach((function(e){E(t,e,i[e])}))}return t}({},{events:{binding:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.dropdown.events.callbacks,i=this.listeners.dropdown=this.listeners.dropdown||{position:this.dropdown.position.bind(this,null),onKeyDown:e.onKeyDown.bind(this),onMouseOver:e.onMouseOver.bind(this),onMouseLeave:e.onMouseLeave.bind(this),onClick:e.onClick.bind(this),onScroll:e.onScroll.bind(this)},n=t?\"addEventListener\":\"removeEventListener\";\"manual\"!=this.settings.dropdown.position&&(document[n](\"scroll\",i.position,!0),window[n](\"resize\",i.position),window[n](\"keydown\",i.onKeyDown)),this.DOM.dropdown[n](\"mouseover\",i.onMouseOver),this.DOM.dropdown[n](\"mouseleave\",i.onMouseLeave),this.DOM.dropdown[n](\"mousedown\",i.onClick),this.DOM.dropdown.content[n](\"scroll\",i.onScroll)},callbacks:{onKeyDown:function(t){var e=this;if(this.state.hasFocus&&!this.state.composing){var i=this.settings,s=this.DOM.dropdown.querySelector(i.classNames.dropdownItemActiveSelector),a=this.dropdown.getSuggestionDataByNode(s),o=\"mix\"==i.mode,r=\"select\"==i.mode;i.hooks.beforeKeyDown(t,{tagify:this}).then((function(l){switch(t.key){case\"ArrowDown\":case\"ArrowUp\":case\"Down\":case\"Up\":t.preventDefault();var d=e.dropdown.getAllSuggestionsRefs(),c=\"ArrowUp\"==t.key||\"Up\"==t.key;s&&(s=e.dropdown.getNextOrPrevOption(s,!c)),s&&s.matches(i.classNames.dropdownItemSelector)||(s=d[c?d.length-1:0]),e.dropdown.highlightOption(s,!0);break;case\"Escape\":case\"Esc\":e.dropdown.hide();break;case\"ArrowRight\":if(e.state.actions.ArrowLeft||i.autoComplete.rightKey)return;case\"Tab\":var u=!i.autoComplete.rightKey||!i.autoComplete.tabKey;if(!o&&!r&&s&&u&&!e.state.editing&&a){t.preventDefault();var g=e.dropdown.getMappedValue(a);return e.input.autocomplete.set.call(e,g),!1}return!0;case\"Enter\":t.preventDefault(),i.hooks.suggestionClick(t,{tagify:e,tagData:a,suggestionElm:s}).then((function(){if(s)return e.dropdown.selectOption(s),s=e.dropdown.getNextOrPrevOption(s,!c),void e.dropdown.highlightOption(s);e.dropdown.hide(),o||e.addTags(e.state.inputText.trim(),!0)})).catch((function(t){return n.warn(t)}));break;case\"Backspace\":if(o||e.state.editing.scope)return;var h=e.input.raw.call(e);\"\"!=h&&8203!=h.charCodeAt(0)||(!0===i.backspace?e.removeTags():\"edit\"==i.backspace&&setTimeout(e.editTag.bind(e),0))}}))}},onMouseOver:function(t){var e=t.target.closest(this.settings.classNames.dropdownItemSelector);this.dropdown.highlightOption(e)},onMouseLeave:function(t){this.dropdown.highlightOption()},onClick:function(t){var e=this;if(0==t.button&&t.target!=this.DOM.dropdown&&t.target!=this.DOM.dropdown.content){var i=t.target.closest(this.settings.classNames.dropdownItemSelector),s=this.dropdown.getSuggestionDataByNode(i);this.state.actions.selectOption=!0,setTimeout((function(){return e.state.actions.selectOption=!1}),50),this.settings.hooks.suggestionClick(t,{tagify:this,tagData:s,suggestionElm:i}).then((function(){i?e.dropdown.selectOption(i,t):e.dropdown.hide()})).catch((function(t){return n.warn(t)}))}},onScroll:function(t){var e=t.target,i=e.scrollTop/(e.scrollHeight-e.parentNode.clientHeight)*100;this.trigger(\"dropdown:scroll\",{percentage:Math.round(i)})}}},refilter:function(t){t=t||this.state.dropdown.query||\"\",this.suggestedListItems=this.dropdown.filterListItems(t),this.dropdown.fill(),this.suggestedListItems.length||this.dropdown.hide(),this.trigger(\"dropdown:updated\",this.DOM.dropdown)},getSuggestionDataByNode:function(t){for(var e,i=t&&t.getAttribute(\"value\"),n=this.suggestedListItems.length;n--;){if(c(e=this.suggestedListItems[n])&&e.value==i)return e;if(e==i)return{value:e}}},getNextOrPrevOption:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.dropdown.getAllSuggestionsRefs(),n=i.findIndex((function(e){return e===t}));return e?i[n+1]:i[n-1]},highlightOption:function(t,e){var i,n=this.settings.classNames.dropdownItemActive;if(this.state.ddItemElm&&(this.state.ddItemElm.classList.remove(n),this.state.ddItemElm.removeAttribute(\"aria-selected\")),!t)return this.state.ddItemData=null,this.state.ddItemElm=null,void this.input.autocomplete.suggest.call(this);i=this.dropdown.getSuggestionDataByNode(t),this.state.ddItemData=i,this.state.ddItemElm=t,t.classList.add(n),t.setAttribute(\"aria-selected\",!0),e&&(t.parentNode.scrollTop=t.clientHeight+t.offsetTop-t.parentNode.clientHeight),this.settings.autoComplete&&(this.input.autocomplete.suggest.call(this,i),this.dropdown.position())},selectOption:function(t,e){var i=this,n=this.settings,s=n.dropdown,a=s.clearOnSelect,o=s.closeOnSelect;if(!t)return this.addTags(this.state.inputText,!0),void(o&&this.dropdown.hide());e=e||{};var r=t.getAttribute(\"value\"),l=\"noMatch\"==r,d=\"mix\"==n.mode,c=this.suggestedListItems.find((function(t){var e;return(null!==(e=t.value)&&void 0!==e?e:t)==r}));if(this.trigger(\"dropdown:select\",{data:c,elm:t,event:e}),c||l){if(this.state.editing){var g=this.normalizeTags([c])[0];c=n.transformTag.call(this,g)||g,this.onEditTagDone(null,u({__isValid:!0},c))}else this[d?\"addMixTags\":\"addTags\"]([c||this.input.raw.call(this)],a);(d||this.DOM.input.parentNode)&&(setTimeout((function(){i.DOM.input.focus(),i.toggleFocusClass(!0)})),o&&setTimeout(this.dropdown.hide.bind(this)),t.addEventListener(\"transitionend\",(function(){i.dropdown.fillHeaderFooter(),setTimeout((function(){t.remove(),i.dropdown.refilter()}),100)}),{once:!0}),t.classList.add(this.settings.classNames.dropdownItemHidden))}else o&&setTimeout(this.dropdown.hide.bind(this))},selectAll:function(t){this.suggestedListItems.length=0,this.dropdown.hide(),this.dropdown.filterListItems(\"\");var e=this.dropdown.filterListItems(\"\");return t||(e=this.state.dropdown.suggestions),this.addTags(e,!0),this},filterListItems:function(t,e){var i,n,s,a,o,r,l=function(){var t,l,d=void 0,u=void 0;t=m[y],n=(null!=(l=Object)&&\"undefined\"!=typeof Symbol&&l[Symbol.hasInstance]?l[Symbol.hasInstance](t):t instanceof l)?m[y]:{value:m[y]};var v,b=!Object.keys(n).some((function(t){return w.includes(t)}))?[\"value\"]:w;g.fuzzySearch&&!e.exact?(a=b.reduce((function(t,e){return t+\" \"+(n[e]||\"\")}),\"\").toLowerCase().trim(),g.accentedSearch&&(a=h(a),r=h(r)),d=0==a.indexOf(r),u=a===r,v=a,s=r.toLowerCase().split(\" \").every((function(t){return v.includes(t.toLowerCase())}))):(d=!0,s=b.some((function(t){var i=\"\"+(n[t]||\"\");return g.accentedSearch&&(i=h(i),r=h(r)),g.caseSensitive||(i=i.toLowerCase()),u=i===r,e.exact?i===r:0==i.indexOf(r)}))),o=!g.includeSelectedTags&&i.isTagDuplicate(c(n)?n.value:n),s&&!o&&(u&&d?f.push(n):\"startsWith\"==g.sortby&&d?p.unshift(n):p.push(n))},d=this,u=this.settings,g=u.dropdown,p=(e=e||{},[]),f=[],m=u.whitelist,v=g.maxItems>=0?g.maxItems:1/0,b=g.includeSelectedTags||\"select\"==u.mode,w=g.searchKeys,y=0;if(!(t=\"select\"==u.mode&&this.value.length&&this.value[0][u.tagTextProp]==t?\"\":t)||!w.length)return p=b?m:m.filter((function(t){return!d.isTagDuplicate(c(t)?t.value:t)})),this.state.dropdown.suggestions=p,p.slice(0,v);for(r=g.caseSensitive?\"\"+t:(\"\"+t).toLowerCase();y<m.length;y++)i=this,l();return this.state.dropdown.suggestions=f.concat(p),\"function\"==typeof g.sortby?g.sortby(f.concat(p),r):f.concat(p).slice(0,v)},getMappedValue:function(t){var e=this.settings.dropdown.mapValueTo;return e?\"function\"==typeof e?e(t):t[e]||t.value:t.value},createListHTML:function(t){var e=this;return u([],t).map((function(t,i){\"string\"!=typeof t&&\"number\"!=typeof t||(t={value:t});var n=e.dropdown.getMappedValue(t);return n=\"string\"==typeof n&&e.settings.dropdown.escapeHTML?d(n):n,e.settings.templates.dropdownItem.apply(e,[I(D({},t),{mappedValue:n}),e])})).join(\"\")}}),A=null!=(A={refs:function(){this.DOM.dropdown=this.parseTemplate(\"dropdown\",[this.settings]),this.DOM.dropdown.content=this.DOM.dropdown.querySelector(\"[data-selector='tagify-suggestions-wrapper']\")},getHeaderRef:function(){return this.DOM.dropdown.querySelector(\"[data-selector='tagify-suggestions-header']\")},getFooterRef:function(){return this.DOM.dropdown.querySelector(\"[data-selector='tagify-suggestions-footer']\")},getAllSuggestionsRefs:function(){return M(this.DOM.dropdown.content.querySelectorAll(this.settings.classNames.dropdownItemSelector))},show:function(t){var e,i,n,a=this,o=this.settings,r=\"mix\"==o.mode&&!o.enforceWhitelist,l=!o.whitelist||!o.whitelist.length,d=\"manual\"==o.dropdown.position;if(t=void 0===t?this.state.inputText:t,!(l&&!r&&!o.templates.dropdownItemNoMatch||!1===o.dropdown.enable||this.state.isLoading||this.settings.readonly)){if(clearTimeout(this.dropdownHide__bindEventsTimeout),this.suggestedListItems=this.dropdown.filterListItems(t),t&&!this.suggestedListItems.length&&(this.trigger(\"dropdown:noMatch\",t),o.templates.dropdownItemNoMatch&&(n=o.templates.dropdownItemNoMatch.call(this,{value:t}))),!n){if(this.suggestedListItems.length)t&&r&&!this.state.editing.scope&&!s(this.suggestedListItems[0].value,t)&&this.suggestedListItems.unshift({value:t});else{if(!t||!r||this.state.editing.scope)return this.input.autocomplete.suggest.call(this),void this.dropdown.hide();this.suggestedListItems=[{value:t}]}i=\"\"+(c(e=this.suggestedListItems[0])?e.value:e),o.autoComplete&&i&&0==i.indexOf(t)&&this.input.autocomplete.suggest.call(this,e)}this.dropdown.fill(n),o.dropdown.highlightFirst&&this.dropdown.highlightOption(this.DOM.dropdown.content.querySelector(o.classNames.dropdownItemSelector)),this.state.dropdown.visible||setTimeout(this.dropdown.events.binding.bind(this)),this.state.dropdown.visible=t||!0,this.state.dropdown.query=t,this.setStateSelection(),d||setTimeout((function(){a.dropdown.position(),a.dropdown.render()})),setTimeout((function(){a.trigger(\"dropdown:show\",a.DOM.dropdown)}))}},hide:function(t){var e=this,i=this.DOM,n=i.scope,s=i.dropdown,a=\"manual\"==this.settings.dropdown.position&&!t;if(s&&document.body.contains(s)&&!a)return window.removeEventListener(\"resize\",this.dropdown.position),this.dropdown.events.binding.call(this,!1),n.setAttribute(\"aria-expanded\",!1),s.parentNode.removeChild(s),setTimeout((function(){e.state.dropdown.visible=!1}),100),this.state.dropdown.query=this.state.ddItemData=this.state.ddItemElm=this.state.selection=null,this.state.tag&&this.state.tag.value.length&&(this.state.flaggedTags[this.state.tag.baseOffset]=this.state.tag),this.trigger(\"dropdown:hide\",s),this},toggle:function(t){this.dropdown[this.state.dropdown.visible&&!t?\"hide\":\"show\"]()},getAppendTarget:function(){var t=this.settings.dropdown;return\"function\"==typeof t.appendTarget?t.appendTarget():t.appendTarget},render:function(){var t,e,i,n=this,s=(t=this.DOM.dropdown,(i=t.cloneNode(!0)).style.cssText=\"position:fixed; top:-9999px; opacity:0\",document.body.appendChild(i),e=i.clientHeight,i.parentNode.removeChild(i),e),a=this.settings,o=this.dropdown.getAppendTarget();return!1===a.dropdown.enabled||(this.DOM.scope.setAttribute(\"aria-expanded\",!0),document.body.contains(this.DOM.dropdown)||(this.DOM.dropdown.classList.add(a.classNames.dropdownInital),this.dropdown.position(s),o.appendChild(this.DOM.dropdown),setTimeout((function(){return n.DOM.dropdown.classList.remove(a.classNames.dropdownInital)})))),this},fill:function(t){t=\"string\"==typeof t?t:this.dropdown.createListHTML(t||this.suggestedListItems);var e,i=this.settings.templates.dropdownContent.call(this,t);this.DOM.dropdown.content.innerHTML=(e=i)?e.replace(/\\>[\\r\\n ]+\\</g,\"><\").split(/>\\s+</).join(\"><\").trim():\"\"},fillHeaderFooter:function(){var t=this.dropdown.filterListItems(this.state.dropdown.query),e=this.parseTemplate(\"dropdownHeader\",[t]),i=this.parseTemplate(\"dropdownFooter\",[t]),n=this.dropdown.getHeaderRef(),s=this.dropdown.getFooterRef();e&&(null==n||n.parentNode.replaceChild(e,n)),i&&(null==s||s.parentNode.replaceChild(i,s))},position:function(t){var e=this.settings.dropdown,i=this.dropdown.getAppendTarget();if(\"manual\"!=e.position&&i){var n,s,a,o,r,l,d,c,u,g=this.DOM.dropdown,h=e.RTL,p=i===document.body,f=i===this.DOM.scope,m=p?window.pageYOffset:i.scrollTop,v=document.fullscreenElement||document.webkitFullscreenElement||document.documentElement,b=v.clientHeight,w=Math.max(v.clientWidth||0,window.innerWidth||0)>480?e.position:\"all\",y=this.DOM[\"input\"==w?\"input\":\"scope\"];if(t=t||g.clientHeight,this.state.dropdown.visible){if(\"text\"==w?(a=(n=function(){var t=document.getSelection();if(t.rangeCount){var e,i,n=t.getRangeAt(0),s=n.startContainer,a=n.startOffset;if(a>0)return(i=document.createRange()).setStart(s,a-1),i.setEnd(s,a),{left:(e=i.getBoundingClientRect()).right,top:e.top,bottom:e.bottom};if(s.getBoundingClientRect)return s.getBoundingClientRect()}return{left:-9999,top:-9999}}()).bottom,s=n.top,o=n.left,r=\"auto\"):(l=function(t){var e=0,i=0;for(t=t.parentNode;t&&t!=v;)e+=t.offsetTop||0,i+=t.offsetLeft||0,t=t.parentNode;return{top:e,left:i}}(i),n=y.getBoundingClientRect(),s=f?-1:n.top-l.top,a=(f?n.height:n.bottom-l.top)-1,o=f?-1:n.left-l.left,r=n.width+\"px\"),!p){var T=function(){for(var t=0,i=e.appendTarget.parentNode;i;)t+=i.scrollTop||0,i=i.parentNode;return t}();s+=T,a+=T}var O;s=Math.floor(s),a=Math.ceil(a),c=((d=null!==(O=e.placeAbove)&&void 0!==O?O:b-n.bottom<t)?s:a)+m,u=\"left: \".concat(o+(h&&n.width||0)+window.pageXOffset,\"px;\"),g.style.cssText=\"\".concat(u,\"; top: \").concat(c,\"px; min-width: \").concat(r,\"; max-width: \").concat(r),g.setAttribute(\"placement\",d?\"top\":\"bottom\"),g.setAttribute(\"position\",w)}}}})?A:{},Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(A)):function(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}(Object(A)).forEach((function(t){Object.defineProperty(_,t,Object.getOwnPropertyDescriptor(A,t))})),_),k=\"@yaireo/tagify/\",L={empty:\"empty\",exceed:\"number of tags exceeded\",pattern:\"pattern mismatch\",duplicate:\"already exists\",notAllowed:\"not allowed\"},j={wrapper:function(e,i){return'<tags class=\"'.concat(i.classNames.namespace,\" \").concat(i.mode?\"\".concat(i.classNames[i.mode+\"Mode\"]):\"\",\" \").concat(e.className,'\"\\n                    ').concat(i.readonly?\"readonly\":\"\",\"\\n                    \").concat(i.disabled?\"disabled\":\"\",\"\\n                    \").concat(i.required?\"required\":\"\",\"\\n                    \").concat(\"select\"===i.mode?\"spellcheck='false'\":\"\",'\\n                    tabIndex=\"-1\">\\n                    ').concat(this.settings.templates.input.call(this),\"\\n                \").concat(t,\"\\n        </tags>\")},input:function(){var e=this.settings,i=e.placeholder||t;return\"<span \".concat(!e.readonly&&e.userInput?\"contenteditable\":\"\",' tabIndex=\"0\" data-placeholder=\"').concat(i,'\" aria-placeholder=\"').concat(e.placeholder||\"\",'\"\\n                    class=\"').concat(e.classNames.input,'\"\\n                    role=\"textbox\"\\n                    autocapitalize=\"false\"\\n                    autocorrect=\"off\"\\n                    spellcheck=\"false\"\\n                    aria-autocomplete=\"both\"\\n                    aria-multiline=\"').concat(\"mix\"==e.mode,'\"></span>')},tag:function(t,e){var i=e.settings;return'<tag title=\"'.concat(t.title||t.value,\"\\\"\\n                    contenteditable='false'\\n                    tabIndex=\\\"\").concat(i.a11y.focusableTags?0:-1,'\"\\n                    class=\"').concat(i.classNames.tag,\" \").concat(t.class||\"\",'\"\\n                    ').concat(this.getAttributes(t),\">\\n            <x title='' tabIndex=\\\"\").concat(i.a11y.focusableTags?0:-1,'\" class=\"').concat(i.classNames.tagX,\"\\\" role='button' aria-label='remove tag'></x>\\n            <div>\\n                <span \").concat(\"select\"===i.mode&&i.userInput?\"contenteditable='true'\":\"\",' autocapitalize=\"false\" autocorrect=\"off\" spellcheck=\\'false\\' class=\"').concat(i.classNames.tagText,'\">').concat(t[i.tagTextProp]||t.value,\"</span>\\n            </div>\\n        </tag>\")},dropdown:function(t){var e=t.dropdown,i=\"manual\"==e.position;return'<div class=\"'.concat(i?\"\":t.classNames.dropdown,\" \").concat(e.classname,'\" role=\"listbox\" aria-labelledby=\"dropdown\" dir=\"').concat(e.RTL?\"rtl\":\"\",\"\\\">\\n                    <div data-selector='tagify-suggestions-wrapper' class=\\\"\").concat(t.classNames.dropdownWrapper,'\"></div>\\n                </div>')},dropdownContent:function(t){var e=this.settings.templates,i=this.state.dropdown.suggestions;return\"\\n            \".concat(e.dropdownHeader.call(this,i),\"\\n            \").concat(t,\"\\n            \").concat(e.dropdownFooter.call(this,i),\"\\n        \")},dropdownItem:function(t){return\"<div \".concat(this.getAttributes(t),\"\\n                    class='\").concat(this.settings.classNames.dropdownItem,\" \").concat(this.isTagDuplicate(t.value)?this.settings.classNames.dropdownItemSelected:\"\",\" \").concat(t.class||\"\",'\\'\\n                    tabindex=\"0\"\\n                    role=\"option\">').concat(t.mappedValue||t.value,\"</div>\")},dropdownHeader:function(t){return\"<header data-selector='tagify-suggestions-header' class=\\\"\".concat(this.settings.classNames.dropdownHeader,'\"></header>')},dropdownFooter:function(t){var e=t.length-this.settings.dropdown.maxItems;return e>0?\"<footer data-selector='tagify-suggestions-footer' class=\\\"\".concat(this.settings.classNames.dropdownFooter,'\">\\n                ').concat(e,\" more items. Refine your search.\\n            </footer>\"):\"\"},dropdownItemNoMatch:null};function P(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function V(t,e){return null!=e&&\"undefined\"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function F(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:\"undefined\"!=typeof Symbol&&t[Symbol.iterator]||t[\"@@iterator\"];if(null!=i){var n,s,a=[],o=!0,r=!1;try{for(i=i.call(t);!(o=(n=i.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){r=!0,s=t}finally{try{o||null==i.return||i.return()}finally{if(r)throw s}}return a}}(t,e)||function(t,e){if(!t)return;if(\"string\"==typeof t)return P(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);\"Object\"===i&&t.constructor&&(i=t.constructor.name);if(\"Map\"===i||\"Set\"===i)return Array.from(i);if(\"Arguments\"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return P(t,e)}(t,e)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function H(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function B(t,e){return null!=e&&\"undefined\"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function W(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):function(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))})),t}function K(t){return function(t){if(Array.isArray(t))return R(t)}(t)||function(t){if(\"undefined\"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t[\"@@iterator\"])return Array.from(t)}(t)||function(t,e){if(!t)return;if(\"string\"==typeof t)return R(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);\"Object\"===i&&t.constructor&&(i=t.constructor.name);if(\"Map\"===i||\"Set\"===i)return Array.from(i);if(\"Arguments\"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return R(t,e)}(t)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}var U={customBinding:function(){var t=this;this.customEventsList.forEach((function(e){t.on(e,t.settings.callbacks[e])}))},binding:function(){var t,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=this.settings,n=this.events.callbacks,s=e?\"addEventListener\":\"removeEventListener\";if(!this.state.mainEvents||!e){for(var a in this.state.mainEvents=e,e&&!this.listeners.main&&(this.events.bindGlobal.call(this),this.settings.isJQueryPlugin&&jQuery(this.DOM.originalInput).on(\"tagify.removeAllTags\",this.removeAllTags.bind(this))),t=this.listeners.main=this.listeners.main||{keydown:[\"input\",n.onKeydown.bind(this)],click:[\"scope\",n.onClickScope.bind(this)],dblclick:\"select\"!=i.mode&&[\"scope\",n.onDoubleClickScope.bind(this)],paste:[\"input\",n.onPaste.bind(this)],drop:[\"input\",n.onDrop.bind(this)],compositionstart:[\"input\",n.onCompositionStart.bind(this)],compositionend:[\"input\",n.onCompositionEnd.bind(this)]})t[a]&&this.DOM[t[a][0]][s](a,t[a][1]);var o=this.listeners.main.inputMutationObserver||new MutationObserver(n.onInputDOMChange.bind(this));o.disconnect(),\"mix\"==i.mode&&o.observe(this.DOM.input,{childList:!0}),this.events.bindOriginaInputListener.call(this)}},bindOriginaInputListener:function(t){var e=(t||0)+500;this.listeners.main&&(clearInterval(this.listeners.main.originalInputValueObserverInterval),this.listeners.main.originalInputValueObserverInterval=setInterval(this.events.callbacks.observeOriginalInputValue.bind(this),e))},bindGlobal:function(t){var e,i=this.events.callbacks,n=t?\"removeEventListener\":\"addEventListener\";if(this.listeners&&(t||!this.listeners.global)){this.listeners.global=this.listeners.global||[{type:this.isIE?\"keydown\":\"input\",target:this.DOM.input,cb:i[this.isIE?\"onInputIE\":\"onInput\"].bind(this)},{type:\"keydown\",target:window,cb:i.onWindowKeyDown.bind(this)},{type:\"focusin\",target:this.DOM.scope,cb:i.onFocusBlur.bind(this)},{type:\"focusout\",target:this.DOM.scope,cb:i.onFocusBlur.bind(this)},{type:\"click\",target:document,cb:i.onClickAnywhere.bind(this),useCapture:!0}];var s=!0,a=!1,o=void 0;try{for(var r,l=this.listeners.global[Symbol.iterator]();!(s=(r=l.next()).done);s=!0)(e=r.value).target[n](e.type,e.cb,!!e.useCapture)}catch(t){a=!0,o=t}finally{try{s||null==l.return||l.return()}finally{if(a)throw o}}}},unbindGlobal:function(){this.events.bindGlobal.call(this,!0)},callbacks:{onFocusBlur:function(t){var e,i,n=this.settings,s=v.call(this,t.target),a=m.call(this,t.target),o=t.target.classList.contains(n.classNames.tagX),r=\"focusin\"==t.type,l=\"focusout\"==t.type;s&&r&&!a&&!o&&this.toggleFocusClass(this.state.hasFocus=+new Date);var d=t.target?this.trim(this.DOM.input.textContent):\"\",c=null===(i=this.value)||void 0===i||null===(e=i[0])||void 0===e?void 0:e[n.tagTextProp],u=n.dropdown.enabled>=0,g={relatedTarget:t.relatedTarget},h=this.state.actions.selectOption&&(u||!n.dropdown.closeOnSelect),p=this.state.actions.addNew&&u;if(l){if(t.relatedTarget===this.DOM.scope)return this.dropdown.hide(),void this.DOM.input.focus();this.postUpdate(),n.onChangeAfterBlur&&this.triggerChangeEvent()}if(!(h||p||o))if(r||s?(this.state.hasFocus=+new Date,this.toggleFocusClass(this.state.hasFocus)):this.state.hasFocus=!1,\"mix\"!=n.mode){if(r){if(!n.focusable)return;var f=0===n.dropdown.enabled&&!this.state.dropdown.visible,b=!a||\"select\"===n.mode;return this.toggleFocusClass(!0),this.trigger(\"focus\",g),void(f&&b&&this.dropdown.show(this.value.length?\"\":void 0))}if(l){if(this.trigger(\"blur\",g),this.loading(!1),\"select\"==n.mode){if(this.value.length){var w=this.getTagElms()[0];d=this.trim(w.textContent)}c===d&&(d=\"\")}d&&!this.state.actions.selectOption&&n.addTagOnBlur&&n.addTagOn.includes(\"blur\")&&this.addTags(d,!0)}s||(this.DOM.input.removeAttribute(\"style\"),this.dropdown.hide())}else r?this.trigger(\"focus\",g):l&&(this.trigger(\"blur\",g),this.loading(!1),this.dropdown.hide(),this.state.dropdown.visible=void 0,this.setStateSelection())},onCompositionStart:function(t){this.state.composing=!0},onCompositionEnd:function(t){this.state.composing=!1},onWindowKeyDown:function(t){var e,i=this.settings,n=document.activeElement,s=v.call(this,n)&&this.DOM.scope.contains(document.activeElement),a=s&&n.hasAttribute(\"readonly\");if(this.state.hasFocus||s&&!a){e=n.nextElementSibling;var o=t.target.classList.contains(i.classNames.tagX);switch(t.key){case\"Backspace\":i.readonly||this.state.editing||(this.removeTags(n),(e||this.DOM.input).focus());break;case\"Enter\":if(o)return void this.removeTags(t.target.parentNode);i.a11y.focusableTags&&m.call(this,n)&&setTimeout(this.editTag.bind(this),0,n);break;case\"ArrowDown\":this.state.dropdown.visible||\"mix\"==i.mode||this.dropdown.show()}}},onKeydown:function(t){var e=this,i=this.settings;if(!this.state.composing&&i.userInput){\"select\"==i.mode&&i.enforceWhitelist&&this.value.length&&\"Tab\"!=t.key&&t.preventDefault();var n=this.trim(t.target.textContent);this.trigger(\"keydown\",{event:t}),i.hooks.beforeKeyDown(t,{tagify:this}).then((function(s){if(\"mix\"==i.mode){switch(t.key){case\"Left\":case\"ArrowLeft\":e.state.actions.ArrowLeft=!0;break;case\"Delete\":case\"Backspace\":if(e.state.editing)return;var a=document.getSelection(),o=\"Delete\"==t.key&&a.anchorOffset==(a.anchorNode.length||0),r=a.anchorNode.previousSibling,d=1==a.anchorNode.nodeType||!a.anchorOffset&&r&&1==r.nodeType&&a.anchorNode.previousSibling;!function(t){var e=document.createElement(\"div\");t.replace(/\\&#?[0-9a-z]+;/gi,(function(t){return e.innerHTML=t,e.innerText}))}(e.DOM.input.innerHTML);var c,u,g,h=e.getTagElms(),f=1===a.anchorNode.length&&a.anchorNode.nodeValue==String.fromCharCode(8203);if(\"edit\"==i.backspace&&d)return c=1==a.anchorNode.nodeType?null:a.anchorNode.previousElementSibling,setTimeout(e.editTag.bind(e),0,c),void t.preventDefault();if(p()&&B(d,Element))return g=l(d),d.hasAttribute(\"readonly\")||d.remove(),e.DOM.input.focus(),void setTimeout((function(){y(g),e.DOM.input.click()}));if(\"BR\"==a.anchorNode.nodeName)return;if((o||d)&&1==a.anchorNode.nodeType?u=0==a.anchorOffset?o?h[0]:null:h[Math.min(h.length,a.anchorOffset)-1]:o?u=a.anchorNode.nextElementSibling:B(d,Element)&&(u=d),3==a.anchorNode.nodeType&&!a.anchorNode.nodeValue&&a.anchorNode.previousElementSibling&&t.preventDefault(),(d||o)&&!i.backspace)return void t.preventDefault();if(\"Range\"!=a.type&&!a.anchorOffset&&a.anchorNode==e.DOM.input&&\"Delete\"!=t.key)return void t.preventDefault();if(\"Range\"!=a.type&&u&&u.hasAttribute(\"readonly\"))return void y(l(u));\"Delete\"==t.key&&f&&w(a.anchorNode.nextSibling)&&e.removeTags(a.anchorNode.nextSibling)}return!0}var m=\"manual\"==i.dropdown.position;switch(t.key){case\"Backspace\":\"select\"==i.mode&&i.enforceWhitelist&&e.value.length?e.removeTags():e.state.dropdown.visible&&\"manual\"!=i.dropdown.position||\"\"!=t.target.textContent&&8203!=n.charCodeAt(0)||(!0===i.backspace?e.removeTags():\"edit\"==i.backspace&&setTimeout(e.editTag.bind(e),0));break;case\"Esc\":case\"Escape\":if(e.state.dropdown.visible)return;t.target.blur();break;case\"Down\":case\"ArrowDown\":e.state.dropdown.visible||e.dropdown.show();break;case\"ArrowRight\":var v=e.state.inputSuggestion||e.state.ddItemData;if(v&&i.autoComplete.rightKey)return void e.addTags([v],!0);break;case\"Tab\":var b=\"select\"==i.mode;if(!n||b)return!0;t.preventDefault();case\"Enter\":if(e.state.dropdown.visible&&!m)return;t.preventDefault(),setTimeout((function(){e.state.dropdown.visible&&!m||e.state.actions.selectOption||!i.addTagOn.includes(t.key.toLowerCase())||e.addTags(n,!0)}))}})).catch((function(t){return t}))}},onInput:function(t){this.postUpdate();var e=this.settings;if(\"mix\"==e.mode)return this.events.callbacks.onMixTagsInput.call(this,t);var i=this.input.normalize.call(this,void 0,{trim:!1}),n=i.length>=e.dropdown.enabled,s={value:i,inputElm:this.DOM.input},a=this.validateTag({value:i});\"select\"==e.mode&&this.toggleScopeValidation(a),s.isValid=a,this.state.inputText!=i&&(this.input.set.call(this,i,!1),-1!=i.search(e.delimiters)?this.addTags(i)&&this.input.set.call(this):e.dropdown.enabled>=0&&this.dropdown[n?\"show\":\"hide\"](i),this.trigger(\"input\",s))},onMixTagsInput:function(t){var e,i,n,s,a,o,r,l,d=this,c=this.settings,g=this.value.length,h=this.getTagElms(),f=document.createDocumentFragment(),m=window.getSelection().getRangeAt(0),v=[].map.call(h,(function(t){return w(t).value}));if(\"deleteContentBackward\"==t.inputType&&p()&&this.events.callbacks.onKeydown.call(this,{target:t.target,key:\"Backspace\"}),T(this.getTagElms()),this.value.slice().forEach((function(t){t.readonly&&!v.includes(t.value)&&f.appendChild(d.createTagElem(t))})),f.childNodes.length&&(m.insertNode(f),this.setRangeAtStartEnd(!1,f.lastChild)),h.length!=g)return this.value=[].map.call(this.getTagElms(),(function(t){return w(t)})),void this.update({withoutChangeEvent:!0});if(this.hasMaxTags())return!0;if(window.getSelection&&(o=window.getSelection()).rangeCount>0&&3==o.anchorNode.nodeType){if((m=o.getRangeAt(0).cloneRange()).collapse(!0),m.setStart(o.focusNode,0),n=(e=m.toString().slice(0,m.endOffset)).split(c.pattern).length-1,(i=e.match(c.pattern))&&(s=e.slice(e.lastIndexOf(i[i.length-1]))),s){if(this.state.actions.ArrowLeft=!1,this.state.tag={prefix:s.match(c.pattern)[0],value:s.replace(c.pattern,\"\")},this.state.tag.baseOffset=o.baseOffset-this.state.tag.value.length,l=this.state.tag.value.match(c.delimiters))return this.state.tag.value=this.state.tag.value.replace(c.delimiters,\"\"),this.state.tag.delimiters=l[0],this.addTags(this.state.tag.value,c.dropdown.clearOnSelect),void this.dropdown.hide();a=this.state.tag.value.length>=c.dropdown.enabled;try{r=(r=this.state.flaggedTags[this.state.tag.baseOffset]).prefix==this.state.tag.prefix&&r.value[0]==this.state.tag.value[0],this.state.flaggedTags[this.state.tag.baseOffset]&&!this.state.tag.value&&delete this.state.flaggedTags[this.state.tag.baseOffset]}catch(t){}(r||n<this.state.mixMode.matchedPatternCount)&&(a=!1)}else this.state.flaggedTags={};this.state.mixMode.matchedPatternCount=n}setTimeout((function(){d.update({withoutChangeEvent:!0}),d.trigger(\"input\",u({},d.state.tag,{textContent:d.DOM.input.textContent})),d.state.tag&&d.dropdown[a?\"show\":\"hide\"](d.state.tag.value)}),10)},onInputIE:function(t){var e=this;setTimeout((function(){e.events.callbacks.onInput.call(e,t)}))},observeOriginalInputValue:function(){this.DOM.originalInput.parentNode||this.destroy(),this.DOM.originalInput.value!=this.DOM.originalInput.tagifyValue&&this.loadOriginalValues()},onClickAnywhere:function(t){t.target==this.DOM.scope||this.DOM.scope.contains(t.target)||(this.toggleFocusClass(!1),this.state.hasFocus=!1,t.target.closest(\".tagify__dropdown\")&&t.target.closest(\".tagify__dropdown\").__tagify!=this&&this.dropdown.hide())},onClickScope:function(t){var e=this.settings,i=t.target.closest(\".\"+e.classNames.tag),n=t.target===this.DOM.scope,s=+new Date-this.state.hasFocus;if(n&&\"select\"!=e.mode)this.DOM.input.focus();else{if(!t.target.classList.contains(e.classNames.tagX))return i&&!this.state.editing?(this.trigger(\"click\",{tag:i,index:this.getNodeIndex(i),data:w(i),event:t}),void(1!==e.editTags&&1!==e.editTags.clicks&&\"select\"!=e.mode||this.events.callbacks.onDoubleClickScope.call(this,t))):void(t.target==this.DOM.input&&(\"mix\"==e.mode&&this.fixFirefoxLastTagNoCaret(),s>500||!e.focusable)?this.state.dropdown.visible?this.dropdown.hide():0===e.dropdown.enabled&&\"mix\"!=e.mode&&this.dropdown.show(this.value.length?\"\":void 0):\"select\"!=e.mode||0!==e.dropdown.enabled||this.state.dropdown.visible||(this.events.callbacks.onDoubleClickScope.call(this,W(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);\"function\"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),n.forEach((function(e){H(t,e,i[e])}))}return t}({},t),{target:this.getTagElms()[0]})),!e.userInput&&this.dropdown.show()));this.removeTags(t.target.parentNode)}},onPaste:function(t){var e=this;t.preventDefault();var i,n,s,a=this.settings;if(\"select\"==a.mode&&a.enforceWhitelist||!a.userInput)return!1;a.readonly||(n=t.clipboardData||window.clipboardData,s=n.getData(\"Text\"),a.hooks.beforePaste(t,{tagify:this,pastedText:s,clipboardData:n}).then((function(a){void 0===a&&(a=s),a&&(e.injectAtCaret(a,window.getSelection().getRangeAt(0)),\"mix\"==e.settings.mode?e.events.callbacks.onMixTagsInput.call(e,t):e.settings.pasteAsTags?i=e.addTags(e.state.inputText+a,!0):(e.state.inputText=a,e.dropdown.show(a))),e.trigger(\"paste\",{event:t,pastedText:s,clipboardData:n,tagsElems:i})})).catch((function(t){return t})))},onDrop:function(t){t.preventDefault()},onEditTagInput:function(t,e){var i,n=t.closest(\".\"+this.settings.classNames.tag),s=this.getNodeIndex(n),a=w(n),o=this.input.normalize.call(this,t),r=(H(i={},this.settings.tagTextProp,o),H(i,\"__tagId\",a.__tagId),i),l=this.validateTag(r);this.editTagChangeDetected(u(a,r))||!0!==t.originalIsValid||(l=!0),n.classList.toggle(this.settings.classNames.tagInvalid,!0!==l),a.__isValid=l,n.title=!0===l?a.title||a.value:l,o.length>=this.settings.dropdown.enabled&&(this.state.editing&&(this.state.editing.value=o),this.dropdown.show(o)),this.trigger(\"edit:input\",{tag:n,index:s,data:u({},this.value[s],{newValue:o}),event:e})},onEditTagPaste:function(t,e){var i=(e.clipboardData||window.clipboardData).getData(\"Text\");e.preventDefault();var n=b(i);this.setRangeAtStartEnd(!1,n)},onEditTagClick:function(t,e){this.events.callbacks.onClickScope.call(this,e)},onEditTagFocus:function(t){this.state.editing={scope:t,input:t.querySelector(\"[contenteditable]\")}},onEditTagBlur:function(t,e){var i=m.call(this,e.relatedTarget);if(\"select\"==this.settings.mode&&i&&e.relatedTarget.contains(e.target))this.dropdown.hide();else if(this.state.editing&&(this.state.hasFocus||this.toggleFocusClass(),this.DOM.scope.contains(t))){var n,s,a,o=this.settings,r=t.closest(\".\"+o.classNames.tag),l=w(r),d=this.input.normalize.call(this,t),c=(H(n={},o.tagTextProp,d),H(n,\"__tagId\",l.__tagId),n),g=l.__originalData,h=this.editTagChangeDetected(u(l,c)),p=this.validateTag(c);if(d)if(h){var f;if(s=this.hasMaxTags(),a=u({},g,(H(f={},o.tagTextProp,this.trim(d)),H(f,\"__isValid\",p),f)),o.transformTag.call(this,a,g),!0!==(p=(!s||!0===g.__isValid)&&this.validateTag(a))){if(this.trigger(\"invalid\",{data:a,tag:r,message:p}),o.editTags.keepInvalid)return;o.keepInvalidTags?a.__isValid=p:a=g}else o.keepInvalidTags&&(delete a.title,delete a[\"aria-invalid\"],delete a.class);this.onEditTagDone(r,a)}else this.onEditTagDone(r,g);else this.onEditTagDone(r)}},onEditTagkeydown:function(t,e){if(!this.state.composing)switch(this.trigger(\"edit:keydown\",{event:t}),t.key){case\"Esc\":case\"Escape\":this.state.editing=!1,!!e.__tagifyTagData.__originalData.value?e.parentNode.replaceChild(e.__tagifyTagData.__originalHTML,e):e.remove();break;case\"Enter\":case\"Tab\":t.preventDefault();setTimeout((function(){return t.target.blur()}),0)}},onDoubleClickScope:function(t){var e,i,n=t.target.closest(\".\"+this.settings.classNames.tag),s=w(n),a=this.settings;n&&!1!==s.editable&&(e=n.classList.contains(this.settings.classNames.tagEditing),i=n.hasAttribute(\"readonly\"),a.readonly||e||i||!this.settings.editTags||!a.userInput||(this.events.callbacks.onEditTagFocus.call(this,n),this.editTag(n)),this.toggleFocusClass(!0),\"select\"!=a.mode&&this.trigger(\"dblclick\",{tag:n,index:this.getNodeIndex(n),data:w(n)}))},onInputDOMChange:function(t){var e=this;t.forEach((function(t){t.addedNodes.forEach((function(t){if(\"<div><br></div>\"==t.outerHTML)t.replaceWith(document.createElement(\"br\"));else if(1==t.nodeType&&t.querySelector(e.settings.classNames.tagSelector)){var i,n=document.createTextNode(\"\");3==t.childNodes[0].nodeType&&\"BR\"!=t.previousSibling.nodeName&&(n=document.createTextNode(\"\\n\")),(i=t).replaceWith.apply(i,K([n].concat(K(K(t.childNodes).slice(0,-1))))),y(n)}else if(m.call(e,t)){var s;if(3!=(null===(s=t.previousSibling)||void 0===s?void 0:s.nodeType)||t.previousSibling.textContent||t.previousSibling.remove(),t.previousSibling&&\"BR\"==t.previousSibling.nodeName){t.previousSibling.replaceWith(\"\\n​\");for(var a=t.nextSibling,o=\"\";a;)o+=a.textContent,a=a.nextSibling;o.trim()&&y(t.previousSibling)}else t.previousSibling&&!w(t.previousSibling)||t.before(\"​\")}})),t.removedNodes.forEach((function(t){t&&\"BR\"==t.nodeName&&m.call(e,i)&&(e.removeTags(i),e.fixFirefoxLastTagNoCaret())}))}));var i=this.DOM.input.lastChild;i&&\"\"==i.nodeValue&&i.remove(),i&&\"BR\"==i.nodeName||this.DOM.input.appendChild(document.createElement(\"br\"))}}};function q(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function z(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function X(t,e){return null!=e&&\"undefined\"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function J(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);\"function\"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),n.forEach((function(e){z(t,e,i[e])}))}return t}function G(t){return function(t){if(Array.isArray(t))return q(t)}(t)||function(t){if(\"undefined\"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t[\"@@iterator\"])return Array.from(t)}(t)||function(t,e){if(!t)return;if(\"string\"==typeof t)return q(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);\"Object\"===i&&t.constructor&&(i=t.constructor.name);if(\"Map\"===i||\"Set\"===i)return Array.from(i);if(\"Arguments\"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return q(t,e)}(t)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function $(t,e){if(!t){n.warn(\"input element not found\",t);var i=new Proxy(this,{get:function(){return function(){return i}}});return i}if(t.__tagify)return n.warn(\"input element is already Tagified - Same instance is returned.\",t),t.__tagify;var s;u(this,function(t){var e=document.createTextNode(\"\"),i={};function s(t,i,n){n&&i.split(/\\s+/g).forEach((function(i){return e[t+\"EventListener\"].call(e,i,n)}))}return{removeAllCustomListeners:function(){Object.entries(i).forEach((function(t){var e=F(t,2),i=e[0];e[1].forEach((function(t){return s(\"remove\",i,t)}))})),i={}},off:function(t,e){return t&&(e?s(\"remove\",t,e):t.split(/\\s+/g).forEach((function(t){var e;null===(e=i[t])||void 0===e||e.forEach((function(e){return s(\"remove\",t,e)})),delete i[t]}))),this},on:function(t,e){return e&&\"function\"==typeof e&&(t.split(/\\s+/g).forEach((function(t){Array.isArray(i[t])?i[t].push(e):i[t]=[e]})),s(\"add\",t,e)),this},trigger:function(i,s,a){var o;if(a=a||{cloneData:!0},i)if(t.settings.isJQueryPlugin)\"remove\"==i&&(i=\"removeTag\"),jQuery(t.DOM.originalInput).triggerHandler(i,[s]);else{try{var r=\"object\"==typeof s?s:{value:s};if((r=a.cloneData?u({},r):r).tagify=this,s.event&&(r.event=this.cloneEvent(s.event)),V(s,Object))for(var l in s)V(s[l],HTMLElement)&&(r[l]=s[l]);o=new CustomEvent(i,{detail:r})}catch(t){n.warn(t)}e.dispatchEvent(o)}}}}(this)),this.isFirefox=/firefox|fxios/i.test(navigator.userAgent)&&!/seamonkey/i.test(navigator.userAgent),this.isIE=window.document.documentMode,e=e||{},this.getPersistedData=(s=e.id,function(t){var e,i=\"/\"+t;if(1==localStorage.getItem(k+s+\"/v\",1))try{e=JSON.parse(localStorage[k+s+i])}catch(t){}return e}),this.setPersistedData=function(t){return t?(localStorage.setItem(k+t+\"/v\",1),function(e,i){var n=\"/\"+i,s=JSON.stringify(e);e&&i&&(localStorage.setItem(k+t+n,s),dispatchEvent(new Event(\"storage\")))}):function(){}}(e.id),this.clearPersistedData=function(t){return function(e){var i=k+\"/\"+t+\"/\";if(e)localStorage.removeItem(i+e);else for(var n in localStorage)n.includes(i)&&localStorage.removeItem(n)}}(e.id),this.applySettings(t,e),this.state={inputText:\"\",editing:!1,composing:!1,actions:{},mixMode:{},dropdown:{},flaggedTags:{}},this.value=[],this.listeners={},this.DOM={},this.build(t),N.call(this),this.getCSSVars(),this.loadOriginalValues(),this.events.customBinding.call(this),this.events.binding.call(this),t.autofocus&&this.DOM.input.focus(),t.__tagify=this}$.prototype={_dropdown:C,placeCaretAfterNode:y,getSetTagData:w,helpers:{sameStr:s,removeCollectionProp:a,omit:o,isObject:c,parseHTML:r,escapeHTML:d,extend:u,concatWithoutDups:g,getUID:f,isNodeTag:m},customEventsList:[\"change\",\"add\",\"remove\",\"invalid\",\"input\",\"paste\",\"click\",\"keydown\",\"focus\",\"blur\",\"edit:input\",\"edit:beforeUpdate\",\"edit:updated\",\"edit:start\",\"edit:keydown\",\"dropdown:show\",\"dropdown:hide\",\"dropdown:select\",\"dropdown:updated\",\"dropdown:noMatch\",\"dropdown:scroll\"],dataProps:[\"__isValid\",\"__removed\",\"__originalData\",\"__originalHTML\",\"__tagId\"],trim:function(t){return this.settings.trim&&t&&\"string\"==typeof t?t.trim():t},parseHTML:r,templates:j,parseTemplate:function(t,e){return r((t=this.settings.templates[t]||t).apply(this,e))},set whitelist(t){var e=t&&Array.isArray(t);this.settings.whitelist=e?t:[],this.setPersistedData(e?t:[],\"whitelist\")},get whitelist(){return this.settings.whitelist},set userInput(t){this.settings.userInput=!!t,this.setContentEditable(!!t)},get userInput(){return this.settings.userInput},generateClassSelectors:function(t){var e=function(e){var i=e;Object.defineProperty(t,i+\"Selector\",{get:function(){return\".\"+this[i].split(\" \")[0]}})};for(var i in t)e(i)},applySettings:function(t,e){var i,n;O.templates=this.templates;var s=u({},O,\"mix\"==e.mode?{dropdown:{position:\"text\"}}:{}),a=this.settings=u({},s,e);if(a.disabled=t.hasAttribute(\"disabled\"),a.readonly=a.readonly||t.hasAttribute(\"readonly\"),a.placeholder=d(t.getAttribute(\"placeholder\")||a.placeholder||\"\"),a.required=t.hasAttribute(\"required\"),this.generateClassSelectors(a.classNames),void 0===a.dropdown.includeSelectedTags&&(a.dropdown.includeSelectedTags=a.duplicates),this.isIE&&(a.autoComplete=!1),[\"whitelist\",\"blacklist\"].forEach((function(e){var i=t.getAttribute(\"data-\"+e);i&&X(i=i.split(a.delimiters),Array)&&(a[e]=i)})),\"autoComplete\"in e&&!c(e.autoComplete)&&(a.autoComplete=O.autoComplete,a.autoComplete.enabled=e.autoComplete),\"mix\"==a.mode&&(a.pattern=a.pattern||/@/,a.autoComplete.rightKey=!0,a.delimiters=e.delimiters||null,a.tagTextProp&&!a.dropdown.searchKeys.includes(a.tagTextProp)&&a.dropdown.searchKeys.push(a.tagTextProp)),t.pattern)try{a.pattern=new RegExp(t.pattern)}catch(t){}if(a.delimiters){a._delimiters=a.delimiters;try{a.delimiters=new RegExp(this.settings.delimiters,\"g\")}catch(t){}}a.disabled&&(a.userInput=!1),this.TEXTS=J({},L,a.texts||{}),(\"select\"!=a.mode||(null===(i=e.dropdown)||void 0===i?void 0:i.enabled))&&a.userInput||(a.dropdown.enabled=0),a.dropdown.appendTarget=(null===(n=e.dropdown)||void 0===n?void 0:n.appendTarget)||document.body;var o=this.getPersistedData(\"whitelist\");Array.isArray(o)&&(this.whitelist=Array.isArray(a.whitelist)?g(a.whitelist,o):o)},getAttributes:function(t){var e,i=this.getCustomAttributes(t),n=\"\";for(e in i)n+=\" \"+e+(void 0!==t[e]?'=\"'.concat(i[e],'\"'):\"\");return n},getCustomAttributes:function(t){if(!c(t))return\"\";var e,i={};for(e in t)\"__\"!=e.slice(0,2)&&\"class\"!=e&&t.hasOwnProperty(e)&&void 0!==t[e]&&(i[e]=d(t[e]));return i},setStateSelection:function(){var t=window.getSelection(),e={anchorOffset:t.anchorOffset,anchorNode:t.anchorNode,range:t.getRangeAt&&t.rangeCount&&t.getRangeAt(0)};return this.state.selection=e,e},getCSSVars:function(){var t,e,i,n=getComputedStyle(this.DOM.scope,null);this.CSSVars={tagHideTransition:(t=function(t){if(!t)return{};var e=(t=t.trim().split(\" \")[0]).split(/\\d+/g).filter((function(t){return t})).pop().trim();return{value:+t.split(e).filter((function(t){return t}))[0].trim(),unit:e}}((i=\"tag-hide-transition\",n.getPropertyValue(\"--\"+i))),e=t.value,\"s\"==t.unit?1e3*e:e)}},build:function(t){var e=this.DOM,i=t.closest(\"label\");this.settings.mixMode.integrated?(e.originalInput=null,e.scope=t,e.input=t):(e.originalInput=t,e.originalInput_tabIndex=t.tabIndex,e.scope=this.parseTemplate(\"wrapper\",[t,this.settings]),e.input=e.scope.querySelector(this.settings.classNames.inputSelector),t.parentNode.insertBefore(e.scope,t),t.tabIndex=-1),i&&i.setAttribute(\"for\",\"\")},destroy:function(){this.events.unbindGlobal.call(this),this.DOM.scope.parentNode.removeChild(this.DOM.scope),this.DOM.originalInput.tabIndex=this.DOM.originalInput_tabIndex,delete this.DOM.originalInput.__tagify,this.dropdown.hide(!0),this.removeAllCustomListeners(),clearTimeout(this.dropdownHide__bindEventsTimeout),clearInterval(this.listeners.main.originalInputValueObserverInterval)},loadOriginalValues:function(t){var e,i=this.settings;if(this.state.blockChangeEvent=!0,void 0===t){var n=this.getPersistedData(\"value\");t=n&&!this.DOM.originalInput.value?n:i.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value}if(this.removeAllTags(),t)if(\"mix\"==i.mode)this.parseMixTags(t),(e=this.DOM.input.lastChild)&&\"BR\"==e.tagName||this.DOM.input.insertAdjacentHTML(\"beforeend\",\"<br>\");else{try{X(JSON.parse(t),Array)&&(t=JSON.parse(t))}catch(t){}this.addTags(t,!0).forEach((function(t){return t&&t.classList.add(i.classNames.tagNoAnimation)}))}else this.postUpdate();this.state.lastOriginalValueReported=i.mixMode.integrated?\"\":this.DOM.originalInput.value},cloneEvent:function(t){var e={};for(var i in t)\"path\"!=i&&(e[i]=t[i]);return e},loading:function(t){return this.state.isLoading=t,this.DOM.scope.classList[t?\"add\":\"remove\"](this.settings.classNames.scopeLoading),this},tagLoading:function(t,e){return t&&t.classList[e?\"add\":\"remove\"](this.settings.classNames.tagLoading),this},toggleClass:function(t,e){\"string\"==typeof t&&this.DOM.scope.classList.toggle(t,e)},toggleScopeValidation:function(t){var e=!0===t||void 0===t;!this.settings.required&&t&&t===this.TEXTS.empty&&(e=!0),this.toggleClass(this.settings.classNames.tagInvalid,!e),this.DOM.scope.title=e?\"\":t},toggleFocusClass:function(t){this.toggleClass(this.settings.classNames.focus,!!t)},setPlaceholder:function(t){var e=this;[\"data\",\"aria\"].forEach((function(i){return e.DOM.input.setAttribute(\"\".concat(i,\"-placeholder\"),t)}))},triggerChangeEvent:function(){if(!this.settings.mixMode.integrated){var t=this.DOM.originalInput,e=this.state.lastOriginalValueReported!==t.value,i=new CustomEvent(\"change\",{bubbles:!0});e&&(this.state.lastOriginalValueReported=t.value,i.simulated=!0,t._valueTracker&&t._valueTracker.setValue(Math.random()),t.dispatchEvent(i),this.trigger(\"change\",this.state.lastOriginalValueReported),t.value=this.state.lastOriginalValueReported)}},events:U,fixFirefoxLastTagNoCaret:function(){},setRangeAtStartEnd:function(t,e){if(e){t=\"number\"==typeof t?t:!!t,e=e.lastChild||e;var i=document.getSelection();if(X(i.focusNode,Element)&&!this.DOM.input.contains(i.focusNode))return!0;try{i.rangeCount>=1&&[\"Start\",\"End\"].forEach((function(n){return i.getRangeAt(0)[\"set\"+n](e,t||e.length)}))}catch(t){console.warn(t)}}},insertAfterTag:function(t,e){if(e=e||this.settings.mixMode.insertAfterTag,t&&t.parentNode&&e)return e=\"string\"==typeof e?document.createTextNode(e):e,t.parentNode.insertBefore(e,t.nextSibling),e},editTagChangeDetected:function(t){var e=t.__originalData;for(var i in e)if(!this.dataProps.includes(i)&&t[i]!=e[i])return!0;return!1},getTagTextNode:function(t){return t.querySelector(this.settings.classNames.tagTextSelector)},setTagTextNode:function(t,e){this.getTagTextNode(t).innerHTML=d(e)},editTag:function(t,e){var i=this;t=t||this.getLastTag(),e=e||{};var s=this.settings,a=this.getTagTextNode(t),o=this.getNodeIndex(t),r=w(t),l=this.events.callbacks,d=!0,c=\"select\"==s.mode;if(!c&&this.dropdown.hide(),a){if(!X(r,Object)||!(\"editable\"in r)||r.editable)return r=w(t,{__originalData:u({},r),__originalHTML:t.cloneNode(!0)}),w(r.__originalHTML,r.__originalData),a.setAttribute(\"contenteditable\",!0),t.classList.add(s.classNames.tagEditing),this.events.callbacks.onEditTagFocus.call(this,t),a.addEventListener(\"click\",l.onEditTagClick.bind(this,t)),a.addEventListener(\"blur\",l.onEditTagBlur.bind(this,this.getTagTextNode(t))),a.addEventListener(\"input\",l.onEditTagInput.bind(this,a)),a.addEventListener(\"paste\",l.onEditTagPaste.bind(this,a)),a.addEventListener(\"keydown\",(function(e){return l.onEditTagkeydown.call(i,e,t)})),a.addEventListener(\"compositionstart\",l.onCompositionStart.bind(this)),a.addEventListener(\"compositionend\",l.onCompositionEnd.bind(this)),e.skipValidation||(d=this.editTagToggleValidity(t)),a.originalIsValid=d,this.trigger(\"edit:start\",{tag:t,index:o,data:r,isValid:d}),a.focus(),!c&&this.setRangeAtStartEnd(!1,a),0===s.dropdown.enabled&&!c&&this.dropdown.show(),this.state.hasFocus=!0,this}else n.warn(\"Cannot find element in Tag template: .\",s.classNames.tagTextSelector)},editTagToggleValidity:function(t,e){var i;if(e=e||w(t))return(i=!(\"__isValid\"in e)||!0===e.__isValid)||this.removeTagsFromValue(t),this.update(),t.classList.toggle(this.settings.classNames.tagNotAllowed,!i),e.__isValid=i,e.__isValid;n.warn(\"tag has no data: \",t,e)},onEditTagDone:function(t,e){t=t||this.state.editing.scope,e=e||{};var i,n,s={tag:t,index:this.getNodeIndex(t),previousData:w(t),data:e},a=this.settings;this.trigger(\"edit:beforeUpdate\",s,{cloneData:!1}),this.state.editing=!1,delete e.__originalData,delete e.__originalHTML,t&&(void 0!==(n=e[a.tagTextProp])?null===(i=(n+=\"\").trim)||void 0===i?void 0:i.call(n):a.tagTextProp in e?void 0:e.value)?(t=this.replaceTag(t,e),this.editTagToggleValidity(t,e),a.a11y.focusableTags?t.focus():\"select\"!=a.mode&&y(t)):t&&this.removeTags(t),this.trigger(\"edit:updated\",s),this.dropdown.hide(),this.settings.keepInvalidTags&&this.reCheckInvalidTags()},replaceTag:function(t,e){e&&\"\"!==e.value&&void 0!==e.value||(e=t.__tagifyTagData),e.__isValid&&1!=e.__isValid&&u(e,this.getInvalidTagAttrs(e,e.__isValid));var i=this.createTagElem(e);return t.parentNode.replaceChild(i,t),this.updateValueByDOMTags(),i},updateValueByDOMTags:function(){var t=this;this.value.length=0;var e=this.settings.classNames,i=[e.tagNotAllowed.split(\" \")[0],e.tagHide];[].forEach.call(this.getTagElms(),(function(e){G(e.classList).some((function(t){return i.includes(t)}))||t.value.push(w(e))})),this.update()},injectAtCaret:function(t,e){var i;if(e=e||(null===(i=this.state.selection)||void 0===i?void 0:i.range),\"string\"==typeof t&&(t=document.createTextNode(t)),!e&&t)return this.appendMixTags(t),this;var n=b(t,e);return this.setRangeAtStartEnd(!1,n),this.updateValueByDOMTags(),this.update(),this},input:{set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"\",e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.settings,n=i.dropdown.closeOnSelect;this.state.inputText=t,e&&(this.DOM.input.innerHTML=d(\"\"+t),t&&this.toggleClass(i.classNames.empty,!this.DOM.input.innerHTML)),!t&&n&&this.dropdown.hide.bind(this),this.input.autocomplete.suggest.call(this),this.input.validate.call(this)},raw:function(){return this.DOM.input.textContent},validate:function(){var t=!this.state.inputText||!0===this.validateTag({value:this.state.inputText});return this.DOM.input.classList.toggle(this.settings.classNames.inputInvalid,!t),t},normalize:function(t,e){var i=t||this.DOM.input,n=[];i.childNodes.forEach((function(t){return 3==t.nodeType&&n.push(t.nodeValue)})),n=n.join(\"\\n\");try{n=n.replace(/(?:\\r\\n|\\r|\\n)/g,this.settings.delimiters.source.charAt(0))}catch(t){}return n=n.replace(/\\s/g,\" \"),(null==e?void 0:e.trim)?this.trim(n):n},autocomplete:{suggest:function(t){if(this.settings.autoComplete.enabled){\"object\"!=typeof(t=t||{value:\"\"})&&(t={value:t});var e=this.dropdown.getMappedValue(t);if(\"number\"!=typeof e){var i=this.state.inputText.toLowerCase(),n=e.substr(0,this.state.inputText.length).toLowerCase(),s=e.substring(this.state.inputText.length);e&&this.state.inputText&&n==i?(this.DOM.input.setAttribute(\"data-suggest\",s),this.state.inputSuggestion=t):(this.DOM.input.removeAttribute(\"data-suggest\"),delete this.state.inputSuggestion)}}},set:function(t){var e=this.DOM.input.getAttribute(\"data-suggest\"),i=t||(e?this.state.inputText+e:null);return!!i&&(\"mix\"==this.settings.mode?this.replaceTextWithNode(document.createTextNode(this.state.tag.prefix+i)):(this.input.set.call(this,i),this.setRangeAtStartEnd(!1,this.DOM.input)),this.input.autocomplete.suggest.call(this),this.dropdown.hide(),!0)}}},getTagIdx:function(t){return this.value.findIndex((function(e){return e.__tagId==(t||{}).__tagId}))},getNodeIndex:function(t){var e=0;if(t)for(;t=t.previousElementSibling;)e++;return e},getTagElms:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=\".\"+G(this.settings.classNames.tag.split(\" \")).concat(G(e)).join(\".\");return[].slice.call(this.DOM.scope.querySelectorAll(n))},getLastTag:function(){var t=this.settings.classNames,e=this.DOM.scope.querySelectorAll(\"\".concat(t.tagSelector,\":not(.\").concat(t.tagHide,\"):not([readonly])\"));return e[e.length-1]},isTagDuplicate:function(t,e,i){var n=0,a=!0,o=!1,r=void 0;try{for(var l,d=this.value[Symbol.iterator]();!(a=(l=d.next()).done);a=!0){var c=l.value;s(this.trim(\"\"+t),c.value,e)&&i!=c.__tagId&&n++}}catch(t){o=!0,r=t}finally{try{a||null==d.return||d.return()}finally{if(o)throw r}}return n},getTagIndexByValue:function(t){var e=this,i=[],n=this.settings.dropdown.caseSensitive;return this.getTagElms().forEach((function(a,o){a.__tagifyTagData&&s(e.trim(a.__tagifyTagData.value),t,n)&&i.push(o)})),i},getTagElmByValue:function(t){var e=this.getTagIndexByValue(t)[0];return this.getTagElms()[e]},flashTag:function(t){var e=this;t&&(t.classList.add(this.settings.classNames.tagFlash),setTimeout((function(){t.classList.remove(e.settings.classNames.tagFlash)}),100))},isTagBlacklisted:function(t){return t=this.trim(t.toLowerCase()),this.settings.blacklist.filter((function(e){return(\"\"+e).toLowerCase()==t})).length},isTagWhitelisted:function(t){return!!this.getWhitelistItem(t)},getWhitelistItem:function(t,e,i){e=e||\"value\";var n,a=this.settings;return(i=i||a.whitelist).some((function(i){var o=\"object\"==typeof i?i[e]||i.value:i;if(s(o,t,a.dropdown.caseSensitive,a.trim))return n=\"object\"==typeof i?i:{value:i},!0})),n||\"value\"!=e||\"value\"==a.tagTextProp||(n=this.getWhitelistItem(t,a.tagTextProp,i)),n},validateTag:function(t){var e=this.settings,i=\"value\"in t?\"value\":e.tagTextProp,n=this.trim(t[i]+\"\");return(t[i]+\"\").trim()?\"mix\"!=e.mode&&e.pattern&&X(e.pattern,RegExp)&&!e.pattern.test(n)?this.TEXTS.pattern:!e.duplicates&&this.isTagDuplicate(n,e.dropdown.caseSensitive,t.__tagId)?this.TEXTS.duplicate:this.isTagBlacklisted(n)||e.enforceWhitelist&&!this.isTagWhitelisted(n)?this.TEXTS.notAllowed:!e.validate||e.validate(t):this.TEXTS.empty},getInvalidTagAttrs:function(t,e){return{\"aria-invalid\":!0,class:\"\".concat(t.class||\"\",\" \").concat(this.settings.classNames.tagNotAllowed).trim(),title:e}},hasMaxTags:function(){return this.value.length>=this.settings.maxTags&&this.TEXTS.exceed},setReadonly:function(t,e){var i=this.settings;this.DOM.scope.contains(document.activeElement)&&document.activeElement.blur(),i[e||\"readonly\"]=t,this.DOM.scope[(t?\"set\":\"remove\")+\"Attribute\"](e||\"readonly\",!0),this.settings.userInput=!0,this.setContentEditable(!t)},setContentEditable:function(t){this.DOM.input.contentEditable=t,this.DOM.input.tabIndex=t?0:-1},setDisabled:function(t){this.setReadonly(t,\"disabled\")},normalizeTags:function(t){var e=this,i=this.settings,n=i.whitelist,s=i.delimiters,a=i.mode,o=i.tagTextProp,r=[],l=!!n&&X(n[0],Object),d=Array.isArray(t),g=d&&t[0].value,h=function(t){return(t+\"\").split(s).reduce((function(t,i){var n,s=e.trim(i);return s&&t.push((z(n={},o,s),z(n,\"value\",s),n)),t}),[])};if(\"number\"==typeof t&&(t=t.toString()),\"string\"==typeof t){if(!t.trim())return[];t=h(t)}else d&&(t=t.reduce((function(t,i){if(c(i)){var n=u({},i);o in n||(o=\"value\"),n[o]=e.trim(n[o]),(n[o]||0===n[o])&&t.push(n)}else if(i){var s;(s=t).push.apply(s,G(h(i)))}return t}),[]));return l&&!g&&(t.forEach((function(t){var i=r.map((function(t){return t.value})),n=e.dropdown.filterListItems.call(e,t[o],{exact:!0});e.settings.duplicates||(n=n.filter((function(t){return!i.includes(t.value)})));var s=n.length>1?e.getWhitelistItem(t[o],o,n):n[0];s&&X(s,Object)?r.push(s):\"mix\"!=a&&(null==t.value&&(t.value=t[o]),r.push(t))})),r.length&&(t=r)),t},parseMixTags:function(t){var e=this,i=this.settings,n=i.mixTagsInterpolator,s=i.duplicates,a=i.transformTag,o=i.enforceWhitelist,r=i.maxTags,l=i.tagTextProp,d=[];t=t.split(n[0]).map((function(t,i){var c,u,g,h=t.split(n[1]),p=h[0],f=d.length==r;try{if(p==+p)throw Error;u=JSON.parse(p)}catch(t){u=e.normalizeTags(p)[0]||{value:p}}if(a.call(e,u),f||!(h.length>1)||o&&!e.isTagWhitelisted(u.value)||!s&&e.isTagDuplicate(u.value)){if(t)return i?n[0]+t:t}else u[c=u[l]?l:\"value\"]=e.trim(u[c]),g=e.createTagElem(u),d.push(u),g.classList.add(e.settings.classNames.tagNoAnimation),h[0]=g.outerHTML,e.value.push(u);return h.join(\"\")})).join(\"\"),this.DOM.input.innerHTML=t,this.DOM.input.appendChild(document.createTextNode(\"\")),this.DOM.input.normalize();var c=this.getTagElms();return c.forEach((function(t,e){return w(t,d[e])})),this.update({withoutChangeEvent:!0}),T(c,this.state.hasFocus),t},replaceTextWithNode:function(t,e){if(this.state.tag||e){e=e||this.state.tag.prefix+this.state.tag.value;var i,n,s=this.state.selection||window.getSelection(),a=s.anchorNode,o=this.state.tag.delimiters?this.state.tag.delimiters.length:0;return a.splitText(s.anchorOffset-o),-1==(i=a.nodeValue.lastIndexOf(e))?!0:(n=a.splitText(i),t&&a.parentNode.replaceChild(t,n),!0)}},prepareNewTagNode:function(t,e){e=e||{};var i=this.settings,n=[],s={},a=Object.assign({},t,{value:t.value+\"\"});if(t=Object.assign({},a),i.transformTag.call(this,t),t.__isValid=this.hasMaxTags()||this.validateTag(t),!0!==t.__isValid){if(e.skipInvalid)return;if(u(s,this.getInvalidTagAttrs(t,t.__isValid),{__preInvalidData:a}),t.__isValid==this.TEXTS.duplicate&&this.flashTag(this.getTagElmByValue(t.value)),!i.createInvalidTags)return void n.push(t.value)}return\"readonly\"in t&&(t.readonly?s[\"aria-readonly\"]=!0:delete t.readonly),{tagElm:this.createTagElem(t,s),tagData:t,aggregatedInvalidInput:n}},postProcessNewTagNode:function(t,e){var i=this,n=this.settings,s=e.__isValid;s&&!0===s?this.value.push(e):(this.trigger(\"invalid\",{data:e,index:this.value.length,tag:t,message:s}),n.keepInvalidTags||setTimeout((function(){return i.removeTags(t,!0)}),1e3)),this.dropdown.position()},selectTag:function(t,e){var i=this;if(!this.settings.enforceWhitelist||this.isTagWhitelisted(e.value)){this.state.actions.selectOption&&setTimeout((function(){return i.setRangeAtStartEnd(!1,i.DOM.input)}));var n=this.getLastTag();return n?this.replaceTag(n,e):this.appendTag(t),this.value[0]=e,this.update(),this.trigger(\"add\",{tag:t,data:e}),[t]}},addEmptyTag:function(t){var e=u({value:\"\"},t||{}),i=this.createTagElem(e);w(i,e),this.appendTag(i),this.editTag(i,{skipValidation:!0}),this.toggleFocusClass(!0)},addTags:function(t,e,i){var n=this,s=[],a=this.settings,o=[],r=document.createDocumentFragment(),l=[];if(!t||0==t.length)return s;switch(t=this.normalizeTags(t),a.mode){case\"mix\":return this.addMixTags(t);case\"select\":e=!1,this.removeAllTags()}return this.DOM.input.removeAttribute(\"style\"),t.forEach((function(t){var e=n.prepareNewTagNode(t,{skipInvalid:i||a.skipInvalid});if(e){var d=e.tagElm;if(t=e.tagData,o=e.aggregatedInvalidInput,s.push(d),\"select\"==a.mode)return n.selectTag(d,t);r.appendChild(d),n.postProcessNewTagNode(d,t),l.push({tagElm:d,tagData:t})}})),this.appendTag(r),l.forEach((function(t){var e=t.tagElm,i=t.tagData;return n.trigger(\"add\",{tag:e,index:n.getTagIdx(i),data:i})})),this.update(),t.length&&e&&(this.input.set.call(this,a.createInvalidTags?\"\":o.join(a._delimiters)),this.setRangeAtStartEnd(!1,this.DOM.input)),this.dropdown.refilter(),s},addMixTags:function(t){var e=this;if((t=this.normalizeTags(t))[0].prefix||this.state.tag)return this.prefixedTextToTag(t[0]);var i=document.createDocumentFragment();return t.forEach((function(t){var n=e.prepareNewTagNode(t);i.appendChild(n.tagElm),e.insertAfterTag(n.tagElm),e.postProcessNewTagNode(n.tagElm,n.tagData)})),this.appendMixTags(i),i.children},appendMixTags:function(t){var e=!!this.state.selection;e?this.injectAtCaret(t):(this.DOM.input.focus(),(e=this.setStateSelection()).range.setStart(this.DOM.input,e.range.endOffset),e.range.setEnd(this.DOM.input,e.range.endOffset),this.DOM.input.appendChild(t),this.updateValueByDOMTags(),this.update())},prefixedTextToTag:function(t){var e,i,n,s=this,a=this.settings,o=null===(e=this.state.tag)||void 0===e?void 0:e.delimiters;if(t.prefix=t.prefix||this.state.tag?this.state.tag.prefix:(a.pattern.source||a.pattern)[0],n=this.prepareNewTagNode(t),i=n.tagElm,this.replaceTextWithNode(i)||this.DOM.input.appendChild(i),setTimeout((function(){return i.classList.add(s.settings.classNames.tagNoAnimation)}),300),this.update(),!o){var r=this.insertAfterTag(i)||i;setTimeout(y,0,r)}return this.state.tag=null,this.postProcessNewTagNode(i,n.tagData),i},appendTag:function(t){var e=this.DOM,i=e.input;e.scope.insertBefore(t,i)},createTagElem:function(t,e){t.__tagId=f();var i,n=u({},t,J({value:d(t.value+\"\")},e));return function(t){for(var e,i=document.createNodeIterator(t,NodeFilter.SHOW_TEXT,null,!1);e=i.nextNode();)e.textContent.trim()||e.parentNode.removeChild(e)}(i=this.parseTemplate(\"tag\",[n,this])),w(i,t),i},reCheckInvalidTags:function(){var t=this,e=this.settings;this.getTagElms(e.classNames.tagNotAllowed).forEach((function(i,n){var s=w(i),a=t.hasMaxTags(),o=t.validateTag(s),r=!0===o&&!a;if(\"select\"==e.mode&&t.toggleScopeValidation(o),r)return s=s.__preInvalidData?s.__preInvalidData:{value:s.value},t.replaceTag(i,s);i.title=a||o}))},removeTags:function(t,e,i){var n,s=this,a=this.settings;if(t=t&&X(t,HTMLElement)?[t]:X(t,Array)?t:t?[t]:[this.getLastTag()].filter((function(t){return t})),n=t.reduce((function(t,e){e&&\"string\"==typeof e&&(e=s.getTagElmByValue(e));var i=w(e);return e&&i&&!i.readonly&&t.push({node:e,idx:s.getTagIdx(i),data:w(e,{__removed:!0})}),t}),[]),i=\"number\"==typeof i?i:this.CSSVars.tagHideTransition,\"select\"==a.mode&&(i=0,this.input.set.call(this)),1==n.length&&\"select\"!=a.mode&&n[0].node.classList.contains(a.classNames.tagNotAllowed)&&(e=!0),n.length)return a.hooks.beforeRemoveTag(n,{tagify:this}).then((function(){var t=function(t){t.node.parentNode&&(t.node.parentNode.removeChild(t.node),e?a.keepInvalidTags&&this.trigger(\"remove\",{tag:t.node,index:t.idx}):(this.trigger(\"remove\",{tag:t.node,index:t.idx,data:t.data}),this.dropdown.refilter(),this.dropdown.position(),this.DOM.input.normalize(),a.keepInvalidTags&&this.reCheckInvalidTags()))};i&&i>10&&1==n.length?function(e){e.node.style.width=parseFloat(window.getComputedStyle(e.node).width)+\"px\",document.body.clientTop,e.node.classList.add(a.classNames.tagHide),setTimeout(t.bind(this),i,e)}.call(s,n[0]):n.forEach(t.bind(s)),e||(s.removeTagsFromValue(n.map((function(t){return t.node}))),s.update(),\"select\"==a.mode&&a.userInput&&s.setContentEditable(!0))})).catch((function(t){}))},removeTagsFromDOM:function(){this.getTagElms().forEach((function(t){return t.remove()}))},removeTagsFromValue:function(t){var e=this;(t=Array.isArray(t)?t:[t]).forEach((function(t){var i=w(t),n=e.getTagIdx(i);n>-1&&e.value.splice(n,1)}))},removeAllTags:function(t){var e=this;t=t||{},this.value=[],\"mix\"==this.settings.mode?this.DOM.input.innerHTML=\"\":this.removeTagsFromDOM(),this.dropdown.refilter(),this.dropdown.position(),this.state.dropdown.visible&&setTimeout((function(){e.DOM.input.focus()})),\"select\"==this.settings.mode&&(this.input.set.call(this),this.settings.userInput&&this.setContentEditable(!0)),this.update(t)},postUpdate:function(){this.state.blockChangeEvent=!1;var t,e,i=this.settings,n=i.classNames,s=\"mix\"==i.mode?i.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value.trim():this.value.length+this.input.raw.call(this).length;(this.toggleClass(n.hasMaxTags,this.value.length>=i.maxTags),this.toggleClass(n.hasNoTags,!this.value.length),this.toggleClass(n.empty,!s),\"select\"==i.mode)&&this.toggleScopeValidation(null===(e=this.value)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.__isValid)},setOriginalInputValue:function(t){var e=this.DOM.originalInput;this.settings.mixMode.integrated||(e.value=t,e.tagifyValue=e.value,this.setPersistedData(t,\"value\"))},update:function(t){clearTimeout(this.debouncedUpdateTimeout),this.debouncedUpdateTimeout=setTimeout(function(){var e=this.getInputValue();this.setOriginalInputValue(e),this.settings.onChangeAfterBlur&&(t||{}).withoutChangeEvent||this.state.blockChangeEvent||this.triggerChangeEvent();this.postUpdate()}.bind(this),100),this.events.bindOriginaInputListener.call(this,100)},getInputValue:function(){var t=this.getCleanValue();return\"mix\"==this.settings.mode?this.getMixedTagsAsString(t):t.length?this.settings.originalInputValueFormat?this.settings.originalInputValueFormat(t):JSON.stringify(t):\"\"},getCleanValue:function(t){return a(t||this.value,this.dataProps)},getMixedTagsAsString:function(){var t=\"\",e=this,i=this.settings,n=i.originalInputValueFormat||JSON.stringify,s=i.mixTagsInterpolator;return function i(a){a.childNodes.forEach((function(a){if(1==a.nodeType){var r=w(a);if(\"BR\"==a.tagName&&(t+=\"\\r\\n\"),r&&m.call(e,a)){if(r.__removed)return;t+=s[0]+n(o(r,e.dataProps))+s[1]}else a.getAttribute(\"style\")||[\"B\",\"I\",\"U\"].includes(a.tagName)?t+=a.textContent:\"DIV\"!=a.tagName&&\"P\"!=a.tagName||(t+=\"\\r\\n\",i(a))}else t+=a.textContent}))}(this.DOM.input),t}},$.prototype.removeTag=$.prototype.removeTags;export{$ as default};\n//# sourceMappingURL=tagify.esm.js.map\r\n","import { MODULE, TEMPLATE } from \"../core/constants.mjs\";\nimport { Logger } from \"../core/utils.mjs\";\nimport DragSort from \"@yaireo/dragsort\";\nimport Tagify from \"@yaireo/tagify\";\n\nconst { ApplicationV2, HandlebarsApplicationMixin } = foundry.applications.api;\n\n/**\n * Tagify-based application\n */\nexport class TagifyApp extends HandlebarsApplicationMixin(ApplicationV2) {\n  constructor(data) {\n    super(data);\n    this.tagify = null;\n    this.dragSort = null;\n    this.content = data.content;\n    this.submit = data.submit;\n    this.categoryId = null;\n    this.subcategoryId = null;\n    this.options.window.title = data.title;\n  }\n\n  /* -------------------------------------------- */\n\n  static DEFAULT_OPTIONS = {\n    actions: {\n      resetActions: TagifyApp.resetActions,\n      unselectAllTags: TagifyApp.unselectAllTags\n    },\n    classes: [`${MODULE.ID}-app`, \"tah-dialog\", \"sheet\"],\n    id: \"token-action-hud-dialog\",\n    form: {\n      closeOnSubmit: true,\n      handler: TagifyApp.submit\n    },\n    position: {\n      width: 600,\n      height: 680\n    },\n    tag: \"form\",\n    window: {\n      minimizable: true,\n      resizable: true\n    }\n  };\n\n  /* -------------------------------------------- */\n\n  async _prepareContext() {\n    return this.content;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Show dialog\n   * @public\n   * @param {string} dialogType      The dialog type\n   * @param {string} nestId          The nest id\n   * @param {object} tags            The available and selected tags\n   * @param {object} dialogData      The dialog data\n   * @param {function*} dialogSubmit The dialog submit function\n   */\n  static open(dialogType, nestId, tags, dialogData, dialogSubmit) {\n    this.nestId = nestId;\n    TagifyApp.#prepareHook(tags);\n\n    const data = {\n      title: dialogData.title,\n      content: dialogData.content,\n      submit: dialogSubmit\n    };\n\n    let dialog;\n    switch (dialogType) {\n      case \"hud\":\n        dialog = new TagifyAppHud(data);\n        break;\n      case \"topLevelGroup\":\n        dialog = new TagifyAppGroup(data);\n        break;\n      case \"group\":\n        dialog = new TagifyAppSubgroup(data);\n        break;\n    }\n\n    dialog.render(true);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Prepare dialog hook\n   * @private\n   * @param {object} tags The tags\n   */\n  static #prepareHook(tags) {\n    Hooks.once(\"renderTagifyApp\", (app, html, options) => {\n      const tagInput = html.querySelector('input[class=\"tah-dialog-tagify\"]');\n\n      if (tagInput) {\n        const options = {\n          delimiters: \";\",\n          maxTags: \"Infinity\",\n          dropdown: {\n            position: \"manual\",\n            maxItems: Infinity, // <- maximum allowed rendered suggestions\n            classname: \"tah-dialog-tags-dropdown\", // <- custom classname for this dropdown, so it could be targeted\n            enabled: 0 // <- show suggestions on focus\n          },\n          templates: {\n            dropdownItemNoMatch() {\n              return \"<div class='empty'>Nothing Found</div>\";\n            }\n          }\n        };\n\n        if (tags.available) options.whitelist = tags.available;\n\n        TagifyApp.tagify = new Tagify(tagInput, options);\n\n        if (tags.selected) TagifyApp.tagify.addTags(tags.selected);\n\n        TagifyApp.dragSort = new DragSort(TagifyApp.tagify.DOM.scope, {\n          selector: `.${TagifyApp.tagify.settings.classNames.tag}`,\n          callbacks: { dragEnd: onDragEnd }\n        });\n\n        /**\n         * On drag end\n         */\n        function onDragEnd() {\n          TagifyApp.tagify.updateValueByDOMTags();\n        }\n\n        const tagifyInput = html.querySelector(\".tagify__input\");\n        if (tagifyInput) {\n          tagifyInput.addEventListener(\"keydown\", event => {\n            if (event.key === \"Enter\") {\n              event.preventDefault();\n              TagifyApp.tagify.addTags(TagifyApp.tagify.state.inputText, !0);\n            }\n          });\n        }\n\n        if (app.constructor.name === \"TagifyAppHud\") return;\n\n        TagifyApp.tagify.dropdown.show();\n        const dropdownLabelElement = document.createElement(\"div\");\n        dropdownLabelElement.classList.add(\"tah-dialog-label\");\n        dropdownLabelElement.innerHTML = game.i18n.localize(\"tokenActionHud.form.hud.availableItems\");\n        TagifyApp.tagify.DOM.scope.parentNode.appendChild(dropdownLabelElement);\n        TagifyApp.tagify.DOM.scope.parentNode.appendChild(TagifyApp.tagify.DOM.dropdown);\n      }\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * When the 'Reset Actions within Groups' button is clicked, reset the actor's HUD data.\n   * Only used in the HUD dialog.\n   * @private\n   */\n  static async resetActions() {\n    await foundry.applications.api.DialogV2.confirm({\n      window: {\n        title: game.i18n.localize(\"tokenActionHud.dialog.resetActions.title\")\n      },\n      content: `<p>${game.i18n.localize(\"tokenActionHud.dialog.resetActions.content\")}</p>`,\n      modal: true,\n      yes: {\n        label: game.i18n.localize(\"tokenActionHud.dialog.button.yes\"),\n        callback: async () => {\n          await game.tokenActionHud.resetActorData();\n          Logger.info(\"Actions reset\", true);\n        }\n      },\n      no: {\n        label: game.i18n.localize(\"tokenActionHud.dialog.button.no\")\n      }\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * When the 'Unselect All' button is clicked, unselect all tags\n   */\n  static unselectAllTags() {\n    TagifyApp.tagify.removeAllTags();\n  }\n\n  /* -------------------------------------------- */\n\n  /** @override */\n  _onKeyDown(event) {\n    // Close dialog\n    if (event.key === \"Escape\" && !event.target.className.includes(\"tagify\")) {\n      event.preventDefault();\n      event.stopPropagation();\n      return this.close();\n    }\n\n    // Confirm default choice\n    if (\n      event.key === \"Enter\"\n            && this.data.default\n            && !event.target.className.includes(\"tagify\")\n    ) {\n      event.preventDefault();\n      event.stopPropagation();\n      const defaultChoice = this.data.buttons[this.data.default];\n      return this.submit(defaultChoice);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle form submission\n   * @param {object} event    The event\n   * @param {object} form     The form\n   * @param {object} formData The form data\n   */\n  static async submit(event, form, formData) {\n    const selection = TagifyApp.tagify.value.map(c => {\n      c.id = c.id ?? c.value.slugify({ replacement: \"-\", strict: true });\n      return {\n        id: c.id,\n        listName: c.value,\n        name: c.name ?? c.value,\n        type: c.type\n      };\n    });\n    await this.submit(selection, formData.object);\n  }\n}\n\n/* -------------------------------------------- */\n\nexport class TagifyAppHud extends TagifyApp {\n  static PARTS = {\n    form: {\n      template: TEMPLATE.tagifyAppHud\n    }\n  };\n}\n\n/* -------------------------------------------- */\n\nexport class TagifyAppGroup extends TagifyApp {\n  static PARTS = {\n    form: {\n      template: TEMPLATE.tagifyAppGroup\n    }\n  };\n}\n\n/* -------------------------------------------- */\n\nexport class TagifyAppSubgroup extends TagifyApp {\n  static PARTS = {\n    form: {\n      template: TEMPLATE.tagifyAppSubgroup\n    }\n  };\n}\n","import { TagifyApp } from \"./tagify-app.mjs\";\nimport { Utils } from \"../core/utils.mjs\";\n\n/**\n * Generates data for the Tagify application.\n */\nexport class TagifyAppHelper {\n  /**\n   * Show the HUD dialog\n   * @public\n   * @param {class} groupHandler The GroupHandler instance\n   */\n  static async openEditHudApp(groupHandler) {\n    // Set available and selected tags\n    const tags = {};\n    tags.available = [];\n    tags.selected = await groupHandler.getSelectedGroupsAsTags();\n    const grid = await Utils.getSetting(\"grid\");\n\n    // Set dialog data\n    const dialogData = {\n      title: game.i18n.localize(\"tokenActionHud.form.hud.hudTitle\"),\n      content: {\n        topLabel: game.i18n.localize(\"tokenActionHud.form.hud.hudDetail\"),\n        placeholder: game.i18n.localize(\"tokenActionHud.form.hud.tagPlaceholder\"),\n        settings: { grid }\n      }\n    };\n\n    // Set function on submit\n    const dialogSubmit = async (choices, formData) => {\n      const grid = formData?.grid;\n      await groupHandler.updateGroups(choices, { level: 0 });\n      await groupHandler.saveGroups({ saveActor: true, saveUser: true });\n      await Utils.setSetting(\"grid\", grid);\n      Hooks.callAll(\"forceUpdateTokenActionHud\");\n    };\n\n    // Show dialog\n    TagifyApp.open(\"hud\", null, tags, dialogData, dialogSubmit);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Show group dialog\n   * @public\n   * @param {class} groupHandler The GroupHandler instance\n   * @param {object} groupData   The group data\n   */\n  static async openEditGroupApp(groupHandler, groupData) {\n    const { nestId, name, level } = groupData;\n\n    // Set available and selected tags\n    const tags = {};\n\n    // Get available subcategories\n    tags.available = await groupHandler.getAvailableGroupAsTags({ nestId, level });\n\n    // Get selected subcategories\n    tags.selected = await groupHandler.getSelectedGroupsAsTags({ nestId, level });\n\n    // Set dialog data\n    const dialogData = {\n      title: `${game.i18n.localize(\"tokenActionHud.form.hud.groupTitle\")}: ${name}`,\n      content: {\n        topLabel: game.i18n.localize(\"tokenActionHud.form.hud.groupDetail\"),\n        placeholder: game.i18n.localize(\"tokenActionHud.form.hud.tagPlaceholder\"),\n        settings: await groupHandler.getGroupSettings(groupData)\n      }\n    };\n\n    // Set function on submit\n    const dialogSubmit = async (choices, formData) => {\n      choices = choices.map(choice => {\n        choice.id =\n                choice.id\n                ?? choice.name.slugify({\n                  replacement: \"-\",\n                  strict: true\n                });\n        choice.type = choice.type ?? \"custom\";\n        return {\n          id: choice.id,\n          listName: choice.listName,\n          name: choice.name,\n          type: choice.type\n        };\n      });\n\n      const characterCount = formData?.characterCount;\n      const customWidth = formData?.customWidth;\n      const grid = formData?.grid;\n      const image = formData?.image;\n      const showTitle = formData?.showTitle;\n      const sort = formData?.sort;\n      groupData.settings = { characterCount, customWidth, grid, image, showTitle, sort };\n\n      // Save selected subcategories to user action list\n      await groupHandler.updateGroups(choices, groupData);\n      await groupHandler.saveGroups({ saveActor: true, saveUser: true });\n      Hooks.callAll(\"forceUpdateTokenActionHud\");\n    };\n\n    TagifyApp.open(\n      \"topLevelGroup\",\n      nestId,\n      tags,\n      dialogData,\n      dialogSubmit\n    );\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Show action dialog\n   * @public\n   * @param {class} groupHandler  The GroupHandler instance\n   * @param {class} actionHandler The ActionHandler instance\n   * @param {object} groupData    The group data\n   */\n  static async openEditSubgroupApp(groupHandler, actionHandler, groupData) {\n    const { nestId, name, level } = groupData;\n\n    // Set available and selected tags\n    const tags = {};\n\n    // Get available groups and actions\n    const availableActions = await actionHandler.getAvailableActionsAsTags(groupData);\n    const availableGroups = await groupHandler.getAvailableGroupAsTags({ nestId, level });\n    tags.available = [...availableActions, ...availableGroups];\n\n    // Get selected actions and subcategories\n    const selectedActions = await actionHandler.getSelectedActionsAsTags(groupData);\n    const selectedGroups = await groupHandler.getSelectedGroupsAsTags({ nestId, level });\n    tags.selected = [...selectedActions, ...selectedGroups];\n\n    // Set dialog data\n    const dialogData = {\n      title: `${game.i18n.localize(\"tokenActionHud.form.hud.groupTitle\")}: ${name} `,\n      content: {\n        topLabel: game.i18n.localize(\"tokenActionHud.form.hud.groupDetail\"),\n        placeholder: game.i18n.localize(\"tokenActionHud.form.hud.tagPlaceholder\"),\n        settings: await groupHandler.getGroupSettings(groupData)\n      }\n    };\n\n    // Set function on submit\n    const dialogSubmit = async (choices, formData) => {\n      const selectedGroups = [];\n      const selectedActions = [];\n      for (const choice of choices) {\n        if (choice.type === \"action\") {\n          selectedActions.push(choice);\n        } else {\n          selectedGroups.push(choice);\n        }\n      }\n\n      // Get advanced category options\n      const characterCount = formData?.characterCount;\n      const collapse = formData?.collapse;\n      const customWidth = formData?.customWidth;\n      const grid = formData?.grid;\n      const image = formData?.image;\n      const showTitle = formData?.showTitle;\n      const sort = formData?.sort;\n      const style = formData?._style;\n      groupData.settings = { characterCount, collapse, customWidth, grid, image, showTitle, sort, style };\n\n      // Save subcategories to user action list\n      await groupHandler.updateGroups(selectedGroups, groupData);\n      await actionHandler.updateActions(selectedActions, groupData);\n      await groupHandler.saveGroups({ saveActor: true, saveUser: true });\n\n      Hooks.callAll(\"forceUpdateTokenActionHud\");\n    };\n\n    TagifyApp.open(\n      \"group\",\n      nestId,\n      tags,\n      dialogData,\n      dialogSubmit\n    );\n  }\n}\n","import { Utils } from \"../core/utils.mjs\";\n\nexport class GroupResizer {\n  constructor(tokenActionHud, hudManager) {\n    this.tokenActionHud = tokenActionHud;\n    this.hudManager = hudManager;\n    this.groupHandler = hudManager.groupHandler;\n    this.minCols = 3;\n    this.isCustomWidth = false;\n    this.settings = null;\n    this.spacing = 10;\n  }\n\n  /**\n   * Resize the groups element\n   * @param {object} groupElement The group element\n   */\n  async resizeGroup(groupElement) {\n    if (!groupElement) return;\n\n    this.#setVariables(groupElement);\n\n    if (!this.subgroupsElement) return;\n\n    if (!this.tokenActionHud.isDocked) {\n      await this.#setWidth();\n    }\n\n    await this.#setHeight();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set variables\n   * @private\n   * @param {object} groupElement The group element\n   */\n  async #setVariables(groupElement) {\n    this.#resetVariables();\n\n    this.groupElement = groupElement;\n\n    // Get groups element\n    await this.#setSubgroupsElement();\n    if (!this.subgroupsElement) return;\n\n    // Reset groups elements\n    this.#resetGroupsElements();\n\n    // Get groups\n    this.#setSubgroupElementArr();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset variables\n   * @private\n   */\n  #resetVariables() {\n    this.actionsElements = null;\n    this.availableHeight = null;\n    this.availableWidth = null;\n    this.gridWidth = null;\n    this.groupElement = null;\n    this.subgroupElementArr = null;\n    this.subgroupsElement = null;\n    this.subgroupsElementPadding = null;\n    this.subgroupsElementRect = null;\n    this.isCustomWidth = false;\n    this.minCols = 3;\n    this.settings = null;\n    this.spacing = 10;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset groups elements\n   */\n  #resetGroupsElements() {\n    const level1GroupElement = this.groupElement.closest('[data-part=\"group\"]');\n    const groupsElements = level1GroupElement.querySelectorAll(\".tah-subgroups\");\n    const style = { maxHeight: \"\", overflowY: \"\" };\n    this.#resetCSS(groupsElements, style);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the grid width\n   * @private\n   */\n  async #getGridWidth() {\n    // Reset action elements\n    const emptyStyle = { display: \"\", gridTemplateColumns: \"\", width: \"\" };\n    await this.#resetCSS(this.actionsElements, emptyStyle);\n\n    const actionWidths = [];\n    const actionWidthsForMedian = [];\n    for (const actionsElement of this.actionsElements) {\n      const actionElements = actionsElement.querySelectorAll(\".tah-action:not(.shrink)\");\n      for (const actionElement of actionElements) {\n        const actionRect = actionElement.getBoundingClientRect();\n        const actionWidth = Math.round(parseFloat(actionRect.width) + 1 || 0);\n        const actionButtonText = actionElement.querySelector(\".tah-action-button-text\");\n        const actionButtonTextRect = actionButtonText?.getBoundingClientRect();\n        const actionButtonTextWidth = Math.round(parseFloat(actionButtonTextRect?.width) || 0);\n        actionWidthsForMedian.push(actionWidth);\n        actionWidths.push({ actionWidth, actionButtonTextWidth });\n      }\n    }\n\n    let upperQuartileAverage = Math.ceil(Utils.getUpperQuartileAverage(actionWidthsForMedian));\n    const minActionButtonTextWidth = 30;\n\n    for (const actionWidth of actionWidths) {\n      const availableactionButtonTextWidth = upperQuartileAverage\n        - (actionWidth.actionWidth - actionWidth.actionButtonTextWidth);\n      if (availableactionButtonTextWidth < minActionButtonTextWidth) {\n        upperQuartileAverage = (upperQuartileAverage - availableactionButtonTextWidth) + minActionButtonTextWidth;\n      }\n    }\n\n    this.gridWidth = upperQuartileAverage;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Resize the actions element into the grid format\n   * @private\n   * @param {object} actionsElement   The actions element\n   * @param {number} groupCustomWidth The group custom width\n   */\n  async #resizeGrid(actionsElement, groupCustomWidth) {\n    if (!actionsElement) return;\n    const emptyStyle = { display: \"\", gridTemplateColumns: \"\", width: \"\" };\n    await this.#assignCSS(actionsElement, emptyStyle);\n\n    const actions = actionsElement.querySelectorAll(\".tah-action\");\n    const squaredCols = Math.ceil(Math.sqrt(actions.length));\n    const availableGroupWidth = groupCustomWidth ?? this.availableWidth;\n    const availableCols = Math.floor(availableGroupWidth / this.gridWidth);\n    const cols = (squaredCols > availableCols || groupCustomWidth)\n      ? availableCols\n      : (actions.length <= this.minCols) ? actions.length : squaredCols;\n    // Apply maxHeight and width styles to content\n    const style = { display: \"grid\", gridTemplateColumns: `repeat(${cols}, ${this.gridWidth}px)` };\n    await this.#assignCSS(actionsElement, style);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Resize the actions element\n   * @private\n   * @param {object} actionsElement   The actions element\n   * @param {number} groupCustomWidth The group custom width\n   */\n  async #resize(actionsElement, groupCustomWidth) {\n    if (!actionsElement) return;\n\n    let width = 500;\n\n    if (this.isCustomWidth) {\n      width = this.availableWidth;\n    } else if (groupCustomWidth) {\n      width = groupCustomWidth;\n    } else {\n      const actions = actionsElement.querySelectorAll(\".tah-action\");\n      if (!actions.length) return;\n      const sqrtActions = Math.ceil(Math.sqrt(actions.length)); // 4\n\n      // Initialize variables\n      let currentRow = 1;\n      let maxRowWidth = 0;\n      let rowWidth = 0;\n      // Iterate through action groups, calculating dimensions and counts\n      if (actions.length > 0) {\n        actions.forEach((action, index) => {\n          if ((index + 1) / sqrtActions > currentRow) {\n            rowWidth = rowWidth - 5;\n            maxRowWidth = (rowWidth > maxRowWidth) ? rowWidth : maxRowWidth;\n            rowWidth = 0;\n            currentRow++;\n          }\n          const actionRect = action.getBoundingClientRect();\n          const actionWidth = Math.ceil(parseFloat(actionRect.width) + 1 || 0);\n          rowWidth += actionWidth;\n          if (index + 1 === actions.length) {\n            rowWidth = rowWidth - 5;\n            maxRowWidth = (rowWidth > maxRowWidth) ? rowWidth : maxRowWidth;\n          }\n        });\n      }\n\n      // Add padding to maxAvgGroupWidth and maxGroupWidth\n      maxRowWidth += this.subgroupsElementPadding;\n\n      // Determine width of content\n      width = (maxRowWidth < this.availableWidth && actions.length > 3) ? maxRowWidth : this.availableWidth;\n      if (width < 200) width = 200;\n    }\n\n    const style = { maxWidth: `${width}px` };\n    await this.#assignCSS(actionsElement, style);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get available content width\n   * @private\n   * @returns {number} The available content width\n   */\n  #getAvailableWidth() {\n    const customWidth = this.settings?.customWidth;\n\n    if (customWidth) {\n      this.isCustomWidth = true;\n      return customWidth;\n    }\n\n    const windowWidth = canvas.screenDimensions[0] || window.innerWidth;\n    const contentLeft = this.subgroupsElementRect.left;\n    const uiRight = document.querySelector(\"#ui-right\");\n    const uiRightClientWidth = uiRight.clientWidth;\n    return Math.floor((\n      uiRightClientWidth > 0\n        ? windowWidth - uiRightClientWidth\n        : windowWidth\n    ) - this.spacing - contentLeft);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get subgroups element\n   * @private\n   */\n  async #setSubgroupsElement() {\n    this.subgroupsElement = this.groupElement.querySelector('[data-part=\"subgroups\"]');\n    if (!this.subgroupsElement) return;\n    this.subgroupsElementRect = this.subgroupsElement.getBoundingClientRect();\n    this.subgroupsElementComputed = getComputedStyle(this.subgroupsElement);\n    this.subgroupsElementPadding =\n      Math.ceil(parseFloat(this.subgroupsElementComputed.paddingLeft) || 0)\n      + Math.ceil(parseFloat(this.subgroupsElementComputed.paddingRight) || 0);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get subgroup elements\n   * @private\n   */\n  #setSubgroupElementArr() {\n    this.subgroupElementArr = this.groupElement.querySelectorAll('[data-part=\"subgroup\"]');\n    if (this.subgroupElementArr.length === 0) this.subgroupElementArr = [this.groupElement];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set the width\n   */\n  async #setWidth() {\n    this.actionsElements = this.groupElement.querySelectorAll('[data-part=\"actions\"]');\n\n    // Exit early if no action elements exist\n    if (this.actionsElements.length === 0) return;\n\n    // Get group settings\n    const nestId = this.groupElement.dataset.nestId;\n    this.settings = await this.groupHandler.getGroupSettings({ nestId, level: 1 });\n\n    // Get available width\n    this.availableWidth = this.#getAvailableWidth();\n\n    // Loop groups\n    let hasGrid = false;\n    for (const subgroupElement of this.subgroupElementArr) {\n      const actionsElement = subgroupElement.querySelector('[data-part=\"actions\"]');\n      if (!actionsElement) continue;\n      const nestId = subgroupElement.dataset.nestId;\n      const groupSettings = await this.groupHandler.getGroupSettings({ nestId });\n      const groupCustomWidth = groupSettings.customWidth;\n      const grid = Utils.getSetting(\"grid\") || this.settings?.grid || groupSettings?.grid || actionsElement.style.display;\n      if (grid) {\n        if (!hasGrid) {\n          await this.#getGridWidth();\n          hasGrid = true;\n        }\n        await this.#resizeGrid(actionsElement, groupCustomWidth);\n      } else {\n        await this.#resize(actionsElement, groupCustomWidth);\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set the height\n   * @private\n   */\n  async #setHeight() {\n    requestAnimationFrame(() => {\n      this.availableHeight = this.#getAvailableHeight();\n      const style = { maxHeight: `${this.availableHeight}px`, overflowY: \"auto\" };\n      Object.assign(this.subgroupsElement.style, style);\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get available height\n   * @private\n   * @returns {number} The available height\n   */\n  #getAvailableHeight() {\n    const windowHeight = canvas.screenDimensions[1] || window.innerHeight;\n    const contentBottom = this.subgroupsElementRect.bottom;\n    const contentTop = this.subgroupsElementRect.top;\n\n    if (this.tokenActionHud.isDocked) {\n      let siblingsHeight = 0;\n      let sibling = this.groupElement.nextElementSibling;\n\n      if (sibling) {\n        const siblings = [sibling];\n        while (sibling) {\n          sibling = sibling.nextElementSibling;\n          if (sibling) siblings.push(sibling);\n        }\n        for (const sibling of siblings) {\n          const siblingHeight = sibling.getBoundingClientRect().height;\n          siblingsHeight += siblingHeight ?? 0;\n        }\n      }\n\n      return Math.max(windowHeight - contentTop - siblingsHeight - this.spacing, 100);\n    } else {\n      const uiTopBottom = (this.tokenActionHud.direction === \"down\")\n        ? document.querySelector(\"#ui-bottom\")\n        : document.querySelector(\"#ui-top\");\n      const uiTopBottomOffsetHeight = uiTopBottom.offsetHeight;\n      const availableHeight = (this.tokenActionHud.direction === \"down\")\n        ? windowHeight - contentTop - uiTopBottomOffsetHeight - this.spacing\n        : contentBottom - uiTopBottomOffsetHeight - this.spacing;\n      return Math.max(availableHeight, 100);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Assign CSS\n   * @private\n   * @param {object} element The DOM element\n   * @param {object} style   The style\n   */\n  async #assignCSS(element, style) {\n    if (!element) return;\n    requestAnimationFrame(() => {\n      Object.assign(element.style, style);\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset CSS\n   * @private\n   * @param {Array} elements The DOM elements\n   * @param {object} style   The style\n   */\n  async #resetCSS(elements, style) {\n    for (const element of elements) {\n      Object.assign(element.style, style);\n    }\n  }\n}\n","import { HudManager } from \"../managers/hud-manager.mjs\";\nimport { TagifyAppHelper } from \"./tagify-app-helper.mjs\";\nimport { GroupResizer } from \"../handlers/group-resizer.mjs\";\nimport { HUD, MODULE, SETTING, TEMPLATE } from \"../core/constants.mjs\";\nimport { Logger, Timer, Utils } from \"../core/utils.mjs\";\n\nconst { ApplicationV2, HandlebarsApplicationMixin } = foundry.applications.api;\n\n/**\n * Token Action HUD application\n */\nexport class TokenActionHud extends HandlebarsApplicationMixin(ApplicationV2) {\n  constructor(systemManager, dataHandler, socket) {\n    super();\n    this.systemManager = systemManager;\n    this.dataHandler = dataHandler;\n    this.hudManager = new HudManager(this, systemManager, dataHandler, socket);\n    this.groupResizer = new GroupResizer(this, this.hudManager);\n    this.socket = socket;\n    this.openGroups = new Set();\n    this.updatePendingTimer = new Timer(10);\n    this.updateTimer = new Timer(10);\n    this.closeTimer = null;\n    this.renderTimer = null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Merge Token Action Hud's default options with ApplicationV2\n   * @override\n   */\n  static DEFAULT_OPTIONS = {\n    actions: {\n      clickGroup: {\n        buttons: [0, 2],\n        handler: TokenActionHud.clickGroup\n      },\n      clickSubgroup: {\n        buttons: [0, 2],\n        handler: TokenActionHud.clickSubgroup\n      },\n      clickAction: {\n        buttons: [0, 2],\n        handler: TokenActionHud.clickAction\n      },\n      collapseHud: TokenActionHud.collapseHud,\n      expandHud: TokenActionHud.expandHud,\n      lockHud: TokenActionHud.lockHud,\n      unlockHud: TokenActionHud.unlockHud,\n      editHud: TokenActionHud.editHud\n    },\n    background: \"none\",\n    id: \"token-action-hud-app\",\n    position: {\n      width: HUD.DEFAULT_WIDTH,\n      height: HUD.DEFAULT_HEIGHT,\n      left: HUD.DEFAULT_LEFT_POS,\n      top: HUD.DEFAULT_TOP_POS,\n      scale: HUD.DEFAULT_SCALE,\n      zIndex: HUD.DEFAULT_ZINDEX\n    },\n    window: {\n      frame: false,\n      title: \"token-action-hud\"\n    }\n  };\n\n  /* -------------------------------------------- */\n\n  /**\n   * Define template parts\n   */\n  static PARTS = {\n    form: {\n      template: TEMPLATE.hud\n    }\n  };\n\n  /* -------------------------------------------- */\n\n  /**\n   * Prepare context\n   * @override\n   */\n  async _prepareContext() {\n    const styleData = this.systemManager.styles[Utils.getSetting(\"style\")];\n    const context = {\n      hud: this.hudManager.hud,\n      id: \"token-action-hud\",\n      style: styleData.class ?? \"\",\n      scale: this.scale,\n      background: \"#00000000\",\n      collapseIcon: styleData.collapseIcon ?? \"fa-caret-left\",\n      expandIcon: styleData.expandIcon ?? \"fa-caret-right\",\n      collapsibleSubgroups: Utils.getSetting(\"collapsibleSubgroups\")\n    };\n\n    Logger.debug(\"Application context\", { context });\n    return context;\n  }\n\n  /* -------------------------------------------- */\n  /* SETTINGS                                     */\n  /* -------------------------------------------- */\n\n  /**\n   * Initialise the HUD\n   * @public\n   */\n  async init() {\n    this.#cacheSettings();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Cache settings for slightly faster retrieval\n   */\n  #cacheSettings() {\n    const settings = [\n      \"activeCssAsText\", \"allow\", \"alwaysShowHud\", \"clickOpenCategory\", \"direction\",\n      \"debug\", \"displayIcons\", \"drag\", \"enable\", \"grid\",\n      \"scale\", \"style\"\n    ];\n\n    settings.forEach(setting => {\n      this[`${setting}Setting`] = Utils.getSetting(setting);\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Update cached settings following changes\n   * @param {string} key The setting key\n   * @param {*|null} value      The setting value\n   * @public\n   */\n  async updateCachedSettings(key, value = null) {\n    if (!this.updateSettingsPending) {\n      this.updateSettingsPending = true;\n      Logger.debug(\"Updating settings...\");\n    }\n\n    if (!SETTING[key]) return;\n\n    const { classes, variable } = SETTING[key];\n    if (variable) {\n      if (classes.includes(\"TokenActionHud\")) this[variable] = value;\n    }\n\n    switch (key) {\n      case \"customLayout\":\n      case \"userCustomLayout\":\n        this.hudManager.layoutHandler.customLayout = null;\n        break;\n      case \"rollHandler\":\n        this.hudManager.rollHandler = this.systemManager.getRollHandlerCore(this.hudManager.actionHandler);\n        break;\n      case \"style\":\n        this.setPosition();\n    }\n  }\n\n  /* -------------------------------------------- */\n  /* RENDER                                       */\n  /* -------------------------------------------- */\n\n  /**\n   * On render\n   * @param {options} context The context\n   * @param {options} options The options\n   */\n  _onRender(context, options) {\n    super._onRender(context, options);\n    this.element.classList.remove(\"tah-closed\");\n    clearTimeout(this.closeTimer);\n    clearTimeout(this.renderTimer);\n    this.#cacheElements();\n    this.#setInitialHudState();\n    this.#addHoverEvents(this.elements);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Cache HUD elements\n   */\n  #cacheElements() {\n    this.elements = {\n      characterName: this.element.querySelector(\"[data-part=\\\"characterName\\\"]\"),\n      actionArr: this.element.querySelectorAll(\"[data-part=\\\"action\\\"]\"),\n      buttons: this.element.querySelector(\"[data-part=\\\"buttons\\\"]\"),\n      tabSubgroupArr: this.element.querySelectorAll(\"[data-group-type=\\\"tab\\\"]\"),\n      groups: this.element.querySelector(\"[data-part=\\\"groups\\\"]\"),\n      editHudButton: this.element.querySelector(\"[data-part=\\\"editHudButton\\\"]\"),\n      listSubgroupsArr: this.element.querySelectorAll(\"[data-part=\\\"listSubgroups\\\"]\"),\n      subgroupsContainerArr: this.element.querySelectorAll(\"[data-part=\\\"subgroupsContainer\\\"]\"),\n      subgroupArr: this.element.querySelectorAll(\"[data-part=\\\"subgroup\\\"]\"),\n      listSubgroupTitleArr: this.element.querySelectorAll(\"[data-part=\\\"listSubgroupTitle\\\"]\"),\n      groupButtonArr: this.element.querySelectorAll(\"[data-part=\\\"groupButton\\\"]\"),\n      collapseExpandContainer: this.element.querySelector(\"[data-part=\\\"collapseExpandContainer\\\"]\"),\n      collapseHudButton: this.element.querySelector(\"[data-part=\\\"collapseHudButton\\\"]\"),\n      expandHudButton: this.element.querySelector(\"[data-part=\\\"expandHudButton\\\"]\"),\n      unlockButton: this.element.querySelector(\"[data-part=\\\"unlockHudButton\\\"]\"),\n      lockButton: this.element.querySelector(\"[data-part=\\\"lockHudButton\\\"]\")\n    };\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set the initial state of the HUD (collapsed or expanded, locked or unlocked)\n   * @private\n   */\n  #setInitialHudState() {\n    if (this.isCollapsed) { TokenActionHud.collapseHud.call(this); }\n\n    if (Utils.getSetting(\"enableCustomization\")) {\n      if (this.isUnlocked) {\n        TokenActionHud.unlockHud.call(this);\n      } else {\n        TokenActionHud.lockHud.call(this);\n      }\n    } else {\n      this.elements.unlockButton.classList.add(\"tah-hidden\");\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add hover events\n   * @param {object} elements The elements\n   */\n  #addHoverEvents(elements) {\n    if (!Utils.getSetting(\"clickOpenCategory\")) {\n      // When a category button is hovered over...\n      elements.tabSubgroupArr.forEach(element => {\n        element.addEventListener(\"touchstart\", this.toggleGroup.bind(this), { passive: true });\n        element.addEventListener(\"pointerenter\", this.toggleGroup.bind(this));\n        element.addEventListener(\"pointerleave\", this.toggleGroup.bind(this));\n      });\n    }\n\n    // When a category button is clicked and held...\n    if (!this.isDocked) {\n      elements.groupButtonArr.forEach(element => {\n        element.addEventListener(\"mousedown\", this.#dragEvent.bind(this));\n        element.addEventListener(\"touchstart\", this.#dragEvent.bind(this), { passive: true });\n      });\n    }\n\n    // When an action is hovered...\n    elements.actionArr.forEach(element => {\n      element.addEventListener(\"pointerenter\", this.handleActionHover.bind(this));\n      element.addEventListener(\"pointerleave\", this.handleActionHover.bind(this));\n    });\n  }\n\n  /* -------------------------------------------- */\n  /* POST-RENDER                                  */\n  /* -------------------------------------------- */\n\n  /**\n   * Functions to execute after the application is rendered\n   */\n  postRender() {\n    this.rendering = false;\n    this.#applyDirection();\n    this.#reopenGroups();\n    if (!this.isCollapsed) {\n      this.renderTimer = setTimeout(() => {\n        requestAnimationFrame(() => {\n          this.element?.classList?.add(\"tah-expanded\");\n        });\n      }, 25);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Apply classes for HUD direction\n   * @private\n   */\n  #applyDirection() {\n    if (this.isDocked) return;\n\n    const { characterName, subgroupsContainerArr } = this.elements;\n\n    if (this.direction === \"up\") {\n      characterName.classList.add(\"tah-hidden\");\n\n      subgroupsContainerArr.forEach(element => {\n        element.classList.remove(\"expand-down\");\n        element.classList.add(\"expand-up\");\n      });\n    } else {\n      if (!this.isCollapsed) {\n        characterName.classList.remove(\"tah-hidden\");\n      }\n\n      subgroupsContainerArr.forEach(element => {\n        element.classList.add(\"expand-down\");\n        element.classList.remove(\"expand-up\");\n      });\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reopen groups following a re-render of the HUD\n   * @private\n   */\n  #reopenGroups() {\n    if (!this.openGroups.size) return;\n\n    this.openGroups.forEach(groupId => {\n      const group = this.element.querySelector(`#${groupId}`);\n      if (group) {\n        this.toggleGroup(null, group);\n      }\n    });\n  }\n\n  /* -------------------------------------------- */\n  /* INTERACTIVITY                                */\n  /* -------------------------------------------- */\n\n  /**\n   * When the 'Edit HUD' button is clicked, open the Edit HUD app\n   */\n  static editHud() {\n    TagifyAppHelper.openEditHudApp(this.hudManager.groupHandler);\n  }\n\n  /* -------------------------------------------- */\n  /* ENABLE/DISABLE HUD                           */\n  /* -------------------------------------------- */\n\n  /**\n   * Toggle the HUD enabled state\n   */\n  async toggleHudEnable() {\n    const binding = Utils.humanizeBinding(\"enableDisableHud\");\n    const state = (this.isEnabled) ? \"disabled\" : \"enabled\";\n    if (this.isEnabled) {\n      this.#close();\n    } else {\n      Hooks.callAll(\"forceUpdateTokenActionHud\");\n    }\n    await Utils.setSetting(\"enable\", !this.isEnabled);\n    Logger.info(game.i18n.format(`tokenActionHud.keybinding.toggleHud.${state}`, { binding }), true);\n  }\n\n  /* -------------------------------------------- */\n  /* COLLAPSE/EXPAND HUD                          */\n  /* -------------------------------------------- */\n\n  /**\n   * When the 'Collapse HUD' button is clicked, collapse the HUD\n   */\n  static collapseHud() {\n    this.toggleHudCollapse(\"collapse\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * When the 'Expand HUD' button is clicked, expand the HUD\n   */\n  static expandHud() {\n    this.toggleHudCollapse(\"expand\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Toggle the HUD between collapse and expand states\n   * @param {string} state The state (\"collapse\" or \"expand\")\n   */\n  toggleHudCollapse(state) {\n    state = state ?? ((this.isCollapsed) ? \"expand\" : \"collapse\");\n    const isCollapsing = state === \"collapse\";\n    const { characterName, collapseHudButton, expandHudButton, groups, buttons } = this.elements;\n\n    collapseHudButton.classList.toggle(\"tah-hidden\", isCollapsing);\n    expandHudButton.classList.toggle(\"tah-hidden\", !isCollapsing);\n\n    if (this.isDocked) {\n      this.element.classList.toggle(\"tah-expanded\", !isCollapsing);\n    } else {\n      if (this.direction === \"down\") { characterName.classList.toggle(\"tah-hidden\", isCollapsing); }\n      groups.classList.toggle(\"tah-hidden\", isCollapsing);\n      buttons.classList.toggle(\"tah-hidden\", isCollapsing);\n    }\n\n    this.isCollapsed = isCollapsing;\n  }\n\n  /* -------------------------------------------- */\n  /* LOCK/UNLOCK HUD                              */\n  /* -------------------------------------------- */\n\n  /**\n   * When the 'Unlock HUD' button is clicked, unlock the HUD\n   * @param {object|null} event The event\n   */\n  static async unlockHud(event = null) {\n    this.toggleHudLock(\"unlock\", event);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * When the 'Lock HUD' button is clicked, lock the HUD\n   * @param {object|null} event The event\n   */\n  static async lockHud(event = null) {\n    this.toggleHudLock(\"lock\", event);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Toggle HUD lock state\n   * @param {string} state      The state (\"lock\" or \"unlock\")\n   * @param {object|null} event The event\n   */\n  toggleHudLock(state, event = null) {\n    if (event) event.preventDefault();\n\n    const isUnlocking = state === \"unlock\";\n    const { unlockButton, lockButton, editHudButton, subgroupArr, groupButtonArr,\n      groups, listSubgroupsArr, tabSubgroupArr, listSubgroupTitleArr } = this.elements;\n\n    // Toggle button visibiltiy\n    unlockButton.classList.toggle(\"tah-hidden\", isUnlocking);\n    lockButton.classList.toggle(\"tah-hidden\", !isUnlocking);\n    editHudButton.classList.toggle(\"tah-hidden\", !isUnlocking);\n\n    // Toggle class for styling when unlocked/locked\n    groups.classList.toggle(\"tah-unlocked\", isUnlocking);\n\n    // Helper function to toggle classes\n    const toggleElements = (elements, className, toggle) => {\n      elements.forEach(element => element.classList.toggle(className, toggle));\n    };\n\n    toggleElements(groupButtonArr, \"disable-edit\", !isUnlocking);\n    toggleElements(listSubgroupTitleArr, \"disable-edit\", !isUnlocking);\n\n    if (isUnlocking) {\n      // When the HUD is unlocked, unhide elements\n      toggleElements(subgroupArr, \"tah-hidden\", !isUnlocking);\n      toggleElements(listSubgroupsArr, \"tah-hidden\", !isUnlocking);\n      toggleElements(tabSubgroupArr, \"tah-hidden\", !isUnlocking);\n      toggleElements(listSubgroupTitleArr, \"tah-hidden\", !isUnlocking);\n    } else {\n      // When the HUD is locked, hide elements that have no underlying actions\n      const hideIfEmpty = elements => {\n        elements.forEach(element => {\n          const hasActions = element.querySelectorAll(\".tah-action\").length > 0;\n          if (!hasActions) element.classList.add(\"tah-hidden\");\n        });\n      };\n\n      hideIfEmpty(tabSubgroupArr);\n      hideIfEmpty(subgroupArr);\n      hideIfEmpty(listSubgroupsArr);\n\n      listSubgroupTitleArr.forEach(element => {\n        const groupElement = element.closest(\".tah-subgroup\");\n        if (groupElement.dataset?.showTitle === \"false\") {\n          element.classList.add(\"tah-hidden\");\n        }\n      });\n    }\n\n    this.isUnlocked = isUnlocking;\n  }\n\n  /* -------------------------------------------- */\n  /* GROUP EVENTS                                 */\n  /* -------------------------------------------- */\n\n  /**\n   * When a group is clicked\n   * @param {object} event The event\n   */\n  static clickGroup(event) {\n    this.bringToFront();\n\n    // Remove focus to allow core ESC interactions\n    event.currentTarget.blur();\n\n    if (event.type === \"contextmenu\") {\n      if (this.isUnlocked) {\n        this.openEditGroupApp(event);\n      } else {\n        this.handleGroupClick(event);\n      }\n    } else if (Utils.getSetting(\"clickOpenCategory\")) {\n      this.toggleGroup(event);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * When a subgroup is clicked\n   * @param {object} event The event\n   */\n  static clickSubgroup(event) {\n    if (event.type === \"contextmenu\") {\n      if (this.isUnlocked) {\n        this.openEditGroupApp(event);\n      } else {\n        this.handleGroupClick(event);\n      }\n    } else {\n      const group = Utils.getClosestGroupElement(event);\n      if (group.dataset?.groupType === \"tab\") {\n        this.toggleGroup(event, group);\n      } else {\n        this.collapseExpandSubgroup(event);\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Toggle the visibility of the group\n   * @param {object} event The event\n   * @param {object} group The group element\n   */\n  toggleGroup(event = null, group = null) {\n    group = group || Utils.getClosestGroupElement(event);\n    const isOpen = group.classList.contains(\"hover\");\n    const shouldOpen = !isOpen;\n    if ((isOpen && event?.type === \"pointerenter\") || (!isOpen && event?.type === \"pointerleave\")) return;\n    group.classList.toggle(\"hover\", shouldOpen);\n    if (shouldOpen) {\n      this.#toggleOtherGroups(group);\n      this.groupResizer.resizeGroup(group);\n\n      this.openGroups.add(group.id);\n    } else {\n      this.openGroups.delete(group.id);\n    }\n    // Remove focus to allow core ESC interactions\n    if (event) event.currentTarget.blur();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Toggle visibility of other groups\n   * @private\n   * @param {string} groupToIgnore The group to ignore\n   */\n  #toggleOtherGroups(groupToIgnore) {\n    if (!this.openGroups.size) return;\n\n    this.openGroups.forEach(groupId => {\n      if (groupId === groupToIgnore.id) return;\n      const group = this.element.querySelector(`#${groupId}`);\n      // If group no longer exists on the HUD, delete it\n      if (!group) {\n        this.openGroups.delete(groupId);\n      }\n      const isParentToIgnore = group.querySelector(`#${groupToIgnore.id}`);\n      if (group && !isParentToIgnore) {\n        this.toggleGroup(null, group);\n      }\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Collapse/expand a subgroup\n   * @param {object} event                       The event\n   */\n  collapseExpandSubgroup(event) {\n    if (!Utils.getSetting(\"collapsibleSubgroups\")) return;\n\n    const target = event.target.closest('[data-part=\"listSubgroupTitle\"]');\n\n    const groupElement = Utils.getClosestGroupElement(event);\n    const nestId = groupElement?.dataset?.nestId;\n    const tabSubgroup = target.closest(\".tah-tab-subgroup.hover\");\n    const groupsElement = groupElement?.querySelector(\"[data-part=\\\"subgroups\\\"]\");\n    const collapseIcon = target.querySelector(\".tah-collapse-icon\");\n    const expandIcon = target.querySelector(\".tah-expand-icon\");\n    const imageElement = groupElement.querySelector(\".tah-list-image\");\n\n    const toggleGroupVisibility = () => {\n      groupsElement?.classList.toggle(\"tah-hidden\");\n      collapseIcon?.classList.toggle(\"tah-hidden\");\n      expandIcon?.classList.toggle(\"tah-hidden\");\n      imageElement?.classList.toggle(\"tah-hidden\");\n    };\n\n    const saveGroupSettings = collapse => {\n      if (Utils.getSetting(\"enableCustomization\")) {\n        this.hudManager.groupHandler.saveGroupSettings({ nestId, settings: { collapse } });\n      }\n    };\n\n    if (groupsElement?.classList.contains(\"tah-hidden\")) {\n      toggleGroupVisibility();\n      saveGroupSettings(false);\n      this.groupResizer.resizeGroup(tabSubgroup);\n    } else {\n      toggleGroupVisibility();\n      saveGroupSettings(true);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle when a group is clicked\n   * @param {object} event The event\n   */\n  handleGroupClick(event) {\n    this.hudManager.handleHudEvent(\"groupClick\", event);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Open the 'Edit Group' or 'Edit Subgroup' app\n   * @param {object} event\n   */\n  openEditGroupApp(event) {\n    const group = Utils.getClosestGroupElement(event);\n    const { nestId, level, type } = group.dataset;\n    if (!nestId) return;\n    const name = this.hudManager.groupHandler.groups[nestId].name;\n    const parsedLevel = parseInt(level, 10) || null;\n\n    if (parsedLevel === 1) {\n      TagifyAppHelper.openEditGroupApp(\n        this.hudManager.groupHandler,\n        { nestId, name, level: parsedLevel, type }\n      );\n    } else {\n      TagifyAppHelper.openEditSubgroupApp(\n        this.hudManager.groupHandler,\n        this.hudManager.actionHandler,\n        { nestId, name, level: parsedLevel, type }\n      );\n    }\n\n  }\n\n  /* -------------------------------------------- */\n  /* ACTION EVENTS                                */\n  /* -------------------------------------------- */\n\n  /**\n   * When an action is clicked\n   * @param {object} event The event\n   */\n  static clickAction(event) {\n    event.preventDefault();\n    this.hudManager.handleHudEvent(\"clickAction\", event);\n    event.currentTarget.blur();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle when an action is hovered\n   * @param {object} event The event\n   */\n  handleActionHover(event) {\n    this.hudManager.handleHudEvent(\"hoverAction\", event);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Drag event handler\n   * @private\n   * @param {object} event The event\n   */\n  #dragEvent(event) {\n    if (!this.isDraggable) return;\n\n    // Get the main element\n    const element = this.element;\n\n    const clientX = event.clientX ?? event.changedTouches[0].clientX;\n    const clientY = event.clientY ?? event.changedTouches[0].clientY;\n\n    // Initialise positions and starting positions\n    let pos1 = 0;\n    let pos2 = 0;\n    let pos3 = clientX;\n    let pos4 = clientY;\n    const originalElementTop = element.offsetTop;\n    const originalElementLeft = element.offsetLeft;\n    let newElementTop = originalElementTop;\n    let newElementLeft = originalElementLeft;\n\n    /**\n     * Mouse movement event handler\n     * @param {object} event The event\n     */\n    const mouseMoveEvent = event => {\n      const clientX = event.clientX ?? event.changedTouches[0].clientX;\n      const clientY = event.clientY ?? event.changedTouches[0].clientY;\n      pos1 = pos3 - clientX;\n      pos2 = pos4 - clientY;\n      pos3 = clientX;\n      pos4 = clientY;\n\n      // If the mouse has not moved, do not update\n      if (pos1 === pos3 && pos2 === pos4) return;\n\n      newElementTop = newElementTop - pos2;\n      newElementLeft = newElementLeft - pos1;\n\n      this.topPos = newElementTop;\n\n      // Apply styles\n      requestAnimationFrame(() => {\n        Object.assign(element.style, { left: `${newElementLeft}px`, top: `${newElementTop}px` });\n      });\n    };\n\n    /* -------------------------------------------- */\n\n    /**\n     * Mouse up event handler\n     */\n    const mouseUpEvent = () => {\n      // Remove the mouse move and touch move events\n      document.onmousemove = null;\n      element.ontouchmove = null;\n\n      // Remove the mouse up and touch end events\n      document.onmouseup = null;\n      element.ontouchend = null;\n\n      // If position has not changed, do not update\n      if (newElementTop === originalElementTop && newElementLeft === originalElementLeft) return;\n\n      this.topPos = newElementTop;\n\n      this.#applyDirection();\n\n      // Save the new position to the user's flags\n      this.hudPosition = { top: newElementTop, left: newElementLeft };\n    };\n\n    // Bind mouse move and touch move events\n    document.onmousemove = mouseMoveEvent;\n    element.ontouchmove = mouseMoveEvent;\n\n    // Bind mouse up and touch end events\n    document.onmouseup = mouseUpEvent;\n    element.ontouchend = mouseUpEvent;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set position of the HUD\n   * @public\n   */\n  setPosition() {\n    if (!this.hudManager.hud) return;\n    if (this.isDocked) {\n      this.#setDockedPosition();\n    } else {\n      this.#setUndockedPosition();\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set docked position\n   */\n  #setDockedPosition() {\n    this.element.style.top = 0;\n    this.element.style.left = 0;\n\n    const interfaceElement = document.querySelector(\"#interface\");\n    const dockPosition = this.systemManager.styles[this.styleSetting]?.dockPosition;\n\n    switch (dockPosition) {\n      case \"right\":\n        interfaceElement.appendChild(this.element);\n        break;\n      case \"center-right\":\n        const rightUiElement = interfaceElement.querySelector(\"#ui-right\");\n        interfaceElement.insertBefore(this.element, rightUiElement);\n        break;\n      case \"left\":\n        const leftUiElement = interfaceElement.querySelector(\"#ui-left\");\n        interfaceElement.insertBefore(this.element, leftUiElement);\n        break;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set undocked position\n   */\n  #setUndockedPosition() {\n    document.body.appendChild(this.element);\n    this.#setPositionFromFlag();\n    this.#applyDirection();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set the position of the HUD based on user flag\n   * @private\n   */\n  #setPositionFromFlag() {\n    if (!this.hudPosition) {\n      this.element.style.top = `${HUD.DEFAULT_TOP_POS}px`;\n      this.element.style.left = `${HUD.DEFAULT_LEFT_POS}px`;\n      return;\n    }\n\n    return new Promise(resolve => {\n      const check = () => {\n        if (this.element) {\n          this.element.style.bottom = null;\n          this.topPos = this.hudPosition.top < 5 || this.hudPosition.top > window.innerHeight + 5\n            ? HUD.DEFAULT_TOP_POS\n            : this.hudPosition.top ?? HUD.DEFAULT_TOP_POS;\n          this.leftPos = this.hudPosition.left < 5 || this.hudPosition.left > window.innerWidth + 5\n            ? HUD.DEFAULT_LEFT_POS\n            : this.hudPosition.left ?? HUD.DEFAULT_LEFT_POS;\n          this.element.style.top = `${this.topPos}px`;\n          this.element.style.left = `${this.leftPos}px`;\n          resolve();\n        } else {\n          setTimeout(check, 10);\n        }\n      };\n\n      check();\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * The direction the HUD will expand\n   * @private\n   * @returns {string} The direction\n   */\n  get direction() {\n    const direction = Utils.getSetting(\"direction\");\n    if (direction === \"up\" || (direction === \"auto\" && this.topPos > window.innerHeight / 2)) return \"up\";\n    return \"down\";\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * The HUD position\n   * @returns {object} The HUD position\n   */\n  get hudPosition() {\n    return Utils.getUserFlag(\"position\");\n  }\n\n  set hudPosition(obj) {\n    Utils.setUserFlag(\"position\", obj);\n    Logger.debug(`Position set to x: ${obj.top}px, y: ${obj.left}px`);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the HUD is enabled\n   * @returns {boolean} Whether the HUD is enabled\n   */\n  get isEnabled() {\n    return Utils.getSetting(\"enable\");\n  }\n\n  set isEnabled(bool) {\n    Utils.setSetting(\"enable\", bool);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the HUD is collapsed\n   * @returns {boolean} Whether the HUD is collapsed\n   */\n  get isCollapsed() {\n    return Utils.getUserFlag(\"isCollapsed\");\n  }\n\n  set isCollapsed(bool) {\n    Utils.setUserFlag(\"isCollapsed\", bool);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the HUD is docked\n   * @returns {boolean} Whether the HUD is docked\n   */\n  get isDocked() {\n    const style = this.systemManager.styles[this.styleSetting];\n    return style.isDocked || style.dockPosition;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the HUD is unlocked\n   * @returns {boolean} Whether the HUD is unlocked\n   */\n  get isUnlocked() {\n    return Utils.getUserFlag(\"isUnlocked\");\n  }\n\n  set isUnlocked(bool) {\n    Utils.setUserFlag(\"isUnlocked\", bool);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the HUD is draggable\n   * @returns {boolean} Whether the HUD is draggable\n   */\n  get isDraggable() {\n    const drag = Utils.getSetting(\"drag\");\n    return ((drag === \"always\") || (drag === \"whenUnlocked\" && this.isUnlocked));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * The HUD scale\n   * @private\n   * @returns {number} The scale\n   */\n  get scale() {\n    if (this.isDocked) return 1;\n    const scale = parseFloat(Utils.getSetting(\"scale\")) || 1;\n    return Math.min(Math.max(scale, 0.5), 2);\n  }\n\n  /**\n   * Reset the position of the HUD\n   * @public\n   */\n  async resetPosition() {\n    Logger.debug(\"Resetting position...\");\n    this.hudPosition = { top: HUD.DEFAULT_TOP_POS, left: HUD.DEFAULT_LEFT_POS };\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Copy user's data to others users\n   * @public\n   * @param {string} fromUserId        The user id to copy from\n   * @param {string | Array} toUserIds The user ids to copy to\n   */\n  async copy(fromUserId, toUserIds) {\n    await this.#copyUserData(fromUserId, toUserIds);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Copy user's data to others users\n   * @private\n   * @param {string} fromUserId        The user id to copy from\n   * @param {string | Array} toUserIds The user ids to copy to\n   */\n  async #copyUserData(fromUserId, toUserIds) {\n    if (!game.user.isGM) {\n      Logger.info(\"Copy failed: User is not a GM\", true);\n      return;\n    }\n    // Exit if parameters are missing\n    if (!fromUserId || !toUserIds.length) {\n      Logger.info(\"Copy failed: Parameters missing\", true);\n      return;\n    }\n\n    Logger.debug(\"Copying user data to users...\");\n\n    const fromGroup = await this.dataHandler.getDataAsGm({ type: \"user\", id: fromUserId });\n\n    if (typeof toUserIds === \"string\") {\n      await this.dataHandler.saveDataAsGm(\"user\", toUserIds, fromGroup);\n    } else if (Array.isArray(toUserIds)) {\n      for (const userId of toUserIds) {\n        await this.dataHandler.saveDataAsGm(\"user\", userId, fromGroup);\n      }\n    }\n\n    Logger.debug(\"User data copied to users\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset the HUD layout with the socket\n   */\n  static async resetLayoutWithSocket() {\n    game?.tokenActionHud?.resetLayout();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset the HUD layout\n   */\n  async resetLayout() {\n    Logger.debug(\"Resetting layout...\");\n    await this.resetUserAndActorData();\n    this.resetPosition();\n    Logger.debug(\"Layout reset\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset current actor's HUD data\n   */\n  async resetActorData() {\n    Logger.debug(\"Resetting actor data...\");\n\n    await this.dataHandler.saveDataAsGm(\"actor\", this.hudManager.actor.id, {});\n\n    Logger.debug(\"Actor data reset\");\n\n    this.hudManager.hardResetHud();\n    const trigger = { trigger: { type: \"method\", name: \"TokenActionHud#resetActorData\" } };\n    this.update(trigger);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset every actor's HUD data\n   * @public\n   */\n  async resetAllActorData() {\n    Logger.debug(\"Resetting all actor data...\");\n\n    for (const actor of game.actors) {\n      Logger.debug(`Resetting flags for actor [${actor.id}]`, { actor });\n      await this.dataHandler.saveDataAsGm(\"actor\", actor.id, {});\n    }\n\n    Logger.debug(\"All actor data reset\");\n    this.hudManager.hardResetHud();\n    const trigger = { trigger: { type: \"method\", name: \"TokenActionHud#resetAllActorData\" } };\n    this.update(trigger);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset user's HUD data\n   * @public\n   */\n  async resetUserData() {\n    Logger.debug(\"Resetting user data...\");\n    await this.dataHandler.saveDataAsGm(\"user\", game.userId, {});\n    Logger.debug(\"User data reset\");\n    this.hudManager.hardResetHud();\n    const trigger = { trigger: { type: \"method\", name: \"TokenActionHud#resetUserData\" } };\n    this.update(trigger);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset every user's HUD data\n   * @public\n   */\n  async resetAllUserData() {\n    Logger.debug(\"Resetting all user data...\");\n    for (const user of game.users) {\n      await this.dataHandler.saveDataAsGm(\"user\", user.id, {});\n    }\n    Logger.debug(\"All user data reset\");\n    this.hudManager.hardResetHud();\n    const trigger = { trigger: { type: \"method\", name: \"TokenActionHud#resetAllUserData\" } };\n    this.update(trigger);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset user and actor's HUD data\n   */\n  async resetUserAndActorData() {\n    Logger.debug(\"Resetting user data...\");\n    await this.dataHandler.saveDataAsGm(\"user\", game.userId, {});\n    Logger.debug(\"User data reset\");\n\n    Logger.debug(\"Resetting actor data...\");\n    await this.dataHandler.saveDataAsGm(\"actor\", this.hudManager.actor.id, {});\n    Logger.debug(\"Actor data reset\");\n\n    this.hudManager.hardResetHud();\n    const trigger = { trigger: { type: \"method\", name: \"TokenActionHud#resetUserAndActorData\" } };\n    this.update(trigger);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Update the HUD\n   * @public\n   * @param {object} trigger The trigger for the update\n   */\n  async update(trigger = null) {\n    // Stops settings updates from triggering the HUD update multiple times\n    // Instead an update is triggered when settings are updated and the settings config window is closed\n    if (trigger?.name === \"closeSettingsConfig\") {\n      if (!this.updateSettingsPending) return;\n      this.updateSettingsPending = false;\n      Logger.debug(\"Settings updated\");\n    }\n\n    await this.#handleUpdate();\n    await this.#performUpdate(trigger);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handles HUD updates to avoid overlapping updates\n   */\n  async #handleUpdate() {\n    // Start a timer and reset it each time an update call is received before the timer has elapsed\n    if (this.isUpdatePending) this.updatePendingTimer.abort();\n\n    this.isUpdatePending = true;\n    await this.updatePendingTimer.start();\n    this.isUpdatePending = false;\n\n    // Wait for the current update to complete before progressing a pending update\n    // Stop waiting if the current update takes longer than 5 seconds\n    const waitForUpdateCompletion = async () => {\n      const maxWaitTime = 5000;\n      const interval = 10;\n      const iterations = maxWaitTime / interval;\n\n      let i = 0;\n      while (i < iterations && this.isUpdating) {\n        await this.updateTimer.start();\n        i++;\n      }\n\n      return !this.isUpdating;\n    };\n\n    if (this.isUpdating) {\n      const hasCompleted = await waitForUpdateCompletion();\n      if (!hasCompleted) {\n        Logger.debug(\"Update took too long. Aborting...\");\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Perform the HUD update following handling\n   * @param {object} trigger The trigger for the update\n   */\n  async #performUpdate(trigger) {\n    this.isUpdating = true;\n    Logger.debug(\"Updating HUD...\", trigger);\n\n    // Await does have an effect\n    const initialised = await this.hudManager.init(trigger);\n    if (!initialised) {\n      this.#abortUpdate();\n      return;\n    }\n\n    this.rendering = true;\n    this.render({ force: true, position: {} });\n\n    if (!ui.windows[this.appId]) {\n      ui.windows[this.appId] = this;\n    }\n\n    this.isUpdating = false;\n\n    Hooks.callAll(\"tokenActionHudCoreHudUpdated\", MODULE);\n    Logger.debug(\"HUD updated\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Abort the HUD update with a debug message\n   * @private\n   */\n  #abortUpdate() {\n    this.#close();\n    Logger.debug(\"HUD update aborted as no character(s) found or HUD is disabled\");\n    this.isUpdating = false;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Close the HUD\n   * @public\n   */\n  closeHud() {\n    this.#close();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Close the HUD\n   * @private\n   */\n  #close() {\n    requestAnimationFrame(() => {\n      this.element?.classList?.remove(\"tah-expanded\");\n      this.element?.classList?.add(\"tah-closed\");\n    });\n\n    this.openGroups = new Set();\n    this.closeTimer = setTimeout(() => {\n      this.close({ animate: false });\n    }, 500);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the token change is valid for a HUD update\n   * @public\n   * @param {object} token The token\n   * @param {object} data  The data\n   * @returns {boolean}    Whether the token change is valid for a HUD update\n   */\n  isValidTokenChange(token, data = null) {\n    if (data.flags) return false;\n    return this.#isRelevantToken(token) || (Utils.getSetting(\"alwaysShowHud\") && token.actorId === game.user.character?.id);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the token is controlled or on the canvas\n   * @private\n   * @param {object} token The token\n   * @returns {boolean} Whether the token is controlled or on the canvas\n   */\n  #isRelevantToken(token) {\n    const controlledTokens = Utils.getControlledTokens();\n    return (\n      controlledTokens?.some(controlledToken => controlledToken.id === token.id)\n        || (!controlledTokens?.length\n          && canvas?.tokens?.placeables?.some(token => token.id === this.hudManager.token?.id))\n    );\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the given actor is the selected actor\n   * @param {object} actor The actor\n   * @returns {boolean}    Whether the given actor is the selected actor\n   */\n  isControlledActor(actor) {\n    return actor?.id === this.hudManager.actor?.id;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the actor or item update is valid for a HUD update\n   * @param {object} actor The actor\n   * @param {object} data  The data\n   * @returns {boolean}    Whether the actor or item update is valid for a HUD update\n   */\n  isValidActorOrItemUpdate(actor, data) {\n    if (!actor) {\n      Logger.debug(\"No actor; updating HUD\", { data });\n      return true;\n    }\n\n    if (this.isControlledActor(actor)) {\n      Logger.debug(\"Same actor; updating HUD\", { actor, data });\n      return true;\n    } else {\n      Logger.debug(\"Different actor; skipping HUD update\", { actor, data });\n      return false;\n    }\n  }\n}\n","import { MODULE } from \"./constants.mjs\";\nimport { DataHandler } from \"../handlers/data-handler.mjs\";\nimport { TokenActionHud } from \"../applications/token-action-hud.mjs\";\n\nlet socket;\n\n/**\n * Register socket with socketlib module\n */\nexport function registerSocket() {\n  socket = socketlib.registerModule(MODULE.ID);\n  socket.register(\"getFilePaths\", DataHandler.getFilePathsWithSocket);\n  socket.register(\"getData\", DataHandler.getDataWithSocket);\n  socket.register(\"saveData\", DataHandler.saveDataWithSocket);\n  socket.register(\"reset\", TokenActionHud.resetLayoutWithSocket);\n}\n\n/**\n * Whether the socketlib module is active\n * @returns {boolean} Whether the socketlib module is active\n */\nexport function isSocketlibActive() {\n  if (game.modules.get(\"socketlib\")?.active) return true;\n\n  Logger.error(\"This module requires the 'socketlib' module to be installed and enabled.\", true);\n  return false;\n}\n\n\n/**\n * Get the socket\n * @returns {object} The socket\n */\nexport function getSocket() {\n  return socket;\n}\n","import { GROUP_TYPE } from \"../../core/constants.mjs\";\nimport { Utils } from \"../../core/utils.mjs\";\n\n/**\n * Handler for building the HUD's generic actions.\n */\nexport class GenericActionHandler {\n  constructor(actionHandler) {\n    this.actionHandler = actionHandler;\n    this.actor = actionHandler.actor;\n    this.token = actionHandler.token;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build generic actions\n   * @public\n   */\n  buildActions() {\n    this.#buildUtilities();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build utilities\n   * @private\n   */\n  #buildUtilities() {\n    if (this.actor) {\n      this.#buildSingleTokenUtilities();\n    } else {\n      this.#buildMultipleTokenUtilities();\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build utilities for a single token\n   * @private\n   */\n  #buildSingleTokenUtilities() {\n    if (!this.token) return;\n    const actionsData = [];\n\n    // Build Toggle Combat action\n    const toggleCombatId = \"toggleCombat\";\n    const toggleCombatName = this.token?.inCombat\n      ? game.i18n.localize(\"tokenActionHud.removeFromCombat\")\n      : game.i18n.localize(\"tokenActionHud.addToCombat\");\n    const toggleCombatAction = {\n      id: toggleCombatId,\n      name: toggleCombatName,\n      onClick: async () => {\n        const token = Utils.getFirstControlledToken();\n        token.document.toggleCombatant();\n\n      }\n    };\n    actionsData.push(toggleCombatAction);\n\n    // Build Toggle Visibility action\n    if (game.user.isGM) {\n      const toggleVisibilityId = \"toggleVisibility\";\n      const toggleVisibilityName = this.token?.document?.hidden\n        ? game.i18n.localize(\"tokenActionHud.makeVisible\")\n        : game.i18n.localize(\"tokenActionHud.makeInvisible\");\n      const toggleVisibilityAction = {\n        id: toggleVisibilityId,\n        name: toggleVisibilityName,\n        onClick: async () => {\n          const token = Utils.getFirstControlledToken();\n          const isHidden = token.document.hidden;\n          await token.document.update({ hidden: !isHidden });\n        }\n      };\n      actionsData.push(toggleVisibilityAction);\n    }\n\n    const groupData = { id: \"token\", type: GROUP_TYPE.SYSTEM };\n\n    // Add actions to HUD\n    this.actionHandler.addActions(actionsData, groupData);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build utilities for multiple tokens\n   * @private\n   */\n  #buildMultipleTokenUtilities() {\n    const tokens = Utils.getControlledTokens();\n    const actionsData = [];\n\n    // Toggle Combat\n    const toggleCombatId = \"toggleCombat\";\n    const toggleCombatName = tokens.every(token => token.inCombat)\n      ? game.i18n.localize(\"tokenActionHud.removeFromCombat\")\n      : game.i18n.localize(\"tokenActionHud.addToCombat\");\n    const toggleCombatAction = {\n      id: toggleCombatId,\n      name: toggleCombatName,\n      onClick: async () => {\n        const controlledTokens = Utils.getControlledTokens();\n        for (const token of controlledTokens) {\n          await token.document.toggleCombatant();\n        }\n      }\n    };\n    actionsData.push(toggleCombatAction);\n\n    // Toggle Visibility\n    if (game.user.isGM) {\n      const toggleVisibilityId = \"toggleVisibility\";\n      const toggleVisibilityname = tokens.every(token => token.document?.hidden)\n        ? game.i18n.localize(\"tokenActionHud.makeVisible\")\n        : game.i18n.localize(\"tokenActionHud.makeInvisible\");\n      const toggleVisibilityAction = {\n        id: toggleVisibilityId,\n        name: toggleVisibilityname,\n        onClick: async () => {\n          const controlledTokens = Utils.getControlledTokens();\n          for (const token of controlledTokens) {\n            const isHidden = token.document.hidden;\n            await token.document.update({ hidden: !isHidden });\n          }\n        }\n      };\n      actionsData.push(toggleVisibilityAction);\n    }\n\n    const groupData = { id: \"token\", type: GROUP_TYPE.SYSTEM };\n\n    // Add actions to HUD\n    this.actionHandler.addActions(actionsData, groupData);\n  }\n}\n","import { ACTION_TYPE, COMPENDIUM_PACK_TYPES } from \"../../core/constants.mjs\";\nimport { Utils } from \"../../core/utils.mjs\";\n\n/**\n * Handler for building the HUD's compendium actions.\n */\nexport class CompendiumActionHandler {\n  actionHandler;\n\n  compendiumActions;\n\n  packIds;\n\n  constructor(actionHandler) {\n    this.actionHandler = actionHandler;\n    this.compendiumActions = new Map();\n    this.packIds = [];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build compendium actions\n   */\n  async buildActions() {\n    if (this.compendiumActions.size === 0) {\n      this.packIds = game.packs\n        .filter(\n          pack =>\n            COMPENDIUM_PACK_TYPES.includes(pack.documentName)\n              && (foundry.utils.isNewerVersion(game.version, \"10\") ? pack.visible : !pack.private || game.user.isGM)\n        )\n        .map(pack => pack.metadata.id);\n\n      if (this.packIds.length === 0) return;\n\n      await Promise.all(this.packIds.map(packId => this.#setActions(packId)));\n    }\n\n    for (const pack of this.compendiumActions.values()) {\n      this.actionHandler.addActions(pack.actionsData, pack.groupData);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set compendium actions into the compendiumActions map\n   * @param {string} packId The pack id\n   */\n  async #setActions(packId) {\n    const pack = game.packs.get(packId);\n    const entries = pack ? pack.index.size > 0 ? pack.index : await pack.getIndex() : null;\n    if (!entries) return;\n    const actionType = this.#getCompendiumActionType(pack?.documentName);\n    if (!actionType) return;\n    const actionsData = entries.map(entry => ({\n      id: entry._id,\n      name: entry.name,\n      listName: `${game.i18n.localize(ACTION_TYPE[actionType])}: ${entry.name}`,\n      img: Utils.getImage(entry),\n      function: this.#getOnClick(actionType, pack, entry._id)\n    }));\n    const groupData = { id: this.#getGroupId(packId), type: \"core\" };\n    this.compendiumActions.set(packId, { actionsData, groupData });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get compendium action type based on document name\n   * @param {string} documentName The pack document name\n   * @returns {string}            The compendium action type\n   */\n  #getCompendiumActionType(documentName) {\n    switch (documentName) {\n      case \"Macro\":\n        return \"compendiumMacro\";\n      default:\n        return \"compendiumEntry\";\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get on click function\n   * @param {string} actionType The action type\n   * @param {object} pack       The compendium pack\n   * @param {string} documentId The document ID\n   * @returns {Function}        The function\n   */\n  #getOnClick(actionType, pack, documentId) {\n    switch (actionType) {\n      case \"compendiumMacro\":\n        return this.#getOnClickFunction(pack, documentId);\n      default:\n        return this.#getOnClickEntry(pack, documentId);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get on click function for compendium journal entry\n   * @param {object} pack       The pack\n   * @param {string} documentId The document ID\n   * @returns {Function}        The function\n   */\n  #getOnClickEntry(pack, documentId) {\n    return async () => {\n      const journalEntry = await pack.getDocument(documentId);\n      journalEntry.sheet.render(true); };\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get on click function for compendium macro\n   * @param {object} pack       The pack\n   * @param {string} documentId The document ID\n   * @returns {Function}        The function\n   */\n  #getOnClickFunction(pack, documentId) {\n    return async () => {\n      await pack.getDocument(documentId).then(macro => macro.execute());\n    };\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the group ID from the pack ID\n   * @param {string} packId The pack id\n   * @returns {string}      The group id\n   */\n  #getGroupId(packId) {\n    return packId.replace(\".\", \"-\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the compendium is linked\n   * @public\n   * @param {string} packId The pack id\n   * @returns {boolean}     Whether the compendium is linked\n   */\n  isLinkedCompendium(packId) {\n    return (this.packIds.length)\n      ? this.packIds?.includes(packId)\n      : false;\n  }\n}\n","import { ACTION_TYPE } from \"../../core/constants.mjs\";\nimport { Utils } from \"../../core/utils.mjs\";\n\n/**\n * Handler for building the HUD's macro actions.\n */\nexport class MacroActionHandler {\n  constructor(actionHandler) {\n    this.actionHandler = actionHandler;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build macro actions\n   * @override\n   */\n  async buildActions() {\n    if (!this.macroActions) {\n      this.macroActions = {\n        actionsData: await this.#getActions(),\n        groupData: { id: \"macros\", type: \"core\" }\n      };\n    }\n\n    this.actionHandler.addActions(this.macroActions.actionsData, this.macroActions.groupData);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get actions\n   * @private\n   * @returns {object} The actions\n   */\n  async #getActions() {\n    const actionType = \"macro\";\n    const macros = game.macros.filter(macro => this.#hasPermission(macro));\n\n    return macros.map(macro => {\n      return {\n        id: macro.id,\n        name: macro.name,\n        listName: this.#getListName(actionType, macro.name),\n        img: Utils.getImage(macro),\n        onClick: () => {\n          game.macros.get(macro.id).execute();\n        }\n      };\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Check if the user has permission for the macro\n   * @private\n   * @param {object} macro The macro\n   * @returns {boolean}    Whether the user has permission\n   */\n  #hasPermission(macro) {\n    const { ownership } = macro;\n    return ownership[game.userId] ? ownership[game.userId] > 0 : ownership.default > 0;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get list name\n   * @param {string} actionType The action type\n   * @param {string} name       The action name\n   * @returns {string}          The list name\n   */\n  #getListName(actionType, name) {\n    const actionTypeName = `${game.i18n.localize(ACTION_TYPE[actionType])}: ` ?? \"\";\n    return `${actionTypeName}${name}`;\n  }\n}\n","import { DELIMITER } from \"../../core/constants.mjs\";\nimport { GenericActionHandler } from \"./generic-action-handler.mjs\";\nimport { CompendiumActionHandler } from \"./compendium-action-handler.mjs\";\nimport { MacroActionHandler } from \"./macro-action-handler.mjs\";\nimport { getTooltip } from \"../tooltip-handler.mjs\";\nimport { Logger, Utils } from \"../../core/utils.mjs\";\n\n/**\n * Handler for the HUD actions.\n */\nexport class ActionHandler {\n  constructor() {\n    this.hudManager = {};\n    this.groupHandler = {};\n    this.genericActionHandler = new GenericActionHandler(this);\n    this.compendiumActionHandler = new CompendiumActionHandler(this);\n    this.macroActionHandler = new MacroActionHandler(this);\n    this.actions = [];\n    this.availableActions = new Map();\n    this.delimiter = DELIMITER;\n    this.actionHandlerExtenders = [];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Soft reset variables\n   */\n  softReset() {\n    this.genericActionHandler = new GenericActionHandler(this);\n    this.actions = [];\n    this.availableActions = new Map();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Prepare actions\n   * @param {object} groups The HUD groups\n   */\n  prepareActions(groups) {\n    for (const group of Object.values(groups)) {\n      if (group.actions?.length) {\n        this.actions.push(...group.actions);\n        for (const action of group.actions) {\n          action.selected = false;\n        }\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build actions\n   */\n  async buildActionsCore() {\n    await Promise.all([\n      this.#buildSystemActionsCore(),\n      this.#buildGenericActionsCore(),\n      this.#buildCompendiumActionsCore(),\n      this.#buildMacroActionsCore()\n    ]);\n    await this.#buildExtendedActionsCore();\n    this.#updateNonPresetActions();\n    this.#setCharacterLimit();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build system-specific actions\n   * @private\n   */\n  async #buildSystemActionsCore() {\n    Logger.debug(\"Building system actions...\", { actor: this.actor, token: this.token });\n    const groupIds = this.groupHandler.getGroupIds();\n    await this.buildSystemActions(groupIds);\n    Logger.debug(\"System actions built\", { hud: this.hud, actor: this.actor, token: this.token });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Placeholder function for the system module\n   * @override\n   * @param {Array} groupIds The group IDs\n   */\n  async buildSystemActions(groupIds) {}\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build compendium-specific actions\n   * @private\n   */\n  async #buildCompendiumActionsCore() {\n    Logger.debug(\"Building compendium actions...\");\n    await this.compendiumActionHandler.buildActions();\n    Logger.debug(\"Compendium actions built\", { hud: this.hud });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build generic actions\n   * @private\n   */\n  #buildGenericActionsCore() {\n    Logger.debug(\"Building generic actions...\", { actor: this.actor, token: this.token });\n    this.genericActionHandler.buildActions();\n    Logger.debug(\"Generic actions built\", { hud: this.hud, actor: this.actor, token: this.token });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build macro-specific actions\n   * @private\n   */\n  async #buildMacroActionsCore() {\n    Logger.debug(\"Building macro actions...\");\n    await this.macroActionHandler.buildActions();\n    Logger.debug(\"Macro actions built\", { hud: this.hud });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build extended actions\n   * @private\n   */\n  async #buildExtendedActionsCore() {\n    await Promise.all(this.actionHandlerExtenders.map(\n      async extender => await extender.extendActionHandler()\n    ));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Update non-preset actions\n   * @private\n   */\n  #updateNonPresetActions() {\n    const nonPresetActions = this.actions.filter(action => !action?.isPreset);\n\n    for (const nonPresetAction of nonPresetActions) {\n      const availableAction = this.availableActions.get(nonPresetAction.id);\n\n      if (availableAction) {\n        const systemSelected = availableAction.systemSelected ?? nonPresetAction.systemSelected;\n        const userSelected = nonPresetAction.userSelected ?? availableAction.userSelected;\n        Object.assign(nonPresetAction, this.#createAction({ ...availableAction, systemSelected, userSelected }));\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set character limit for action names based on the 'Character per Word' setting\n   * @private\n   */\n  #setCharacterLimit() {\n    const groups = this.groupHandler.getGroups({ level: 1 });\n\n    for (const group of groups) {\n      const groupCharacterCount = group?.settings?.characterCount;\n\n      const subgroups = this.groupHandler.getGroups({ nestId: group.nestId });\n\n      for (const subgroup of subgroups) {\n        const actions = subgroup.actions;\n        if (!actions?.length) continue;\n\n        const subgroupCharacterCount = subgroup?.settings?.characterCount;\n        const characterCount = (subgroupCharacterCount >= 0)\n          ? groupCharacterCount\n          : subgroupCharacterCount;\n\n        // Exit if character limit is not defined\n        if ((!characterCount && characterCount !== 0) || characterCount < 0) continue;\n\n        for (const action of actions) {\n          if (action.name.length <= characterCount) continue;\n          if (characterCount === 0) {\n            action.name = \"\";\n            continue;\n          }\n          // Set each word to the character limit\n          action.name = action.name\n            .split(\" \")\n            .map(word => word.slice(0, characterCount))\n            .join(\" \");\n        }\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get actions by ID\n   * @public\n   * @param {object} actionData The action data\n   * @returns {Array}           The actions\n   */\n  getActions(actionData) {\n    return this.actions.filter(action => action.id === actionData.id);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Create action\n   * @private\n   * @param {object} actionData The action data\n   * @returns {object}          The action\n   */\n  #createAction(actionData) {\n    const fullName = actionData.fullName ?? actionData.name;\n    const tooltip = getTooltip(actionData.tooltip, fullName);\n\n    const infoProps = info => {\n      if (!info) return {};\n      return {\n        ...(info.class && { class: info.class }),\n        ...(info.icon && { icon: info.icon }),\n        ...(info.text && { text: info.text }),\n        ...(info.title && { title: info.title })\n      };\n    };\n\n    return {\n      id: actionData.id,\n      name: actionData.name,\n      fullName,\n      listName: actionData.listName || actionData.name,\n      ...(actionData.onClick && { onClick: actionData.onClick }),\n      ...(actionData.onHover && { onClick: actionData.onHover }),\n      ...(actionData.encodedValue && { encodedValue: actionData.encodedValue }),\n      ...(actionData.cssClass && { cssClass: actionData.cssClass }),\n      icons: actionData.icons || {},\n      ...(actionData.icon1 && { icon1: actionData.icon1 }),\n      ...(actionData.icon2 && { icon2: actionData.icon2 }),\n      ...(actionData.icon3 && { icon3: actionData.icon3 }),\n      ...(actionData.img && { img: actionData.img }),\n      info1: infoProps(actionData.info1),\n      info2: infoProps(actionData.info2),\n      info3: infoProps(actionData.info3),\n      system: actionData.system || {},\n      isAction: true,\n      ...(actionData.isItem && { isItem: actionData.isItem }),\n      ...(actionData.isPreset && { isPreset: actionData.isPreset }),\n      userSelected: actionData.userSelected ?? true,\n      systemSelected: actionData.systemSelected ?? true,\n      selected: actionData.systemSelected\n        ? actionData.userSelected ?? actionData.systemSelected ?? true\n        : false,\n      tooltip,\n      ...(actionData.useRawHtmlName && { useRawHtmlName: actionData.useRawHtmlName })\n    };\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add actions to the HUD\n   * @public\n   * @param {object} actionsData The actions data\n   * @param {object} groupData   The group data\n   */\n  addActions(actionsData, groupData) {\n    if (!actionsData.length) return;\n\n    // Create actions\n    const actions = new Map(actionsData.map(actionData => [actionData.id, this.#createAction(actionData)]));\n    this.#addToAvailableActions(actions);\n\n    if (!groupData?.id) return;\n\n    if (!groupData?.type) { groupData.type = \"system\"; }\n\n    const groups = this.groupHandler.getGroups(groupData);\n\n    if (!groups) return;\n\n    for (const group of groups) {\n      // Get existing actions\n      const existingActions = new Map(group.actions.map(action => [action.id, action]));\n\n      const reorderedActions = [];\n\n      // Loop the previously saved actions in the group\n      existingActions.forEach((existingAction, existingActionId) => {\n        const action = actions.get(existingActionId);\n        if (action) {\n          const systemSelected = action.systemSelected ?? existingAction.systemSelected;\n          const userSelected = existingAction.userSelected ?? action.userSelected;\n          const selected = (!systemSelected)\n            ? false\n            : userSelected ?? systemSelected ?? true;\n          Object.assign(existingAction, { ...action, isPreset: true, selected, systemSelected, userSelected });\n        } else if (!existingAction.selected && existingAction.isPreset) {\n          const systemSelected = false;\n          Object.assign(existingAction, this.#createAction({ ...existingAction, systemSelected }));\n        }\n      });\n\n      // Loop the generated actions and add any not previously saved\n      actions.forEach((action, actionId) => {\n        const existingAction = existingActions.get(actionId);\n        if (!existingAction) reorderedActions.push(this.#createAction({ ...action, isPreset: true }));\n      });\n\n      // Sort actions alphabetically\n      if (\n        groupData?.settings?.sort\n        || (typeof groupData?.settings?.sort === \"undefined\" && Utils.getSetting(\"sortActions\"))\n      ) {\n        reorderedActions.sort((a, b) => a.name.localeCompare(b.name));\n      }\n\n      // Add actions to group\n      group.actions.push(...reorderedActions);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Update actions\n   * @public\n   * @param {Array} actionsData The actions data\n   * @param {object} groupData  The group data\n   */\n  updateActions(actionsData, groupData) {\n    const group = this.groupHandler.getGroup(groupData);\n    const actions = group.actions;\n\n    const reorderedActions = [];\n\n    // Set 'selected' to true for selected actions\n    // Reorder actions based on order in dialog\n    for (const actionData of actionsData) {\n      if (actionData.id.includes(\"itemMacro\")) continue;\n      const existingAction = group.actions.find(action => action.id === actionData.id);\n      if (existingAction) {\n        const actionClone = { ...existingAction, userSelected: true };\n        reorderedActions.push(actionClone);\n      } else {\n        const availableAction = this.availableActions.get(actionData.id);\n        if (availableAction) {\n          const actionClone = { ...availableAction, userSelected: true };\n          reorderedActions.push(actionClone);\n        }\n      }\n    }\n    // Set 'selected' to false for unselected actions\n    for (const action of actions) {\n      if (!action.id || action?.id.includes(\"itemMacro\")) continue;\n\n      const actionData = actionsData.find(actionData => actionData.id === action.id);\n      if (!actionData && action.isPreset) {\n        const actionClone = { ...action, userSelected: false };\n        reorderedActions.push(actionClone);\n      }\n    }\n\n    // Sort actions alphabetically\n    if (groupData?.settings?.sort\n      || (typeof groupData?.settings?.sort === \"undefined\" && Utils.getSetting(\"sortActions\"))) {\n      reorderedActions.sort((a, b) => a.name.localeCompare(b.name));\n    }\n\n    // Replace group actions\n    group.actions = reorderedActions;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add to available actions\n   * @private\n   * @param {Array} actions The actions\n   */\n  #addToAvailableActions(actions) {\n    actions.forEach((action, actionId) => {\n      if (!this.availableActions.has(actionId)) this.availableActions.set(actionId, action);\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get available actions as Tagify entries\n   * @public\n   * @returns {Array} The available actions as Tagify entries\n   */\n  getAvailableActionsAsTags() {\n    return [...this.availableActions.values()]\n      .map(action => this.#toTagify(action))\n      .sort((a, b) => a.value.localeCompare(b.value));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get selected actions as Tagify entries\n   * @public\n   * @param {object} groupData The group data\n   * @returns {Array}          The selected actions as Tagify entries\n   */\n  getSelectedActionsAsTags(groupData) {\n    const group = this.groupHandler.getGroup(groupData);\n    if (!group) return [];\n    return group.actions\n      .filter(action => action.selected === true)\n      .map(action => this.#toTagify(action));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add action handler extender\n   * @public\n   * @param {object} actionHandlerExtender The action handler extender\n   */\n  addActionHandlerExtender(actionHandlerExtender) {\n    Logger.debug(\"Adding action handler extender...\", { actionHandlerExtender });\n    actionHandlerExtender.hudManager = this.hudManager;\n    actionHandlerExtender.groupHandler = this.groupHandler;\n    actionHandlerExtender.actionHandler = this;\n    this.actionHandlerExtenders.push(actionHandlerExtender);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Convert an action into a Tagify entry\n   * @private\n   * @param {object} actionData The action data\n   * @returns {object}          The Tagify entry\n   */\n  #toTagify(actionData) {\n    const { id, name, listName } = actionData;\n    return { id, name, type: \"action\", value: listName ?? name };\n  }\n\n  /* -------------------------------------------- */\n  /* Shortcuts to the HudManager properties       */\n  /* -------------------------------------------- */\n\n  /**\n   * Get character name\n   * @returns {string} The character name\n   */\n  get characterName() {\n    return this.hudManager?.characterName;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get actor\n   * @returns {object} The actor\n   */\n  get actor() {\n    return this.hudManager?.actor;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set actor\n   */\n  set actor(actor) {\n    this.hudManager.actor = actor;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get actors\n   * @returns {Array} The actors\n   */\n  get actors() {\n    return this.hudManager?.actors;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set actors\n   * @param {Array} actors The actors\n   */\n  set actors(actors) {\n    this.hudManager.actors = actors;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get token\n   * @returns {object} The token\n   */\n  get token() {\n    return this.hudManager?.token;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set token\n   */\n  set token(token) {\n    this.hudManager.token = token;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get tokens\n   * @returns {Array} The tokens\n   */\n  get tokens() {\n    return this.hudManager?.tokens;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set tokens\n   * @param {Array} tokens The tokens\n   */\n  set tokens(tokens) {\n    this.hudManager.tokens = tokens;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the right mouse button was clicked\n   * @returns {boolean} Whether the right mouse button was clicked\n   */\n  get isRightClick() {\n    return this.hudManager?.isRightClick;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the ALT key was pressed\n   * @returns {boolean} Whether the ALT key was pressed\n   */\n  get isAlt() {\n    return this.hudManager?.isAlt;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the CTRL key was pressed\n   * @returns {boolean} Whether the CTRL key was pressed\n   */\n  get isCtrl() {\n    return this.hudManager?.isCtrl;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the SHIFT key was pressed\n   * @returns {boolean} Whether the SHIFT key was pressed\n   */\n  get isShift() {\n    return this.hudManager?.isShift;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the element was hovered\n   * @returns {boolean} Whether the element was hovered\n   */\n  get isHover() {\n    return this.hudManager?.isHover;\n  }\n}\n","import { ActionHandler } from \"./action-handler.mjs\";\n\n/**\n * An extension of the base ActionHandler which extends the HUD via core or system modules.\n */\nexport class ActionHandlerExtender extends ActionHandler {\n  constructor() {\n    super();\n  }\n\n  /**\n   * Extend action handler\n   * @override\n   */\n  extendActionHandler() {}\n}\n","import { DELIMITER } from \"../../core/constants.mjs\";\nimport { Logger, Utils } from \"../../core/utils.mjs\";\n\n/**\n * Resolves core actions triggered from the HUD\n */\nexport class RollHandler {\n  constructor() {\n    this.hudManager = null;\n    this.delimiter = DELIMITER;\n    this.preRollHandlers = [];\n    this.rollHandlerExtenders = [];\n  }\n\n  /**\n   * Throw error\n   * @public\n   * @param {*} err The error\n   */\n  throwInvalidValueErr(err) {\n    throw new Error(\n      `Error handling button click: ${err}`\n    );\n  }\n\n  /**\n   * Add roll handler extender\n   * @public\n   * @param {object} rollHandlerExtender The RollHandlerExtender instance\n   */\n  addRollHandlerExtender(rollHandlerExtender) {\n    Logger.debug(\"Adding roll handler extender...\", { rollHandlerExtender });\n    this.rollHandlerExtenders.push(rollHandlerExtender);\n  }\n\n  /**\n   * Handle action events\n   * @public\n   * @param {object} event The event\n   * @param {object} action The action\n   * @param {class} actionHandler The ActionHandler instance\n   */\n  async handleActionClickCore(event, action, actionHandler) {\n    try {\n      Logger.debug(\"Handling action click event\", { event });\n\n      // Update variables with current action context\n      this.action = action;\n\n      // If the action has an onClick function, call it and trigger a HUD update\n      if (typeof action?.onClick === \"function\") {\n        action.onClick();\n        Hooks.callAll(\"forceUpdateTokenActionHud\");\n        return;\n      }\n\n      // Get the value of the associated button\n      const buttonValue = this.#getButtonValue(event);\n\n      // Check pre-handlers in extenders\n      for (let handler of this.rollHandlerExtenders) {\n        handler.action = this.action;\n        if (handler.prehandleActionEvent(event, buttonValue, actionHandler)) {\n          return;\n        }\n      }\n\n      // Check pre-handlers\n      for (let handler of this.preRollHandlers) {\n        handler.action = this.action;\n        if (handler.prehandleActionEvent(event, buttonValue, actionHandler)) {\n          return;\n        }\n      }\n\n      // Check handlers in extenders\n      for (let handler of this.rollHandlerExtenders) {\n        handler.action = this.action;\n        if (handler.handleActionClick(event, buttonValue, actionHandler)) {\n          return;\n        }\n      }\n\n      // If the action was not yet handled, call the default method\n      this.handleActionClick(event, buttonValue);\n    } catch(error) {\n      Logger.error(\"Error handling action click event\", { error, event, action });\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Overide for the TAH system module\n   * @override\n   * @param {object} event       The event\n   * @param {string} buttonValue The button value\n   */\n  handleActionClick(event, buttonValue) {}\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle action hover events\n   * @param {object} event  The event\n   * @param {object} action The action\n   */\n  async handleActionHoverCore(event, action) {\n    Logger.debug(\"Handling action hover event\", { event });\n\n    // Update variables with current action context\n    this.action = action;\n\n    // If the action has an onHover function, call it\n    if (typeof action?.onHover === \"function\") {\n      action.onHover();\n      return;\n    }\n\n    // Get the value of the associated button\n    const buttonValue = this.#getButtonValue(event);\n\n    this.handleActionHover(event, buttonValue);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Overide for the TAH system module\n   * @override\n   * @param {object} event       The event\n   * @param {string} buttonValue The button value\n   */\n  handleActionHover(event, buttonValue) {}\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle group click events\n   * @param {object} event The event\n   * @param {group} group  The nest ID\n   */\n  async handleGroupClickCore(event, group) {\n    Logger.debug(`Handling click event for group [${group.name}]`, { event });\n\n    this.handleGroupClick(event, group);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Overide for the TAH system module\n   * @override\n   * @param {object} event The event\n   * @param {object} group The group\n   */\n  handleGroupClick(event, group) {}\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add a pre-roll handler\n   * @public\n   * @param {object} handler The roll handler\n   */\n  addPreRollHandler(handler) {\n    Logger.debug(`Adding pre-roll handler ${handler.constructor.name}`);\n    this.preRollHandlers.push(handler);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get button value\n   * @private\n   * @param {object} event  The event\n   * @returns {string}      The button value\n   */\n  #getButtonValue(event) {\n    if (!event) return null;\n    const buttonElement = event.target.querySelector(\".tah-action-button\") ?? event.target.closest(\".tah-action-button\");\n    return buttonElement?.value || null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Renders the item sheet\n   * @public\n   * @param {object} actor  The actor\n   * @param {string} itemId The item id\n   * @returns {boolean}     Whether the item was rendered\n   */\n  renderItem(actor, itemId) {\n    // If actor is not specified, use the RollHandler's actor\n    if (!actor) {\n      actor = this.actor;\n    }\n\n    // Get the item\n    const item = Utils.getItem(actor, itemId);\n\n    // If the item is not found, return false\n    if (!item) return false;\n\n    // Render the item and return true\n    item.sheet.render(true);\n    return true;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the item sheet should be rendered\n   * @public\n   * @returns {boolean}\n   */\n  isRenderItem() {\n    return (this.isRightClick && !(this.isAlt || this.isCtrl || this.isShift));\n  }\n\n  /* -------------------------------------------- */\n  /* Shortcuts to the HudManager properties       */\n  /* -------------------------------------------- */\n\n  /**\n   * Get actor\n   * @returns {object} The actor\n   */\n  get actor() {\n    return this.hudManager?.actor;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get actors\n   * @returns {Array} The actors\n   */\n  get actors() {\n    return this.hudManager?.actors;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get token\n   * @returns {object} The token\n   */\n  get token() {\n    return this.hudManager?.token;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get tokens\n   * @returns {Array} The tokens\n   */\n  get tokens() {\n    return this.hudManager?.tokens;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the right mouse button was clicked\n   * @returns {boolean} Whether the right mouse button was clicked\n   */\n  get isRightClick() {\n    return this.hudManager.isRightClick;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the ALT key was pressed\n   * @returns {boolean} Whether the ALT key was pressed\n   */\n  get isAlt() {\n    return this.hudManager.isAlt;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the CTRL key was pressed\n   * @returns {boolean} Whether the CTRL key was pressed\n   */\n  get isCtrl() {\n    return this.hudManager.isCtrl;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the SHIFT key was pressed\n   * @returns {boolean} Whether the SHIFT key was pressed\n   */\n  get isShift() {\n    return this.hudManager.isShift;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the element was hovered over\n   * @returns {boolean} Whether the element was hovered over\n   */\n  get isHover() {\n    return this.hudManager?.isHover;\n  }\n}\n","import { RollHandler } from \"./roll-handler.mjs\";\n\n/*\n * Used for adding support for actions not part of the core functions.\n * Returns true from prehandleActionEvent() if it can perform an action and stops\n * further actions being performed.\n */\nexport class PreRollHandler extends RollHandler {\n  /**\n   * Pre-handle action event\n   * @param {object} event        The event\n   * @param {string} buttonValue  The button value\n   * @param {class} actionHandler The ActionHandler instance\n   * @returns {boolean}\n   */\n  prehandleActionEvent(event, buttonValue, actionHandler) {\n    return false;\n  }\n}\n","import { RollHandler } from \"./roll-handler.mjs\";\n\n/**\n * An extension of the base RollHandler which extends the actions that can be handled\n */\nexport class RollHandlerExtender extends RollHandler {\n  constructor() {\n    super();\n  }\n\n  /**\n   * Pre-handle action event\n   * @param {object} event        The event\n   * @param {string} buttonValue  The button value\n   * @param {class} actionHandler The ActionHandler instance\n   * @returns {boolean}\n   */\n  prehandleActionEvent(event, buttonValue, actionHandler) {\n    return false;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle action click\n   * @override\n   * @param {object} event        The click event\n   * @param {string} buttonValue  The button value\n   * @param {class} actionHandler The ActionHandler instance\n   * @returns {boolean}\n   */\n  handleActionClick(event, buttonValue, actionHandler) {\n    return false;\n  }\n}\n","import { CUSTOM_STYLE, MODULE, TEMPLATE } from \"../core/constants.mjs\";\nimport { Utils } from \"../core/utils.mjs\";\n\nconst { ApplicationV2, HandlebarsApplicationMixin } = foundry.applications.api;\n\nexport class CustomStyleForm extends HandlebarsApplicationMixin(ApplicationV2) {\n  constructor(...args) {\n    super(args);\n  }\n\n  /* -------------------------------------------- */\n\n  static DEFAULT_OPTIONS = {\n    actions: {\n      reset: CustomStyleForm.reset\n    },\n    classes: [`${MODULE.ID}-app`, \"sheet\"],\n    id: \"token-action-hud-core-settings\",\n    form: {\n      closeOnSubmit: true,\n      handler: CustomStyleForm.submit\n    },\n    position: {\n      width: 600,\n      height: 680\n    },\n    tag: \"form\",\n    window: {\n      minimizable: true,\n      resizable: true,\n      title: \"tokenActionHud.settings.customStyle.form.title\"\n    }\n  };\n\n  /* -------------------------------------------- */\n\n  static PARTS = {\n    form: {\n      template: TEMPLATE.customStyleForm\n    }\n  };\n\n  /* -------------------------------------------- */\n\n  async _prepareContext() {\n    this.context = {\n      backgroundColor: Utils.getSetting(\"backgroundColor\", CUSTOM_STYLE.backgroundColor.default),\n      buttonHeight: Utils.getSetting(\"buttonHeight\", CUSTOM_STYLE.buttonHeight.default),\n      buttonBackgroundColor: Utils.getSetting(\"buttonBackgroundColor\", CUSTOM_STYLE.buttonBackgroundColor.default),\n      buttonHoverBackgroundColor: Utils.getSetting(\"buttonHoverBackgroundColor\", CUSTOM_STYLE.buttonHoverBackgroundColor.default),\n      buttonToggleActiveBackgroundColor: Utils.getSetting(\"buttonToggleActiveBackgroundColor\", CUSTOM_STYLE.buttonToggleActiveBackgroundColor.default),\n      buttonToggleHoverBackgroundColor: Utils.getSetting(\"buttonToggleHoverBackgroundColor\", CUSTOM_STYLE.buttonToggleHoverBackgroundColor.default),\n      buttonTextColor: Utils.getSetting(\"buttonTextColor\", CUSTOM_STYLE.buttonTextColor.default),\n      buttonHoverTextColor: Utils.getSetting(\"buttonHoverTextColor\", CUSTOM_STYLE.buttonHoverTextColor.default),\n      buttonToggleActiveTextColor: Utils.getSetting(\"buttonToggleActiveTextColor\", CUSTOM_STYLE.buttonToggleActiveTextColor.default),\n      buttonToggleHoverTextColor: Utils.getSetting(\"buttonToggleHoverTextColor\", CUSTOM_STYLE.buttonToggleHoverTextColor.default),\n      buttonBorderPrimaryColor: Utils.getSetting(\"buttonBorderPrimaryColor\", CUSTOM_STYLE.buttonBorderPrimaryColor.default),\n      buttonBorderSecondaryColor: Utils.getSetting(\"buttonBorderSecondaryColor\", CUSTOM_STYLE.buttonBorderSecondaryColor.default),\n      buttonHoverBorderPrimaryColor: Utils.getSetting(\"buttonHoverBorderPrimaryColor\", CUSTOM_STYLE.buttonHoverBorderPrimaryColor.default),\n      buttonHoverBorderSecondaryColor: Utils.getSetting(\"buttonHoverBorderSecondaryColor\", CUSTOM_STYLE.buttonHoverBorderSecondaryColor.default),\n      buttonToggleActiveBorderPrimaryColor: Utils.getSetting(\"buttonToggleActiveBorderPrimaryColor\", CUSTOM_STYLE.buttonToggleActiveBorderPrimaryColor.default),\n      buttonToggleActiveBorderSecondaryColor: Utils.getSetting(\"buttonToggleActiveBorderSecondaryColor\", CUSTOM_STYLE.buttonToggleActiveBorderSecondaryColor.default),\n      buttonToggleHoverBorderPrimaryColor: Utils.getSetting(\"buttonToggleHoverBorderPrimaryColor\", CUSTOM_STYLE.buttonToggleHoverBorderPrimaryColor.default),\n      buttonToggleHoverBorderSecondaryColor: Utils.getSetting(\"buttonToggleHoverBorderSecondaryColor\", CUSTOM_STYLE.buttonToggleHoverBorderSecondaryColor.default),\n      textPrimaryColor: Utils.getSetting(\"textPrimaryColor\", CUSTOM_STYLE.textPrimaryColor.default),\n      textSecondaryColor: Utils.getSetting(\"textSecondaryColor\", CUSTOM_STYLE.textSecondaryColor.default),\n      textTertiaryColor: Utils.getSetting(\"textTertiaryColor\", CUSTOM_STYLE.textTertiaryColor.default),\n      textHoverPrimaryColor: Utils.getSetting(\"textHoverPrimaryColor\", CUSTOM_STYLE.textHoverPrimaryColor.default),\n      textHoverSecondaryColor: Utils.getSetting(\"textHoverSecondaryColor\", CUSTOM_STYLE.textHoverSecondaryColor.default),\n      textHoverTertiaryColor: Utils.getSetting(\"textHoverTertiaryColor\", CUSTOM_STYLE.textHoverTertiaryColor.default)\n    };\n    return this.context;\n  }\n\n  /* -------------------------------------------- */\n\n  _onRender(context, options) {\n    super._onRender(context, options);\n    if (typeof ColorPicker !== \"undefined\") { ColorPicker.install(); }\n  }\n\n  /* -------------------------------------------- */\n\n  static async reset() {\n    for (const [key, value] of Object.entries(CUSTOM_STYLE)) {\n      Utils.setSetting(key, value.default);\n      document.querySelector(\":root\").style.setProperty(value.cssProperty, value.default);\n    }\n    this.render(true);\n  }\n\n  /* -------------------------------------------- */\n\n  static async submit(event, form, formData) {\n    const isCustom = Utils.getSetting(\"style\") === \"custom\";\n    for (const [key, value] of Object.entries(formData.object)) {\n      const customStyle = CUSTOM_STYLE[key];\n      if (value !== this.context[key]) {\n        Utils.setSetting(key, value);\n        if (isCustom) {\n          document.querySelector(\":root\").style.setProperty(customStyle.cssProperty, value);\n        }\n      }\n    }\n  }\n}\n","import { Logger, Utils } from \"../core/utils.mjs\";\n\n/**\n * Reset layout confirmation dialog\n * @public\n */\nexport async function resetLayoutDialog() {\n  await foundry.applications.api.DialogV2.confirm({\n    window: {\n      title: game.i18n.localize(\"tokenActionHud.dialog.resetLayout.title\")\n    },\n    content: `<p>${game.i18n.localize(\"tokenActionHud.dialog.resetLayout.content\")}</p>`,\n    modal: true,\n    yes: {\n      label: game.i18n.localize(\"tokenActionHud.dialog.button.yes\"),\n      callback: async () => resetLayout()\n    },\n    no: {\n      label: game.i18n.localize(\"tokenActionHud.dialog.button.no\")\n    }\n  });\n}\n\n/* -------------------------------------------- */\n\n/**\n * Reset user layout\n */\nasync function resetLayout() {\n  if (!game?.tokenActionHud) return;\n\n  const customLayoutElement = document.querySelector(\"#token-action-hud-core-settings input[name=customLayout]\");\n  if (customLayoutElement) {\n    await game.tokenActionHud.updateCachedSettings(\"customLayout\", customLayoutElement?.value ?? \"\");\n    await Utils.setSetting(\"customLayout\", customLayoutElement?.value ?? \"\");\n  }\n\n  const userCustomLayoutElement = document.querySelector(\"#token-action-hud-core-settings input[name=userCustomLayout]\");\n  if (userCustomLayoutElement) {\n    await game.tokenActionHud.updateCachedSettings(\"userCustomLayout\", userCustomLayoutElement?.value ?? \"\");\n    await Utils.setUserFlag(\"userCustomLayout\", userCustomLayoutElement?.value ?? \"\");\n  }\n\n  await game.tokenActionHud.resetLayout();\n  Logger.info(\"Layout reset\", true);\n}\n","import { Logger, Utils } from \"../core/utils.mjs\";\n\n/**\n * Reset all layouts confirmation dialog\n * @public\n */\nexport async function resetAllLayoutsDialog() {\n  await foundry.applications.api.DialogV2.confirm({\n    window: {\n      title: game.i18n.localize(\"tokenActionHud.dialog.resetAllLayouts.title\")\n    },\n    content: `<p>${game.i18n.localize(\"tokenActionHud.dialog.resetAllLayouts.content\")}</p>`,\n    modal: true,\n    yes: {\n      label: game.i18n.localize(\"tokenActionHud.dialog.button.yes\"),\n      callback: async () => resetAllLayouts()\n    },\n    no: {\n      label: game.i18n.localize(\"tokenActionHud.dialog.button.no\")\n    }\n  });\n}\n\n/* -------------------------------------------- */\n\n/**\n * Reset HUD layouts for everyone\n * @public\n */\nasync function resetAllLayouts() {\n  if (!game.tokenActionHud) return;\n\n  const customLayoutElement = document.querySelector(\"#token-action-hud-core-settings input[name=customLayout]\");\n  if (customLayoutElement) {\n    await Utils.setSetting(\"customLayout\", customLayoutElement?.value ?? \"\");\n  }\n\n  const userCustomLayoutElement = document.querySelector(\"#token-action-hud-core-settings input[name=userCustomLayout]\");\n  if (userCustomLayoutElement) {\n    await Utils.setUserFlag(\"userCustomLayout\", userCustomLayoutElement?.value ?? \"\");\n  }\n\n  await game.tokenActionHud.socket.executeForEveryone(\"reset\");\n  Logger.info(\"All layouts reset\", true);\n}\n","import { MODULE, LAYOUT_SETTING, TEMPLATE } from \"../core/constants.mjs\";\nimport { resetLayoutDialog } from \"../dialogs/reset-layout.mjs\";\nimport { resetAllLayoutsDialog } from \"../dialogs/reset-all-layouts.mjs\";\nimport { Utils } from \"../core/utils.mjs\";\n\nconst { ApplicationV2, HandlebarsApplicationMixin } = foundry.applications.api;\n\nexport class TahSettingsForm extends HandlebarsApplicationMixin(ApplicationV2) {\n  constructor(...args) {\n    super(args);\n\n    this.settings = {};\n  }\n\n  /* -------------------------------------------- */\n\n  static DEFAULT_OPTIONS = {\n    actions: {\n      exportLayout: TahSettingsForm.exportLayout,\n      resetLayout: resetLayoutDialog,\n      resetAllLayouts: resetAllLayoutsDialog,\n      reset: TahSettingsForm.reset\n    },\n    classes: [`${MODULE.ID}-app`, \"sheet\"],\n    id: \"token-action-hud-core-settings\",\n    form: {\n      closeOnSubmit: true,\n      handler: TahSettingsForm.submit\n    },\n    position: {\n      width: 600,\n      height: 800\n    },\n    tag: \"form\",\n    window: {\n      minimizable: true,\n      resizable: true\n    }\n  };\n\n  /* -------------------------------------------- */\n\n  static PARTS = {\n    form: {\n      template: TEMPLATE.settings\n    }\n  };\n\n  /* -------------------------------------------- */\n\n  async _prepareContext() {\n    const settings = [];\n    const context = { settings };\n\n    for (const [key, setting] of Object.entries(this.settings)) {\n      const { scope, hint, icon, label, name, type, inputType, range, choices, action } = setting;\n\n      if (scope === \"world\" && !game.user.isGM) continue;\n\n      const value = (setting?.scope)\n        ? (scope === \"user\")\n          ? await Utils.getUserFlag(key)\n          : await Utils.getSetting(key)\n        : \"\";\n      const settingType = type instanceof Function ? type.name : \"String\";\n      const isButton = inputType === \"button\";\n      const isCheckbox = inputType === \"checkbox\";\n      const isFilePicker = inputType === \"filePicker\";\n      const filePickerType = (inputType === \"filePicker\") ? settingType ?? \"any\" : \"\";\n      const isNumber = inputType === \"number\";\n      const isRange = (inputType === \"range\") && range;\n      const isSelect = choices !== undefined;\n      settings.push({\n        id: key,\n        hint: game.i18n.localize(hint),\n        icon,\n        label: game.i18n.localize(label),\n        name: game.i18n.localize(name),\n        value,\n        type,\n        isButton,\n        action,\n        isCheckbox,\n        isFilePicker,\n        filePickerType,\n        isNumber,\n        isRange,\n        isSelect\n      });\n    }\n    return context;\n  }\n\n  /* -------------------------------------------- */\n\n  static exportLayout() {\n    if (!game.tokenActionHud) return;\n    game.tokenActionHud.hudManager.layoutHandler.exportLayout();\n  }\n\n  static async submit(event, form, formData) {\n    for (const [key, value] of Object.entries(formData.object)) {\n      switch (this.settings[key].scope) {\n        case \"client\":\n        case \"world\":\n          await Utils.setSetting(key, value); break;\n        case \"user\":\n          await Utils.setUserFlag(key, value); break;\n      }\n\n      await game.tokenActionHud.updateCachedSettings(key, value);\n    }\n\n    game.tokenActionHud.update();\n  }\n}\n\n/* -------------------------------------------- */\n\nexport class TahSettingsFormLayout extends TahSettingsForm {\n  constructor() {\n    super();\n    this.settings = LAYOUT_SETTING;\n  }\n\n  /* -------------------------------------------- */\n\n  static DEFAULT_OPTIONS = {\n    window: {\n      title: \"tokenActionHud.settings.layout.form.title\"\n    }\n  };\n}\n","import { CustomStyleForm } from \"../applications/custom-style-form.mjs\";\nimport { TahSettingsFormLayout } from \"../applications/settings-form.mjs\";\nimport { CUSTOM_STYLE, MODULE } from \"./constants.mjs\";\nimport { Logger, Utils } from \"./utils.mjs\";\n\n/**\n * When a module setting is changed, update the HUD settings\n * @param {string} key The setting key\n * @param {*} value    The setting value\n */\nfunction onChangeFunction(key, value) {\n  if (game.tokenActionHud) game.tokenActionHud.updateCachedSettings(key, value);\n}\n\n/* -------------------------------------------- */\n\n// Register key bindings\nHooks.on(\"init\", async () => {\n  game.keybindings.register(MODULE.ID, \"enableDisableHud\", {\n    name: game.i18n.localize(\"tokenActionHud.enableDisableHud\"),\n    editable: [],\n    onDown: () => { if (game.tokenActionHud) game.tokenActionHud.toggleHudEnable(); }\n  });\n\n  game.keybindings.register(MODULE.ID, \"collapseExpandHud\", {\n    name: game.i18n.localize(\"tokenActionHud.collapseExpandHud\"),\n    editable: [],\n    onDown: () => { if (game.tokenActionHud) game.tokenActionHud.toggleHudCollapse(); }\n  });\n});\n\n/* -------------------------------------------- */\n\n/**\n * Register module settings\n * @param {class} systemManager The system manager\n * @param {Array} rollHandlers  The available roll handlers\n * @param {object} styles       The styles\n */\nexport const registerSettingsCore = function(systemManager, rollHandlers, styles) {\n  game.settings.registerMenu(MODULE.ID, \"customStyle\", {\n    hint: game.i18n.localize(\"tokenActionHud.settings.customStyle.hint\"),\n    label: game.i18n.localize(\"tokenActionHud.settings.customStyle.label\"),\n    name: game.i18n.localize(\"tokenActionHud.settings.customStyle.name\"),\n    icon: \"fas fa-palette\",\n    type: CustomStyleForm,\n    restricted: false,\n    scope: \"client\"\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.registerMenu(MODULE.ID, \"layout\", {\n    hint: game.i18n.localize(\"tokenActionHud.settings.layout.hint\"),\n    label: game.i18n.localize(\"tokenActionHud.settings.layout.label\"),\n    name: game.i18n.localize(\"tokenActionHud.settings.layout.name\"),\n    icon: \"fas fa-table-layout\",\n    type: TahSettingsFormLayout,\n    restricted: false,\n    scope: \"client\"\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"startup\", {\n    name: \"One-Time Startup Prompt\",\n    scope: \"world\",\n    config: false,\n    type: Boolean,\n    default: false\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"migrationVersion\", {\n    name: \"Migration Version\",\n    scope: \"world\",\n    config: false,\n    type: String,\n    default: \"0.0\"\n  });\n\n  /* -------------------------------------------- */\n\n  const styleChoices = Object.fromEntries(Object.entries(styles).map(([key, value]) => [key, value.name]));\n\n  game.settings.register(MODULE.ID, \"style\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.style.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.style.hint\"),\n    scope: \"client\",\n    config: true,\n    type: String,\n    default: \"foundryVTT\",\n    choices: styleChoices,\n    onChange: value => {\n      Utils.switchCSS(value);\n      onChangeFunction(\"style\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"customLayout\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.customLayout.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.customLayout.hint\"),\n    scope: \"world\",\n    config: false,\n    type: String\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"userCustomLayout\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.userCustomLayout.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.userCustomLayout.hint\"),\n    scope: \"client\",\n    config: false,\n    type: String\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"direction\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.direction.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.direction.hint\"),\n    scope: \"client\",\n    config: true,\n    type: String,\n    default: \"auto\",\n    choices: {\n      auto: game.i18n.localize(\"tokenActionHud.settings.direction.choice.auto\"),\n      up: game.i18n.localize(\"tokenActionHud.settings.direction.choice.up\"),\n      down: game.i18n.localize(\"tokenActionHud.settings.direction.choice.down\")\n    },\n    onChange: value => {\n      onChangeFunction(\"direction\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"grid\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.grid.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.grid.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: false,\n    onChange: value => {\n      onChangeFunction(\"grid\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"scale\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.scale.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.scale.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Number,\n    range: {\n      min: 0.5,\n      max: 2,\n      step: 0.05\n    },\n    default: 1,\n    onChange: value => {\n      onChangeFunction(\"scale\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"drag\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.drag.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.drag.hint\"),\n    scope: \"client\",\n    config: true,\n    type: String,\n    default: \"whenUnlocked\",\n    choices: {\n      always: game.i18n.localize(\"tokenActionHud.settings.drag.choices.always\"),\n      whenUnlocked: game.i18n.localize(\"tokenActionHud.settings.drag.choices.whenUnlocked\"),\n      never: game.i18n.localize(\"tokenActionHud.settings.drag.choices.never\")\n    },\n    onChange: value => {\n      onChangeFunction(\"drag\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"enable\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.enable.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.enable.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: true,\n    onChange: value => {\n      onChangeFunction(\"enable\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"rollHandler\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.rollHandler.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.rollHandler.hint\"),\n    scope: \"world\",\n    config: true,\n    type: String,\n    choices: rollHandlers,\n    default: \"core\",\n    onChange: value => {\n      onChangeFunction(\"rollHandler\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"allow\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.allow.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.allow.hint\"),\n    scope: \"world\",\n    config: true,\n    type: String,\n    choices: {\n      4: game.i18n.localize(\"tokenActionHud.settings.allow.choice.4\"),\n      3: game.i18n.localize(\"tokenActionHud.settings.allow.choice.3\"),\n      2: game.i18n.localize(\"tokenActionHud.settings.allow.choice.2\"),\n      1: game.i18n.localize(\"tokenActionHud.settings.allow.choice.1\")\n    },\n    default: 1,\n    requiresReload: true\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"enableCustomization\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.enableCustomization.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.enableCustomization.hint\"),\n    scope: \"world\",\n    config: true,\n    type: Boolean,\n    default: true,\n    onChange: value => {\n      onChangeFunction(\"enableCustomization\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"alwaysShowHud\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.alwaysShowHud.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.alwaysShowHud.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: true,\n    onChange: value => {\n      onChangeFunction(\"alwaysShowHud\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"displayCharacterName\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.displayCharacterName.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.displayCharacterName.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: true,\n    onChange: value => {\n      onChangeFunction(\"displayCharacterName\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"sortActions\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.sortActions.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.sortActions.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: false,\n    onChange: value => {\n      onChangeFunction(\"sortActions\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"displayIcons\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.displayIcons.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.displayIcons.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: true,\n    onChange: value => {\n      onChangeFunction(\"displayIcons\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"tooltips\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.tooltips.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.tooltips.hint\"),\n    scope: \"client\",\n    config: true,\n    type: String,\n    default: \"full\",\n    choices: {\n      full: game.i18n.localize(\"tokenActionHud.settings.tooltips.choices.full\"),\n      nameOnly: game.i18n.localize(\"tokenActionHud.settings.tooltips.choices.nameOnly\"),\n      none: game.i18n.localize(\"tokenActionHud.settings.tooltips.choices.none\")\n    },\n    onChange: value => {\n      onChangeFunction(\"tooltips\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"tooltipDelay\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.tooltipDelay.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.tooltipDelay.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Number,\n    default: 1500,\n    onChange: value => {\n      setTooltipDelay(value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  const tooltipDelay = Utils.getSetting(\"tooltipDelay\") || 1500;\n  setTooltipDelay(tooltipDelay);\n\n  /**\n   * Set the tooltip delay\n   * @param {number} ms Delay amount in milliseconds\n   */\n  function setTooltipDelay(ms) {\n    const root = document.querySelector(\":root\");\n    root.style.setProperty(\"--tah-tooltip-delay\", `${ms}ms`);\n  }\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"clickOpenCategory\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.clickOpenCategory.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.clickOpenCategory.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: false,\n    onChange: value => {\n      onChangeFunction(\"clickOpenCategory\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  if (Utils.isModuleActive(\"itemacro\") && !Utils.isModuleActive(\"midi-qol\")) {\n    game.settings.register(MODULE.ID, \"itemMacro\", {\n      name: game.i18n.localize(\"tokenActionHud.settings.itemMacro.name\"),\n      hint: game.i18n.localize(\"tokenActionHud.settings.itemMacro.hint\"),\n      scope: \"client\",\n      config: true,\n      type: String,\n      choices: {\n        both: game.i18n.localize(\"tokenActionHud.settings.itemMacro.choices.both\"),\n        itemMacro: game.i18n.localize(\"tokenActionHud.settings.itemMacro.choices.itemMacro\"),\n        original: game.i18n.localize(\"tokenActionHud.settings.itemMacro.choices.original\")\n      },\n      default: \"both\",\n      onChange: value => {\n        onChangeFunction(\"itemMacro\", value);\n      }\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"activeCssAsText\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.activeCssAsText.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.activeCssAsText.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: false,\n    onChange: value => {\n      onChangeFunction(\"activeCssAsText\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"collapsibleSubgroups\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.collapsibleSubgroups.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.collapsibleSubgroups.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: true,\n    onChange: value => {\n      onChangeFunction(\"collapsibleSubgroups\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"debug\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.debug.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.debug.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: false,\n    onChange: value => {\n      onChangeFunction(\"debug\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  registerCustomStyleSettings();\n\n  systemManager.registerSettings(onChangeFunction);\n\n  Logger.debug(\"Available roll handlers\", { rollHandlers });\n};\n\n/* -------------------------------------------- */\n\n/**\n * Register color settings\n */\nfunction registerCustomStyleSettings() {\n  for (const [key, value] of Object.entries(CUSTOM_STYLE)) {\n    game.settings.register(MODULE.ID, key, {\n      scope: \"client\",\n      config: false,\n      type: value.type,\n      default: value.default\n    });\n  }\n}\n","import { ActionHandlerExtender } from \"./action-handler-extender.mjs\";\nimport { DELIMITER, ITEM_MACRO_ICON } from \"../../core/constants.mjs\";\nimport { Utils } from \"../../core/utils.mjs\";\n\n/**\n * Handler for building actions related to the Item Macro module.\n */\nexport class ItemMacroActionHandlerExtender extends ActionHandlerExtender {\n  constructor() {\n    super();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Extend the action list\n   * @override\n   */\n  extendActionHandler() {\n    if (!this.actor) return;\n\n    const items = this.actor.items.filter(item => item.flags?.itemacro?.macro?.command);\n    if (!items?.length) return;\n\n    const itemMacroSetting = Utils.getSetting(\"itemMacro\");\n    if (itemMacroSetting === \"original\") return;\n\n    const replaceExisting = itemMacroSetting === \"itemMacro\";\n\n    Object.values(this.groupHandler.groups).forEach(group => {\n      this.#addGroupActions(items, group, replaceExisting);\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add group actions\n   * @private\n   * @param {Array} items     The items\n   * @param {object} group    The group\n   * @param {boolean} replace Whether to replace the action or not\n   */\n  #addGroupActions(items, group, replace) {\n    // Exit if no actions exist\n    if (!group?.actions?.length) return;\n\n    const actions = [];\n    for (const existingAction of group.actions) {\n      const item = items.find(item => item.id === existingAction.id);\n      if (!item) continue;\n\n      const existingItemMacroAction = group.actions.find(action => action.id === `itemMacro+${existingAction.id}`);\n      const actionToReplace = existingItemMacroAction ?? existingAction;\n\n      if (existingItemMacroAction) replace = true;\n\n      const macroAction = this.#createItemMacroAction(item, existingAction, actionToReplace, replace);\n\n      if (!replace) {\n        actions.push(macroAction);\n      }\n\n      if (!this.actionHandler.availableActions.has(macroAction.id)) {\n        this.actionHandler.availableActions.set(macroAction.id, macroAction);\n      }\n    }\n\n    this.#addActions(actions, group);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Create item macro action\n   * @private\n   * @param {object} item            The item\n   * @param {object} existingAction  The existing action\n   * @param {object} actionToReplace The action to replace\n   * @param {boolean} replace        Whether to replace the action or not\n   * @returns {object}               The item macro action\n   */\n  #createItemMacroAction(item, existingAction, actionToReplace, replace) {\n    const action = (replace) ? actionToReplace : Utils.deepClone(existingAction);\n    action.encodedValue = `itemMacro${existingAction.encodedValue?.substr(existingAction.encodedValue.indexOf(DELIMITER))}`;\n    action.id = `itemMacro+${existingAction.id}`;\n    action.fullName = existingAction.fullName;\n    action.listName = `Item Macro: ${existingAction.fullName}`;\n    action.name = existingAction.name;\n    action.img = existingAction.img;\n    action.itemMacroIcon = `<i class=\"${ITEM_MACRO_ICON.ICON}\" data-tooltip=\"${ITEM_MACRO_ICON.TOOLTIP}\"></i>`;\n    action.selected = existingAction.userSelected ?? existingAction.systemSelected;\n\n    action.onClick = () => {\n      try {\n        item.executeMacro();\n      } catch(err) {\n        Logger.debug(\"ItemMacro Error\", err);\n        return false;\n      }\n    };\n\n    return action;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add actions to the group\n   * @private\n   * @param {object} actions The actions\n   * @param {object} group   The group\n   */\n  #addActions(actions, group) {\n    actions.forEach(macroAction => {\n      const index = group.actions.findIndex(action => action.id === macroAction.id) + 1;\n      group.actions.splice(index, 0, macroAction);\n    });\n  }\n}\n","import { registerSettingsCore } from \"../core/settings.mjs\";\nimport { ItemMacroActionHandlerExtender } from \"../handlers/action-handlers/item-macro-extender.mjs\";\nimport { RollHandler } from \"../handlers/roll-handlers/roll-handler.mjs\";\nimport { MODULE, CSS_STYLE } from \"../core/constants.mjs\";\nimport { Logger, Utils } from \"../core/utils.mjs\";\n\nexport class SystemManager {\n  constructor() {\n    this.coreModuleId = MODULE.ID;\n    this.defaults = [];\n    this.styles = null;\n  }\n\n  /* -------------------------------------------- */\n  /*  Methods for system modules to override      */\n  /* -------------------------------------------- */\n\n  getActionHandler() {}\n\n  getRollHandler(rollHandlerId) {\n    return false;\n  }\n\n  getAvailableRollHandlers() {}\n\n  registerSettings(onChangeFunction) {}\n\n  async registerDefaults() {}\n\n  registerStyles() {}\n\n  /* -------------------------------------------- */\n\n  /**\n   * Initialise the system manager\n   */\n  async init() {\n    await this.#registerDefaultsCore();\n    this.#registerStylesCore();\n    this.#registerSettingsCore();\n  }\n\n\n  /* -------------------------------------------- */\n\n  /**\n   * Register defaults\n   * @private\n   * @returns {Array} The defaults\n   */\n  async #registerDefaultsCore() {\n    const defaults = await this.registerDefaults() ?? [];\n\n    Hooks.callAll(\"tokenActionHudCoreRegisterDefaults\", defaults);\n\n    if (defaults) {\n      this.defaults = defaults;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Register styles\n   * @private\n   */\n  #registerStylesCore() {\n    const systemStyles = this.registerStyles() ?? {};\n    this.styles = foundry.utils.mergeObject(CSS_STYLE, systemStyles);\n\n    Hooks.callAll(\"tokenActionHudCoreRegisterStyles\", this.styles);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Register module settings\n   * @private\n   */\n  #registerSettingsCore() {\n    const rollHandlers = this.getAvailableRollHandlers();\n    registerSettingsCore(this, rollHandlers, this.styles);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Initialise the action handler\n   * @public\n   * @param {class} hudManager The HudManager instance\n   * @returns {class}          The ActionHandler instance\n   */\n  getActionHandlerCore(hudManager) {\n    const actionHandler = this.getActionHandler();\n    actionHandler.systemManager = this;\n\n    const { dataHandler, groupHandler } = hudManager;\n    actionHandler.hudManager = hudManager;\n    actionHandler.dataHandler = dataHandler;\n    actionHandler.groupHandler = groupHandler;\n    actionHandler.addGroup = groupHandler.addGroup.bind(groupHandler);\n    actionHandler.addGroupInfo = groupHandler.addGroupInfo.bind(groupHandler);\n    this.#addActionHandlerExtenders(groupHandler, actionHandler);\n\n    Hooks.callAll(\"tokenActionHudCoreAddActionHandler\", actionHandler);\n\n    return actionHandler;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add action handler extensions\n   * @public\n   * @param {class} groupHandler The GroupHandler instance\n   * @param {class} actionHandler The ActionHandler instance\n   */\n  #addActionHandlerExtenders(groupHandler, actionHandler) {\n    if (Utils.isModuleActive(\"itemacro\") && !Utils.isModuleActive(\"midi-qol\")) {\n      actionHandler.addActionHandlerExtender(new ItemMacroActionHandlerExtender(groupHandler, actionHandler));\n    }\n\n    Hooks.callAll(\"tokenActionHudCoreAddActionHandlerExtenders\", actionHandler);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the roll handler\n   * @public\n   * @param {class} hudManager The HudManager instance\n   * @returns {class}          The RollHandler instance\n   */\n  getRollHandlerCore(hudManager) {\n    let rollHandlerId = Utils.getSetting(\"rollHandler\");\n\n    if (!(rollHandlerId === \"core\" || Utils.isModuleActive(rollHandlerId))) {\n      Logger.error(rollHandlerId, game.i18n.localize(\"tokenActionHud.handlerNotFound\"));\n      rollHandlerId = \"core\";\n      Utils.setSetting(\"rollHandler\", rollHandlerId);\n    }\n\n    // If no system RollHandler is returned, use core RollHandler\n    const rollHandler = this.getRollHandler(rollHandlerId) ?? new RollHandler();\n    rollHandler.hudManager = hudManager;\n\n    this.#addRollHandlerExtenders(rollHandler);\n\n    Hooks.callAll(\"tokenActionHudCoreAddRollHandler\", rollHandler);\n\n    return rollHandler;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add roll handler extensions\n   * @public\n   * @param {class} rollHandler The roll handler\n   */\n  #addRollHandlerExtenders(rollHandler) {\n    Hooks.callAll(\"tokenActionHudCoreAddRollHandlerExtenders\", rollHandler);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add handler\n   * @param {Array} choices The choices\n   * @param {string} id     The module id\n   */\n  static addHandler(choices, id) {\n    if (Utils.isModuleActive(id)) {\n      const title = Utils.getModuleTitle(id);\n      foundry.utils.mergeObject(choices, { [id]: title });\n    }\n  }\n}\n","import { MODULE } from \"./constants.mjs\";\nimport { ActionHandler } from \"../handlers/action-handlers/action-handler.mjs\";\nimport { ActionHandlerExtender } from \"../handlers/action-handlers/action-handler-extender.mjs\";\nimport { DataHandler } from \"../handlers/data-handler.mjs\";\nimport { PreRollHandler } from \"../handlers/roll-handlers/pre-roll-handler.mjs\";\nimport { RollHandler } from \"../handlers/roll-handlers/roll-handler.mjs\";\nimport { RollHandlerExtender } from \"../handlers/roll-handlers/roll-handler-extender.mjs\";\nimport { SystemManager } from \"../managers/system-manager.mjs\";\nimport { Logger, Timer, Utils } from \"./utils.mjs\";\n\n/**\n * Register the API\n */\nexport function registerApi() {\n  const module = game.modules.get(MODULE.ID);\n  module.api = {\n    ActionHandlerExtender,\n    ActionHandler,\n    DataHandler,\n    Logger,\n    PreRollHandler,\n    RollHandler,\n    RollHandlerExtender,\n    SystemManager,\n    Timer,\n    Utils\n  };\n\n  Hooks.callAll(\"tokenActionHudCoreApiReady\", module);\n}\n","import { MODULE, TEMPLATE } from \"./core/constants.mjs\";\nimport { DataHandler } from \"./handlers/data-handler.mjs\";\nimport { MigrationManager } from \"./managers/migration-manager.mjs\";\nimport { TokenActionHud } from \"./applications/token-action-hud.mjs\";\nimport { Logger, Utils } from \"./core/utils.mjs\";\nimport { registerSocket, getSocket, isSocketlibActive } from \"./core/sockets.mjs\";\nimport { registerApi } from \"./core/api.mjs\";\n\nlet systemManager;\n\n/**\n * Register hooks\n */\nHooks.once(\"socketlib.ready\", registerSocket);\nHooks.on(\"ready\", registerApi);\nHooks.on(\"tokenActionHudSystemReady\", registerCoreModule);\nHooks.on(\"tokenActionHudCoreReady\", registerHud);\nHooks.on(\"renderHotbar\", (_, html) => addContextMenuListener(html, \"li.macro\"));\nHooks.on(\"renderSceneNavigation\", (_, html) => addContextMenuListener(html, \"li.scene.nav-item\"));\n\n/* -------------------------------------------- */\n\n/**\n * Register the core module\n * @param {object} systemModule The system module\n */\nasync function registerCoreModule(systemModule) {\n  // Exit if core module version is not compatible with the system module\n  if (!Utils.isSystemModuleCompatible(systemModule.api?.requiredCoreModuleVersion)) return;\n\n  // Exit if socketlit module is not installed or enabled\n  if (!isSocketlibActive()) return;\n\n  // Create new SystemManager and register core and system module settings\n  systemManager = new systemModule.api.SystemManager(MODULE.ID);\n  await systemManager.init();\n\n  // Set stylesheet to 'style' core module setting\n  Utils.switchCSS(Utils.getSetting(\"style\"));\n\n  // Register Handlebar helpers\n  Utils.registerHandlebars();\n\n  // Load templates\n  loadTemplates(Object.values(TEMPLATE));\n\n  Hooks.callAll(\"tokenActionHudCoreReady\");\n}\n\n/* -------------------------------------------- */\n\n/**\n * Register the TokenActionHud application\n */\nasync function registerHud() {\n  // Get socket\n  const socket = getSocket();\n\n  // Initialise DataHandler\n  const dataHandler = new DataHandler(socket);\n  await dataHandler.init();\n\n  // Initialise MigrationManager\n  const migrationManager = new MigrationManager(dataHandler, socket);\n  await migrationManager.init();\n\n  checkColorPicker();\n  registerHudHooks();\n\n  game.tokenActionHud = new TokenActionHud(systemManager, dataHandler, socket);\n  await game.tokenActionHud.init();\n\n  Hooks.callAll(\"tokenActionHudReady\");\n\n  game.tokenActionHud.update({ type: \"hook\", name: \"tokenActionHudCoreReady\" });\n}\n\n/* -------------------------------------------- */\n\n/**\n * Notify GM if the Color Picker is not active\n */\nfunction checkColorPicker() {\n  if (game.user.isGM && !game.modules.get(\"color-picker\")?.active && Utils.getSetting(\"startup\") === false) {\n    Logger.info(\"To enable color pickers, install the 'Color Picker' module.\", true);\n    Utils.setSetting(\"startup\", true);\n  }\n}\n\n/* -------------------------------------------- */\n\n/**\n * Register HUD-related hooks\n */\nfunction registerHudHooks() {\n  Hooks.on(\"renderTokenActionHud\", () => game.tokenActionHud.postRender());\n  const hooks = [\n    \"deleteActor\", \"updateActor\", \"createActiveEffect\", \"deleteActiveEffect\",\n    \"createCombat\", \"deleteCombat\", \"updateCombat\", \"updateCombatant\",\n    \"deleteCompendium\", \"updateCompendium\", \"createItem\", \"deleteItem\",\n    \"updateItem\", \"deleteMacro\", \"updateMacro\", \"controlToken\", \"deleteToken\",\n    \"updateToken\", \"closeSettingsConfig\", \"forceUpdateTokenActionHud\"\n  ];\n\n  hooks.forEach(hook => Hooks.on(hook, (...args) => handleHookEvent({ ...args }, hook)));\n}\n\n/* -------------------------------------------- */\n\n/**\n * Handle hook events\n * @param {object} hookData The hook data\n * @param {string} hookName The hook name\n */\nfunction handleHookEvent(hookData, hookName) {\n  if (!validateHookData(hookData, hookName)) return;\n  game.tokenActionHud.update({ type: \"hook\", name: hookName, data: hookData });\n}\n\n/* -------------------------------------------- */\n\n/**\n * Validate hook data\n * @param {object} hookData The hook data\n * @param {string} hookName The hook name\n * @returns {boolean}\n */\nfunction validateHookData(hookData, hookName) {\n  switch (hookName) {\n    case \"deleteActor\":\n    case \"updateActor\":\n      return game.tokenActionHud.isValidActorOrItemUpdate(hookData[0], hookData[1]);\n    case \"createActiveEffect\":\n    case \"deleteActiveEffect\":\n      return game.tokenActionHud.isControlledActor(hookData[0]?.parent);\n    case \"createCombatant\":\n    case \"updateCombatant\":\n      return game.tokenActionHud.isControlledActor(hookData[0]?.actor);\n    case \"deleteCompendium\":\n    case \"updateCompendium\":\n      return validateCompendium(hookData.source?.metadata?.id);\n    case \"createItem\":\n    case \"deleteItem\":\n    case \"updateItem\":\n      return game.tokenActionHud.isValidActorOrItemUpdate(hookData[0]?.actor);\n    case \"deleteMacro\":\n    case \"updateMacro\":\n      game.tokenActionHud.actionHandler.macroActionHandler.macroActions = null;\n      return true;\n    case \"updateToken\":\n      return Object.hasOwn(hookData[1], \"hidden\") && game.tokenActionHud.isValidTokenChange(hookData[0], hookData[1]);\n    default:\n      return true;\n  }\n}\n\n/* -------------------------------------------- */\n\n/**\n * Validate compendium hook\n * @param {string} id The compendium ID\n * @returns {boolean} Whether the compendium hook is valid\n */\nfunction validateCompendium(id) {\n  const compendiumHandler = game.tokenActionHud.actionHandler.compendiumActionHandler;\n  if (!compendiumHandler.isLinkedCompendium(id)) return false;\n  compendiumHandler.compendiumActions = new Map();\n  return true;\n}\n\n/* -------------------------------------------- */\n\n/**\n * Add context menu listeners\n * @param {object} html     The HTML\n * @param {string} selector The selector for the HTML element\n */\nfunction addContextMenuListener(html, selector) {\n  const element = html[0].querySelector(selector);\n  if (element) element.addEventListener(\"contextmenu\", sendHudToBottom);\n}\n\n/* -------------------------------------------- */\n\n/**\n * Send HUD to bottom\n */\nfunction sendHudToBottom() {\n  if (game.tokenActionHud?.element) {\n    game.tokenActionHud.element.style.zIndex = 20;\n  }\n}\n"],"names":["MODULE","ID","NAME","TEMPLATE_DIR","TEMPLATE","action","customStyleForm","group","hud","listSubgroup","settings","tabSubgroup","tagifyAppHud","tagifyAppGroup","tagifyAppSubgroup","DELIMITER","ACTION_TYPE","compendiumEntry","compendiumMacro","compendiumPlaylist","macro","COMPENDIUM_PACK_TYPES","CSS_STYLE","foundryVTT","class","file","moduleId","name","primaryColor","secondaryColor","tertiaryColor","compact","dockedLeft","isDocked","dockPosition","dockedCenterRight","collapseIcon","expandIcon","dockedRight","foundryVttLight","pathfinder","highContrast","custom","CUSTOM_STYLE","backgroundColor","cssProperty","type","String","default","buttonHeight","Number","buttonBackgroundColor","buttonBorderPrimaryColor","buttonBorderSecondaryColor","buttonTextColor","buttonHoverBorderPrimaryColor","buttonHoverBorderSecondaryColor","buttonHoverBackgroundColor","buttonHoverTextColor","buttonToggleActiveBackgroundColor","buttonToggleActiveBorderPrimaryColor","buttonToggleActiveBorderSecondaryColor","buttonToggleActiveTextColor","buttonToggleHoverBackgroundColor","buttonToggleHoverBorderPrimaryColor","buttonToggleHoverBorderSecondaryColor","buttonToggleHoverTextColor","textPrimaryColor","textSecondaryColor","textTertiaryColor","textHoverPrimaryColor","textHoverSecondaryColor","textHoverTertiaryColor","GROUP_TYPE","COMPENDIUM","CUSTOM","SYSTEM","SYSTEM_DERIVED","HUD","DEFAULT_HEIGHT","DEFAULT_WIDTH","DEFAULT_LEFT_POS","DEFAULT_TOP_POS","DEFAULT_SCALE","DEFAULT_ZINDEX","ITEM_MACRO_ICON","ICON","TOOLTIP","LAYOUT_SETTING","customLayout","hint","inputType","filePickerType","dtype","scope","userCustomLayout","exportLayout","label","icon","resetLayout","resetAllLayouts","SETTING","activeCssAsText","classes","variable","allow","alwaysShowHud","clickOpenCategory","customStyle","debug","direction","displayCharacterName","displayIcons","drag","enable","enableCustomization","grid","itemMacro","migrationVersion","reset","renderItemOnRightClick","rollHandler","scale","sortActions","startup","style","tooltips","Logger$1","Logger","info","message","notify","ui","notifications","console","log","error","permanent","data","isDebug","game","tokenActionHud","debugSetting","Utils","getSetting","dataClone","deepClone","Timer","constructor","milliseconds","this","timer","start","abort","Promise","resolve","setTimeout","clearTimeout","checkAllow","userRole","allowSetting","capitalize","value","replace","text","charAt","toUpperCase","substring","toLowerCase","original","options","foundry","utils","getActor","actorId","tokenId","token","canvas","tokens","placeables","find","id","actor","actors","get","getClosestGroupElement","event","target","closest","getControlledActors","controlled","map","getStatusEffect","statusId","effects","effect","statuses","every","status","getImage","entity","defaultImages","push","result","displayIconsSetting","img","includes","getItem","itemId","items","getToken","getControlledTokens","getFirstControlledToken","controlledToken","character","user","key","defaultValue","setSetting","set","getActorFlag","getFlag","setActorFlag","setFlag","unsetActorFlag","unsetFlag","getUserFlag","setUserFlag","unsetUserFlag","i18n","toTranslate","localize","isGmActive","users","some","isGM","active","isModuleActive","module","modules","getModuleTitle","title","getModuleVersion","version","humanizeBinding","binding","keybindings","stringParts","modifiers","reduce","parts","part","KeyboardManager","MODIFIER_CODES","unshift","getKeycodeDisplayString","join","median","numbers","mid","Math","floor","length","nums","sort","a","b","getUpperQuartileAverage","sortedNumbers","slice","startIndex","ceil","endIndex","sum","count","i","upperQuartileAverage","getModifier","num","sign","sortItems","Map","entries","localeCompare","sortItemsByName","switchCSS","Object","href","stylesheet","values","document","styleSheets","ss","disabled","setting","querySelector","setProperty","tahElement","classList","remove","add","registerHandlebars","Handlebars","registerHelper","string","reduceOp","args","reducer","Array","from","pop","first","shift","tokenActionHudCoreTrue","arguments","block","activeCssAsTextSetting","fn","inverse","getModuleVersionParts","moduleVersion","trigger","moduleVersionParts","split","major","minor","patch","isSystemModuleCompatible","requiredCoreModuleVersion","requiredCoreModuleVersionParts","coreModuleVersionParts","requiredVersion","installedVersion","getNestedGroups","groups","order","groupId","groupType","isArray","foundGroups","level","nestId","assign","keys","getGroupByNestId","findGroup","async","groupStyle","foundGroup","deleteGroupByNestId","findAndDeleteGroup","index","splice","deleteGroupsById","DataHandler","socket","init","createDirectories","all","private","isPrivate","fileMap","getFilePathsAsGm","isPersistentStorage","isNewerVersion","ForgeVTT","DATA_FOLDER","moduleDirectory","directoriesToCreate","world","directory","FilePicker","browse","catch","createDirectory","path","getFileParts","filename","folder","hasPermission","files","getFilePaths","executeAsGM","getFilePathsWithSocket","dataHandler","actorFiles","userFiles","canSaveData","saveDataAsGm","saveData","saveDataWithSocket","fileName","encodeURI","File","JSON","stringify","response","upload","has","canGetData","getDataAsGm","getData","getDataWithSocket","foundFile","foundFolder","endsWith","ms","Date","now","fetch","ok","json","getDataMigrate","folderPath","foundFolderPath","foundFilePath","then","MigrationManager","isSuccess","unsetOldFlags","migrateFiles","filter","objects","children","scene","scenes","err","CharacterHandler","hudManager","groupHandler","actionHandler","previousActorId","setCharacter","isCharacter","isMultipleTokens","controlledTokens","isSameActor","resetCharacter","handleMultipleTokens","handleSingleToken","characterName","isValidCharacter","t","testUserPermission","LayoutHandler","systemManager","defaultLayout","setDefaultLayout","setCustomLayout","softReset","hardReset","defaults","layout","userId","saveDataToFile","getTooltip","tooltip","content","GroupHandler","layoutHandler","defaultGroups","actorGroups","userGroups","setDefaultGroups","setSavedActorGroups","setSavedUserGroups","defaultGroup","getUserGroups","savedUserData","prepareGroups","userGroup","createGroup","parentNestId","parentGroup","tabs","lists","getActorGroups","actorGroup","existingGroup","actions","getGroup","getGroups","selected","startsWith","getGroupIds","getGroupSettings","groupData","keepData","groupDataClone","nestIdParts","defaultSettings","showTitle","groupSettings","subtitleClass","groupSystem","system","commonProps","cssClass","info1","info2","info3","listName","isSelected","defaultSelected","updateGroups","groupsData","parentGroupData","childGroupData","existingGroups","existingParentGroup","saveGroupSettings","saveGroups","saveActor","saveUser","saveActorGroups","saveUserGroups","getReducedGroupData","keepActions","isPreset","userSelected","getSelectedGroupsAsTags","toTagify","getAvailableGroupAsTags","derivedGroups","getDerivedGroupsAsTags","systemGroups","getSystemGroupsAsTags","compendiumGroups","getCompendiumGroupsAsTags","macroGroups","getMacroGroupsAsTags","packs","pack","documentName","visible","metadata","addGroup","update","parentGroups","updateGroup","updateExistingGroups","removeGroup","addGroupInfo","groupInfo","forEach","setHasActions","hasActions","HudManager","getActionHandlerCore","getRollHandlerCore","characterHandler","isHudEnabled","buildHud","softResetHud","hardResetHud","previousActor","isGmInactiveUserNotified","prepareHud","buildActionsCore","prepareActions","handleHudEvent","eventType","getAction","registerKeyPresses","setIsHover","handleGroupClickCore","handleActionClickCore","handleActionHoverCore","setIsRightClick","setIsAlt","setIsCtrl","setIsShift","button","originalEvent","isRightClick","isModiferActive","keyboard","isModifierActive","MODIFIER_KEYS","ALT","altKey","emulateKeypress","force","downKeys","isAlt","CONTROL","ctrlKey","isCtrl","SHIFT","shiftKey","isShift","isHover","groupElement","dataset","actionButtonElement","actionId","availableActions","role","e","amd","exports","s","r","window","MutationObserver","WebKitMutationObserver","nodeType","observe","childList","subtree","addEventListener","parentElm","uid","selector","callbacks","setup","bind","bindEvents","prototype","namespace","childNodes","parentNode","removeChild","matches","draggable","gap","getItemsGap","firstElementChild","throttle","call","getDraggableElm","dragstart","saveInitialStyles","source","getInitialState","getBoundingClientRect","elm","idx","getNodeIndex","size","width","height","dataTransfer","effectAllowed","dragStart","afterDragStart","mode","dragover","preventDefault","stopPropagation","hoverDirection","dropEffect","getTargetDirection","directionAwareDragEnter","dragenter","isValidElm","bounding","cleanupLastTarget","abs","toggle","dragend","dragoverTimeout","cleanup","nextElementSibling","insertBefore","dragEnd","isTargetLastChild","lastElementChild","pageY","top","pageX","left","previousSibling","test","setAttribute","getAttribute","removeAttribute","getComputedStyle","parseInt","listeners","destroy","DragSort","n","Symbol","iterator","toString","TypeError","isEnabled","TAGIFY_DEBUG","apply","concat","warn","trim","o","indexOf","DOMParser","parseFromString","body","l","d","c","u","hasOwnProperty","hasInstance","g","next","done","h","p","return","normalize","navigator","userAgent","f","crypto","getRandomValues","Uint8Array","m","contains","classNames","tag","v","tagSelector","getSelection","getRangeAt","createTextNode","deleteContents","insertNode","w","__tagifyTagData","tagElm","y","rangeCount","setStartAfter","collapse","removeAllRanges","addRange","T","before","O","delimiters","pattern","tagTextProp","maxTags","addTagOnBlur","addTagOn","onChangeAfterBlur","duplicates","whitelist","blacklist","enforceWhitelist","userInput","focusable","keepInvalidTags","createInvalidTags","mixTagsAllowedAfter","mixTagsInterpolator","backspace","skipInvalid","pasteAsTags","editTags","clicks","keepInvalid","transformTag","a11y","focusableTags","mixMode","insertAfterTag","autoComplete","enabled","rightKey","tabKey","selectMode","input","focus","tagNoAnimation","tagInvalid","tagNotAllowed","scopeLoading","hasMaxTags","hasNoTags","empty","inputInvalid","dropdown","dropdownWrapper","dropdownHeader","dropdownFooter","dropdownItem","dropdownItemActive","dropdownItemHidden","dropdownItemSelected","dropdownInital","tagText","tagX","tagLoading","tagEditing","tagFlash","tagHide","classname","maxItems","searchKeys","fuzzySearch","caseSensitive","accentedSearch","includeSelectedTags","escapeHTML","highlightFirst","closeOnSelect","clearOnSelect","position","appendTarget","hooks","beforeRemoveTag","beforePaste","suggestionClick","beforeKeyDown","x","defineProperty","enumerable","configurable","writable","D","getOwnPropertySymbols","getOwnPropertyDescriptor","I","getOwnPropertyDescriptors","defineProperties","S","E","M","N","_dropdown","refs","DOM","__tagify","_","A","C","events","onKeyDown","onMouseOver","onMouseLeave","onClick","onScroll","state","hasFocus","composing","dropdownItemActiveSelector","getSuggestionDataByNode","tagify","getAllSuggestionsRefs","getNextOrPrevOption","dropdownItemSelector","highlightOption","hide","ArrowLeft","editing","getMappedValue","autocomplete","tagData","suggestionElm","selectOption","addTags","inputText","raw","charCodeAt","removeTags","editTag","scrollTop","scrollHeight","clientHeight","percentage","round","refilter","query","suggestedListItems","filterListItems","fill","findIndex","ddItemElm","ddItemData","suggest","offsetTop","normalizeTags","onEditTagDone","__isValid","toggleFocusClass","fillHeaderFooter","once","selectAll","suggestions","exact","isTagDuplicate","sortby","mapValueTo","createListHTML","templates","mappedValue","parseTemplate","getHeaderRef","getFooterRef","querySelectorAll","show","dropdownItemNoMatch","isLoading","readonly","dropdownHide__bindEventsTimeout","setStateSelection","render","removeEventListener","selection","flaggedTags","baseOffset","getAppendTarget","cloneNode","cssText","appendChild","dropdownContent","innerHTML","replaceChild","RTL","pageYOffset","fullscreenElement","webkitFullscreenElement","documentElement","max","clientWidth","innerWidth","startContainer","startOffset","createRange","setStart","setEnd","right","bottom","offsetLeft","placeAbove","pageXOffset","k","L","exceed","duplicate","notAllowed","j","wrapper","className","required","placeholder","getAttributes","P","V","F","R","H","B","W","K","U","customBinding","customEventsList","on","mainEvents","main","bindGlobal","isJQueryPlugin","jQuery","originalInput","removeAllTags","keydown","onKeydown","click","onClickScope","dblclick","onDoubleClickScope","paste","onPaste","drop","onDrop","compositionstart","onCompositionStart","compositionend","onCompositionEnd","inputMutationObserver","onInputDOMChange","disconnect","bindOriginaInputListener","clearInterval","originalInputValueObserverInterval","setInterval","observeOriginalInputValue","global","isIE","cb","onWindowKeyDown","onFocusBlur","onClickAnywhere","useCapture","unbindGlobal","textContent","relatedTarget","addNew","postUpdate","triggerChangeEvent","loading","getTagElms","activeElement","hasAttribute","anchorOffset","anchorNode","createElement","innerText","nodeValue","fromCharCode","previousElementSibling","Element","nodeName","min","nextSibling","blur","inputSuggestion","onInput","onMixTagsInput","inputElm","validateTag","toggleScopeValidation","isValid","search","createDocumentFragment","createTagElem","setRangeAtStartEnd","lastChild","withoutChangeEvent","cloneRange","focusNode","endOffset","match","lastIndexOf","prefix","matchedPatternCount","onInputIE","tagifyValue","loadOriginalValues","fixFirefoxLastTagNoCaret","clipboardData","pastedText","injectAtCaret","tagsElems","onEditTagInput","__tagId","editTagChangeDetected","originalIsValid","newValue","onEditTagPaste","onEditTagClick","onEditTagFocus","onEditTagBlur","__originalData","onEditTagkeydown","__originalHTML","editable","addedNodes","outerHTML","replaceWith","removedNodes","q","z","X","J","G","$","Proxy","removeAllCustomListeners","off","cloneData","triggerHandler","cloneEvent","HTMLElement","CustomEvent","detail","dispatchEvent","isFirefox","documentMode","getPersistedData","localStorage","parse","setPersistedData","setItem","Event","clearPersistedData","removeItem","applySettings","build","getCSSVars","autofocus","placeCaretAfterNode","getSetTagData","helpers","sameStr","removeCollectionProp","omit","isObject","parseHTML","extend","concatWithoutDups","getUID","isNodeTag","dataProps","setContentEditable","generateClassSelectors","RegExp","_delimiters","TEXTS","texts","getCustomAttributes","range","CSSVars","tagHideTransition","unit","getPropertyValue","integrated","originalInput_tabIndex","tabIndex","inputSelector","blockChangeEvent","parseMixTags","tagName","insertAdjacentHTML","lastOriginalValueReported","toggleClass","setPlaceholder","bubbles","simulated","_valueTracker","setValue","random","getTagTextNode","tagTextSelector","setTagTextNode","getLastTag","skipValidation","editTagToggleValidity","removeTagsFromValue","previousData","replaceTag","reCheckInvalidTags","getInvalidTagAttrs","updateValueByDOMTags","appendMixTags","validate","substr","replaceTextWithNode","getTagIdx","getTagIndexByValue","getTagElmByValue","flashTag","isTagBlacklisted","isTagWhitelisted","getWhitelistItem","setReadonly","contentEditable","setDisabled","Error","splitText","prepareNewTagNode","__preInvalidData","aggregatedInvalidInput","postProcessNewTagNode","selectTag","appendTag","addEmptyTag","addMixTags","prefixedTextToTag","createNodeIterator","NodeFilter","SHOW_TEXT","nextNode","node","__removed","parseFloat","clientTop","removeTagsFromDOM","setOriginalInputValue","debouncedUpdateTimeout","getInputValue","getCleanValue","getMixedTagsAsString","originalInputValueFormat","removeTag","ApplicationV2","HandlebarsApplicationMixin","applications","api","TagifyApp","super","dragSort","submit","categoryId","subcategoryId","static","resetActions","unselectAllTags","form","closeOnSubmit","handler","minimizable","resizable","_prepareContext","open","dialogType","tags","dialogData","dialogSubmit","prepareHook","dialog","TagifyAppHud","TagifyAppGroup","TagifyAppSubgroup","Hooks","app","html","tagInput","Infinity","onDragEnd","available","Tagify","tagifyInput","dropdownLabelElement","DialogV2","confirm","modal","yes","callback","resetActorData","no","_onKeyDown","close","defaultChoice","buttons","formData","slugify","replacement","strict","object","template","TagifyAppHelper","openEditHudApp","topLabel","choices","callAll","openEditGroupApp","choice","characterCount","customWidth","image","openEditSubgroupApp","getAvailableActionsAsTags","availableGroups","selectedActions","getSelectedActionsAsTags","selectedGroups","_style","updateActions","GroupResizer","minCols","isCustomWidth","spacing","resizeGroup","setVariables","subgroupsElement","setWidth","setHeight","resetVariables","setSubgroupsElement","resetGroupsElements","setSubgroupElementArr","actionsElements","availableHeight","availableWidth","gridWidth","subgroupElementArr","subgroupsElementPadding","subgroupsElementRect","level1GroupElement","groupsElements","maxHeight","overflowY","resetCSS","getGridWidth","emptyStyle","display","gridTemplateColumns","actionWidths","actionWidthsForMedian","actionsElement","actionElements","actionElement","actionRect","actionWidth","actionButtonText","actionButtonTextRect","actionButtonTextWidth","minActionButtonTextWidth","availableactionButtonTextWidth","resizeGrid","groupCustomWidth","assignCSS","squaredCols","sqrt","availableGroupWidth","availableCols","cols","resize","sqrtActions","currentRow","maxRowWidth","rowWidth","maxWidth","getAvailableWidth","windowWidth","screenDimensions","contentLeft","uiRight","uiRightClientWidth","subgroupsElementComputed","paddingLeft","paddingRight","hasGrid","subgroupElement","requestAnimationFrame","getAvailableHeight","windowHeight","innerHeight","contentBottom","contentTop","siblingsHeight","sibling","siblings","siblingHeight","uiTopBottom","uiTopBottomOffsetHeight","offsetHeight","element","elements","TokenActionHud","groupResizer","openGroups","Set","updatePendingTimer","updateTimer","closeTimer","renderTimer","clickGroup","clickSubgroup","clickAction","collapseHud","expandHud","lockHud","unlockHud","editHud","background","zIndex","frame","styleData","styles","context","collapsibleSubgroups","cacheSettings","updateCachedSettings","updateSettingsPending","setPosition","_onRender","cacheElements","setInitialHudState","addHoverEvents","actionArr","tabSubgroupArr","editHudButton","listSubgroupsArr","subgroupsContainerArr","subgroupArr","listSubgroupTitleArr","groupButtonArr","collapseExpandContainer","collapseHudButton","expandHudButton","unlockButton","lockButton","isCollapsed","isUnlocked","toggleGroup","passive","dragEvent","handleActionHover","postRender","rendering","applyDirection","reopenGroups","toggleHudEnable","format","toggleHudCollapse","isCollapsing","toggleHudLock","isUnlocking","toggleElements","hideIfEmpty","bringToFront","currentTarget","handleGroupClick","collapseExpandSubgroup","isOpen","shouldOpen","toggleOtherGroups","delete","groupToIgnore","isParentToIgnore","groupsElement","imageElement","toggleGroupVisibility","parsedLevel","isDraggable","clientX","changedTouches","clientY","pos1","pos2","pos3","pos4","originalElementTop","originalElementLeft","newElementTop","newElementLeft","mouseMoveEvent","topPos","mouseUpEvent","onmousemove","ontouchmove","onmouseup","ontouchend","hudPosition","setDockedPosition","setUndockedPosition","interfaceElement","styleSetting","rightUiElement","leftUiElement","setPositionFromFlag","check","leftPos","obj","bool","resetPosition","copy","fromUserId","toUserIds","copyUserData","fromGroup","resetLayoutWithSocket","resetUserAndActorData","resetAllActorData","resetUserData","resetAllUserData","handleUpdate","performUpdate","isUpdatePending","waitForUpdateCompletion","maxWaitTime","interval","iterations","isUpdating","hasCompleted","initialised","windows","appId","abortUpdate","closeHud","animate","isValidTokenChange","flags","isRelevantToken","isControlledActor","isValidActorOrItemUpdate","registerSocket","socketlib","registerModule","register","isSocketlibActive","getSocket","GenericActionHandler","buildActions","buildUtilities","buildSingleTokenUtilities","buildMultipleTokenUtilities","actionsData","toggleCombatId","toggleCombatName","inCombat","toggleCombatAction","toggleCombatant","toggleVisibilityId","toggleVisibilityName","hidden","toggleVisibilityAction","isHidden","addActions","toggleVisibilityname","CompendiumActionHandler","compendiumActions","packIds","packId","setActions","getIndex","actionType","getCompendiumActionType","entry","_id","function","getOnClick","getGroupId","documentId","getOnClickFunction","getOnClickEntry","journalEntry","getDocument","sheet","execute","isLinkedCompendium","MacroActionHandler","macroActions","getActions","macros","getListName","ownership","actionTypeName","ActionHandler","genericActionHandler","compendiumActionHandler","macroActionHandler","delimiter","actionHandlerExtenders","buildSystemActionsCore","buildGenericActionsCore","buildCompendiumActionsCore","buildMacroActionsCore","buildExtendedActionsCore","updateNonPresetActions","setCharacterLimit","groupIds","buildSystemActions","extender","extendActionHandler","nonPresetActions","nonPresetAction","availableAction","systemSelected","createAction","groupCharacterCount","subgroups","subgroup","subgroupCharacterCount","word","actionData","fullName","infoProps","onHover","encodedValue","icons","icon1","icon2","icon3","isAction","isItem","useRawHtmlName","addToAvailableActions","existingActions","reorderedActions","existingAction","existingActionId","actionClone","addActionHandlerExtender","actionHandlerExtender","ActionHandlerExtender","RollHandler","preRollHandlers","rollHandlerExtenders","throwInvalidValueErr","addRollHandlerExtender","rollHandlerExtender","buttonValue","getButtonValue","prehandleActionEvent","handleActionClick","addPreRollHandler","buttonElement","renderItem","item","isRenderItem","PreRollHandler","RollHandlerExtender","CustomStyleForm","ColorPicker","install","isCustom","resetLayoutDialog","customLayoutElement","userCustomLayoutElement","resetAllLayoutsDialog","executeForEveryone","TahSettingsForm","settingType","Function","isButton","isCheckbox","isFilePicker","isNumber","isRange","isSelect","undefined","TahSettingsFormLayout","onChangeFunction","onDown","registerSettingsCore","rollHandlers","registerMenu","restricted","config","Boolean","styleChoices","fromEntries","onChange","auto","up","down","step","always","whenUnlocked","never","requiresReload","full","nameOnly","none","setTooltipDelay","tooltipDelay","root","both","registerCustomStyleSettings","registerSettings","ItemMacroActionHandlerExtender","itemacro","command","itemMacroSetting","replaceExisting","addGroupActions","existingItemMacroAction","actionToReplace","macroAction","createItemMacroAction","itemMacroIcon","executeMacro","SystemManager","coreModuleId","getActionHandler","getRollHandler","rollHandlerId","getAvailableRollHandlers","registerDefaults","registerStyles","registerDefaultsCore","registerStylesCore","systemStyles","mergeObject","addActionHandlerExtenders","addRollHandlerExtenders","addHandler","registerApi","registerCoreModule","systemModule","loadTemplates","registerHud","migrationManager","checkColorPicker","registerHudHooks","hook","handleHookEvent","hookData","hookName","validateHookData","parent","validateCompendium","hasOwn","compendiumHandler","addContextMenuListener","sendHudToBottom"],"mappings":"AAGO,MAAMA,EAAS,CACpBC,GAAI,wBACJC,KAAM,oBASFC,EAAe,WAAWH,EAAOC,eAO1BG,EAAW,CACtBC,OAAQ,GAAGF,eACXG,gBAAiB,GAAGH,0BACpBI,MAAO,GAAGJ,cACVK,IAAK,GAAGL,YACRM,aAAc,GAAGN,sBACjBO,SAAU,GAAGP,iBACbQ,YAAa,GAAGR,qBAChBS,aAAc,GAAGT,uBACjBU,eAAgB,GAAGV,yBACnBW,kBAAmB,GAAGX,6BAQXY,EAAY,IAOZC,EAAc,CACzBC,gBAAiB,iCACjBC,gBAAiB,iCACjBC,mBAAoB,oCACpBC,MAAO,wBAeIC,EAAwB,CAAC,eAAgB,QAAS,aAOlDC,EAAY,CACvBC,WAAY,CACVC,MAAO,6BACPC,KAAM,uBACNC,SAAU1B,EAAOC,GACjB0B,KAAM,mBACNC,aAAc,UACdC,eAAgB,YAChBC,cAAe,WAEjBC,QAAS,CACPP,MAAO,wBACPC,KAAM,+BACNC,SAAU1B,EAAOC,GACjB0B,KAAM,2BACNC,aAAc,UACdC,eAAgB,YAChBC,cAAe,WAEjBE,WAAY,CACVR,MAAO,wBACPC,KAAM,kBACNC,SAAU1B,EAAOC,GACjB0B,KAAM,+BACNC,aAAc,UACdC,eAAgB,YAChBC,cAAe,UACfG,UAAU,EACVC,aAAc,QAEhBC,kBAAmB,CACjBX,MAAO,yBACPC,KAAM,mBACNC,SAAU1B,EAAOC,GACjB0B,KAAM,uCACNC,aAAc,UACdC,eAAgB,YAChBC,cAAe,UACfM,aAAc,iBACdC,WAAY,gBACZJ,UAAU,EACVC,aAAc,gBAEhBI,YAAa,CACXd,MAAO,yBACPC,KAAM,mBACNC,SAAU1B,EAAOC,GACjB0B,KAAM,gCACNC,aAAc,UACdC,eAAgB,YAChBC,cAAe,UACfM,aAAc,iBACdC,WAAY,gBACZJ,UAAU,EACVC,aAAc,SAEhBK,gBAAiB,CACff,MAAO,8BACPC,KAAM,wBACNC,SAAU1B,EAAOC,GACjB0B,KAAM,oBACNC,aAAc,UACdC,eAAgB,YAChBC,cAAe,WAEjBU,WAAY,CACVhB,MAAO,uBACPC,KAAM,iBACNC,SAAU1B,EAAOC,GACjB0B,KAAM,cAERc,aAAc,CACZjB,MAAO,0BACPC,KAAM,oBACNC,SAAU1B,EAAOC,GACjB0B,KAAM,gBACNC,aAAc,UACdC,eAAgB,UAChBC,cAAe,WAEjBY,OAAQ,CACNlB,MAAO,mBACPC,KAAM,aACNC,SAAU1B,EAAOC,GACjB0B,KAAM,WASGgB,EAAe,CAC1BC,gBAAiB,CAAEC,YAAa,yBAA0BC,KAAMC,OAAQC,QAAS,aACjFC,aAAc,CAAEJ,YAAa,+BAAgCC,KAAMI,OAAQF,QAAS,IACpFG,sBAAuB,CAAEN,YAAa,yCAA0CC,KAAMC,OAAQC,QAAS,aACvGI,yBAA0B,CAAEP,YAAa,6CAA8CC,KAAMC,OAAQC,QAAS,aAC9GK,2BAA4B,CAAER,YAAa,+CAAgDC,KAAMC,OAAQC,QAAS,aAClHM,gBAAiB,CAAET,YAAa,mCAAoCC,KAAMC,OAAQC,QAAS,aAC3FO,8BAA+B,CAAEV,YAAa,mDAAoDC,KAAMC,OAAQC,QAAS,aACzHQ,gCAAiC,CAAEX,YAAa,qDAAsDC,KAAMC,OAAQC,QAAS,aAC7HS,2BAA4B,CAAEZ,YAAa,+CAAgDC,KAAMC,OAAQC,QAAS,aAClHU,qBAAsB,CAAEb,YAAa,yCAA0CC,KAAMC,OAAQC,QAAS,aACtGW,kCAAmC,CAAEd,YAAa,uDAAwDC,KAAMC,OAAQC,QAAS,aACjIY,qCAAsC,CAAEf,YAAa,2DAA4DC,KAAMC,OAAQC,QAAS,aACxIa,uCAAwC,CAAEhB,YAAa,6DAA8DC,KAAMC,OAAQC,QAAS,aAC5Ic,4BAA6B,CAAEjB,YAAa,iDAAkDC,KAAMC,OAAQC,QAAS,aACrHe,iCAAkC,CAAElB,YAAa,sDAAuDC,KAAMC,OAAQC,QAAS,aAC/HgB,oCAAqC,CAAEnB,YAAa,0DAA2DC,KAAMC,OAAQC,QAAS,aACtIiB,sCAAuC,CAAEpB,YAAa,qDAAsDC,KAAMC,OAAQC,QAAS,aACnIkB,2BAA4B,CAAErB,YAAa,gDAAiDC,KAAMC,OAAQC,QAAS,aACnHmB,iBAAkB,CAAEtB,YAAa,oCAAqCC,KAAMC,OAAQC,QAAS,aAC7FoB,mBAAoB,CAAEvB,YAAa,sCAAuCC,KAAMC,OAAQC,QAAS,aACjGqB,kBAAmB,CAAExB,YAAa,qCAAsCC,KAAMC,OAAQC,QAAS,aAC/FsB,sBAAuB,CAAEzB,YAAa,0CAA2CC,KAAMC,OAAQC,QAAS,aACxGuB,wBAAyB,CAAE1B,YAAa,4CAA6CC,KAAMC,OAAQC,QAAS,aAC5GwB,uBAAwB,CAAE3B,YAAa,qCAAsCC,KAAMC,OAAQC,QAAS,cAQzFyB,EAAa,CACxBC,WAAY,aACZC,OAAQ,SACRC,OAAQ,SACRC,eAAgB,kBAQLC,EAAM,CACjBC,eAAgB,IAChBC,cAAe,GACfC,iBAAkB,IAClBC,gBAAiB,GACjBC,cAAe,EACfC,eAAgB,KAQLC,EAAkB,CAC7BC,KAAM,iBACNC,QAAS,cAQEC,EAAiB,CAC5BC,aAAc,CACZC,KAAM,4CACN/D,KAAM,4CACNgE,UAAW,aACXC,eAAgB,OAChBC,MAAO,SACPC,MAAO,SAETC,iBAAkB,CAChBL,KAAM,gDACN/D,KAAM,gDACNgE,UAAW,aACXC,eAAgB,OAChBC,MAAO,SACPC,MAAO,QAETE,aAAc,CACZN,KAAM,4CACNO,MAAO,6CACPtE,KAAM,4CACNgE,UAAW,SACXO,KAAM,0BACN7F,OAAQ,gBAEV8F,YAAa,CACXT,KAAM,2CACNO,MAAO,4CACPtE,KAAM,2CACNgE,UAAW,SACXO,KAAM,gCACN7F,OAAQ,cACRyF,MAAO,UAETM,gBAAiB,CACfV,KAAM,+CACNO,MAAO,gDACPtE,KAAM,+CACNgE,UAAW,SACXO,KAAM,mBACN7F,OAAQ,kBACRyF,MAAO,UASEO,GAAU,CACrBC,gBAAiB,CAAEC,QAAS,CAAC,kBAAmBC,SAAU,0BAC1DC,MAAO,CAAEF,QAAS,CAAC,kBAAmBC,SAAU,gBAChDE,cAAe,CAAEH,QAAS,CAAC,kBAAmBC,SAAU,wBACxD5D,gBAAiB,CAAE,EACnBO,sBAAuB,CAAE,EACzBC,yBAA0B,CAAE,EAC5BC,2BAA4B,CAAE,EAC9BJ,aAAc,CAAE,EAChBM,8BAA+B,CAAE,EACjCC,gCAAiC,CAAE,EACnCC,2BAA4B,CAAE,EAC9BC,qBAAsB,CAAE,EACxBJ,gBAAiB,CAAE,EACnBK,kCAAmC,CAAE,EACrCC,qCAAsC,CAAE,EACxCC,uCAAwC,CAAE,EAC1CC,4BAA6B,CAAE,EAC/BC,iCAAkC,CAAE,EACpCC,oCAAqC,CAAE,EACvCC,sCAAuC,CAAE,EACzCC,2BAA4B,CAAE,EAC9ByC,kBAAmB,CAAEJ,QAAS,CAAC,kBAAmBC,SAAU,4BAC5Df,aAAc,CAAEc,QAAS,CAAC,iBAAkBC,SAAU,uBACtDI,YAAa,CAAE,EACfC,MAAO,CAAEN,QAAS,CAAC,kBAAmBC,SAAU,gBAChDM,UAAW,CAAEP,QAAS,CAAC,kBAAmBC,SAAU,oBACpDO,qBAAsB,CAAER,QAAS,CAAC,kBAAmBC,SAAU,wBAC/DQ,aAAc,CAAET,QAAS,CAAC,kBAAmBC,SAAU,uBACvDS,KAAM,CAAEV,QAAS,CAAC,kBAAmBC,SAAU,eAC/CU,OAAQ,CAAEX,QAAS,CAAC,kBAAmBC,SAAU,iBACjDW,oBAAqB,CAAEZ,QAAS,CAAC,gBAAiB,kBAAmBC,SAAU,8BAC/EY,KAAM,CAAEb,QAAS,CAAC,kBAAmBC,SAAU,eAC/Ca,UAAW,CAAE,EACbC,iBAAkB,CAAE,EACpBC,MAAO,CAAE,EACTC,uBAAwB,CAAE,EAC1BC,YAAa,CAAEzE,QAAS,QACxB0E,MAAO,CAAEnB,QAAS,CAAC,kBAAmBC,SAAU,gBAChDmB,YAAa,CAAEpB,QAAS,CAAC,iBAAkBC,SAAU,sBACrDoB,QAAS,CAAE,EACXC,MAAO,CAAEtB,QAAS,CAAC,kBAAmBC,SAAU,gBAChDsB,SAAU,CAAEvB,QAAS,CAAC,iBAAkBC,SAAU,mBAClDrC,iBAAkB,CAAE,EACpBC,mBAAoB,CAAE,EACtBC,kBAAmB,CAAE,EACrBC,sBAAuB,CAAE,EACzBC,wBAAyB,CAAE,EAC3BC,uBAAwB,CAAE,EAC1BuB,iBAAkB,CAAEQ,QAAS,CAAC,iBAAkBC,SAAU,yBCvUrD,IAAAuB,GAAA,MAAMC,OAMX,WAAOC,CAAKC,EAASC,GAAS,GACxBA,EAAQC,GAAGC,cAAcJ,KAAK,sBAAsBC,KACnDI,QAAQC,IAAI,2BAA2BL,IAC7C,CASD,YAAOM,CAAMN,EAASC,GAAS,GACzBA,EAAQC,GAAGC,cAAcG,MAAM,sBAAsBN,IAAW,CAAEO,WAAW,IAC5EH,QAAQE,MAAM,4BAA4BN,IAChD,CASD,YAAOrB,CAAMqB,EAASQ,EAAO,MAC3B,MAAMC,EAAWC,KAAmB,eAAIA,KAAKC,eAAeC,aAAeC,MAAMC,WAAW,SAC5F,GAAIL,EAAS,CACX,IAAKD,EAEH,YADAJ,QAAQC,IAAI,4BAA4BL,KAG1C,MAAMe,EAAYF,MAAMG,UAAUR,GAClCJ,QAAQC,IAAI,4BAA4BL,IAAWe,EACpD,CACF,GAQI,MAAME,MACX,WAAAC,CAAYC,GACVC,KAAKD,aAAeA,EACpBC,KAAKC,MAAQ,IACd,CAED,WAAMC,GAEJ,OADIF,KAAKC,OAAOD,KAAKG,QACd,IAAIC,SAAQC,IACjBL,KAAKC,MAAQK,YAAW,KAAQD,GAAS,GAAKL,KAAKD,cAAgB,IAAI,GAE1E,CAED,WAAMI,GACJI,aAAaP,KAAKC,OAClBD,KAAKC,MAAQ,IACd,EAQI,MAAMR,MAQX,iBAAOe,CAAWC,EAAUC,GAC1B,OAAOD,GAAYC,CACpB,CASD,iBAAOC,CAAWC,GAChB,OAAOA,EAAMC,QACX,UACAC,GAAQA,EAAKC,OAAO,GAAGC,cAAgBF,EAAKG,UAAU,GAAGC,eAE5D,CAWD,gBAAOtB,CAAUuB,EAAUC,GAEzB,OAAOC,QAAQC,MAAM1B,UAAUuB,EAAUC,EAC1C,CAWD,eAAOG,CAASC,EAASC,GACvB,IAAIC,EAAQ,KAEZ,OADID,IAASC,EAAQC,OAAOC,OAAOC,WAAWC,MAAKJ,GAASA,EAAMK,KAAON,KACrEC,EAAcA,EAAMM,MACjB1C,KAAK2C,OAAOC,IAAIV,EACxB,CAOD,6BAAOW,CAAuBC,GAC5B,OAAKA,EACEA,EAAMC,OAAOC,QAAQ,2BAA+BF,EAAMC,OAAOC,QAAQ,uBAD7D,IAEpB,CASD,0BAAOC,GACL,MAAMX,EAAStC,KAAKqC,OAAOC,QAAQY,YAAc,GACjD,OAAOZ,EAAOa,KAAIf,GAASA,EAAMM,OAClC,CAUD,sBAAOU,CAAgBV,EAAOW,GAC5B,OAAOX,EAAMY,QAAQd,MAAKe,GAAUA,EAAOC,SAASC,OAAMC,GAAUA,IAAWL,KAChF,CAWD,eAAOM,CAASC,EAAQC,EAAgB,IACtCA,EAAcC,KAAK,6BACnB,IAAIC,EAAS,GAMb,OALI/D,KAAKC,eAAe+D,sBACtBD,EAA4B,iBAAXH,EACbA,EACAA,GAAQK,KAAOL,GAAQtG,MAAQ,IAE7BuG,EAAcK,SAASH,GAAmB,GAATA,CAC1C,CAWD,cAAOI,CAAQzB,EAAO0B,GACpB,OAAO1B,EAAM2B,MAAMzB,IAAIwB,EACxB,CAUD,eAAOE,CAASnC,GACd,OAAOE,OAAOC,OAAOC,WAAWC,MAAKJ,GAASA,EAAMK,KAAON,GAC5D,CASD,0BAAOoC,GACL,OAAOvE,KAAKqC,OAAOC,QAAQY,YAAc,EAC1C,CASD,8BAAOsB,GACL,MAAMC,EAAkBzE,KAAKqC,OAAOC,OAAOY,WAAW,GACtD,GAAIuB,EACF,OAAOA,EAGT,MAAMC,EAAY1E,KAAK2E,MAAMD,UAC7B,OAAIA,EACKrC,OAAOC,OAAOC,WAAWC,MAAKJ,GAASA,EAAMM,OAAOD,KAAOiC,EAAUjC,KAGvE,IACR,CAWD,iBAAOrC,CAAWwE,EAAKC,EAAe,MACpC,IAAIvD,EAAQuD,GAAgB,KAC5B,IACEvD,EAAQtB,KAAKlI,SAAS8K,IAAIxL,EAAOC,GAAIuN,EAC3C,CAAM,MACAxF,GAAOnB,MAAM,YAAY2G,eAC1B,CACD,OAAOtD,CACR,CAUD,uBAAawD,CAAWF,EAAKtD,GACvBtB,KAAKlI,SAASA,SAAS8K,IAAI,GAAGxL,EAAOC,MAAMuN,YACvC5E,KAAKlI,SAASiN,IAAI3N,EAAOC,GAAIuN,EAAKtD,GACxClC,GAAOnB,MAAM,YAAY2G,cAAgBtD,OACxB,UAARsD,GACTxF,GAAOnB,MAAM,YAAY2G,eAE5B,CAUD,mBAAOI,CAAaJ,GAClB,OAAO5E,KAAKC,eAAeyC,MAAMuC,QAAQ7N,EAAOC,GAAIuN,EACrD,CAUD,yBAAaM,CAAaN,EAAKtD,SACvBtB,KAAKC,eAAeyC,MAAMyC,QAAQ/N,EAAOC,GAAIuN,EAAKtD,EACzD,CASD,2BAAa8D,CAAeR,SACpB5E,KAAKC,eAAeyC,MAAM2C,UAAUjO,EAAOC,GAAIuN,EACtD,CAUD,kBAAOU,CAAYV,GACjB,OAAO5E,KAAK2E,KAAKM,QAAQ7N,EAAOC,GAAIuN,EACrC,CAUD,wBAAaW,CAAYX,EAAKtD,SACtBtB,KAAK2E,KAAKQ,QAAQ/N,EAAOC,GAAIuN,EAAKtD,EACzC,CASD,0BAAakE,CAAcZ,SACnB5E,KAAK2E,KAAKU,UAAUjO,EAAOC,GAAIuN,EACtC,CAUD,WAAOa,CAAKC,GACV,OAAO1F,KAAKyF,KAAKE,SAASD,EAC3B,CASD,iBAAOE,GACL,OAAO5F,KAAK6F,MAAMC,MAAKnB,GAAQA,EAAKoB,MAAQpB,EAAKqB,QAClD,CAUD,qBAAOC,CAAenN,GACpB,MAAMoN,EAASlG,KAAKmG,QAAQvD,IAAI9J,GAChC,OAAOoN,GAAUA,EAAOF,MACzB,CAUD,qBAAOI,CAAetN,GACpB,OAAOkH,KAAKmG,QAAQvD,IAAI9J,IAAWuN,OAAS,EAC7C,CAUD,uBAAOC,CAAiBxN,GACtB,OAAOkH,KAAKmG,QAAQvD,IAAI9J,IAAWyN,SAAW,EAC/C,CASD,sBAAOC,CAAgB5B,GACrB,MAAM6B,EAAUzG,KAAK0G,YAAY9D,IAAIxL,EAAOC,GAAIuN,GAChD,IAAK6B,EAAS,MAAO,GACrB,MAAME,EAAcF,EAAQ,GAAGG,UAAUC,QAAO,CAACC,EAAOC,KAClDC,gBAAgBC,eAAeF,IAAO7C,SAASuC,EAAQ,GAAG7B,MAC9DkC,EAAMI,QAAQF,gBAAgBG,wBAAwBJ,IADqBD,IAG1E,CAACE,gBAAgBG,wBAAwBV,EAAQ,GAAG7B,OACvD,OAAO+B,EAAYS,KAAK,MACzB,CAUD,aAAOC,CAAOC,GACZ,MAAMC,EAAMC,KAAKC,MAAMH,EAAQI,OAAS,GAClCC,EAAO,IAAIL,GAASM,MAAK,CAACC,EAAGC,IAAMD,EAAIC,IAC7C,OAAOR,EAAQI,OAAS,GAAM,EAAIC,EAAKJ,IAAQI,EAAKJ,EAAM,GAAKI,EAAKJ,IAAQ,CAC7E,CASD,8BAAOQ,CAAwBT,GAC7B,MAAMU,EAAgBV,EAAQW,QAAQL,MAAK,CAACC,EAAGC,IAAMD,EAAIC,IACnDJ,EAASM,EAAcN,OACvBQ,EAAaV,KAAKW,KAAc,IAATT,GACvBU,EAAWV,EAAS,EAE1B,IAAIW,EAAM,EACNC,EAAQ,EAEZ,IAAK,IAAIC,EAAIL,EAAYK,GAAKH,EAAUG,IACtCF,GAAOL,EAAcO,GACrBD,IAGF,MAAME,EAAuBH,EAAMC,EAEnC,OAAOE,CACR,CASD,kBAAOC,CAAYC,GACjB,IAAKA,GAAe,IAARA,EAAW,MAAO,GAC9B,MAAMC,EAAQD,GAAO,EAAK,IAAM,GAChC,MAAO,GAAGC,IAAOD,GAClB,CAUD,gBAAOE,CAAUvE,GACf,OAAO,IAAIwE,IAAI,IAAIxE,EAAMyE,WAAWlB,MAAK,CAACC,EAAGC,IAAMD,EAAE,GAAGD,KAAKmB,cAAcjB,EAAE,GAAGF,QACjF,CAUD,sBAAOoB,CAAgB3E,GACrB,OAAO,IAAIwE,IAAI,IAAIxE,EAAMyE,WAAWlB,MAAK,CAACC,EAAGC,IAAMD,EAAE,GAAG9O,KAAKgQ,cAAcjB,EAAE,GAAG/O,QACjF,CASD,gBAAOkQ,CAAUhK,GACf,MAAMpG,KAAEA,EAAIC,SAAEA,GAAaJ,EAAUuG,GAErC,IAAK,MAAO2F,EAAKtD,KAAU4H,OAAOJ,QAAQpQ,GAAY,CACpD,MAAMyQ,EAAO,CAAC,WAAW7H,EAAMxI,YAAa,GAAGwI,EAAMzI,QAC/CuQ,EAAaF,OAAOG,OAAOC,SAASC,aAAa/G,MACrDgH,GAAMA,EAAGL,MAAMjF,SAASiF,EAAK,KAAOK,EAAGL,MAAMjF,SAASiF,EAAK,MAGzDvE,IAAQ3F,EACVmK,EAAWK,UAAW,EACb3Q,IAAawI,EAAMxI,UAAYD,IAASyI,EAAMzI,OACvDuQ,EAAWK,UAAW,EAEzB,CAED,GAAc,WAAVxK,EACF,IAAK,MAAO2F,EAAKtD,KAAU4H,OAAOJ,QAAQ/O,GAAe,CACvD,MAAM2P,EAAUvJ,MAAMC,WAAWwE,GAC7B8E,GACFJ,SAASK,cAAc,SAAS1K,MAAM2K,YAAYtI,EAAMrH,YAAayP,EAExE,CAGH,MAAMG,EAAaP,SAASK,cAAc,qBACtCE,IACFA,EAAWC,UAAUC,UAAUF,EAAWC,WAC1CD,EAAWC,UAAUE,IAAItR,EAAUuG,GAAOrG,OAE7C,CAQD,yBAAOqR,GAELC,WAAWC,eAAe,yBAAyB,SAASC,GAC1D,OAAKA,GAAUA,EAAO1C,OAAS,EAAU,GAClC0C,EAAO,GAAG1I,cAAgB0I,EAAOnC,MAAM,EACpD,IACI,MAAMoC,SAAW,SAASC,EAAMC,GAC9BD,EAAOE,MAAMC,KAAKH,GAClBA,EAAKI,MACL,MAAMC,EAAQL,EAAKM,QACnB,OAAON,EAAKzD,OAAO0D,EAASI,EAClC,EAGIT,WAAWC,eAAe,CACxBU,uBAAwB,WAAa,OAAOR,SAASS,WAAWjD,GAAKA,GAAK,IAI5EqC,WAAWC,eAAe,gCAAgC,SAASY,GACjE,OAAI/K,KAAKC,eAAe+K,uBACfD,EAAME,GAAGvK,MAEXqK,EAAMG,QAAQxK,KAC3B,GACG,CAUD,4BAAOyK,CAAsBC,GAC3B,IAAKA,EAEH,OADAhM,GAAOnB,MAAM,+BAAgC,CAAEoN,QAAS,0BACjD,KAET,MAAMC,EAAqBF,EAAcG,MAAM,KAC/C,MAAO,CACLC,MAAOF,EAAmB,GAC1BG,MAAOH,EAAmB,GAC1BI,MAAOJ,EAAmB,GAE7B,CAUD,+BAAOK,CAAyBC,GAC9B,IAAKA,EAA2B,OAAO,EAGvC,MAAMC,EAAiCnL,KAAKyK,sBAAsBS,GAC5DE,EAAyBpL,KAAKyK,sBAAsBnL,KAAKmG,QAAQvD,IAAIxL,EAAOC,IAAIkP,SAEtF,GAAIuF,EAAuBN,QAAUK,EAA+BL,OAC/DM,EAAuBL,QAAUI,EAA+BJ,OAC/DI,EAA+BH,OAASI,EAAuBJ,QAAUG,EAA+BH,MAC5G,CACA,MAAMK,EAAkB,GAAGF,EAA+BL,SAASK,EAA+BJ,SAASI,EAA+BH,OAAS,MAC7IM,EAAmBhM,KAAKmG,QAAQvD,IAAIxL,EAAOC,IAAIkP,QAKrD,OAJA/G,GAAGC,cAAcG,MACf,8FAA8FmM,kBAAgCC,gEAA+ED,sJAC7M,CAAElM,WAAW,KAER,CACR,CACD,OAAO,CACR,CAWD,sBAAOoM,CAAgBC,EAAQpM,EAAO,IACpC,IAAIqM,EAAQ,EACZ,IAAKD,EAAQ,OAAO,KACpB,MAAME,EAAUtM,GAAM2C,GAChB4J,EAAYvM,GAAM5F,KACxBgS,EAAU1B,MAAM8B,QAAQJ,GAAWA,EAAShD,OAAOG,OAAO6C,GAC1D,MAAMK,EAAc,CAAA,EACpB,IAAK,MAAM5U,KAASuU,EAAQ,CAC1B,KAAME,GAAWzU,EAAM8K,KAAO2J,GAAcC,GAAa1U,EAAMuC,OAASmS,GAAY,CAClFF,IACA,MAAMK,EAAQ7U,EAAM8U,OAAOlB,MAAM,KAAK7D,OACtC6E,EAAY5U,EAAM8U,QAAU,IAAK9U,EAAOwU,QAAOK,QAChD,CACD,GAAI7U,EAAMuU,QAAQxE,OAAS,EAAG,CAC5B,MAAMwE,EAASxL,KAAKuL,gBAAgBtU,EAAMuU,OAAQpM,GAC9CoM,GAAQhD,OAAOwD,OAAOH,EAAaL,EACxC,CACF,CACD,OAAQhD,OAAOyD,KAAKJ,GAAa7E,OAAS,EAAK6E,EAAc,IAC9D,CAWD,6BAAaK,CAAiBV,EAAQpM,EAAO,IAC3C,MAAM2M,EAA0B,iBAAT3M,EAAoBA,EAAOA,GAAM2M,OAClDJ,EAAYvM,GAAM5F,KACxB,IAAKuS,EAAQ,OAAO,KAEpB,MAAM3F,EAAQ2F,EAAOlB,MAAM,KAC3B,aAAasB,UAAUX,EAAQpF,GAU/BgG,eAAeD,UAAUX,EAAQpF,GAC/B,IAAKoF,EAAQ,OAAO,KACpBA,EAAU1B,MAAM8B,QAAQJ,GAAWA,EAAShD,OAAOG,OAAO6C,GAC1D,IAAK,MAAMvU,KAASuU,EAClB,GAAIvU,EAAM8K,KAAOqE,EAAM,GAAI,CACzB,GAAqB,IAAjBA,EAAMY,OACR,OAAK/P,EAAMuC,MAASmS,GAAa1U,EAAMuC,OAASmS,OAChD,EADkE1U,EAIpE,GADAmP,EAAM8D,SACDjT,EAAMuU,OAAQ,SACnB,IAAK,MAAMa,KAAc7D,OAAOG,OAAO1R,EAAMuU,QAAS,CACpD,GAA0B,IAAtBa,EAAWrF,OAAc,SAC7B,MAAMsF,QAAmBH,UAAUE,EAAYjG,GAC/C,GAAIkG,EAAY,OAAOA,CACxB,CACF,CAEJ,CACF,CAUD,gCAAaC,CAAoBf,EAAQpM,EAAO,IAC9C,MAAM2M,EAA0B,iBAAT3M,EAAoBA,EAAOA,GAAM2M,OACxD,IAAKA,EAAQ,OAEb,MAAM3F,EAAQ2F,EAAOlB,MAAM,WACrB2B,mBAAmBhB,EAAQpF,EAClC,CASD,+BAAaoG,CAAmBhB,EAAQpF,GACtCoF,EAAU1B,MAAM8B,QAAQJ,GAAWA,EAAShD,OAAOG,OAAO6C,GAC1D,IAAK,MAAOiB,EAAOxV,KAAUuU,EAAOpD,UAClC,GAAInR,EAAM8K,KAAOqE,EAAM,GAAI,CACzB,GAAqB,IAAjBA,EAAMY,OAER,YADAwE,EAAOkB,OAAOD,EAAO,GAGvB,GAA4B,IAAxBxV,EAAMuU,OAAOxE,OAAc,OAC/BZ,EAAM8D,QACN,MAAMoC,QAAmBE,mBAAmBvV,EAAMuU,OAAQpF,GAC1D,GAAIkG,EAAY,MACjB,CAEJ,CAUD,6BAAaK,CAAiBnB,EAAQpM,EAAO,IAC3C,MAAM2C,EAAsB,iBAAT3C,EAAoBA,EAAOA,GAAM2C,GACpD,GAAKA,EAEL,IAAK,IAAI8F,EAAI2D,EAAOxE,OAAS,EAAGa,GAAK,EAAGA,IAClC2D,EAAO3D,GAAG9F,KAAOA,EACnByJ,EAAOkB,OAAO7E,EAAG,GACR2D,EAAO3D,GAAG2D,QAAQxE,OAAS,GACpC2F,iBAAiBnB,EAAO3D,GAAG2D,OAAQpM,EAGxC,EClvBI,MAAMwN,YACX,WAAA9M,CAAY+M,GACV7M,KAAK6M,OAASA,CACf,CAKD,UAAMC,SACE9M,MAAK+M,UACL3M,QAAQ4M,IAAI,CAChBhN,KAAKiN,cAAgBjN,KAAKkN,YAC1BlN,KAAKmN,cAAgBnN,KAAKoN,oBAE7B,CAQD,uBAAIC,GACF,OAAQhM,QAAQC,MAAMgM,eAAehO,KAAKuG,QAAS,WAAiC,oBAAb0H,QACxE,CAQD,OAAMR,GACJ,IAAKzN,KAAK2E,KAAKoB,OAAS5F,MAAMC,WAAW,uBAAwB,OAEjE,MAAM8N,EAAc,OACdC,EAAmBzN,KAAwB,oBAC7C,WAAWtJ,EAAOC,aAClBD,EAAOC,GAEL+W,EAAsB,CAC1BD,EACA,GAAGA,KAAmBnO,KAAKqO,MAAM5L,KACjC,GAAG0L,KAAmBnO,KAAKqO,MAAM5L,WACjC,GAAG0L,KAAmBnO,KAAKqO,MAAM5L,WAGnC,IAAK,MAAM6L,KAAaF,QAChBG,WAAWC,OAAON,EAAaI,GAAWG,OAAM3B,gBACxCyB,WAAWG,gBAAgBR,EAAaI,EAAW,CAAE,IAC/DlP,GAAOnB,MAAM,+BAA+BqQ,IAC7C,GAGN,CAQD,QAAIK,GACF,OAAQjO,KAAwB,oBAC5B,WAAWtJ,EAAOC,cAAc2I,KAAKqO,MAAM5L,MAC3C,GAAGrL,EAAOC,MAAM2I,KAAKqO,MAAM5L,KAChC,CASD,YAAAmM,CAAa/V,GACX,MAAMiO,EAAQjO,EAAK0S,MAAM,KACnBsD,EAAW/H,EAAM4D,MACjBoE,EAAShI,EAAMM,KAAK,KACpB3E,EAAKoM,EAAStD,MAAM,KAAK,GAC/B,MAAO,CAAEuD,SAAQD,WAAUpM,KAC5B,CAQD,eAAMmL,GACJ,GAAI5N,KAAK2E,KAAKoB,KAAM,OAAO,EAE3B,GAAI/F,KAAK2E,KAAKoK,cAAc,gBAC1B,IAEE,aADMR,WAAWC,OAAO,OAAQ9N,KAAKiO,OAC9B,CACf,CAAQ,MACA,OAAO,CACR,CAEH,OAAO,CACR,CAQD,sBAAMb,GACJ,KAAM9N,KAAK2E,KAAKoK,cAAc,iBAAmBrO,KAAKiN,WAAaxN,MAAMyF,aAEvE,OADAxG,GAAOC,KAAK,8CAA8C,GACnD,IAAIwJ,IAGb,MAAMmG,EAAQhP,KAAK2E,KAAKoK,cAAc,kBAAoBrO,KAAKiN,cACrDjN,KAAKuO,qBACLvO,KAAK6M,OAAO2B,YAAY,gBAElC,OAAO,IAAIrG,IAAImG,EAAM7L,KAAItK,IACvB,MAAM4J,GAAEA,GAAO/B,KAAKkO,aAAa/V,GACjC,MAAO,CAAC4J,EAAI5J,EAAK,IAEpB,CAMD,mCAAasW,GACX,aAAanP,KAAKC,gBAAgBmP,aAAaH,iBAAkB,EAClE,CAQD,kBAAMA,GACJ,MAAOI,EAAYC,SAAmBxO,QAAQ4M,IAAI,CAChDa,WAAWC,OAAO,OAAQ,GAAG9N,KAAKiO,cAClCJ,WAAWC,OAAO,OAAQ,GAAG9N,KAAKiO,eAGpC,MAAO,IAAKU,GAAYL,OAAS,MAASM,GAAWN,OAAS,GAC/D,CAQD,eAAIO,GACF,OAASvP,KAAK2E,KAAKoK,cAAc,kBAAoBrO,KAAKiN,SAAYxN,MAAMyF,YAC7E,CAWD,kBAAM4J,CAAatV,EAAMuI,EAAI3C,GACvBE,KAAK2E,KAAKoK,cAAc,kBAAoBrO,KAAKiN,eAC7CjN,KAAK+O,SAASvV,EAAMuI,EAAI3C,GAG3BK,MAAMyF,mBAKLlF,KAAK6M,OAAO2B,YAAY,WAAYhV,EAAMuI,EAAI3C,GAJlDV,GAAOC,KAAK,yCAAyC,EAKxD,CAID,+BAAaqQ,CAAmBxV,EAAMuI,EAAI3C,GACxC,aAAaE,KAAKC,eAAemP,YAAYK,SAASvV,EAAMuI,EAAI3C,EACjE,CAUD,cAAM2P,CAASvV,EAAMuI,EAAI3C,GACvB,IAEE,MAAMgP,EAAS,GAAGpO,KAAKiO,OAAOzU,IAGxByV,EAAWC,UAAU,GAAGnN,UAGxB5J,EAAO,IAAIgX,KAAK,CAACC,KAAKC,UAAUjQ,EAAM,KAAM,KAAM6P,EAAU,CAAEzV,KAAM,qBAGpE8V,QAAiBzB,WAAW0B,OAAO,OAAQnB,EAAQjW,EAAM,GAAI,CAAE0G,QAAQ,IAEzEyQ,EAASrB,KACNjO,KAAKmN,QAAQqC,IAAIzN,IACpB/B,KAAKmN,QAAQ9I,IAAItC,EAAIuN,EAASrB,MAGhCvP,GAAOnB,MAAM,2BAA2B0R,cAAqBK,EAASpQ,OAAS,kBAElF,CAAC,MAAMA,GACNR,GAAOQ,MAAM,2CAA2C6C,WAAY7C,EAAMN,UAC3E,CACF,CAQD,cAAI6Q,GACF,OAASnQ,KAAK2E,KAAKoK,cAAc,kBAAoBrO,KAAKiN,SAAYxN,MAAMyF,YAC7E,CAUD,iBAAMwK,CAAYtO,GAChB,IACE,KAAM9B,KAAK2E,KAAKoK,cAAc,iBAAmBrO,KAAKiN,WAAaxN,MAAMyF,aAEvE,YADAxG,GAAOC,KAAK,wCAAwC,GAItD,MAAMS,EAAQE,KAAK2E,KAAKoK,cAAc,sBAC5BrO,KAAK2P,QAAQvO,SACbpB,KAAK6M,OAAO2B,YAAY,UAAWpN,GAE7C,OAAOhC,CACR,CAAC,MAAMF,GAEN,OADAR,GAAOQ,MAAM,yCAAyCA,EAAMN,WACrD,IACR,CACF,CAID,8BAAagR,CAAkBxO,GAC7B,aAAa9B,KAAKC,eAAemP,YAAYiB,QAAQvO,EACtD,CASD,aAAMuO,CAAQvO,GACZ,MAAMW,GAAEA,EAAE5J,KAAEA,GAASiJ,EAGrB,IAAIyO,EAAY7P,KAAKmN,QAAQjL,IAAIH,IAAO,KAGxC,IAAK8N,EAAW,CACd,IAAK1X,EAAM,OAAO,KAClB,MAAMiW,OAAEA,EAAMD,SAAEA,GAAanO,KAAKkO,aAAa/V,GACzC2X,QAAoBjC,WAAWC,OAAO,OAAQM,GAEpD,GADAyB,EAAYC,EAAYxB,MAAMxM,MAAK3J,GAAQA,EAAK4X,SAAS5B,MACpD0B,EAAW,OAAO,IACxB,CAED,IACE,MAAMG,EAAKC,KAAKC,MACVZ,QAAiBa,MAAM,GAAGN,QAAgBG,KAGhD,GAAIV,EAASc,GAAI,CACf,MAAMhR,QAAakQ,EAASe,OAC5B,OAAOjR,CACf,CACQ,OAAO,IAEV,CAAC,MAAMF,GAEN,OADAF,QAAQE,MAAMA,GACP,IACR,CACF,CAUD,oBAAMoR,CAAe9W,EAAMuI,GACzB,MAAMwO,EAAa,GAAG7Z,EAAOC,MAAM2I,KAAKqO,MAAM5L,MAAMvI,IAC9CyV,EAAWC,UAAU,GAAGnN,UAC9B,IACE,MAAMyO,QAAwB3C,WAAWC,OAAO,OAAQyC,GAClDE,EAAgBD,EAAgBlC,MAAMxM,MAAK3J,GAAQA,EAAK4X,SAASd,KACvE,GAAIwB,EAAe,CACjB,MAAMT,EAAKC,KAAKC,MAChB,aAAaC,MAAM,GAAGM,QAAoBT,KACvCU,MAAKpB,GACAA,EAASc,GACJd,EAASe,OAET,OAGVtC,OAAM7O,IACLF,QAAQE,MAAMA,EAAM,GAEhC,CACQ,OAAO,IAEf,CAAM,MACA,OAAO,IACR,CACF,EChVI,MAAMyR,iBACX,WAAA7Q,CAAY4O,EAAa7B,GACvB7M,KAAK0O,YAAcA,EACnB1O,KAAK6M,OAASA,CACf,CAQD,UAAMC,GACJ,IAAKxN,KAAK2E,KAAKoB,KAAM,OAErB,MAAMqF,EAAgBpL,KAAKmG,QAAQvD,IAAIxL,EAAOC,IAAIkP,QAC5C7H,EAAmByB,MAAMC,WAAW,oBAC1C,GAAIgL,IAAkB1M,EAAkB,OAExC,IAAI4S,GAAY,EAChBA,KAAc5S,GAAoBqD,QAAQC,MAAMgM,eAAe,SAAUtP,WAC/DgC,MAAK6Q,IAEfD,IAAa5Q,KAAK0O,YAAYrB,uBAAyBrP,GAAoBqD,QAAQC,MAAMgM,eAAe,SAAUtP,YACxGgC,MAAK8Q,IAGXF,GACFnR,MAAM2E,WAAW,mBAAoBsG,EAExC,CASD,OAAMmG,GACJ,IACE,MAAM1L,EAAQ7F,KAAK6F,MAAM4L,QAAO9M,GAAQA,EAAKM,QAAQ7N,EAAOC,GAAI,gBAChE,IAAK,MAAMsN,KAAQkB,EACjBlB,EAAKU,UAAUjO,EAAOC,GAAI,cAC1BsN,EAAKU,UAAUjO,EAAOC,GAAI,YAG5B,MAAMsL,EAAS3C,KAAK2C,OAAO8O,QAAO/O,GAASA,EAAMuC,QAAQ7N,EAAOC,GAAI,gBACpE,IAAK,MAAMqL,KAASC,EAClBD,EAAM2C,UAAUjO,EAAOC,GAAI,cAG7B,MAAMiL,EAAStC,KAAKqC,OAAOC,OAAOoP,QAAQC,SAASF,QAAOrP,GAASA,EAAMM,OAAOuC,QAAQ7N,EAAOC,GAAI,gBACnG,IAAK,MAAM+K,KAASE,EAClBF,EAAMM,OAAO2C,UAAUjO,EAAOC,GAAI,cAGpC,IAAK,MAAMua,KAAS5R,KAAK6R,OAAQ,CAC/B,MAAMvP,EAASsP,EAAMtP,OAAOmP,QAAOrP,GAASA,EAAMM,OAAOuC,QAAQ7N,EAAOC,GAAI,gBAC5E,IAAK,MAAM+K,KAASE,EAClBF,EAAMM,OAAO2C,UAAUjO,EAAOC,GAAI,aAErC,CAED,OAAO,CACR,CAAC,MAAMya,GAGN,OAFA1S,GAAOnB,MAAM6T,EAAIxS,QAASwS,IAEnB,CACR,CACF,CAQD,OAAMN,GACJ,IACEpS,GAAOC,KAAK,4CAA4C,GACxD,IAAK,MAAMsF,KAAQ3E,KAAK6F,MAAO,CAC7B,MAAM/F,QAAaY,KAAK0O,YAAY4B,eAAe,OAAQrM,EAAKlC,IAC5D3C,SACIY,KAAK0O,YAAYK,SAAS,OAAQ9K,EAAKlC,GAAI3C,EAEpD,CAED,IAAK,MAAM4C,KAAS1C,KAAK2C,OAAQ,CAC/B,MAAM7C,QAAaY,KAAK0O,YAAY4B,eAAe,QAAStO,EAAMD,IAC9D3C,SACIY,KAAK0O,YAAYK,SAAS,QAAS/M,EAAMD,GAAI3C,EAEtD,CAED,OADAV,GAAOC,KAAK,qDAAqD,IAC1D,CACb,CAAM,MAEA,OADAD,GAAOC,KAAK,iDAAiD,IACtD,CACR,CACF,ECxGI,MAAM0S,iBACX,WAAAvR,CAAYwR,GACVtR,KAAKsR,WAAaA,EAClBtR,KAAKuR,aAAeD,EAAWC,aAC/BvR,KAAKwR,cAAgBF,EAAWE,cAChCxR,KAAK7B,YAAcmT,EAAWnT,WAC/B,CAKD,IAAA2O,GACE9M,KAAKyR,gBAAkBzR,KAAKgC,OAAOD,GACnC/B,KAAK0R,cACN,CAQD,eAAIC,GACF,OAAO3R,KAAKgC,OAAShC,KAAK4R,gBAC3B,CAQD,oBAAIA,GACF,MAAMC,EAAmBpS,MAAMoE,sBAC/B,OAAOgO,EAAiB7K,OAAS,IAAMhH,KAAKgC,KAC7C,CAQD,eAAI8P,GACF,OAAO9R,KAAKyR,kBAAoBzR,KAAKgC,OAAOD,EAC7C,CAQD,YAAA2P,GACE1R,KAAK+R,iBACL,MAAMF,EAAmBpS,MAAMoE,sBAC3BgO,EAAiB7K,OAAS,EAC5BhH,MAAKgS,EAAsBH,GAE3B7R,MAAKiS,EAAmBJ,EAE3B,CAOD,cAAAE,GACE/R,KAAK0B,MAAQ,KACb1B,KAAKgC,MAAQ,KACbhC,KAAK4B,OAAS,GACd5B,KAAKiC,OAAS,EACf,CAQD,EAAA+P,CAAsBH,GACpB7R,KAAKkS,cAAgB5S,KAAKyF,KAAKE,SAAS,2BAGxCjF,KAAK0B,MAAQ,KACb1B,KAAKgC,MAAQ,KAGbhC,KAAK4B,OAASiQ,EACd7R,KAAKiC,OAASxC,MAAM8C,qBACrB,CASD,EAAA0P,CAAmBJ,GACjB,MAAM7N,EAAY,CAAEtC,MAAO,KAAMM,MAAO,MAER,IAA5B6P,EAAiB7K,QAAgBhH,MAAKmS,EAAkBN,EAAiB,KAC3E7N,EAAUtC,MAAQmQ,EAAiB,GACnC7N,EAAUhC,MAAQgC,EAAUtC,OAAOM,OACE,IAA5B6P,EAAiB7K,QAAgB1H,KAAK2E,KAAKD,WAAavE,MAAMC,WAAW,mBAClFsE,EAAUhC,MAAQ1C,KAAK2E,KAAKD,UAC5BA,EAAUtC,MAAQC,OAAOC,QAAQC,WAAWC,MAAKsQ,GAAKA,EAAEpQ,OAAOD,KAAOiC,EAAUhC,MAAMD,MAAO,MAG1FiC,EAAUhC,QAEfhC,KAAKkS,cAAgBlO,EAAUtC,OAAOrJ,MAAQ2L,EAAUhC,MAAM3J,KAG9D2H,KAAK0B,MAAQsC,EAAUtC,MACvB1B,KAAKgC,MAAQgC,EAAUhC,MACvBhC,KAAK4B,OAAS,CAACoC,EAAUtC,OACzB1B,KAAKiC,OAAS,CAAC+B,EAAUhC,OAC1B,CAUD,EAAAmQ,CAAkBzQ,EAAQ,IACxB,OAAOpC,KAAK2E,KAAKoB,MAAQ3D,EAAMM,OAAOqQ,mBAAmB/S,KAAK2E,KAAM,QACrE,ECjII,MAAMqO,cACX,WAAAxS,CAAYyS,EAAe7D,GACzB1O,KAAKuS,cAAgBA,EACrBvS,KAAK0O,YAAcA,EACnB1O,KAAKwS,cAAgB,KACrBxS,KAAK7D,aAAe,IACrB,CAKD,UAAM2Q,SACE1M,QAAQ4M,IAAI,CAChBhN,MAAKyS,IACLzS,MAAK0S,KAER,CAOD,SAAAC,GACE3S,KAAKwS,cAAgB,IACtB,CAOD,SAAAI,GACE5S,KAAK2S,YACL3S,KAAK7D,aAAe,IACrB,CAQD,OAAMsW,GACJ,GAAIzS,KAAKwS,cAAe,OACxB,MAAMA,EAAgBxS,KAAKuS,cAAcM,UAAUC,OAEnD9S,KAAKwS,cADAA,QACsB/S,MAAM8L,gBAAgBiH,GADN,IAE5C,CAQD,OAAME,GACJ,GAAI1S,KAAK7D,aAAc,OACvB,MAAMhE,EAAOsH,MAAMmF,YAAY,qBAAuBnF,MAAMC,WAAW,iBAAmB,KAC1FM,KAAK7D,aAAe,QAAe6D,KAAK0O,YAAYgB,YAAY,CAAEvX,SAAU,IAC7E,CAQD,kBAAMuE,GACJ,MAAM0C,QAAaY,KAAK0O,YAAYgB,YAAY,CAAElW,KAAM,OAAQuI,GAAIzC,KAAKyT,UAAa/S,KAAK7D,cAAgB6D,KAAKwS,cAC5GpT,GACF4T,eAAe5D,KAAKC,UAAUjQ,EAAM,KAAM,GAAI,YAAa,+BAE9D,CAMD,UAAI0T,GACF,OAAO9S,KAAK7D,cAAgB6D,KAAKwS,aAClC,EC7EI,SAASS,WAAWC,EAAS7a,GAClC,MAAM2Q,EAAUvJ,MAAMC,WAAW,YAEjC,MAAgB,SAAZsJ,EAA2B,KACf,aAAZA,GAA2BkK,GAER,iBAAZA,IACTA,EAAU,CAAEC,QAASD,IAGlBA,EAAQC,QAAQ3P,SAAS,yBAC5B0P,EAAQC,QAAU,oCAAoCD,EAAQC,iBAGzDD,GAVwC7a,CAWjD,CCjBO,MAAM+a,aACX,WAAAtT,CAAYwR,EAAYiB,EAAe7D,EAAa2E,GAClDrT,KAAKsR,WAAaA,EAClBtR,KAAKuS,cAAgBA,EACrBvS,KAAK0O,YAAcA,EACnB1O,KAAKqT,cAAgBA,EACrBrT,KAAKsT,cAAgB,GACrBtT,KAAKwL,OAAS,GACdxL,KAAKuT,YAAc,GACnBvT,KAAKwT,WAAa,EACnB,CAED,SAAIxR,GACF,OAAOhC,KAAKsR,YAAYtP,KACzB,CAED,UAAIC,GACF,OAAOjC,KAAKsR,YAAYrP,MACzB,CAED,SAAIP,GACF,OAAO1B,KAAKsR,YAAY5P,KACzB,CAED,UAAIE,GACF,OAAO5B,KAAKsR,YAAY1P,MACzB,CAKD,UAAMkL,GACJ9M,MAAKyT,UACCrT,QAAQ4M,IAAI,CAChBhN,MAAK0T,IACL1T,MAAK2T,KAER,CAOD,SAAAhB,GACE3S,KAAKsT,cAAgB,GACrBtT,KAAKwL,OAAS,EACf,CAOD,SAAAoH,GACE5S,KAAK2S,YACL3S,KAAKuT,YAAc,GACnBvT,KAAKwT,WAAa,EACnB,CAQD,EAAAC,GACE,MAAMH,EAAgBtT,KAAKuS,cAAcM,UAAUrH,OACnD,GAAK8H,EACL,IAAK,MAAMM,KAAgBN,EACzBtT,KAAKsT,cAAcM,EAAa7R,IAAM6R,CAEzC,CAQD,OAAMF,GACJ,IAAK1T,KAAKgC,MAAO,OAEjB,IAAKvC,MAAMC,WAAW,uBAEpB,YADAM,KAAKuT,YAAc,IAIrB,GAAIvT,KAAK8R,aAAetJ,OAAOJ,QAAQpI,KAAKuT,aAAavM,OAAQ,OAEjE,IAAKhH,KAAK0O,YAAYe,WAEpB,YADAzP,KAAKuT,YAAc,IAIrB7U,GAAOnB,MAAM,kCAAmC,CAAEyE,MAAOhC,KAAKgC,QAC9DhC,KAAKuT,YAAc,GACnB,MAAMA,QAAoBvT,KAAK0O,YAAYgB,YAAY,CAAElW,KAAM,QAASuI,GAAI/B,KAAKgC,MAAMD,MAAS,KAChG,GAAKwR,EAAL,CACA,IAAK,MAAMtc,KAASuR,OAAOJ,QAAQmL,GACjCtc,EAAM,GAAG8U,OAAS9U,EAAM,GAE1B+I,KAAKuT,YAAcA,EACnB7U,GAAOnB,MAAM,8BAA+B,CAAEgW,YAAavT,KAAKuT,YAAavR,MAAOhC,KAAKgC,OALhE,CAM1B,CAQD,OAAM2R,GACJ,MAAM1P,EAAO3E,KAAK2E,KACZ6O,EAAS9S,KAAKqT,cAAcP,OAE5Be,cAAgBzU,IACpB,MAAMoU,EAAahL,OAAOyD,KAAK7M,GAAM4H,OAAS5H,EAAO0T,EACrD,IAAK,MAAM7b,KAASuR,OAAOJ,QAAQoL,GACjCvc,EAAM,GAAG8U,OAAS9U,EAAM,GAE1B,OAAOuc,CAAU,EAGnB,IAAK/T,MAAMC,WAAW,uBAEpB,YADAM,KAAKwT,WAAaK,cAAcf,IAIlC,GAAItK,OAAOJ,QAAQpI,KAAKwT,YAAYxM,OAAQ,OAE5C,IAAKhH,KAAK0O,YAAYe,WAEpB,YADAzP,KAAKwT,WAAaK,cAAcf,IAIlCpU,GAAOnB,MAAM,iCAAkC,CAAE0G,SACjDjE,KAAKwT,WAAa,GAClB,MAAMM,QAAsB9T,KAAK0O,YAAYgB,YAAY,CAAElW,KAAM,OAAQuI,GAAIkC,EAAKlC,MAAS,CAAA,EAC3F/B,KAAKwT,WAAaK,cAAcC,GAChCpV,GAAOnB,MAAM,6BAA8B,CAAEiW,WAAYxT,KAAKwT,WAAYvP,QAC3E,CASD,mBAAM8P,CAAc7c,GAClB,GAAIsR,OAAOyD,KAAKjM,KAAKwT,YAAYxM,OAAQ,CACvC,MAAMwM,EAAaxT,KAAK6T,gBACxB,IAAK,MAAMG,KAAaR,EACtB,GAAwB,IAApBQ,EAAUlI,MAAa,CACzB,MAAM7U,EAAQ+I,KAAKiU,YAAYD,GAC/B9c,EAAIsU,OAAOpI,KAAKnM,GAChB+I,KAAKwL,OAAOvU,EAAM8U,QAAU9U,CACtC,KAAe,CACL,MAAMid,EAAeF,EAAUjI,OAAOlB,MAAM,IAAKmJ,EAAUlI,MAAQ,GAAGpF,KAAK,KACrEyN,QAAoB1U,MAAMyM,iBAAiBhV,EAAIsU,OAAQ,CAAEO,OAAQmI,IACvE,GAAIC,EAAa,CACf,MAAMld,EAAQ+I,KAAKiU,YAAYD,GACF,QAAzB/c,EAAMG,SAASmH,MACjB4V,EAAY3I,OAAO4I,KAAKhR,KAAKnM,GAE7Bkd,EAAY3I,OAAO6I,MAAMjR,KAAKnM,GAEhC+I,KAAKwL,OAAOvU,EAAM8U,QAAU9U,CAC7B,CACF,CAEJ,CAED,GAAIuR,OAAOyD,KAAKjM,KAAKuT,aAAavM,OAAQ,CACxC,MAAMuM,EAAcvT,KAAKsU,iBAEzB,IAAK,MAAMC,KAAchB,EAAa,CACpC,MAAMW,EAAeK,EAAWxI,OAAOlB,MAAM,IAAK0J,EAAWzI,MAAQ,GAAGpF,KAAK,KACvE8N,QAAsB/U,MAAMyM,iBAAiBhV,EAAIsU,OAAQ,CAAEO,OAAQwI,EAAWxI,SACpF,GAAIyI,EACED,EAAWE,SAASzN,SACtBwN,EAAcC,QAAUF,EAAWE,aAEhC,CACL,MAAMN,QAAoB1U,MAAMyM,iBAAiBhV,EAAIsU,OAAQ,CAAEO,OAAQmI,IAEvE,GAAIC,GAAmC,mBAApBI,EAAW/a,KAA2B,CAClD2a,EAAY3I,SAAQ2I,EAAY3I,OAAS,CAAE6I,MAAO,GAAID,KAAM,KAEjE,MAAMnd,EAAQ+I,KAAKiU,YAAYM,GAAY,GAEvCA,EAAWE,SAASzN,SACtB/P,EAAMwd,QAAUF,EAAWE,SAGA,QAAzBxd,EAAMG,SAASmH,MACjB4V,EAAY3I,OAAO4I,KAAKhR,KAAKnM,GAE7Bkd,EAAY3I,OAAO6I,MAAMjR,KAAKnM,GAGhC+I,KAAKwL,OAAOvU,EAAM8U,QAAU9U,CAC7B,CACF,CACF,CACF,CAED,OAAO+I,KAAKwL,MACb,CAcD,QAAAkJ,EAAS3I,OAAEA,EAAMhK,GAAEA,EAAE+J,MAAEA,EAAKtS,KAAEA,GAAS,IACrC,OAAIuS,EAAe/L,KAAKwL,OAAOO,GAExBvD,OAAOG,OAAO3I,KAAKwL,QAAQ1J,MAAK7K,KACnC8K,GAAM9K,EAAM8K,KAAOA,GAChB+J,GAAS7U,EAAM6U,QAAUA,GACzBtS,GAAQvC,EAAMuC,OAASA,IAE/B,CAeD,SAAAmb,EAAU5I,OAAEA,EAAMhK,GAAEA,EAAE+J,MAAEA,EAAKtS,KAAEA,EAAIob,SAAEA,GAAa,IAChD,OAAOpM,OAAOG,OAAO3I,KAAKwL,QAAQuF,QAAO9Z,KACrC8U,GAAU9U,EAAM8U,OAAO8I,WAAW9I,OAC/BhK,GAAM9K,EAAM8K,KAAOA,MACnB+J,GAAS7U,EAAM6U,QAAUA,MACzBtS,GAAQvC,EAAMuC,OAASA,MACvBob,GAAY3d,EAAM2d,WAAaA,IAEvC,CAcD,cAAAN,EAAevI,OAAEA,EAAMhK,GAAEA,EAAE+J,MAAEA,EAAKtS,KAAEA,GAAS,IAC3C,OAAOgP,OAAOG,OAAO3I,KAAKuT,aAAaxC,QAAO9Z,KAC1C8U,GAAU9U,EAAM8U,OAAO8I,WAAW9I,OAC/BhK,GAAM9K,EAAM8K,KAAOA,MACnB+J,GAAS7U,EAAM6U,QAAUA,MACzBtS,GAAQvC,EAAMuC,OAASA,KAC5B0N,MAAK,CAACC,EAAGC,IAAOD,EAAE2E,MAAQ1E,EAAE0E,OAAS3E,EAAEsE,MAAQrE,EAAEqE,OACpD,CAcD,aAAAoI,EAAc9H,OAAEA,EAAMhK,GAAEA,EAAE+J,MAAEA,EAAKtS,KAAEA,GAAS,IAC1C,OAAOgP,OAAOG,OAAO3I,KAAKwT,YAAYzC,QAAO9Z,KACzC8U,GAAU9U,EAAM8U,OAAO8I,WAAW9I,OAC/BhK,GAAM9K,EAAM8K,KAAOA,MACnB+J,GAAS7U,EAAM6U,QAAUA,MACzBtS,GAAQvC,EAAMuC,OAASA,KAC5B0N,MAAK,CAACC,EAAGC,IAAOD,EAAE2E,MAAQ1E,EAAE0E,OAAS3E,EAAEsE,MAAQrE,EAAEqE,OACpD,CAQD,WAAAqJ,GACE,OAAOtM,OAAOG,OAAO3I,KAAKwL,QAAQ/I,KAAIxL,GAASA,EAAM8K,IACtD,CAUD,gBAAAgT,CAAiBC,EAAY,IAC3B,OAAOhV,KAAK0U,SAASM,IAAY5d,UAAY,IAC9C,CAWD,WAAA6c,CAAYe,EAAWC,GAAW,GAChC,MAAMC,EAAiBzV,MAAMG,UAAUoV,GACjCG,EAAcH,EAAUjJ,OAAOlB,MAAM,KACrCiB,EAAQqJ,EAAYnO,QAAU,EAE9BkM,EAAUD,WAAW+B,GAAW9B,QAASgC,GAAgB7c,MAE1D4c,IACHC,EAAeT,QAAU,GACzBS,EAAe1J,OAAS,CAAE6I,MAAO,GAAID,KAAM,KAG7C,MAAMgB,EAAkB,CACtBC,WAAW,EACX9W,MAAkB,IAAVuN,EAAe,MAAQ,QAG3BwJ,EAAgBJ,EAAe9d,UAAY,GACjDke,EAAcD,YAAcD,EAAgBC,UAC5CC,EAAc/W,QAAU6W,EAAgB7W,MAExC2W,EAAeK,cAAiBD,EAAuB,UAAI,GAAK,aAEhE,MAAME,EAAcN,EAAeO,QAAU,GAEvCC,EAAc,CAClBjB,QAASS,EAAeT,QACxBvc,MAAOgd,EAAehd,OAASgd,EAAeS,UAAY,GAC1DnK,OAAQ0J,EAAe1J,OACvBzJ,GAAImT,EAAenT,GACnB6T,MAAOV,EAAeU,OAAS,GAC/BC,MAAOX,EAAeW,OAAS,GAC/BC,MAAOZ,EAAeY,OAAS,GAC/BhK,MAAOoJ,EAAepJ,OAASA,GAAS,EACxCiK,SAAUb,EAAea,UAAYb,EAAe7c,KACpDA,KAAM6c,EAAe7c,KACrB0T,OAAQmJ,EAAenJ,QAAUmJ,EAAenT,GAChD0J,MAAOyJ,EAAezJ,MACtBmJ,SAAUM,EAAeN,UAAYM,EAAec,YAAcd,EAAee,kBAAmB,EACpG7e,SAAUke,EACVG,OAAQD,EACRtC,UACA1Z,KAAM0b,EAAe1b,MAAQ2B,EAAWE,QAO1C,OAJIyQ,EAAQ,IACV4J,EAAYH,cAAgBL,EAAeK,eAAiB,IAGvDG,CACR,CAUD,YAAAQ,CAAaC,EAAYC,GAClBtM,MAAM8B,QAAQuK,KAAaA,EAAa,CAACA,IAE9C,MAAMrK,GAASsK,GAAiBtK,OAAS,GAAK,EACxCuK,EAAiB,CAAEvK,SACrBsK,GAAiBrK,SAAQsK,EAAetK,OAASqK,EAAgBrK,QAErE,MAAMuK,EAAiBtW,KAAK2U,UAAU0B,GAGtC,IAAK,MAAM7B,KAAiB8B,EACC,mBAAvB9B,EAAchb,MAChBgb,EAAcI,UAAW,EACzBJ,EAAc/I,MAAQ,KACZ0K,EAAWrU,MAAKkT,GAAaA,EAAUjT,KAAOyS,EAAczS,aAC/D/B,KAAKwL,OAAOgJ,EAAczI,QAKrC,IAAIN,EAAQ,EACZ,IAAK,MAAMuJ,KAAamB,EAAY,CAClCnB,EAAUjJ,OAAUqK,GAAiBrK,OACjC,GAAGqK,EAAgBrK,UAAUiJ,EAAUjT,KACvCiT,EAAUjT,GACdiT,EAAUJ,SAAWI,EAAUJ,WAAY,EAC3CI,EAAUvJ,MAAQA,EAElB,MAAM+I,EAAgBxU,KAAK0U,SAASM,GAEpC,GAAIR,EACFhM,OAAOwD,OAAOwI,EAAeQ,OACxB,CACL,MAAM/d,EAAQ+I,KAAKiU,YAAYe,GAC/BhV,KAAKwL,OAAOwJ,EAAUjJ,QAAU9U,CACjC,CACDwU,GACD,CAGD,GAAI2K,GAAiBhf,SAAU,CAC7B,MAAMmf,EAAsBvW,KAAK0U,SAAS0B,GACtCG,IACFA,EAAoBnf,SAAWgf,EAAgBhf,SAElD,CACF,CASD,iBAAAof,CAAkBxB,GAChB,MAAM/d,EAAQ+I,KAAK0U,SAASM,GAC5B/d,EAAMG,SAAW,IAAKH,EAAMG,YAAa4d,EAAU5d,UACnD4I,KAAKyW,WAAW,CAAEC,WAAW,EAAMC,UAAU,GAC9C,CASD,gBAAMF,CAAWrV,EAAU,CAAEsV,WAAW,EAAOC,UAAU,IAClDlX,MAAMC,WAAW,yBAEtBhB,GAAOnB,MAAM,oBAET6D,GAASsV,iBAAiB1W,KAAK4W,kBAC/BxV,GAASuV,gBAAgB3W,KAAK6W,iBAElCnY,GAAOnB,MAAM,eAAgB,CAAEiO,OAAQxL,KAAKwL,SAC7C,CAQD,qBAAMoL,GACJ,IAAK5W,KAAKgC,QAAUwG,OAAOyD,KAAKjM,KAAKwL,QAAQxE,OAAQ,OAErDtI,GAAOnB,MAAM,0BAEb,MAAMgW,EAAc,CAAA,EACpBvT,KAAKuT,YAAc,GAEnB,IAAK,MAAMtc,KAASuR,OAAOG,OAAO3I,KAAKwL,QACrCxL,KAAKuT,YAAYtc,EAAM8U,QAAU9U,EACjCsc,EAAYtc,EAAM8U,QAAU/L,MAAK8W,EAAqB7f,GAAO,GAG3D+I,KAAK0O,YAAYG,mBACb7O,KAAK0O,YAAYI,aAAa,QAAS9O,KAAKgC,MAAMD,GAAIwR,GAE5D7U,GAAOnB,MAAM,qBAAsB,CAAEgW,iBAErC7U,GAAOnB,MAAM,0CAEhB,CAQD,oBAAMsZ,GACJ,IAAKrO,OAAOyD,KAAKjM,KAAKwL,QAAQxE,OAAQ,OAEtCtI,GAAOnB,MAAM,yBAEb,MAAMiW,EAAa,CAAA,EACnBxT,KAAKwT,WAAa,GAElB,IAAK,MAAMvc,KAASuR,OAAOG,OAAO3I,KAAKwL,QAClB,mBAAfvU,EAAMuC,OACRwG,KAAKwT,WAAWvc,EAAM8U,QAAU9U,EAChCuc,EAAWvc,EAAM8U,QAAU/L,MAAK8W,EAAqB7f,GAAO,IAI5D+I,KAAK0O,YAAYG,mBACb7O,KAAK0O,YAAYI,aAAa,OAAQxP,KAAKyT,OAAQS,GACzD9U,GAAOnB,MAAM,oBAAqB,CAAEiW,gBAEpC9U,GAAOnB,MAAM,yCAEhB,CAoBD,EAAAuZ,EAAqB/U,GAAEA,EAAE1J,KAAEA,EAAI0d,SAAEA,EAAQjK,MAAEA,EAAKL,MAAEA,EAAKmJ,SAAEA,EAAQxd,SAAEA,EAAQoC,KAAEA,EAAIib,QAAEA,GAAWsC,GAAc,GAC1G,MAAM3X,EAAO,CAAE2C,KAAI1J,OAAM0d,WAAUjK,QAAOL,QAAOmJ,WAAUxd,WAAUoC,QAMrE,OAJIud,IACF3X,EAAKqV,QAAUA,EAAQhS,KAAI,EAAGV,KAAIiV,WAAUC,mBAA4B,CAAElV,KAAIiV,WAAUC,oBAGnF7X,CACR,CAUD,uBAAA8X,CAAwBlC,EAAY,IAClCA,EAAUJ,UAAW,EACrBI,EAAUlJ,OAASkJ,EAAUlJ,OAAS,GAAK,EAC3C,MAAMN,EAASxL,KAAK2U,UAAUK,GAC9B,OAAOxJ,GAAQ/I,KAAIxL,GAAS+I,MAAKmX,EAAUlgB,MAAW,EACvD,CAUD,6BAAMmgB,CAAwBpC,GAC5B,MAAMqC,QAAsBrX,MAAKsX,EAAwBtC,GACnDuC,QAAqBvX,MAAKwX,IAC1BC,QAAyBzX,MAAK0X,IAC9BC,QAAoB3X,MAAK4X,IAC/B,MAAO,IAAIP,KAAkBE,KAAiBE,KAAqBE,EACpE,CAWD,EAAAL,EAAwBvL,OAAEA,IACxB,MAAMsL,EAAgBrX,KAAK2U,UAAU,CAAE5I,SAAQvS,KAAM2B,EAAWI,iBAChE,OAAO8b,GAAe5U,KAAIxL,GAAS+I,MAAKmX,EAAUlgB,MAAW,EAC9D,CASD,EAAAugB,GACE,OAAOhP,OAAOG,OAAO3I,KAAKsT,eAAe7Q,KAAIxL,GAAS+I,MAAKmX,EAAUlgB,IACtE,CASD,EAAAygB,GACE,MAAMG,EAAQvY,KAAKuY,MAAM9G,QAAO+G,GAC9B/f,EAAsByL,SAASsU,EAAKC,gBAC1B1W,QAAQC,MAAMgM,eAAehO,KAAKuG,QAAS,MAAQiS,EAAKE,SAAYF,EAAK7K,SAAW3N,KAAK2E,KAAKoB,QAEpGmG,EAASqM,EAAMpV,KAAIqV,IAChB,CACL/V,GAAI+V,EAAKG,SAASlW,GAAGlB,QAAQ,IAAK,KAClCkV,SAAU,GAAGzW,KAAKyF,KAAKE,SAAS,4BAA4B6S,EAAKG,SAAStb,QAC1EtE,KAAMyf,EAAKG,SAAStb,MACpBnD,KAAM,WAGV,OAAOgS,EAAO/I,KAAIxL,GAAS+I,MAAKmX,EAAUlgB,IAC3C,CAOD,EAAA2gB,GACE,MAAO,CAAC5X,MAAKmX,EAAU,CACrBpV,GAAI,SACJgU,SAAU,GAAGzW,KAAKyF,KAAKE,SAAS,4BAA4B3F,KAAKyF,KAAKE,SAAS,2BAC/E5M,KAAMiH,KAAKyF,KAAKE,SAAS,yBACzBzL,KAAM,SAET,CASD,QAAA0e,CAASlD,EAAWoB,EAAiB+B,GAAS,GAI5C,GAHAnD,EAAUxb,KAAOwb,GAAWxb,MAAQ,iBACpCwb,EAAUzW,MAAQyW,GAAWzW,OAAS,QAEjC6X,GAAiBrU,KAAOqU,GAAiBrK,OAAQ,OAEtD,MAAMqM,EAAepY,KAAK2U,UAAUyB,GACpC,GAAKgC,GAAcpR,OAEnB,IAAK,MAAMmN,KAAeiE,EAAc,CACtC,MAAMrM,EAAS,GAAGoI,EAAYpI,UAAUiJ,EAAUjT,KAC5CuU,EAAiBtW,KAAK2U,UAAU,IAAKK,EAAWjJ,WAEtD,GAAIuK,EAAetP,OACjB,GAAImR,EACF,IAAK,MAAM3D,KAAiB8B,EAEtBtB,EAAUrW,OACZ6J,OAAOwD,OAAOgJ,EAAW,IAAKA,EAAUrW,cACjCqW,EAAUrW,MAGnB6J,OAAOwD,OAAOwI,EAAexU,KAAKiU,YAAY,IAAKO,KAAkBQ,IAAa,SAGpF,IAAK,MAAMR,KAAiB8B,EAAgB,CAC1C,MAAMpD,EAAUD,WAAW+B,EAAU9B,QAASsB,EAAcnc,MAC5DmQ,OAAOwD,OAAOwI,EAAe,CAAEtB,WAChC,KAEE,CACL,MAAMjc,EAAQ+I,KAAKiU,YAAY,IAAKe,EAAWjJ,WAE1CoI,EAAY3I,SAAQ2I,EAAY3I,OAAS,CAAE6I,MAAO,GAAID,KAAM,KAEpC,QAAzBnd,EAAMG,SAASmH,MACjB4V,EAAY3I,OAAO4I,KAAKhR,KAAKnM,GAE7Bkd,EAAY3I,OAAO6I,MAAMjR,KAAKnM,GAEhC+I,KAAKwL,OAAOvU,EAAM8U,QAAU9U,CAC7B,CACF,CACF,CAUD,WAAAohB,CAAYrD,EAAWoB,EAAkB,MACvCpB,EAAUxb,KAAOwb,GAAWxb,MAAQ,iBAEpC,MAAM8e,qBAAuBhC,IAC3B,IAAK,MAAM9B,KAAiB8B,EAEtBtB,EAAUrW,OACZ6J,OAAOwD,OAAOgJ,EAAW,IAAKA,EAAUrW,cACjCqW,EAAUrW,MAGnB6J,OAAOwD,OAAOwI,EAAexU,KAAKiU,YAAY,IAAKO,KAAkBQ,IAAa,GACnF,EAGH,GAAIoB,EAAiB,CACnB,MAAMgC,EAAepY,KAAK2U,UAAUyB,GACpC,IAAK,MAAMjC,KAAeiE,EAAc,CACtC,MAAMrM,EAAS,GAAGoI,EAAYpI,UAAUiJ,EAAUjT,KAC5CuU,EAAiBtW,KAAK2U,UAAU,IAAKK,EAAWjJ,WAEtDuM,qBAAqBhC,EACtB,CACP,KAAW,CACL,MAAMA,EAAiBtW,KAAK2U,UAAUK,GAEtCsD,qBAAqBhC,EACtB,CACF,CASD,WAAAiC,CAAYvD,IACLA,GAAWjJ,QAAUiJ,GAAWjT,IACnCtC,MAAMkN,iBAAiB3M,KAAK9I,IAAIsU,OAAQwJ,EAAUjT,IAGpD,MAAMyJ,EAASxL,KAAK2U,UAAUK,GAC9B,GAAKxJ,GAAQxE,OAEb,IAAK,MAAM/P,KAASuU,SACXxL,KAAKwL,OAAOvU,EAAM8U,QACrBiJ,GAAWjJ,QACbtM,MAAM8M,oBAAoBvM,KAAK9I,IAAIsU,OAAQvU,EAAM8U,OAGtD,CASD,YAAAyM,CAAaxD,GACX,MAAMtJ,EAAUsJ,GAAWjT,GACrB0W,EAAYzD,GAAWrW,KAE7B,IAAK+M,IAAY+M,EAAW,OAE5B,MAAMjN,EAASxL,KAAK2U,UAAUK,GAE9BxJ,EAAOkN,SAAQzhB,IACbA,EAAM2e,MAAQ6C,EAAU7C,MACxB3e,EAAM4e,MAAQ4C,EAAU5C,MACxB5e,EAAM6e,MAAQ2C,EAAU3C,KAAK,GAEhC,CAQD,aAAA6C,GACEnQ,OAAOG,OAAO3I,KAAKwL,QAAQkN,SAAQzhB,IAC7BA,EAAMwd,QAAQrP,MAAKrO,GAAUA,EAAO6d,WACtC3d,EAAM2hB,YAAa,EAEnB3hB,EAAM2hB,YAAa,CACpB,GAEJ,CAUD,EAAAzB,CAAUnC,GACR,MAAMjT,GAAEA,EAAE1J,KAAEA,EAAImB,KAAEA,EAAIuc,SAAEA,GAAaf,EACrC,MAAO,CAAEjT,KAAI1J,OAAMmB,OAAMoH,MAAOmV,GAAY1d,EAC7C,ECzyBI,MAAMwgB,WACX,WAAA/Y,CAAYP,EAAgBgT,EAAe7D,EAAa7B,GACtD7M,KAAKT,eAAiBA,EACtBS,KAAK0O,YAAcA,EACnB1O,KAAK6M,OAASA,EACd7M,KAAKqT,cAAgB,IAAIf,cAAcC,EAAe7D,GACtD1O,KAAKuR,aAAe,IAAI6B,aAAapT,KAAMuS,EAAe7D,EAAa1O,KAAKqT,eAC5ErT,KAAKwR,cAAgBe,EAAcuG,qBAAqB9Y,KAAMA,KAAK0O,YAAa1O,KAAKuR,cACrFvR,KAAK7B,YAAcoU,EAAcwG,mBAAmB/Y,MACpDA,KAAKgZ,iBAAmB,IAAI3H,iBAAiBrR,KAC9C,CAOD,UAAM8M,CAAKnC,GAGT,GAFA3K,KAAKgZ,iBAAiBlM,QAEhB9M,KAAKgZ,iBAAiBrH,cAAgB3R,KAAKiZ,aAAc,OAAO,EAEtE,MAAM7X,EAAuB,iBAAZuJ,GAA8B3K,KAAKgZ,iBAAiBlH,YAAe,CAAE4E,WAAW,GAAS,CAAA,EAI1G,aAFM1W,MAAKkZ,EAAU9X,IAEd,CACR,CAQD,YAAA+X,GACEnZ,KAAK9I,IAAM,GACX8I,KAAKuR,aAAaoB,YAClB3S,KAAKqT,cAAcV,YACnB3S,KAAKwR,cAAcmB,WACpB,CAQD,YAAAyG,GACEpZ,KAAKmZ,eACLnZ,KAAKuR,aAAaqB,YAClB5S,KAAKqT,cAAcT,WACpB,CAQD,OAAMsG,CAAU9X,GACd1C,GAAOnB,MAAM,kBAAmB,CAAEyE,MAAOhC,KAAKgC,MAAON,MAAO1B,KAAK0B,QAE7D1B,KAAKqZ,eAAetX,KAAO/B,KAAKgC,OAAOD,GACzC/B,KAAK8R,aAAc,GAEnB9R,KAAKqZ,cAAgBrZ,KAAKgC,MAC1BhC,KAAK8R,aAAc,GAGrB9R,KAAKmZ,qBAECnZ,KAAKqT,cAAcvG,aACnB9M,KAAKuR,aAAazE,OAEnB9M,KAAK0O,YAAYe,YAAezP,KAAKsZ,2BACxC5a,GAAOC,KAAK,iDAAiD,GAC7DqB,KAAKsZ,0BAA2B,GAGlCtZ,KAAK9I,UAAY8I,MAAKuZ,UAEhBvZ,KAAKwR,cAAcgI,mBACzBxZ,KAAKuR,aAAaoH,sBACZ3Y,KAAKuR,aAAakF,WAAWrV,GAEnC1C,GAAOnB,MAAM,YAAa,CAAErG,IAAK8I,KAAK9I,IAAK8K,MAAOhC,KAAKgC,MAAON,MAAO1B,KAAK0B,OAC3E,CASD,OAAM6X,GACJ7a,GAAOnB,MAAM,mBAAoB,CAAEyE,MAAOhC,KAAKgC,MAAON,MAAO1B,KAAK0B,QAElE,MAAMrJ,EAAQoH,MAAMC,WAAW,wBAC3BM,KAAKgZ,iBAAiB9G,eAAiB5S,KAAKyF,KAAKE,SAAS,2BAC1D,GACEzD,EAAUxB,KAAKgC,OAAOD,IAAM,QAC5BN,EAAUzB,KAAK0B,OAAOK,IAAM,QAC5B7K,EAAM,CAAEmB,OAAMoJ,UAASD,UAASgK,OAAQ,IAExCA,QAAexL,KAAKuR,aAAawC,cAAc7c,GAIrD,OAHA8I,KAAKwR,cAAciI,eAAejO,GAElC9M,GAAOnB,MAAM,eAAgB,CAAErG,MAAK8K,MAAOhC,KAAKgC,MAAON,MAAO1B,KAAK0B,QAC5DxK,CACR,CASD,cAAAwiB,CAAeC,EAAWvX,GACxB,MAAMnL,EAAS,CAAC,cAAcuM,SAASmW,GAAc3Z,KAAK0U,SAAStS,GAAS,KACtErL,EAAU,CAAC,cAAe,eAAeyM,SAASmW,GAAc3Z,KAAK4Z,UAAUxX,GAAS,KAE9FpC,MAAK6Z,EAAoBzX,GACzBpC,MAAK8Z,EAAY1X,GAEjB,IACE,OAAQuX,GACN,IAAK,aACH3Z,KAAK7B,YAAY4b,qBAAqB3X,EAAOnL,GAC7C,MACF,IAAK,cACH+I,KAAK7B,YAAY6b,sBAAsB5X,EAAOrL,EAAQiJ,KAAKwR,eAC3D,MACF,IAAK,cACHxR,KAAK7B,YAAY8b,sBAAsB7X,EAAOrL,GAEnD,CAAC,MAAMmI,GACNR,GAAOQ,MAAMkD,EACd,CACF,CAOD,EAAAyX,CAAoBzX,GAClBpC,MAAKka,EAAiB9X,GACtBpC,MAAKma,EAAU/X,GACfpC,MAAKoa,EAAWhY,GAChBpC,MAAKqa,EAAYjY,EAClB,CASD,EAAA8X,CAAiB9X,GACf,MAAMkY,EAASlY,GAAOmY,eAAeD,QAAUlY,EAAMkY,OACrDta,KAAKwa,aAA0B,IAAXF,CACrB,CASD,EAAAH,CAAU/X,GACR,MAAMqY,EAAkBnb,KAAKob,SAASC,iBAAiBrU,gBAAgBsU,cAAcC,KACjFzY,EAAM0Y,SAAWL,GACnB/b,GAAOnB,MAAM,gCACb+I,gBAAgByU,iBAAgB,EAAO,UAAW,CAAED,QAAQ,EAAME,OAAO,IACzE1b,KAAKob,SAASO,SAAS3R,IAAI,WAC3BtJ,KAAKkb,OAAQ,GAEblb,KAAKkb,MAAQT,CAEhB,CASD,EAAAL,CAAWhY,GACT,MAAMqY,EAAkBnb,KAAKob,SAASC,iBAAiBrU,gBAAgBsU,cAAcO,SACjF/Y,EAAMgZ,UAAYX,GACpB/b,GAAOnB,MAAM,iCACb+I,gBAAgByU,iBAAgB,EAAO,cAAe,CAAEK,SAAS,EAAMJ,OAAO,IAC9E1b,KAAKob,SAASO,SAAS3R,IAAI,eAC3BtJ,KAAKqb,QAAS,GAEdrb,KAAKqb,OAASZ,CAEjB,CASD,EAAAJ,CAAYjY,GACV,MAAMqY,EAAkBnb,KAAKob,SAASC,iBAAiBrU,gBAAgBsU,cAAcU,OACjFlZ,EAAMmZ,WAAad,GACrB/b,GAAOnB,MAAM,kCACb+I,gBAAgByU,iBAAgB,EAAO,YAAa,CAAEQ,UAAU,EAAMP,OAAO,IAC7E1b,KAAKob,SAASO,SAAS3R,IAAI,aAC3BtJ,KAAKwb,SAAU,GAEfxb,KAAKwb,QAAUf,CAElB,CASD,EAAAX,CAAY1X,GACVpC,KAAKyb,QAAU,CAAC,aAAc,YAAa,gBAAgBjY,SAASpB,EAAM5I,KAC3E,CASD,QAAAkb,CAAStS,GACP,MAAMsZ,EAAejc,MAAM0C,uBAAuBC,GAC5C2J,EAAS2P,GAAcC,SAAS5P,OACtC,OAAO/L,KAAKuR,aAAamD,SAAS,CAAE3I,YAAa,IAClD,CASD,SAAA6N,CAAUxX,GACR,IAAKA,EAAO,MAAO,GACnB,MAAMwZ,EAAsBxZ,EAAMC,OAAOC,QAAQ,+BAC5CF,EAAMC,OAAO4G,cAAc,8BAC1B4S,EAAWD,GAAqBD,SAASE,SAC/C,OAAKA,GACE7b,KAAKwR,cAAcsK,iBAAiB5Z,IAAI2Z,IADzB,EAEvB,CASD,gBAAI5C,GACF,QAAKxZ,MAAMC,WAAW,cAClBJ,KAAK2E,KAAKoB,MACP5F,MAAMe,WAAWlB,KAAK2E,KAAK8X,KAAMtc,MAAMC,WAAW,UAC1D,CAMD,iBAAIwS,GACF,OAAOlS,KAAKgZ,kBAAkB9G,aAC/B,CAED,SAAIlQ,GACF,OAAOhC,KAAKgZ,kBAAkBhX,KAC/B,CAED,SAAIA,CAAMA,GACRhC,KAAKgZ,iBAAiBhX,MAAQA,CAC/B,CAED,UAAIC,GACF,OAAOjC,KAAKgZ,kBAAkB/W,MAC/B,CAED,UAAIA,CAAOA,GACTjC,KAAKgZ,iBAAiB/W,OAASA,CAChC,CAED,SAAIP,GACF,OAAO1B,KAAKgZ,kBAAkBtX,KAC/B,CAED,SAAIA,CAAMA,GACR1B,KAAKgZ,iBAAiBtX,MAAQA,CAC/B,CAED,UAAIE,GACF,OAAO5B,KAAKgZ,kBAAkBpX,MAC/B,CAED,UAAIA,CAAOA,GACT5B,KAAKgZ,iBAAiBpX,OAASA,CAChC,sSCjUF,SAASwQ,EAAE4J,GAAG,IAAInU,EAAEA,GAAG,CAAE,EAAC,mBAAmBA,GAAGA,EAAEoU,IAAIpU,EAAE,GAAGmU,GAAqDxW,GAAA0W,QAAeF,GAAgE,CAA/L,CAAiMhc,cAAiB,IAAIoS,EAAE4J,EAAE,EAAEnU,EAAE,CAAE,EAACsU,EAAE,CAAA,EAAGC,GAAGhK,EAAEiK,OAAOC,kBAAkBD,OAAOE,uBAAuB,SAASP,EAAEnU,GAAGmU,GAAG,IAAIA,EAAEQ,WAAWpK,EAAE,IAAIA,GAAC,SAAWA,EAAE4J,GAAGnU,EAAEuK,EAAG,IAAGqK,QAAQT,EAAE,CAACU,WAAU,EAAGC,SAAQ,IAAKN,OAAOO,kBAAkBZ,EAAEY,iBAAiB,kBAAkB/U,GAAE,GAAI,GAAG,SAASV,EAAEiL,EAAE4J,GAAG,IAAI5J,EAAE,OAAOpS,KAAKgc,EAAEA,GAAG,CAAE,EAAChc,KAAK6c,UAAUzK,EAAEpS,KAAK8c,IAAId,EAAEc,IAAI9c,KAAK5I,SAAS,CAAC2lB,SAAS,IAAIC,UAAU,CAAA,GAAIxU,OAAOwD,OAAOhM,KAAK5I,SAAS4kB,GAAGhc,KAAKid,QAAQb,EAAEpc,KAAK6c,UAAU7c,KAAKid,MAAMC,KAAKld,OAAOA,KAAKmd,YAAY,CAAC,OAAOhW,EAAEiW,UAAU,CAACC,UAAU,WAAW,KAAAJ,GAAQ,IAAIjd,KAAK6c,UAAUS,YAAY5E,SAAStG,IAAI,GAAG,GAAGA,EAAEoK,SAAS,OAAOpK,EAAEmL,WAAWC,YAAYpL,GAAGA,EAAEqL,QAAQzd,KAAK5I,SAAS2lB,YAAY3K,EAAEsL,WAAU,EAAI,IAAG1d,KAAK2d,IAAI3d,KAAK4d,YAAY5d,KAAK6c,UAAUgB,kBAAkB,EAAE,QAAAC,CAAS1L,EAAE4J,GAAG,IAAInU,GAAE,EAAGsU,EAAEnc,KAAK,OAAO,SAASoc,GAAGvU,IAAIuK,EAAE2L,KAAK5B,EAAEC,GAAGvU,GAAE,EAAGvH,YAAU,IAAMuH,GAAE,GAAImU,GAAG,CAAC,EAAE,eAAAgC,CAAgB5L,GAAG,IAAIA,EAAE9P,QAAQ,OAAO,KAAK,IAAI0Z,EAAE5J,EAAE9P,QAAQ,sBAAsB,OAAOtC,KAAK8c,KAAKjV,EAAEiV,IAAId,EAAE,IAAI,EAAE,SAAAiC,CAAU7L,EAAE4J,GAAGnU,EAAE7H,KAAK,IAAImc,EAAEC,EAAEpc,KAAKge,gBAAgBhC,GAAGI,GAAGpc,KAAKke,oBAAoBle,KAAKme,OAAOne,KAAKoe,kBAAkBpe,KAAKqC,OAAOrC,KAAKoe,kBAAkBjC,EAAEC,EAAEiC,wBAAwBre,KAAKme,OAAOG,IAAIlC,EAAEpc,KAAKme,OAAOI,IAAIve,KAAKwe,aAAapC,GAAGpc,KAAKme,OAAOM,KAAKC,MAAMvC,EAAEuC,MAAM1e,KAAKme,OAAOM,KAAKE,OAAOxC,EAAEwC,OAAOvM,EAAEwM,aAAaC,cAAc,OAAO7e,KAAK5I,SAAS4lB,UAAU8B,WAAW9e,KAAK5I,SAAS4lB,UAAU8B,UAAU9e,KAAKme,OAAOG,IAAIlM,GAAG9R,WAAWN,KAAK+e,eAAe7B,KAAKld,QAAQ6H,EAAE,EAAE,EAAE,cAAAkX,GAAiB,IAAI3M,EAAE,YAAYpS,KAAK5I,SAAS4nB,KAAK,SAAS,QAAQhf,KAAK6c,UAAUzT,UAAUE,IAAI,GAAGtJ,KAAKqd,wBAAwBrd,KAAKme,OAAOG,IAAI/f,MAAM6T,GAAGpS,KAAKme,OAAOM,KAAKrM,GAAG,KAAKpS,KAAKme,OAAOG,IAAIlV,UAAUE,IAAI,GAAGtJ,KAAKqd,sBAAsB,EAAE,QAAA4B,CAAS7M,GAAGA,EAAE8M,iBAAiB9M,EAAE+M,kBAAkB,IAAInD,EAAE5J,EAAE/P,OAAO,IAAI2Z,EAAEhc,KAAKge,gBAAgBhC,KAAKhc,KAAKqC,OAAO,CAAC,IAAIwF,EAAE7H,KAAKqC,OAAOic,IAAInC,EAAEnc,KAAKqC,OAAO+c,eAAehN,EAAEwM,aAAaS,WAAW,OAAOrf,KAAKqC,OAAO+c,eAAepf,KAAKsf,mBAAmBlN,GAAGvK,GAAGmU,GAAGG,GAAGnc,KAAKqC,OAAO+c,gBAAgBpf,KAAKuf,wBAAwBnN,EAAE4J,EAAE,CAAC,EAAE,SAAAwD,CAAUpN,EAAE4J,IAAIA,EAAEhc,KAAKge,gBAAgBhC,KAAKhc,KAAKqC,QAAQrC,KAAKyf,WAAWzD,IAAIhc,KAAKme,OAAOG,KAAKtC,GAAGhc,KAAKme,OAAOG,MAAMte,KAAKqC,OAAOqd,SAAS1D,EAAEqC,wBAAwB,EAAE,uBAAAkB,CAAwBnN,EAAE4J,GAAG,IAAInU,EAAEuK,EAAE8M,iBAAiB9M,EAAE+M,kBAAkB/M,EAAEwM,aAAaS,WAAW,OAAOrf,KAAKyf,WAAWzD,IAAIhc,KAAKme,OAAOG,KAAKtC,GAAGhc,KAAKme,OAAOG,MAAMlM,EAAEwM,aAAaS,WAAW,OAAOrf,KAAK2f,oBAAoB3f,KAAKqC,OAAOic,IAAItC,EAAEhc,KAAKqC,OAAOkc,IAAIve,KAAKwe,aAAaxC,GAAGA,EAAE5S,UAAUE,IAAI,QAAQzB,EAAEf,KAAK8Y,IAAI5f,KAAKqC,OAAOkc,IAAIve,KAAKme,OAAOI,KAAKve,KAAKme,OAAOG,IAAIlV,UAAUyW,OAAO,GAAG7f,KAAKqd,kBAAkBxV,EAAE,GAAG,YAAY7H,KAAK5I,SAAS4nB,KAAKhf,KAAKqC,OAAOic,IAAI/f,MAAMyB,KAAKqC,OAAO+c,eAAe,eAAe,aAAapf,KAAKme,OAAOM,KAAKE,OAAO3e,KAAK2d,IAAI,KAAK3d,KAAKqC,OAAOic,IAAI/f,MAAMyB,KAAKqC,OAAO+c,eAAe,cAAc,cAAcpf,KAAKme,OAAOM,KAAKC,MAAM1e,KAAK2d,IAAI,KAAK,EAAE,OAAAmC,CAAQ1N,GAAG,GAAG7R,aAAaP,KAAK+f,iBAAiB/f,KAAK+f,gBAAgB,KAAK/f,KAAK6c,UAAUzT,UAAUC,OAAO,GAAGrJ,KAAKqd,yBAAyBrd,KAAKyf,WAAWzf,KAAKqC,OAAOic,KAAK,OAAOte,KAAKggB,UAAU,IAAIhE,EAAEhc,KAAKqC,OAAO+c,eAAepf,KAAKqC,OAAOic,IAAI2B,mBAAmBjgB,KAAKqC,OAAOic,IAAI,OAAOte,KAAKme,OAAOG,KAAKte,KAAKqC,OAAOic,KAAKte,KAAKqC,OAAOic,MAAMte,KAAKqC,OAAOic,IAAIlV,UAAUE,IAAI,GAAGtJ,KAAKqd,qBAAqBrd,KAAKggB,UAAUhgB,KAAK6c,UAAUqD,aAAalgB,KAAKme,OAAOG,IAAItC,IAAIhc,KAAKme,OAAOG,KAAKte,KAAKme,OAAOG,IAAIlV,UAAUC,OAAO,GAAGrJ,KAAKqd,sBAAsB,GAAGrd,KAAKqd,mBAAmBrd,KAAK5I,SAAS4lB,UAAUmD,SAASngB,KAAK5I,SAAS4lB,UAAUmD,QAAQngB,KAAKme,OAAOG,KAAKte,IAAI,EAAE,iBAAAogB,GAAoB,OAAOpgB,KAAK6c,UAAUwD,kBAAkBrgB,KAAKqC,OAAOic,GAAG,EAAE,kBAAAgB,CAAmBlN,GAAG,GAAGpS,KAAKqC,OAAOqd,SAAS,MAAM,YAAY1f,KAAK5I,SAAS4nB,KAAK5M,EAAEkO,MAAMtgB,KAAKqC,OAAOqd,SAASa,IAAIvgB,KAAKqC,OAAOqd,SAASf,OAAO,EAAE,EAAE,EAAEvM,EAAEoO,MAAMxgB,KAAKqC,OAAOqd,SAASe,KAAKzgB,KAAKqC,OAAOqd,SAAShB,MAAM,EAAE,EAAE,CAAC,EAAE,YAAAF,CAAapM,GAAG,IAAI,IAAI4J,EAAE,EAAE5J,EAAEA,EAAEsO,iBAAiB,GAAGtO,EAAEoK,UAAU,QAAQmE,KAAKvO,EAAEhT,OAAO4c,IAAI,OAAOA,CAAC,EAAE,UAAAyD,CAAWrN,GAAG,OAAOA,GAAGA,EAAEoK,UAAUpK,EAAEmL,YAAYvd,KAAK6c,SAAS,EAAE,iBAAAqB,GAAoB,IAAIle,KAAK6c,UAAU5L,UAAUyH,SAAStG,IAAIA,EAAEwO,aAAa,yBAAyBxO,EAAEyO,aAAa,SAAU,GAAE,EAAE,OAAAb,GAAUnY,EAAE,CAAA,EAAG,IAAI7H,KAAK6c,UAAU5L,UAAUyH,SAAStG,IAAIA,EAAE7T,MAAM6T,EAAEyO,aAAa,0BAA0BzO,EAAE0O,gBAAgB,0BAA0BxgB,YAAU,KAAO8R,EAAEhJ,UAAUC,OAAO,GAAGrJ,KAAKqd,kBAAkB,GAAGrd,KAAKqd,oBAAoB,GAAGrd,KAAKqd,sBAAuB,GAAE,GAAI,GAAE,EAAE,iBAAAsC,GAAoB,MAAMrB,IAAIlM,GAAGpS,KAAKqC,OAAO+P,IAAIA,EAAEhJ,UAAUC,OAAO,GAAGrJ,KAAKqd,kBAAkB,GAAGrd,KAAKqd,mBAAmBjL,EAAE7T,MAAM6T,EAAEyO,aAAa,0BAA0B,EAAEzC,gBAAgB,KAAK,CAACE,IAAI,KAAKG,KAAK,CAAA,IAAK,WAAAb,CAAYxL,GAAG,IAAI4J,EAAE+E,iBAAiB3O,GAAGvK,EAAEkZ,iBAAiB3O,EAAEmL,YAAYpB,EAAE,YAAYnc,KAAK5I,SAAS4nB,KAAK5C,EAAE4E,SAASnZ,EAAE8V,MAAM,EAAE,OAAOqD,SAAShF,EAAE,UAAUG,EAAE,MAAM,UAAU6E,SAAShF,EAAE,UAAUG,EAAE,SAAS,WAAWC,CAAC,EAAE,UAAAe,CAAW/K,GAAG,IAAI,IAAI4J,KAAKhc,KAAKihB,UAAUjhB,KAAKihB,WAAW,CAAChD,UAAU7L,GAAGpS,KAAKie,UAAU7L,EAAEA,EAAE/P,QAAQmd,UAAUpN,GAAGpS,KAAKwf,UAAUpN,EAAEA,EAAE/P,QAAQyd,QAAQ1N,GAAGpS,KAAK8f,QAAQ1N,EAAEA,EAAE/P,QAAQ4c,SAASjf,KAAK8d,SAAS9d,KAAKif,SAAS,MAAMjf,KAAKihB,UAAUjhB,KAAK6c,UAAUzK,EAAE,sBAAsB,oBAAoB4J,EAAEhc,KAAKihB,UAAUjF,GAAG,EAAE,OAAAkF,GAAUlhB,KAAKggB,UAAUhgB,KAAKmd,YAAW,UAAWhB,EAAEnc,KAAK8c,IAAI,GAAG,SAAS1K,EAAEvK,GAAG,OAAOsU,IAAIH,GAAG5J,EAAE+O,SAAShF,EAAE/J,EAAE+O,UAAU,IAAIha,EAAEiL,EAAE,IAAIvK,EAAEiV,IAAId,IAAI5J,EAAE+O,SAASnF,EAAEG,EAAEH,EAAE,CAAE,2DC2Bz1K,IAAI5J,GAAE,UAAU,SAAS4J,EAAE5J,EAAE4J,IAAI,MAAMA,GAAGA,EAAE5J,EAAEpL,UAAUgV,EAAE5J,EAAEpL,QAAQ,IAAI,IAAIa,EAAE,EAAEuZ,EAAE,IAAItX,MAAMkS,GAAGnU,EAAEmU,EAAEnU,IAAIuZ,EAAEvZ,GAAGuK,EAAEvK,GAAG,OAAOuZ,CAAC,CAAC,SAASvZ,EAAEuK,GAAG,OAAO,SAASA,GAAG,GAAGtI,MAAM8B,QAAQwG,GAAG,OAAO4J,EAAE5J,EAAE,CAA3C,CAA6CA,IAAI,SAASA,GAAG,GAAG,oBAAoBiP,QAAQ,MAAMjP,EAAEiP,OAAOC,WAAW,MAAMlP,EAAE,cAAc,OAAOtI,MAAMC,KAAKqI,EAAE,CAA/G,CAAiHA,IAAI,SAASA,EAAEvK,GAAG,GAAIuK,EAAJ,CAAa,GAAG,iBAAiBA,EAAE,OAAO4J,EAAE5J,EAAEvK,GAAG,IAAIuZ,EAAE5Y,OAAO4U,UAAUmE,SAASxD,KAAK3L,GAAG7K,MAAM,GAAG,GAAuD,MAApD,WAAW6Z,GAAGhP,EAAEtS,cAAcshB,EAAEhP,EAAEtS,YAAYzH,MAAS,QAAQ+oB,GAAG,QAAQA,EAAStX,MAAMC,KAAKqX,GAAM,cAAcA,GAAG,2CAA2CT,KAAKS,GAAUpF,EAAE5J,EAAEvK,QAAlF,CAAzL,CAA6Q,CAAxS,CAA0SuK,IAAI,WAAW,MAAM,IAAIoP,UAAU,wIAAwI,CAAvK,EAA0K,CAAC,IAAIJ,GAAE,CAACK,UAAU,WAAW,IAAIrP,EAAE,OAAO,QAAQA,EAAEiK,OAAOqF,oBAAe,IAAStP,GAAGA,CAAC,EAAEnT,IAAI,WAAW,IAAI,IAAImT,EAAEhI,UAAUpD,OAAOgV,EAAE,IAAIlS,MAAMsI,GAAGgP,EAAE,EAAEA,EAAEhP,EAAEgP,IAAIpF,EAAEoF,GAAGhX,UAAUgX,GAAG,IAAIjF,EAAEnc,KAAKyhB,cAActF,EAAEnd,SAASC,IAAI0iB,MAAMxF,EAAE,CAAC,aAAayF,OAAO/Z,EAAEmU,IAAI,EAAE6F,KAAK,WAAW,IAAI,IAAIzP,EAAEhI,UAAUpD,OAAOgV,EAAE,IAAIlS,MAAMsI,GAAGgP,EAAE,EAAEA,EAAEhP,EAAEgP,IAAIpF,EAAEoF,GAAGhX,UAAUgX,GAAG,IAAIjF,EAAEnc,KAAKyhB,cAActF,EAAEnd,SAAS6iB,KAAKF,MAAMxF,EAAE,CAAC,aAAayF,OAAO/Z,EAAEmU,IAAI,GAAGG,EAAE,SAAS/J,EAAE4J,EAAEnU,EAAEuZ,GAAG,OAAOhP,EAAE,GAAGA,EAAE4J,EAAE,GAAGA,EAAEoF,IAAIhP,EAAEA,EAAE0P,OAAO9F,EAAEA,EAAE8F,QAAQja,EAAEuK,GAAG4J,EAAE5J,EAAElR,eAAe8a,EAAE9a,aAAa,EAAEiG,EAAE,SAASiL,EAAE4J,GAAG,OAAO5J,GAAGtI,MAAM8B,QAAQwG,IAAIA,EAAE3P,cAAc2P,GAAG,OAAO2P,EAAE3P,EAAE4J,EAAG,GAAE,EAAE,SAAS+F,EAAE3P,EAAE4J,GAAG,IAAInU,EAAEuZ,EAAE,CAAA,EAAG,IAAIvZ,KAAKuK,EAAE4J,EAAEgG,QAAQna,GAAG,IAAIuZ,EAAEvZ,GAAGuK,EAAEvK,IAAI,OAAOuZ,CAAC,CAAC,SAAShF,EAAEhK,GAAG,OAAM,IAAK6P,WAAWC,gBAAgB9P,EAAE0P,OAAO,aAAaK,KAAKtE,iBAAiB,CAAC,SAASuE,EAAEhQ,EAAE4J,GAAG,IAAIA,EAAEA,GAAG,WAAW5J,EAAEA,EAAE4J,EAAE,YAAY,GAAG,GAAG5J,EAAEoK,SAAS,OAAOpK,CAAC,CAAC,SAASiQ,EAAEjQ,GAAG,MAAM,iBAAiBA,EAAEA,EAAEvR,QAAQ,KAAK,SAASA,QAAQ,KAAK,QAAQA,QAAQ,KAAK,QAAQA,QAAQ,KAAK,UAAUA,QAAQ,OAAO,UAAUuR,CAAC,CAAC,SAASkQ,EAAElQ,GAAG,IAAI4J,EAAExT,OAAO4U,UAAUmE,SAASxD,KAAK3L,GAAGvH,MAAM,KAAK,GAAGtD,MAAM,GAAG,GAAG,OAAO6K,IAAI5J,OAAO4J,IAAI,SAAS4J,GAAG,YAAYA,GAAG,UAAUA,GAAG,sBAAsBA,CAAC,CAAC,SAASuG,EAAEnQ,EAAE4J,EAAEnU,GAAG,IAAIuZ,EAAEjF,EAAE,SAAShV,EAAEiL,EAAE4J,GAAG,IAAI,IAAInU,KAAKmU,EAAE,GAAGA,EAAEwG,eAAe3a,GAAG,CAAC,GAAGya,EAAEtG,EAAEnU,IAAI,CAACya,EAAElQ,EAAEvK,IAAIV,EAAEiL,EAAEvK,GAAGmU,EAAEnU,IAAIuK,EAAEvK,GAAGW,OAAOwD,OAAO,CAAE,EAACgQ,EAAEnU,IAAI,QAAQ,CAAC,GAAGiC,MAAM8B,QAAQoQ,EAAEnU,IAAI,CAACuK,EAAEvK,GAAGW,OAAOwD,OAAO,GAAGgQ,EAAEnU,IAAI,QAAQ,CAACuK,EAAEvK,GAAGmU,EAAEnU,EAAE,CAAC,CAAC,OAAOuZ,EAAEhP,GAAG,OAAO+J,EAAE3T,SAAS,oBAAoB6Y,QAAQlF,EAAEkF,OAAOoB,aAAatG,EAAEkF,OAAOoB,aAAarB,GAAGA,aAAajF,KAAK/J,EAAE,CAAA,GAAIjL,EAAEiL,EAAE4J,GAAGnU,GAAGV,EAAEiL,EAAEvK,GAAGuK,CAAC,CAAC,SAASsQ,IAAI,IAAItQ,EAAE,GAAG4J,EAAE,GAAGnU,GAAE,EAAGuZ,GAAE,EAAGjF,OAAE,EAAO,IAAI,IAAI,IAAIhV,EAAE4a,EAAE3X,UAAUiX,OAAOC,cAAczZ,GAAGV,EAAE4a,EAAEY,QAAQC,MAAM/a,GAAE,EAAG,CAAC,IAAIuU,EAAEjV,EAAEvG,MAAMwhB,GAAE,EAAGC,GAAE,EAAGE,OAAE,EAAO,IAAI,IAAI,IAAIG,EAAEG,GAAEzG,EAAEiF,OAAOC,cAAcc,GAAGM,EAAEG,GAAEF,QAAQC,MAAMR,GAAE,EAAG,CAAC,IAAIU,GAAEJ,EAAE9hB,MAAM0hB,EAAEQ,IAAG9G,EAAE8G,GAAEliB,SAASwR,EAAEhP,KAAK0f,IAAG9G,EAAE8G,GAAEliB,OAAO,GAAGwR,EAAE5O,SAASsf,KAAI1Q,EAAEhP,KAAK0f,GAAE,CAAC,CAAC,MAAM1Q,GAAGiQ,GAAE,EAAGE,EAAEnQ,CAAC,CAAC,QAAQ,IAAIgQ,GAAG,MAAMS,GAAEE,QAAQF,GAAEE,QAAQ,CAAC,QAAQ,GAAGV,EAAE,MAAME,CAAC,CAAC,CAAC,CAAC,CAAC,MAAMnQ,GAAGgP,GAAE,EAAGjF,EAAE/J,CAAC,CAAC,QAAQ,IAAIvK,GAAG,MAAMka,EAAEgB,QAAQhB,EAAEgB,QAAQ,CAAC,QAAQ,GAAG3B,EAAE,MAAMjF,CAAC,CAAC,CAAC,OAAO/J,CAAC,CAAC,SAASyQ,EAAEzQ,GAAG,OAAO3Y,OAAO2jB,UAAU4F,UAAU,iBAAiB5Q,EAAEA,EAAE4Q,UAAU,OAAOniB,QAAQ,mBAAmB,SAAI,EAAOuR,CAAC,CAAC,IAAI0Q,EAAE,WAAW,MAAM,6BAA6BnC,KAAKsC,UAAUC,UAAU,EAAE,SAASC,IAAI,OAAO,CAAC,MAAM,KAAK,KAAK,KAAK,MAAMtiB,QAAQ,mBAAmBuR,GAAG,OAAOA,EAAEgR,OAAOC,gBAAgB,IAAIC,WAAW,IAAI,GAAG,IAAIlR,EAAE,GAAGmP,SAAS,GAAI,GAAE,CAAC,SAASgC,EAAEnR,GAAG,OAAOA,GAAGA,EAAEhJ,WAAWgJ,EAAEhJ,UAAUoa,SAASxjB,KAAK5I,SAASqsB,WAAWC,IAAI,CAAC,SAASC,EAAEvR,GAAG,OAAOA,GAAGA,EAAE9P,QAAQtC,KAAK5I,SAASqsB,WAAWG,YAAY,CAAC,SAASxc,EAAEgL,EAAE4J,GAAG,IAAInU,EAAEwU,OAAOwH,eAAe,OAAO7H,EAAEA,GAAGnU,EAAEic,WAAW,GAAG,iBAAiB1R,IAAIA,EAAExJ,SAASmb,eAAe3R,IAAI4J,IAAIA,EAAEgI,iBAAiBhI,EAAEiI,WAAW7R,IAAIA,CAAC,CAAC,SAAS8R,EAAE9R,EAAE4J,EAAEnU,GAAG,OAAOuK,GAAG4J,IAAI5J,EAAE+R,gBAAgBtc,EAAEmU,EAAEuG,EAAE,CAAE,EAACnQ,EAAE+R,iBAAiB,CAAE,EAACnI,IAAI5J,EAAE+R,kBAAkB/C,GAAES,KAAK,4BAA4B,CAACuC,OAAOhS,EAAEhT,KAAK4c,IAAIA,EAAE,CAAC,SAASqI,EAAEjS,GAAG,GAAGA,GAAGA,EAAEmL,WAAW,CAAC,IAAIvB,EAAE5J,EAAEvK,EAAEwU,OAAOwH,eAAezC,EAAEvZ,EAAEic,WAAW,GAAGjc,EAAEyc,aAAalD,EAAEmD,cAAcvI,GAAGoF,EAAEoD,UAAS,GAAI3c,EAAE4c,kBAAkB5c,EAAE6c,SAAStD,GAAG,CAAC,CAAC,SAASuD,EAAEvS,EAAE4J,GAAG5J,EAAEsG,SAAO,SAAWtG,GAAG,GAAG8R,EAAE9R,EAAEsO,mBAAmBtO,EAAEsO,gBAAgB,CAAC,IAAI7Y,EAAEe,SAASmb,eAAe,KAAK3R,EAAEwS,OAAO/c,GAAGmU,GAAGqI,EAAExc,EAAE,CAAE,GAAE,CAAC,IAAIgd,GAAE,CAACC,WAAW,IAAIC,QAAQ,KAAKC,YAAY,QAAQC,QAAQ,IAAIjI,UAAU,CAAE,EAACkI,cAAa,EAAGC,SAAS,CAAC,OAAO,MAAM,SAASC,mBAAkB,EAAGC,YAAW,EAAGC,UAAU,GAAGC,UAAU,GAAGC,kBAAiB,EAAGC,WAAU,EAAGC,WAAU,EAAGC,iBAAgB,EAAGC,mBAAkB,EAAGC,oBAAoB,aAAaC,oBAAoB,CAAC,KAAK,MAAMC,WAAU,EAAGC,aAAY,EAAGC,aAAY,EAAGC,SAAS,CAACC,OAAO,EAAEC,aAAY,GAAIC,aAAa,WAAY,EAACvE,MAAK,EAAGwE,KAAK,CAACC,eAAc,GAAIC,QAAQ,CAACC,eAAe,KAAKC,aAAa,CAACC,SAAQ,EAAGC,UAAS,EAAGC,QAAO,GAAIpD,WAAW,CAACpG,UAAU,SAASmJ,QAAQ,cAAcM,WAAW,iBAAiBC,MAAM,gBAAgBC,MAAM,gBAAgBC,eAAe,iBAAiBC,WAAW,kBAAkBC,cAAc,qBAAqBC,aAAa,kBAAkBC,WAAW,qBAAqBC,UAAU,iBAAiBC,MAAM,gBAAgBC,aAAa,yBAAyBC,SAAS,mBAAmBC,gBAAgB,4BAA4BC,eAAe,2BAA2BC,eAAe,2BAA2BC,aAAa,yBAAyBC,mBAAmB,iCAAiCC,mBAAmB,iCAAiCC,qBAAqB,mCAAmCC,eAAe,4BAA4BvE,IAAI,cAAcwE,QAAQ,mBAAmBC,KAAK,yBAAyBC,WAAW,uBAAuBC,WAAW,wBAAwBC,SAAS,qBAAqBC,QAAQ,qBAAqBd,SAAS,CAACe,UAAU,GAAG7B,QAAQ,EAAE8B,SAAS,GAAGC,WAAW,CAAC,QAAQ,YAAYC,aAAY,EAAGC,eAAc,EAAGC,gBAAe,EAAGC,qBAAoB,EAAGC,YAAW,EAAGC,gBAAe,EAAGC,eAAc,EAAGC,eAAc,EAAGC,SAAS,MAAMC,aAAa,MAAMC,MAAM,CAACC,gBAAgB,WAAW,OAAOlpB,QAAQC,SAAS,EAAEkpB,YAAY,WAAW,OAAOnpB,QAAQC,SAAS,EAAEmpB,gBAAgB,WAAW,OAAOppB,QAAQC,SAAS,EAAEopB,cAAc,WAAW,OAAOrpB,QAAQC,SAAS,IAAI,SAASqpB,EAAEtX,EAAE4J,EAAEnU,GAAG,OAAOmU,KAAK5J,EAAE5J,OAAOmhB,eAAevX,EAAE4J,EAAE,CAACpb,MAAMiH,EAAE+hB,YAAW,EAAGC,cAAa,EAAGC,UAAS,IAAK1X,EAAE4J,GAAGnU,EAAEuK,CAAC,CAAC,SAAS2X,EAAE3X,GAAG,IAAI,IAAI4J,EAAE,EAAEA,EAAE5R,UAAUpD,OAAOgV,IAAI,CAAC,IAAInU,EAAE,MAAMuC,UAAU4R,GAAG5R,UAAU4R,GAAG,CAAA,EAAGoF,EAAE5Y,OAAOyD,KAAKpE,GAAG,mBAAmBW,OAAOwhB,wBAAwB5I,EAAEA,EAAEQ,OAAOpZ,OAAOwhB,sBAAsBniB,GAAGkJ,iBAAiBqB,GAAG,OAAO5J,OAAOyhB,yBAAyBpiB,EAAEuK,GAAGwX,UAAW,MAAKxI,EAAE1I,SAAO,SAAWsD,GAAG0N,EAAEtX,EAAE4J,EAAEnU,EAAEmU,GAAI,GAAE,CAAC,OAAO5J,CAAC,CAAC,SAAS8X,EAAE9X,EAAE4J,GAAG,OAAOA,EAAE,MAAMA,EAAEA,EAAE,CAAE,EAACxT,OAAO2hB,0BAA0B3hB,OAAO4hB,iBAAiBhY,EAAE5J,OAAO2hB,0BAA0BnO,IAAI,SAAS5J,EAAE4J,GAAG,IAAInU,EAAEW,OAAOyD,KAAKmG,GAAG,GAAG5J,OAAOwhB,sBAAsB,CAAC,IAAI5I,EAAE5Y,OAAOwhB,sBAAsB5X,GAAG4J,IAAIoF,EAAEA,EAAErQ,QAAQ,SAASiL,GAAG,OAAOxT,OAAOyhB,yBAAyB7X,EAAE4J,GAAG4N,UAAW,KAAI/hB,EAAEzE,KAAKue,MAAM9Z,EAAEuZ,EAAE,CAAC,OAAOvZ,CAAC,CAA3N,CAA6NW,OAAOwT,IAAItD,kBAAkB7Q,GAAGW,OAAOmhB,eAAevX,EAAEvK,EAAEW,OAAOyhB,yBAAyBjO,EAAEnU,GAAI,IAAGuK,CAAC,CAAC,SAASiY,EAAEjY,EAAE4J,IAAI,MAAMA,GAAGA,EAAE5J,EAAEpL,UAAUgV,EAAE5J,EAAEpL,QAAQ,IAAI,IAAIa,EAAE,EAAEuZ,EAAE,IAAItX,MAAMkS,GAAGnU,EAAEmU,EAAEnU,IAAIuZ,EAAEvZ,GAAGuK,EAAEvK,GAAG,OAAOuZ,CAAC,CAAC,SAASkJ,EAAElY,EAAE4J,EAAEnU,GAAG,OAAOmU,KAAK5J,EAAE5J,OAAOmhB,eAAevX,EAAE4J,EAAE,CAACpb,MAAMiH,EAAE+hB,YAAW,EAAGC,cAAa,EAAGC,UAAS,IAAK1X,EAAE4J,GAAGnU,EAAEuK,CAAC,CAAC,SAASmY,EAAEnY,GAAG,OAAO,SAASA,GAAG,GAAGtI,MAAM8B,QAAQwG,GAAG,OAAOiY,EAAEjY,EAAE,CAA3C,CAA6CA,IAAI,SAASA,GAAG,GAAG,oBAAoBiP,QAAQ,MAAMjP,EAAEiP,OAAOC,WAAW,MAAMlP,EAAE,cAAc,OAAOtI,MAAMC,KAAKqI,EAAE,CAA/G,CAAiHA,IAAI,SAASA,EAAE4J,GAAG,GAAI5J,EAAJ,CAAa,GAAG,iBAAiBA,EAAE,OAAOiY,EAAEjY,EAAE4J,GAAG,IAAInU,EAAEW,OAAO4U,UAAUmE,SAASxD,KAAK3L,GAAG7K,MAAM,GAAG,GAAuD,MAApD,WAAWM,GAAGuK,EAAEtS,cAAc+H,EAAEuK,EAAEtS,YAAYzH,MAAS,QAAQwP,GAAG,QAAQA,EAASiC,MAAMC,KAAKlC,GAAM,cAAcA,GAAG,2CAA2C8Y,KAAK9Y,GAAUwiB,EAAEjY,EAAE4J,QAAlF,CAAzL,CAA6Q,CAAxS,CAA0S5J,IAAI,WAAW,MAAM,IAAIoP,UAAU,wIAAwI,CAAvK,EAA0K,CAAC,SAASgJ,IAAI,IAAI,IAAIpY,KAAKpS,KAAKynB,SAAS,GAAGznB,KAAKyqB,UAAUzqB,KAAKynB,SAASrV,GAAG,mBAAmBpS,KAAKyqB,UAAUrY,GAAGpS,KAAKyqB,UAAUrY,GAAG8K,KAAKld,MAAMA,KAAKyqB,UAAUrY,GAAGpS,KAAKynB,SAASiD,OAAO1qB,KAAK2qB,IAAIlD,SAASmD,SAAS5qB,IAAI,CAAC,IAAI6qB,GAAEC,GAAEC,IAAGF,GAAE,SAASzY,GAAG,IAAI,IAAI4J,EAAE,EAAEA,EAAE5R,UAAUpD,OAAOgV,IAAI,CAAC,IAAInU,EAAE,MAAMuC,UAAU4R,GAAG5R,UAAU4R,GAAG,CAAE,EAACoF,EAAE5Y,OAAOyD,KAAKpE,GAAG,mBAAmBW,OAAOwhB,wBAAwB5I,EAAEA,EAAEQ,OAAOpZ,OAAOwhB,sBAAsBniB,GAAGkJ,QAAQ,SAASqB,GAAG,OAAO5J,OAAOyhB,yBAAyBpiB,EAAEuK,GAAGwX,UAAW,MAAKxI,EAAE1I,SAAS,SAASsD,GAAGsO,EAAElY,EAAE4J,EAAEnU,EAAEmU,GAAI,GAAE,CAAC,OAAO5J,CAAC,CAArU,CAAuU,CAAA,EAAG,CAAC4Y,OAAO,CAACjlB,QAAQ,WAAW,IAAIqM,IAAIhI,UAAUpD,OAAO,QAAG,IAASoD,UAAU,KAAKA,UAAU,GAAG4R,EAAEhc,KAAKynB,SAASuD,OAAOhO,UAAUnV,EAAE7H,KAAKihB,UAAUwG,SAASznB,KAAKihB,UAAUwG,UAAU,CAAC0B,SAASnpB,KAAKynB,SAAS0B,SAASjM,KAAKld,KAAK,MAAMirB,UAAUjP,EAAEiP,UAAU/N,KAAKld,MAAMkrB,YAAYlP,EAAEkP,YAAYhO,KAAKld,MAAMmrB,aAAanP,EAAEmP,aAAajO,KAAKld,MAAMorB,QAAQpP,EAAEoP,QAAQlO,KAAKld,MAAMqrB,SAASrP,EAAEqP,SAASnO,KAAKld,OAAOohB,EAAEhP,EAAE,mBAAmB,sBAAsB,UAAUpS,KAAK5I,SAASqwB,SAAS0B,WAAWvgB,SAASwY,GAAG,SAASvZ,EAAEshB,UAAS,GAAI9M,OAAO+E,GAAG,SAASvZ,EAAEshB,UAAU9M,OAAO+E,GAAG,UAAUvZ,EAAEojB,YAAYjrB,KAAK2qB,IAAIlD,SAASrG,GAAG,YAAYvZ,EAAEqjB,aAAalrB,KAAK2qB,IAAIlD,SAASrG,GAAG,aAAavZ,EAAEsjB,cAAcnrB,KAAK2qB,IAAIlD,SAASrG,GAAG,YAAYvZ,EAAEujB,SAASprB,KAAK2qB,IAAIlD,SAAStU,QAAQiO,GAAG,SAASvZ,EAAEwjB,SAAS,EAAErO,UAAU,CAACiO,UAAU,SAAS7Y,GAAG,IAAI4J,EAAEhc,KAAK,GAAGA,KAAKsrB,MAAMC,WAAWvrB,KAAKsrB,MAAME,UAAU,CAAC,IAAI3jB,EAAE7H,KAAK5I,SAAS+kB,EAAEnc,KAAK2qB,IAAIlD,SAASxe,cAAcpB,EAAE4b,WAAWgI,4BAA4BtkB,EAAEnH,KAAKynB,SAASiE,wBAAwBvP,GAAG4F,EAAE,OAAOla,EAAEmX,KAAK5C,EAAE,UAAUvU,EAAEmX,KAAKnX,EAAEwhB,MAAMI,cAAcrX,EAAE,CAACuZ,OAAO3rB,OAAO0Q,MAAM,SAAS0R,GAAG,OAAOhQ,EAAElO,KAAK,IAAI,YAAY,IAAI,UAAU,IAAI,OAAO,IAAI,KAAKkO,EAAE8M,iBAAiB,IAAImD,EAAErG,EAAEyL,SAASmE,wBAAwBtJ,EAAE,WAAWlQ,EAAElO,KAAK,MAAMkO,EAAElO,IAAIiY,IAAIA,EAAEH,EAAEyL,SAASoE,oBAAoB1P,GAAGmG,IAAInG,GAAGA,EAAEsB,QAAQ5V,EAAE4b,WAAWqI,wBAAwB3P,EAAEkG,EAAEC,EAAED,EAAErb,OAAO,EAAE,IAAIgV,EAAEyL,SAASsE,gBAAgB5P,GAAE,GAAI,MAAM,IAAI,SAAS,IAAI,MAAMH,EAAEyL,SAASuE,OAAO,MAAM,IAAI,aAAa,GAAGhQ,EAAEsP,MAAM7W,QAAQwX,WAAWpkB,EAAE6e,aAAaE,SAAS,OAAO,IAAI,MAAM,IAAIrE,GAAG1a,EAAE6e,aAAaE,WAAW/e,EAAE6e,aAAaG,OAAO,IAAI9E,IAAI3F,GAAGD,GAAGoG,IAAIvG,EAAEsP,MAAMY,SAAS/kB,EAAE,CAACiL,EAAE8M,iBAAiB,IAAIwD,EAAE1G,EAAEyL,SAAS0E,eAAehlB,GAAG,OAAO6U,EAAE+K,MAAMqF,aAAa/nB,IAAI0Z,KAAK/B,EAAE0G,IAAG,CAAE,CAAC,OAAM,EAAG,IAAI,QAAQtQ,EAAE8M,iBAAiBrX,EAAEwhB,MAAMG,gBAAgBpX,EAAE,CAACuZ,OAAO3P,EAAEqQ,QAAQllB,EAAEmlB,cAAcnQ,IAAIzL,MAAI,WAAa,GAAGyL,EAAE,OAAOH,EAAEyL,SAAS8E,aAAapQ,GAAGA,EAAEH,EAAEyL,SAASoE,oBAAoB1P,GAAGmG,QAAQtG,EAAEyL,SAASsE,gBAAgB5P,GAAGH,EAAEyL,SAASuE,OAAOjK,GAAG/F,EAAEwQ,QAAQxQ,EAAEsP,MAAMmB,UAAU3K,QAAO,EAAI,IAAG/T,OAAO,SAASqE,GAAG,OAAOgP,GAAES,KAAKzP,EAAG,IAAG,MAAM,IAAI,YAAY,GAAG2P,GAAG/F,EAAEsP,MAAMY,QAAQ1vB,MAAM,OAAO,IAAIqmB,GAAE7G,EAAE+K,MAAM2F,IAAI3O,KAAK/B,GAAG,IAAI6G,IAAG,MAAMA,GAAE8J,WAAW,MAAK,IAAK9kB,EAAEke,UAAU/J,EAAE4Q,aAAa,QAAQ/kB,EAAEke,WAAWzlB,WAAW0b,EAAE6Q,QAAQ3P,KAAKlB,GAAG,IAAK,GAAE,CAAC,EAAEkP,YAAY,SAAS9Y,GAAG,IAAI4J,EAAE5J,EAAE/P,OAAOC,QAAQtC,KAAK5I,SAASqsB,WAAWqI,sBAAsB9rB,KAAKynB,SAASsE,gBAAgB/P,EAAE,EAAEmP,aAAa,SAAS/Y,GAAGpS,KAAKynB,SAASsE,iBAAiB,EAAEX,QAAQ,SAAShZ,GAAG,IAAI4J,EAAEhc,KAAK,GAAG,GAAGoS,EAAEkI,QAAQlI,EAAE/P,QAAQrC,KAAK2qB,IAAIlD,UAAUrV,EAAE/P,QAAQrC,KAAK2qB,IAAIlD,SAAStU,QAAQ,CAAC,IAAItL,EAAEuK,EAAE/P,OAAOC,QAAQtC,KAAK5I,SAASqsB,WAAWqI,sBAAsB3P,EAAEnc,KAAKynB,SAASiE,wBAAwB7jB,GAAG7H,KAAKsrB,MAAM7W,QAAQ8X,cAAa,EAAGjsB,YAAU,WAAa,OAAO0b,EAAEsP,MAAM7W,QAAQ8X,cAAa,CAAG,GAAE,IAAIvsB,KAAK5I,SAASiyB,MAAMG,gBAAgBpX,EAAE,CAACuZ,OAAO3rB,KAAKqsB,QAAQlQ,EAAEmQ,cAAczkB,IAAI6I,iBAAiB7I,EAAEmU,EAAEyL,SAAS8E,aAAa1kB,EAAEuK,GAAG4J,EAAEyL,SAASuE,MAAO,IAAGje,OAAK,SAAWqE,GAAG,OAAOgP,GAAES,KAAKzP,EAAG,GAAE,CAAC,EAAEiZ,SAAS,SAASjZ,GAAG,IAAI4J,EAAE5J,EAAE/P,OAAOwF,EAAEmU,EAAE8Q,WAAW9Q,EAAE+Q,aAAa/Q,EAAEuB,WAAWyP,cAAc,IAAIhtB,KAAK2K,QAAQ,kBAAkB,CAACsiB,WAAWnmB,KAAKomB,MAAMrlB,IAAI,IAAIslB,SAAS,SAAS/a,GAAGA,EAAEA,GAAGpS,KAAKsrB,MAAM7D,SAAS2F,OAAO,GAAGptB,KAAKqtB,mBAAmBrtB,KAAKynB,SAAS6F,gBAAgBlb,GAAGpS,KAAKynB,SAAS8F,OAAOvtB,KAAKqtB,mBAAmBrmB,QAAQhH,KAAKynB,SAASuE,OAAOhsB,KAAK2K,QAAQ,mBAAmB3K,KAAK2qB,IAAIlD,SAAS,EAAEiE,wBAAwB,SAAStZ,GAAG,IAAI,IAAI4J,EAAEnU,EAAEuK,GAAGA,EAAEyO,aAAa,SAASO,EAAEphB,KAAKqtB,mBAAmBrmB,OAAOoa,KAAK,CAAC,GAAGkB,EAAEtG,EAAEhc,KAAKqtB,mBAAmBjM,KAAKpF,EAAEpb,OAAOiH,EAAE,OAAOmU,EAAE,GAAGA,GAAGnU,EAAE,MAAM,CAACjH,MAAMob,EAAE,CAAC,EAAE6P,oBAAoB,SAASzZ,GAAG,IAAI4J,IAAI5R,UAAUpD,OAAO,QAAG,IAASoD,UAAU,KAAKA,UAAU,GAAGvC,EAAE7H,KAAKynB,SAASmE,wBAAwBxK,EAAEvZ,EAAE2lB,WAAS,SAAWxR,GAAG,OAAOA,IAAI5J,CAAE,IAAG,OAAO4J,EAAEnU,EAAEuZ,EAAE,GAAGvZ,EAAEuZ,EAAE,EAAE,EAAE2K,gBAAgB,SAAS3Z,EAAE4J,GAAG,IAAInU,EAAEuZ,EAAEphB,KAAK5I,SAASqsB,WAAWqE,mBAAmB,GAAG9nB,KAAKsrB,MAAMmC,YAAYztB,KAAKsrB,MAAMmC,UAAUrkB,UAAUC,OAAO+X,GAAGphB,KAAKsrB,MAAMmC,UAAU3M,gBAAgB,mBAAmB1O,EAAE,OAAOpS,KAAKsrB,MAAMoC,WAAW,KAAK1tB,KAAKsrB,MAAMmC,UAAU,UAAUztB,KAAK+mB,MAAMqF,aAAauB,QAAQ5P,KAAK/d,MAAM6H,EAAE7H,KAAKynB,SAASiE,wBAAwBtZ,GAAGpS,KAAKsrB,MAAMoC,WAAW7lB,EAAE7H,KAAKsrB,MAAMmC,UAAUrb,EAAEA,EAAEhJ,UAAUE,IAAI8X,GAAGhP,EAAEwO,aAAa,iBAAgB,GAAI5E,IAAI5J,EAAEmL,WAAWuP,UAAU1a,EAAE4a,aAAa5a,EAAEwb,UAAUxb,EAAEmL,WAAWyP,cAAchtB,KAAK5I,SAASsvB,eAAe1mB,KAAK+mB,MAAMqF,aAAauB,QAAQ5P,KAAK/d,KAAK6H,GAAG7H,KAAKynB,SAAS0B,WAAW,EAAEoD,aAAa,SAASna,EAAE4J,GAAG,IAAInU,EAAE7H,KAAKohB,EAAEphB,KAAK5I,SAAS+kB,EAAEiF,EAAEqG,SAAStgB,EAAEgV,EAAE+M,cAAcnH,EAAE5F,EAAE8M,cAAc,IAAI7W,EAAE,OAAOpS,KAAKwsB,QAAQxsB,KAAKsrB,MAAMmB,WAAU,QAAS1K,GAAG/hB,KAAKynB,SAASuE,QAAQhQ,EAAEA,GAAG,CAAE,EAAC,IAAII,EAAEhK,EAAEyO,aAAa,SAASuB,EAAE,WAAWhG,EAAEiG,EAAE,OAAOjB,EAAEpC,KAAKsD,EAAEtiB,KAAKqtB,mBAAmBvrB,eAAesQ,GAAG,IAAI4J,EAAE,OAAO,QAAQA,EAAE5J,EAAExR,aAAQ,IAASob,EAAEA,EAAE5J,IAAIgK,CAAE,IAAG,GAAGpc,KAAK2K,QAAQ,kBAAkB,CAACvL,KAAKkjB,EAAEhE,IAAIlM,EAAEhQ,MAAM4Z,IAAIsG,GAAGF,EAAE,CAAC,GAAGpiB,KAAKsrB,MAAMY,QAAQ,CAAC,IAAIxJ,EAAE1iB,KAAK6tB,cAAc,CAACvL,IAAI,GAAGA,EAAElB,EAAEiF,aAAatI,KAAK/d,KAAK0iB,IAAIA,EAAE1iB,KAAK8tB,cAAc,KAAKvL,EAAE,CAACwL,WAAU,GAAIzL,GAAG,MAAMtiB,KAAKqiB,EAAE,aAAa,WAAW,CAACC,GAAGtiB,KAAK+mB,MAAM2F,IAAI3O,KAAK/d,OAAOmH,IAAIkb,GAAGriB,KAAK2qB,IAAI5D,MAAMxJ,cAAcjd,YAAY,WAAWuH,EAAE8iB,IAAI5D,MAAMC,QAAQnf,EAAEmmB,kBAAiB,EAAI,IAAGjM,GAAGzhB,WAAWN,KAAKynB,SAASuE,KAAK9O,KAAKld,OAAOoS,EAAEwK,iBAAiB,iBAAe,WAAa/U,EAAE4f,SAASwG,mBAAmB3tB,YAAY,WAAW8R,EAAE/I,SAASxB,EAAE4f,SAAS0F,UAAW,GAAE,IAAK,GAAE,CAACe,MAAK,IAAK9b,EAAEhJ,UAAUE,IAAItJ,KAAK5I,SAASqsB,WAAWsE,oBAAoB,MAAMhG,GAAGzhB,WAAWN,KAAKynB,SAASuE,KAAK9O,KAAKld,MAAM,EAAEmuB,UAAU,SAAS/b,GAAGpS,KAAKqtB,mBAAmBrmB,OAAO,EAAEhH,KAAKynB,SAASuE,OAAOhsB,KAAKynB,SAAS6F,gBAAgB,IAAI,IAAItR,EAAEhc,KAAKynB,SAAS6F,gBAAgB,IAAI,OAAOlb,IAAI4J,EAAEhc,KAAKsrB,MAAM7D,SAAS2G,aAAapuB,KAAKwsB,QAAQxQ,GAAE,GAAIhc,IAAI,EAAEstB,gBAAgB,SAASlb,EAAE4J,GAAG,IAAInU,EAAEuZ,EAAEjF,EAAEhV,EAAE4a,EAAE3F,EAAEgG,EAAE,WAAW,IAAIhQ,EAAEgQ,EAAEC,OAAE,EAAOE,QAAE,EAAOnQ,EAAEmR,GAAEc,IAAGjD,GAAG,OAAOgB,EAAE5Z,SAAS,oBAAoB6Y,QAAQe,EAAEf,OAAOoB,aAAaL,EAAEf,OAAOoB,aAAarQ,GAAGA,aAAagQ,GAAGmB,GAAEc,IAAG,CAACzjB,MAAM2iB,GAAEc,KAAI,IAAIV,GAAEvc,GAAGoB,OAAOyD,KAAKmV,GAAGhc,MAAI,SAAWgN,GAAG,OAAO8R,GAAE1gB,SAAS4O,EAAG,IAAa8R,GAAV,CAAC,SAAWxB,EAAEiG,cAAc3M,EAAEqS,OAAOlnB,EAAEC,GAAEjB,iBAAiBiM,EAAE4J,GAAG,OAAO5J,EAAE,KAAKgP,EAAEpF,IAAI,GAAI,GAAE,IAAI9a,cAAc4gB,OAAOY,EAAEmG,iBAAiB1hB,EAAE0b,EAAE1b,GAAGiV,EAAEyG,EAAEzG,IAAIiG,EAAE,GAAGlb,EAAE6a,QAAQ5F,GAAGmG,GAAEpb,IAAIiV,EAAEuH,GAAExc,EAAEgV,EAAEC,EAAElb,cAAc2J,MAAM,KAAK9H,gBAAgBqP,GAAG,OAAOuR,GAAEngB,SAAS4O,EAAElR,cAAe,MAAKmhB,GAAE,EAAGlG,EAAE/U,GAAEhC,eAAegN,GAAG,IAAIvK,EAAE,IAAIuZ,EAAEhP,IAAI,IAAI,OAAOsQ,EAAEmG,iBAAiBhhB,EAAEgb,EAAEhb,GAAGuU,EAAEyG,EAAEzG,IAAIsG,EAAEkG,gBAAgB/gB,EAAEA,EAAE3G,eAAeqhB,GAAE1a,IAAIuU,EAAEJ,EAAEqS,MAAMxmB,IAAIuU,EAAE,GAAGvU,EAAEma,QAAQ5F,EAAG,KAAI2F,GAAGW,EAAEoG,qBAAqBjhB,EAAEymB,eAAehM,EAAElB,GAAGA,EAAExgB,MAAMwgB,GAAGjF,IAAI4F,IAAIQ,IAAGF,EAAEc,GAAE/f,KAAKge,GAAG,cAAcsB,EAAE6L,QAAQlM,EAAES,EAAEtc,QAAQ4a,GAAG0B,EAAE1f,KAAKge,GAAG,EAAEiB,EAAEriB,KAAKuiB,EAAEviB,KAAK5I,SAASsrB,EAAEH,EAAEkF,SAAS3E,GAAG9G,EAAEA,GAAG,CAAE,EAAC,IAAImH,GAAE,GAAGI,GAAEhB,EAAE+C,UAAU3B,GAAEjB,EAAE+F,UAAU,EAAE/F,EAAE+F,SAAS,IAAIrhB,GAAEsb,EAAEoG,qBAAqB,UAAUvG,EAAEvD,KAAKkF,GAAExB,EAAEgG,WAAWrE,GAAE,EAAE,KAAKjS,EAAE,UAAUmQ,EAAEvD,MAAMhf,KAAKY,MAAMoG,QAAQhH,KAAKY,MAAM,GAAG2hB,EAAEyC,cAAc5S,EAAE,GAAGA,KAAK8R,GAAEld,OAAO,OAAO8b,EAAE1b,GAAEmc,GAAEA,GAAExS,iBAAiBqB,GAAG,OAAOiQ,EAAEiM,eAAehM,EAAElQ,GAAGA,EAAExR,MAAMwR,EAAG,IAAGpS,KAAKsrB,MAAM7D,SAAS2G,YAAYtL,EAAEA,EAAEvb,MAAM,EAAEoc,IAAG,IAAIvH,EAAEsG,EAAEkG,cAAc,GAAGxW,GAAG,GAAGA,GAAGlR,cAAcmjB,GAAEd,GAAEvc,OAAOqd,KAAIxc,EAAE7H,KAAKoiB,IAAI,OAAOpiB,KAAKsrB,MAAM7D,SAAS2G,YAAYjL,GAAEvB,OAAOkB,GAAG,mBAAmBJ,EAAE6L,OAAO7L,EAAE6L,OAAOpL,GAAEvB,OAAOkB,GAAG1G,GAAG+G,GAAEvB,OAAOkB,GAAGvb,MAAM,EAAEoc,GAAE,EAAEwI,eAAe,SAAS/Z,GAAG,IAAI4J,EAAEhc,KAAK5I,SAASqwB,SAAS+G,WAAW,OAAOxS,EAAE,mBAAmBA,EAAEA,EAAE5J,GAAGA,EAAE4J,IAAI5J,EAAExR,MAAMwR,EAAExR,KAAK,EAAE6tB,eAAe,SAASrc,GAAG,IAAI4J,EAAEhc,KAAK,OAAOuiB,EAAE,GAAGnQ,GAAG3P,cAAc2P,EAAEvK,GAAG,iBAAiBuK,GAAG,iBAAiBA,IAAIA,EAAE,CAACxR,MAAMwR,IAAI,IAAIgP,EAAEpF,EAAEyL,SAAS0E,eAAe/Z,GAAG,OAAOgP,EAAE,iBAAiBA,GAAGpF,EAAE5kB,SAASqwB,SAASsB,WAAW1G,EAAEjB,GAAGA,EAAEpF,EAAE5kB,SAASs3B,UAAU7G,aAAalG,MAAM3F,EAAE,CAACkO,EAAEH,EAAE,CAAE,EAAC3X,GAAG,CAACuc,YAAYvN,IAAIpF,GAAI,IAAGtV,KAAK,GAAG,IAAIokB,GAAE,OAAOA,GAAE,CAACJ,KAAK,WAAW1qB,KAAK2qB,IAAIlD,SAASznB,KAAK4uB,cAAc,WAAW,CAAC5uB,KAAK5I,WAAW4I,KAAK2qB,IAAIlD,SAAStU,QAAQnT,KAAK2qB,IAAIlD,SAASxe,cAAc,+CAA+C,EAAE4lB,aAAa,WAAW,OAAO7uB,KAAK2qB,IAAIlD,SAASxe,cAAc,8CAA8C,EAAE6lB,aAAa,WAAW,OAAO9uB,KAAK2qB,IAAIlD,SAASxe,cAAc,8CAA8C,EAAE2iB,sBAAsB,WAAW,OAAOrB,EAAEvqB,KAAK2qB,IAAIlD,SAAStU,QAAQ4b,iBAAiB/uB,KAAK5I,SAASqsB,WAAWqI,sBAAsB,EAAEkD,KAAK,SAAS5c,GAAG,IAAI4J,EAAEnU,EAAEuZ,EAAEja,EAAEnH,KAAK+hB,EAAE/hB,KAAK5I,SAASglB,EAAE,OAAO2F,EAAE/C,OAAO+C,EAAEyD,iBAAiBpD,GAAGL,EAAEuD,YAAYvD,EAAEuD,UAAUte,OAAOqb,EAAE,UAAUN,EAAE0F,SAAS0B,SAAS,GAAG/W,OAAE,IAASA,EAAEpS,KAAKsrB,MAAMmB,UAAUra,IAAIgQ,IAAIhG,IAAI2F,EAAE2M,UAAUO,sBAAqB,IAAKlN,EAAE0F,SAAS7pB,QAAQoC,KAAKsrB,MAAM4D,WAAWlvB,KAAK5I,SAAS+3B,UAAU,CAAC,GAAG5uB,aAAaP,KAAKovB,iCAAiCpvB,KAAKqtB,mBAAmBrtB,KAAKynB,SAAS6F,gBAAgBlb,GAAGA,IAAIpS,KAAKqtB,mBAAmBrmB,SAAShH,KAAK2K,QAAQ,mBAAmByH,GAAG2P,EAAE2M,UAAUO,sBAAsB7N,EAAEW,EAAE2M,UAAUO,oBAAoBlR,KAAK/d,KAAK,CAACY,MAAMwR,OAAOgP,EAAE,CAAC,GAAGphB,KAAKqtB,mBAAmBrmB,OAAOoL,GAAGgK,IAAIpc,KAAKsrB,MAAMY,QAAQ1vB,QAAQ2f,EAAEnc,KAAKqtB,mBAAmB,GAAGzsB,MAAMwR,IAAIpS,KAAKqtB,mBAAmB7mB,QAAQ,CAAC5F,MAAMwR,QAAQ,CAAC,IAAIA,IAAIgK,GAAGpc,KAAKsrB,MAAMY,QAAQ1vB,MAAM,OAAOwD,KAAK+mB,MAAMqF,aAAauB,QAAQ5P,KAAK/d,WAAWA,KAAKynB,SAASuE,OAAOhsB,KAAKqtB,mBAAmB,CAAC,CAACzsB,MAAMwR,GAAG,CAACvK,EAAE,IAAIya,EAAEtG,EAAEhc,KAAKqtB,mBAAmB,IAAIrR,EAAEpb,MAAMob,GAAG+F,EAAE2E,cAAc7e,GAAG,GAAGA,EAAEma,QAAQ5P,IAAIpS,KAAK+mB,MAAMqF,aAAauB,QAAQ5P,KAAK/d,KAAKgc,EAAE,CAAChc,KAAKynB,SAAS8F,KAAKnM,GAAGW,EAAE0F,SAASuB,gBAAgBhpB,KAAKynB,SAASsE,gBAAgB/rB,KAAK2qB,IAAIlD,SAAStU,QAAQlK,cAAc8Y,EAAE0B,WAAWqI,uBAAuB9rB,KAAKsrB,MAAM7D,SAASzP,SAAS1X,WAAWN,KAAKynB,SAASuD,OAAOjlB,QAAQmX,KAAKld,OAAOA,KAAKsrB,MAAM7D,SAASzP,QAAQ5F,IAAG,EAAGpS,KAAKsrB,MAAM7D,SAAS2F,MAAMhb,EAAEpS,KAAKqvB,oBAAoBhN,GAAG/hB,uBAAuB6G,EAAEsgB,SAAS0B,WAAWhiB,EAAEsgB,SAAS6H,QAAS,IAAGhvB,YAAY,WAAW6G,EAAEwD,QAAQ,gBAAgBxD,EAAEwjB,IAAIlD,SAAU,GAAE,CAAC,EAAEuE,KAAK,SAAS5Z,GAAG,IAAI4J,EAAEhc,KAAK6H,EAAE7H,KAAK2qB,IAAIvJ,EAAEvZ,EAAErL,MAAM2f,EAAEtU,EAAE4f,SAAStgB,EAAE,UAAUnH,KAAK5I,SAASqwB,SAAS0B,WAAW/W,EAAE,GAAG+J,GAAGvT,SAASuZ,KAAKqB,SAASrH,KAAKhV,EAAE,OAAOkV,OAAOkT,oBAAoB,SAASvvB,KAAKynB,SAAS0B,UAAUnpB,KAAKynB,SAASuD,OAAOjlB,QAAQgY,KAAK/d,MAAK,GAAIohB,EAAER,aAAa,iBAAgB,GAAIzE,EAAEoB,WAAWC,YAAYrB,GAAG7b,uBAAuB0b,EAAEsP,MAAM7D,SAASzP,SAAQ,CAAG,GAAE,KAAKhY,KAAKsrB,MAAM7D,SAAS2F,MAAMptB,KAAKsrB,MAAMoC,WAAW1tB,KAAKsrB,MAAMmC,UAAUztB,KAAKsrB,MAAMkE,UAAU,KAAKxvB,KAAKsrB,MAAM5H,KAAK1jB,KAAKsrB,MAAM5H,IAAI9iB,MAAMoG,SAAShH,KAAKsrB,MAAMmE,YAAYzvB,KAAKsrB,MAAM5H,IAAIgM,YAAY1vB,KAAKsrB,MAAM5H,KAAK1jB,KAAK2K,QAAQ,gBAAgBwR,GAAGnc,IAAI,EAAE6f,OAAO,SAASzN,GAAGpS,KAAKynB,SAASznB,KAAKsrB,MAAM7D,SAASzP,UAAU5F,EAAE,OAAO,SAAS,EAAEud,gBAAgB,WAAW,IAAIvd,EAAEpS,KAAK5I,SAASqwB,SAAS,MAAM,mBAAmBrV,EAAEgX,aAAahX,EAAEgX,eAAehX,EAAEgX,YAAY,EAAEkG,OAAO,WAAW,IAAIld,EAAE4J,EAAEnU,EAAEuZ,EAAEphB,KAAKmc,GAAG/J,EAAEpS,KAAK2qB,IAAIlD,UAAU5f,EAAEuK,EAAEwd,WAAU,IAAKrxB,MAAMsxB,QAAQ,yCAAyCjnB,SAASuZ,KAAK2N,YAAYjoB,GAAGmU,EAAEnU,EAAEmlB,aAAanlB,EAAE0V,WAAWC,YAAY3V,GAAGmU,GAAG7U,EAAEnH,KAAK5I,SAAS2qB,EAAE/hB,KAAKynB,SAASkI,kBAAkB,OAAM,IAAKxoB,EAAEsgB,SAASd,UAAU3mB,KAAK2qB,IAAInuB,MAAMokB,aAAa,iBAAgB,GAAIhY,SAASuZ,KAAKqB,SAASxjB,KAAK2qB,IAAIlD,YAAYznB,KAAK2qB,IAAIlD,SAASre,UAAUE,IAAInC,EAAEsc,WAAWwE,gBAAgBjoB,KAAKynB,SAAS0B,SAAShN,GAAG4F,EAAE+N,YAAY9vB,KAAK2qB,IAAIlD,UAAUnnB,YAAU,WAAa,OAAO8gB,EAAEuJ,IAAIlD,SAASre,UAAUC,OAAOlC,EAAEsc,WAAWwE,eAAgB,MAAKjoB,IAAI,EAAEutB,KAAK,SAASnb,GAAGA,EAAE,iBAAiBA,EAAEA,EAAEpS,KAAKynB,SAASgH,eAAerc,GAAGpS,KAAKqtB,oBAAoB,IAAIrR,EAAEnU,EAAE7H,KAAK5I,SAASs3B,UAAUqB,gBAAgBhS,KAAK/d,KAAKoS,GAAGpS,KAAK2qB,IAAIlD,SAAStU,QAAQ6c,WAAWhU,EAAEnU,GAAGmU,EAAEnb,QAAQ,gBAAgB,MAAMgK,MAAM,SAASnE,KAAK,MAAMob,OAAO,EAAE,EAAEmM,iBAAiB,WAAW,IAAI7b,EAAEpS,KAAKynB,SAAS6F,gBAAgBttB,KAAKsrB,MAAM7D,SAAS2F,OAAOpR,EAAEhc,KAAK4uB,cAAc,iBAAiB,CAACxc,IAAIvK,EAAE7H,KAAK4uB,cAAc,iBAAiB,CAACxc,IAAIgP,EAAEphB,KAAKynB,SAASoH,eAAe1S,EAAEnc,KAAKynB,SAASqH,eAAe9S,IAAI,MAAMoF,GAAGA,EAAE7D,WAAW0S,aAAajU,EAAEoF,IAAIvZ,IAAI,MAAMsU,GAAGA,EAAEoB,WAAW0S,aAAapoB,EAAEsU,GAAG,EAAEgN,SAAS,SAAS/W,GAAG,IAAI4J,EAAEhc,KAAK5I,SAASqwB,SAAS5f,EAAE7H,KAAKynB,SAASkI,kBAAkB,GAAG,UAAU3T,EAAEmN,UAAUthB,EAAE,CAAC,IAAIuZ,EAAEjF,EAAEhV,EAAE4a,EAAE3F,EAAEgG,EAAEC,EAAEC,EAAEC,EAAEG,GAAE1iB,KAAK2qB,IAAIlD,SAAS5E,GAAE7G,EAAEkU,IAAIpN,GAAEjb,IAAIe,SAASuZ,KAAKgB,GAAEtb,IAAI7H,KAAK2qB,IAAInuB,MAAM+mB,GAAET,GAAEzG,OAAO8T,YAAYtoB,EAAEilB,UAAUnJ,GAAE/a,SAASwnB,mBAAmBxnB,SAASynB,yBAAyBznB,SAAS0nB,gBAAgBlpB,GAAEuc,GAAEqJ,aAAa9I,GAAEpd,KAAKypB,IAAI5M,GAAE6M,aAAa,EAAEnU,OAAOoU,YAAY,GAAG,IAAIzU,EAAEmN,SAAS,MAAM9E,GAAErkB,KAAK2qB,IAAI,SAASzG,GAAE,QAAQ,SAAS,GAAG9R,EAAEA,GAAGsQ,GAAEsK,aAAahtB,KAAKsrB,MAAM7D,SAASzP,QAAQ,CAAC,GAAG,QAAQkM,IAAG/c,GAAGia,EAAE,WAAW,IAAIhP,EAAExJ,SAASib,eAAe,GAAGzR,EAAEkS,WAAW,CAAC,IAAItI,EAAEnU,EAAEuZ,EAAEhP,EAAE0R,WAAW,GAAG3H,EAAEiF,EAAEsP,eAAevpB,EAAEia,EAAEuP,YAAY,GAAGxpB,EAAE,EAAE,OAAOU,EAAEe,SAASgoB,eAAeC,SAAS1U,EAAEhV,EAAE,GAAGU,EAAEipB,OAAO3U,EAAEhV,GAAG,CAACsZ,MAAMzE,EAAEnU,EAAEwW,yBAAyB0S,MAAMxQ,IAAIvE,EAAEuE,IAAIyQ,OAAOhV,EAAEgV,QAAQ,GAAG7U,EAAEkC,sBAAsB,OAAOlC,EAAEkC,uBAAuB,CAAC,MAAM,CAACoC,MAAM,KAAKF,KAAK,KAAK,CAA1V,IAA+VyQ,OAAO7U,EAAEiF,EAAEb,IAAIwB,EAAEX,EAAEX,KAAKrE,EAAE,SAASgG,EAAE,SAAShQ,GAAG,IAAI4J,EAAE,EAAEnU,EAAE,EAAE,IAAIuK,EAAEA,EAAEmL,WAAWnL,GAAGA,GAAGuR,IAAG3H,GAAG5J,EAAEwb,WAAW,EAAE/lB,GAAGuK,EAAE6e,YAAY,EAAE7e,EAAEA,EAAEmL,WAAW,MAAM,CAACgD,IAAIvE,EAAEyE,KAAK5Y,EAAE,CAA5H,CAA8HA,GAAGuZ,EAAEiD,GAAEhG,wBAAwBlC,EAAEgH,IAAG,EAAE/B,EAAEb,IAAI6B,EAAE7B,IAAIpZ,GAAGgc,GAAE/B,EAAEzC,OAAOyC,EAAE4P,OAAO5O,EAAE7B,KAAK,EAAEwB,EAAEoB,IAAG,EAAE/B,EAAEX,KAAK2B,EAAE3B,KAAKrE,EAAEgF,EAAE1C,MAAM,OAAOoE,GAAE,CAAC,IAAI6B,GAAE,WAAW,IAAI,IAAIvS,EAAE,EAAEvK,EAAEmU,EAAEoN,aAAa7L,WAAW1V,GAAGuK,GAAGvK,EAAEilB,WAAW,EAAEjlB,EAAEA,EAAE0V,WAAW,OAAOnL,CAAC,CAA/F,GAAmG+J,GAAGwI,GAAExd,GAAGwd,EAAC,CAAC,IAAIE,GAAE1I,EAAErV,KAAKC,MAAMoV,GAAGhV,EAAEL,KAAKW,KAAKN,GAAGmb,IAAID,EAAE,QAAQwC,GAAE7I,EAAEkV,kBAAa,IAASrM,GAAEA,GAAEzd,GAAEga,EAAE4P,OAAO5e,GAAG+J,EAAEhV,GAAGoc,GAAEhB,EAAE,SAASX,OAAOG,GAAGc,IAAGzB,EAAE1C,OAAO,GAAGrC,OAAO8U,YAAY,OAAOzO,GAAEnkB,MAAMsxB,QAAQ,GAAGjO,OAAOW,EAAE,WAAWX,OAAOU,EAAE,mBAAmBV,OAAOxF,EAAE,iBAAiBwF,OAAOxF,GAAGsG,GAAE9B,aAAa,YAAYyB,EAAE,MAAM,UAAUK,GAAE9B,aAAa,WAAWsD,GAAE,CAAC,CAAC,IAAI4G,GAAE,CAAE,EAACtiB,OAAO2hB,0BAA0B3hB,OAAO4hB,iBAAiBS,GAAEriB,OAAO2hB,0BAA0BW,KAAI,SAAS1Y,EAAE4J,GAAG,IAAInU,EAAEW,OAAOyD,KAAKmG,GAAG,GAAG5J,OAAOwhB,sBAAsB,CAAC,IAAI5I,EAAE5Y,OAAOwhB,sBAAsB5X,GAAG4J,IAAIoF,EAAEA,EAAErQ,QAAQ,SAASiL,GAAG,OAAOxT,OAAOyhB,yBAAyB7X,EAAE4J,GAAG4N,UAAW,KAAI/hB,EAAEzE,KAAKue,MAAM9Z,EAAEuZ,EAAE,CAAC,OAAOvZ,CAAC,CAA3N,CAA6NW,OAAOsiB,KAAIpS,SAAS,SAAStG,GAAG5J,OAAOmhB,eAAekB,GAAEzY,EAAE5J,OAAOyhB,yBAAyBa,GAAE1Y,GAAI,IAAGyY,IAAGuG,GAAE,kBAAkBC,GAAE,CAAC9J,MAAM,QAAQ+J,OAAO,0BAA0BvM,QAAQ,mBAAmBwM,UAAU,iBAAiBC,WAAW,eAAeC,GAAE,CAACC,QAAQ,SAAS1V,EAAEnU,GAAG,MAAM,gBAAgB+Z,OAAO/Z,EAAE4b,WAAWpG,UAAU,KAAKuE,OAAO/Z,EAAEmX,KAAK,GAAG4C,OAAO/Z,EAAE4b,WAAW5b,EAAEmX,KAAK,SAAS,GAAG,KAAK4C,OAAO5F,EAAE2V,UAAU,2BAA2B/P,OAAO/Z,EAAEsnB,SAAS,WAAW,GAAG,0BAA0BvN,OAAO/Z,EAAEkB,SAAS,WAAW,GAAG,0BAA0B6Y,OAAO/Z,EAAE+pB,SAAS,WAAW,GAAG,0BAA0BhQ,OAAO,WAAW/Z,EAAEmX,KAAK,qBAAqB,GAAG,8DAA8D4C,OAAO5hB,KAAK5I,SAASs3B,UAAU3H,MAAMhJ,KAAK/d,MAAM,sBAAsB4hB,OAAOxP,GAAE,oBAAoB,EAAE2U,MAAM,WAAW,IAAI/K,EAAEhc,KAAK5I,SAASyQ,EAAEmU,EAAE6V,aAAazf,GAAE,MAAM,SAASwP,QAAQ5F,EAAEmT,UAAUnT,EAAEyJ,UAAU,kBAAkB,GAAG,oCAAoC7D,OAAO/Z,EAAE,wBAAwB+Z,OAAO5F,EAAE6V,aAAa,GAAG,kCAAkCjQ,OAAO5F,EAAEyH,WAAWsD,MAAM,wPAAwPnF,OAAO,OAAO5F,EAAEgD,KAAK,YAAY,EAAE0E,IAAI,SAAStR,EAAE4J,GAAG,IAAInU,EAAEmU,EAAE5kB,SAAS,MAAM,eAAewqB,OAAOxP,EAAEzM,OAAOyM,EAAExR,MAAM,oFAAoFghB,OAAO/Z,EAAEye,KAAKC,cAAc,GAAG,EAAE,kCAAkC3E,OAAO/Z,EAAE4b,WAAWC,IAAI,KAAK9B,OAAOxP,EAAEla,OAAO,GAAG,2BAA2B0pB,OAAO5hB,KAAK8xB,cAAc1f,GAAG,0CAA0CwP,OAAO/Z,EAAEye,KAAKC,cAAc,GAAG,EAAE,aAAa3E,OAAO/Z,EAAE4b,WAAW0E,KAAK,4FAA4FvG,OAAO,WAAW/Z,EAAEmX,MAAMnX,EAAE4d,UAAU,yBAAyB,GAAG,0EAA0E7D,OAAO/Z,EAAE4b,WAAWyE,QAAQ,MAAMtG,OAAOxP,EAAEvK,EAAEmd,cAAc5S,EAAExR,MAAM,8CAA8C,EAAE6mB,SAAS,SAASrV,GAAG,IAAI4J,EAAE5J,EAAEqV,SAAS5f,EAAE,UAAUmU,EAAEmN,SAAS,MAAM,eAAevH,OAAO/Z,EAAE,GAAGuK,EAAEqR,WAAWgE,SAAS,KAAK7F,OAAO5F,EAAEwM,UAAU,qDAAqD5G,OAAO5F,EAAEkU,IAAI,MAAM,GAAG,qFAAqFtO,OAAOxP,EAAEqR,WAAWiE,gBAAgB,mCAAmC,EAAEqI,gBAAgB,SAAS3d,GAAG,IAAI4J,EAAEhc,KAAK5I,SAASs3B,UAAU7mB,EAAE7H,KAAKsrB,MAAM7D,SAAS2G,YAAY,MAAM,iBAAiBxM,OAAO5F,EAAE2L,eAAe5J,KAAK/d,KAAK6H,GAAG,kBAAkB+Z,OAAOxP,EAAE,kBAAkBwP,OAAO5F,EAAE4L,eAAe7J,KAAK/d,KAAK6H,GAAG,aAAa,EAAEggB,aAAa,SAASzV,GAAG,MAAM,QAAQwP,OAAO5hB,KAAK8xB,cAAc1f,GAAG,iCAAiCwP,OAAO5hB,KAAK5I,SAASqsB,WAAWoE,aAAa,KAAKjG,OAAO5hB,KAAKsuB,eAAelc,EAAExR,OAAOZ,KAAK5I,SAASqsB,WAAWuE,qBAAqB,GAAG,KAAKpG,OAAOxP,EAAEla,OAAO,GAAG,4EAA4E0pB,OAAOxP,EAAEuc,aAAavc,EAAExR,MAAM,SAAS,EAAE+mB,eAAe,SAASvV,GAAG,MAAM,6DAA6DwP,OAAO5hB,KAAK5I,SAASqsB,WAAWkE,eAAe,cAAc,EAAEC,eAAe,SAASxV,GAAG,IAAI4J,EAAE5J,EAAEpL,OAAOhH,KAAK5I,SAASqwB,SAASgB,SAAS,OAAOzM,EAAE,EAAE,6DAA6D4F,OAAO5hB,KAAK5I,SAASqsB,WAAWmE,eAAe,wBAAwBhG,OAAO5F,EAAE,2DAA2D,EAAE,EAAEiT,oBAAoB,MAAM,SAAS8C,EAAE3f,EAAE4J,IAAI,MAAMA,GAAGA,EAAE5J,EAAEpL,UAAUgV,EAAE5J,EAAEpL,QAAQ,IAAI,IAAIa,EAAE,EAAEuZ,EAAE,IAAItX,MAAMkS,GAAGnU,EAAEmU,EAAEnU,IAAIuZ,EAAEvZ,GAAGuK,EAAEvK,GAAG,OAAOuZ,CAAC,CAAC,SAAS4Q,EAAE5f,EAAE4J,GAAG,OAAO,MAAMA,GAAG,oBAAoBqF,QAAQrF,EAAEqF,OAAOoB,eAAezG,EAAEqF,OAAOoB,aAAarQ,GAAGA,aAAa4J,CAAC,CAAC,SAASiW,EAAE7f,EAAE4J,GAAG,OAAO,SAAS5J,GAAG,GAAGtI,MAAM8B,QAAQwG,GAAG,OAAOA,CAAC,CAAxC,CAA0CA,IAAI,SAASA,EAAE4J,GAAG,IAAInU,EAAE,MAAMuK,EAAE,KAAK,oBAAoBiP,QAAQjP,EAAEiP,OAAOC,WAAWlP,EAAE,cAAc,GAAG,MAAMvK,EAAE,CAAC,IAAIuZ,EAAEjF,EAAEhV,EAAE,GAAG4a,GAAE,EAAG3F,GAAE,EAAG,IAAI,IAAIvU,EAAEA,EAAEkW,KAAK3L,KAAK2P,GAAGX,EAAEvZ,EAAE8a,QAAQC,QAAQzb,EAAE/D,KAAKge,EAAExgB,QAAQob,GAAG7U,EAAEH,SAASgV,GAAG+F,GAAE,GAAI,CAAC,MAAM3P,GAAGgK,GAAE,EAAGD,EAAE/J,CAAC,CAAC,QAAQ,IAAI2P,GAAG,MAAMla,EAAEkb,QAAQlb,EAAEkb,QAAQ,CAAC,QAAQ,GAAG3G,EAAE,MAAMD,CAAC,CAAC,CAAC,OAAOhV,CAAC,CAAC,CAArT,CAAuTiL,EAAE4J,IAAI,SAAS5J,EAAE4J,GAAG,GAAI5J,EAAJ,CAAa,GAAG,iBAAiBA,EAAE,OAAO2f,EAAE3f,EAAE4J,GAAG,IAAInU,EAAEW,OAAO4U,UAAUmE,SAASxD,KAAK3L,GAAG7K,MAAM,GAAG,GAAuD,MAApD,WAAWM,GAAGuK,EAAEtS,cAAc+H,EAAEuK,EAAEtS,YAAYzH,MAAS,QAAQwP,GAAG,QAAQA,EAASiC,MAAMC,KAAKlC,GAAM,cAAcA,GAAG,2CAA2C8Y,KAAK9Y,GAAUkqB,EAAE3f,EAAE4J,QAAlF,CAAzL,CAA6Q,CAAxS,CAA0S5J,EAAE4J,IAAI,WAAW,MAAM,IAAIwF,UAAU,6IAA6I,CAA5K,EAA+K,CAAC,SAAS0Q,EAAE9f,EAAE4J,IAAI,MAAMA,GAAGA,EAAE5J,EAAEpL,UAAUgV,EAAE5J,EAAEpL,QAAQ,IAAI,IAAIa,EAAE,EAAEuZ,EAAE,IAAItX,MAAMkS,GAAGnU,EAAEmU,EAAEnU,IAAIuZ,EAAEvZ,GAAGuK,EAAEvK,GAAG,OAAOuZ,CAAC,CAAC,SAAS+Q,EAAE/f,EAAE4J,EAAEnU,GAAG,OAAOmU,KAAK5J,EAAE5J,OAAOmhB,eAAevX,EAAE4J,EAAE,CAACpb,MAAMiH,EAAE+hB,YAAW,EAAGC,cAAa,EAAGC,UAAS,IAAK1X,EAAE4J,GAAGnU,EAAEuK,CAAC,CAAC,SAASggB,EAAEhgB,EAAE4J,GAAG,OAAO,MAAMA,GAAG,oBAAoBqF,QAAQrF,EAAEqF,OAAOoB,eAAezG,EAAEqF,OAAOoB,aAAarQ,GAAGA,aAAa4J,CAAC,CAAC,SAASqW,EAAEjgB,EAAE4J,GAAG,OAAOA,EAAE,MAAMA,EAAEA,EAAE,GAAGxT,OAAO2hB,0BAA0B3hB,OAAO4hB,iBAAiBhY,EAAE5J,OAAO2hB,0BAA0BnO,IAAI,SAAS5J,EAAE4J,GAAG,IAAInU,EAAEW,OAAOyD,KAAKmG,GAAG,GAAG5J,OAAOwhB,sBAAsB,CAAC,IAAI5I,EAAE5Y,OAAOwhB,sBAAsB5X,GAAG4J,IAAIoF,EAAEA,EAAErQ,iBAAiBiL,GAAG,OAAOxT,OAAOyhB,yBAAyB7X,EAAE4J,GAAG4N,UAAW,KAAI/hB,EAAEzE,KAAKue,MAAM9Z,EAAEuZ,EAAE,CAAC,OAAOvZ,CAAC,CAA3N,CAA6NW,OAAOwT,IAAItD,SAAO,SAAW7Q,GAAGW,OAAOmhB,eAAevX,EAAEvK,EAAEW,OAAOyhB,yBAAyBjO,EAAEnU,GAAI,IAAGuK,CAAC,CAAC,SAASkgB,EAAElgB,GAAG,OAAO,SAASA,GAAG,GAAGtI,MAAM8B,QAAQwG,GAAG,OAAO8f,EAAE9f,EAAE,CAA3C,CAA6CA,IAAI,SAASA,GAAG,GAAG,oBAAoBiP,QAAQ,MAAMjP,EAAEiP,OAAOC,WAAW,MAAMlP,EAAE,cAAc,OAAOtI,MAAMC,KAAKqI,EAAE,CAA/G,CAAiHA,IAAI,SAASA,EAAE4J,GAAG,GAAI5J,EAAJ,CAAa,GAAG,iBAAiBA,EAAE,OAAO8f,EAAE9f,EAAE4J,GAAG,IAAInU,EAAEW,OAAO4U,UAAUmE,SAASxD,KAAK3L,GAAG7K,MAAM,GAAG,GAAuD,MAApD,WAAWM,GAAGuK,EAAEtS,cAAc+H,EAAEuK,EAAEtS,YAAYzH,MAAS,QAAQwP,GAAG,QAAQA,EAASiC,MAAMC,KAAKlC,GAAM,cAAcA,GAAG,2CAA2C8Y,KAAK9Y,GAAUqqB,EAAE9f,EAAE4J,QAAlF,CAAzL,CAA6Q,CAAxS,CAA0S5J,IAAI,WAAW,MAAM,IAAIoP,UAAU,wIAAwI,CAAvK,EAA0K,CAAC,IAAI+Q,GAAE,CAACC,cAAc,WAAW,IAAIpgB,EAAEpS,KAAKA,KAAKyyB,iBAAiB/Z,SAAS,SAASsD,GAAG5J,EAAEsgB,GAAG1W,EAAE5J,EAAEhb,SAAS4lB,UAAUhB,GAAI,GAAE,EAAEjW,QAAQ,WAAW,IAAIqM,EAAE4J,IAAI5R,UAAUpD,OAAO,QAAG,IAASoD,UAAU,KAAKA,UAAU,GAAGvC,EAAE7H,KAAK5I,SAASgqB,EAAEphB,KAAKgrB,OAAOhO,UAAUb,EAAEH,EAAE,mBAAmB,sBAAsB,IAAIhc,KAAKsrB,MAAMqH,aAAa3W,EAAE,CAAC,IAAI,IAAI7U,KAAKnH,KAAKsrB,MAAMqH,WAAW3W,EAAEA,IAAIhc,KAAKihB,UAAU2R,OAAO5yB,KAAKgrB,OAAO6H,WAAW9U,KAAK/d,MAAMA,KAAK5I,SAAS07B,gBAAgBC,OAAO/yB,KAAK2qB,IAAIqI,eAAeN,GAAG,uBAAuB1yB,KAAKizB,cAAc/V,KAAKld,QAAQoS,EAAEpS,KAAKihB,UAAU2R,KAAK5yB,KAAKihB,UAAU2R,MAAM,CAACM,QAAQ,CAAC,QAAQ9R,EAAE+R,UAAUjW,KAAKld,OAAOozB,MAAM,CAAC,QAAQhS,EAAEiS,aAAanW,KAAKld,OAAOszB,SAAS,UAAUzrB,EAAEmX,MAAM,CAAC,QAAQoC,EAAEmS,mBAAmBrW,KAAKld,OAAOwzB,MAAM,CAAC,QAAQpS,EAAEqS,QAAQvW,KAAKld,OAAO0zB,KAAK,CAAC,QAAQtS,EAAEuS,OAAOzW,KAAKld,OAAO4zB,iBAAiB,CAAC,QAAQxS,EAAEyS,mBAAmB3W,KAAKld,OAAO8zB,eAAe,CAAC,QAAQ1S,EAAE2S,iBAAiB7W,KAAKld,QAAQoS,EAAEjL,IAAInH,KAAK2qB,IAAIvY,EAAEjL,GAAG,IAAIgV,GAAGhV,EAAEiL,EAAEjL,GAAG,IAAI,IAAI4a,EAAE/hB,KAAKihB,UAAU2R,KAAKoB,uBAAuB,IAAI1X,iBAAiB8E,EAAE6S,iBAAiB/W,KAAKld,OAAO+hB,EAAEmS,aAAa,OAAOrsB,EAAEmX,MAAM+C,EAAEtF,QAAQzc,KAAK2qB,IAAI5D,MAAM,CAACrK,WAAU,IAAK1c,KAAKgrB,OAAOmJ,yBAAyBpW,KAAK/d,KAAK,CAAC,EAAEm0B,yBAAyB,SAAS/hB,GAAG,IAAI4J,GAAG5J,GAAG,GAAG,IAAIpS,KAAKihB,UAAU2R,OAAOwB,cAAcp0B,KAAKihB,UAAU2R,KAAKyB,oCAAoCr0B,KAAKihB,UAAU2R,KAAKyB,mCAAmCC,YAAYt0B,KAAKgrB,OAAOhO,UAAUuX,0BAA0BrX,KAAKld,MAAMgc,GAAG,EAAE6W,WAAW,SAASzgB,GAAG,IAAI4J,EAAEnU,EAAE7H,KAAKgrB,OAAOhO,UAAUoE,EAAEhP,EAAE,sBAAsB,mBAAmB,GAAGpS,KAAKihB,YAAY7O,IAAIpS,KAAKihB,UAAUuT,QAAQ,CAACx0B,KAAKihB,UAAUuT,OAAOx0B,KAAKihB,UAAUuT,QAAQ,CAAC,CAACh7B,KAAKwG,KAAKy0B,KAAK,UAAU,QAAQpyB,OAAOrC,KAAK2qB,IAAI5D,MAAM2N,GAAG7sB,EAAE7H,KAAKy0B,KAAK,YAAY,WAAWvX,KAAKld,OAAO,CAACxG,KAAK,UAAU6I,OAAOga,OAAOqY,GAAG7sB,EAAE8sB,gBAAgBzX,KAAKld,OAAO,CAACxG,KAAK,UAAU6I,OAAOrC,KAAK2qB,IAAInuB,MAAMk4B,GAAG7sB,EAAE+sB,YAAY1X,KAAKld,OAAO,CAACxG,KAAK,WAAW6I,OAAOrC,KAAK2qB,IAAInuB,MAAMk4B,GAAG7sB,EAAE+sB,YAAY1X,KAAKld,OAAO,CAACxG,KAAK,QAAQ6I,OAAOuG,SAAS8rB,GAAG7sB,EAAEgtB,gBAAgB3X,KAAKld,MAAM80B,YAAW,IAAK,IAAI3Y,GAAE,EAAGhV,GAAE,EAAG4a,OAAE,EAAO,IAAI,IAAI,IAAI3F,EAAEgG,EAAEpiB,KAAKihB,UAAUuT,OAAOnT,OAAOC,cAAcnF,GAAGC,EAAEgG,EAAEO,QAAQC,MAAMzG,GAAE,GAAIH,EAAEI,EAAExb,OAAOyB,OAAO+e,GAAGpF,EAAExiB,KAAKwiB,EAAE0Y,KAAK1Y,EAAE8Y,WAAW,CAAC,MAAM1iB,GAAGjL,GAAE,EAAG4a,EAAE3P,CAAC,CAAC,QAAQ,IAAI+J,GAAG,MAAMiG,EAAEW,QAAQX,EAAEW,QAAQ,CAAC,QAAQ,GAAG5b,EAAE,MAAM4a,CAAC,CAAC,CAAC,CAAC,EAAEgT,aAAa,WAAW/0B,KAAKgrB,OAAO6H,WAAW9U,KAAK/d,MAAK,EAAG,EAAEgd,UAAU,CAAC4X,YAAY,SAASxiB,GAAG,IAAI4J,EAAEnU,EAAEuZ,EAAEphB,KAAK5I,SAAS+kB,EAAEwH,EAAE5F,KAAK/d,KAAKoS,EAAE/P,QAAQ8E,EAAEoc,EAAExF,KAAK/d,KAAKoS,EAAE/P,QAAQ0f,EAAE3P,EAAE/P,OAAO+G,UAAUoa,SAASpC,EAAEqC,WAAW0E,MAAM/L,EAAE,WAAWhK,EAAE5Y,KAAK4oB,EAAE,YAAYhQ,EAAE5Y,KAAK2iB,GAAGC,IAAIjV,IAAI4a,GAAG/hB,KAAKguB,iBAAiBhuB,KAAKsrB,MAAMC,UAAU,IAAItb,MAAM,IAAIoS,EAAEjQ,EAAE/P,OAAOrC,KAAK8hB,KAAK9hB,KAAK2qB,IAAI5D,MAAMiO,aAAa,GAAG1S,EAAE,QAAQza,EAAE7H,KAAKY,aAAQ,IAASiH,GAAG,QAAQmU,EAAEnU,EAAE,UAAK,IAASmU,OAAE,EAAOA,EAAEoF,EAAE4D,aAAazC,EAAEnB,EAAEqG,SAASd,SAAS,EAAEjE,GAAE,CAACuS,cAAc7iB,EAAE6iB,eAAepS,GAAE7iB,KAAKsrB,MAAM7W,QAAQ8X,eAAehK,IAAInB,EAAEqG,SAASwB,eAAenG,GAAE9iB,KAAKsrB,MAAM7W,QAAQygB,QAAQ3S,EAAE,GAAGH,EAAE,CAAC,GAAGhQ,EAAE6iB,gBAAgBj1B,KAAK2qB,IAAInuB,MAAM,OAAOwD,KAAKynB,SAASuE,YAAYhsB,KAAK2qB,IAAI5D,MAAMC,QAAQhnB,KAAKm1B,aAAa/T,EAAEgE,mBAAmBplB,KAAKo1B,oBAAoB,CAAC,KAAKvS,IAAGC,IAAGf,GAAG,GAAG3F,GAAGD,GAAGnc,KAAKsrB,MAAMC,UAAU,IAAItb,KAAKjQ,KAAKguB,iBAAiBhuB,KAAKsrB,MAAMC,WAAWvrB,KAAKsrB,MAAMC,UAAS,EAAG,OAAOnK,EAAEpC,KAAK,CAAC,GAAG5C,EAAE,CAAC,IAAIgF,EAAEsE,UAAU,OAAO,IAAIvC,GAAE,IAAI/B,EAAEqG,SAASd,UAAU3mB,KAAKsrB,MAAM7D,SAASzP,QAAQ5Q,IAAGD,GAAG,WAAWia,EAAEpC,KAAK,OAAOhf,KAAKguB,kBAAiB,GAAIhuB,KAAK2K,QAAQ,QAAQ+X,SAAQS,IAAG/b,IAAGpH,KAAKynB,SAASuH,KAAKhvB,KAAKY,MAAMoG,OAAO,QAAG,GAAQ,CAAC,GAAGob,EAAE,CAAC,GAAGpiB,KAAK2K,QAAQ,OAAO+X,IAAG1iB,KAAKq1B,SAAQ,GAAI,UAAUjU,EAAEpC,KAAK,CAAC,GAAGhf,KAAKY,MAAMoG,OAAO,CAAC,IAAIkd,GAAElkB,KAAKs1B,aAAa,GAAGjT,EAAEriB,KAAK8hB,KAAKoC,GAAE8Q,YAAY,CAAC1S,IAAID,IAAIA,EAAE,GAAG,CAACA,IAAIriB,KAAKsrB,MAAM7W,QAAQ8X,cAAcnL,EAAE8D,cAAc9D,EAAE+D,SAAS3hB,SAAS,SAASxD,KAAKwsB,QAAQnK,GAAE,EAAG,CAAClG,IAAInc,KAAK2qB,IAAI5D,MAAMjG,gBAAgB,SAAS9gB,KAAKynB,SAASuE,OAAO,MAAM5P,EAAEpc,KAAK2K,QAAQ,QAAQ+X,IAAGN,IAAIpiB,KAAK2K,QAAQ,OAAO+X,IAAG1iB,KAAKq1B,SAAQ,GAAIr1B,KAAKynB,SAASuE,OAAOhsB,KAAKsrB,MAAM7D,SAASzP,aAAQ,EAAOhY,KAAKqvB,oBAAoB,EAAEwE,mBAAmB,SAASzhB,GAAGpS,KAAKsrB,MAAME,WAAU,CAAE,EAAEuI,iBAAiB,SAAS3hB,GAAGpS,KAAKsrB,MAAME,WAAU,CAAE,EAAEmJ,gBAAgB,SAASviB,GAAG,IAAI4J,EAAEnU,EAAE7H,KAAK5I,SAASgqB,EAAExY,SAAS2sB,cAAcpZ,EAAEwH,EAAE5F,KAAK/d,KAAKohB,IAAIphB,KAAK2qB,IAAInuB,MAAMgnB,SAAS5a,SAAS2sB,eAAepuB,EAAEgV,GAAGiF,EAAEoU,aAAa,YAAY,GAAGx1B,KAAKsrB,MAAMC,UAAUpP,IAAIhV,EAAE,CAAC6U,EAAEoF,EAAEnB,mBAAmB,IAAI8B,EAAE3P,EAAE/P,OAAO+G,UAAUoa,SAAS3b,EAAE4b,WAAW0E,MAAM,OAAO/V,EAAElO,KAAK,IAAI,YAAY2D,EAAEsnB,UAAUnvB,KAAKsrB,MAAMY,UAAUlsB,KAAK4sB,WAAWxL,IAAIpF,GAAGhc,KAAK2qB,IAAI5D,OAAOC,SAAS,MAAM,IAAI,QAAQ,GAAGjF,EAAE,YAAY/hB,KAAK4sB,WAAWxa,EAAE/P,OAAOkb,YAAY1V,EAAEye,KAAKC,eAAehD,EAAExF,KAAK/d,KAAKohB,IAAI9gB,WAAWN,KAAK6sB,QAAQ3P,KAAKld,MAAM,EAAEohB,GAAG,MAAM,IAAI,YAAYphB,KAAKsrB,MAAM7D,SAASzP,SAAS,OAAOnQ,EAAEmX,MAAMhf,KAAKynB,SAASuH,OAAO,CAAC,EAAEmE,UAAU,SAAS/gB,GAAG,IAAI4J,EAAEhc,KAAK6H,EAAE7H,KAAK5I,SAAS,IAAI4I,KAAKsrB,MAAME,WAAW3jB,EAAE4d,UAAU,CAAC,UAAU5d,EAAEmX,MAAMnX,EAAE2d,kBAAkBxlB,KAAKY,MAAMoG,QAAQ,OAAOoL,EAAElO,KAAKkO,EAAE8M,iBAAiB,IAAIkC,EAAEphB,KAAK8hB,KAAK1P,EAAE/P,OAAO2yB,aAAah1B,KAAK2K,QAAQ,UAAU,CAACvI,MAAMgQ,IAAIvK,EAAEwhB,MAAMI,cAAcrX,EAAE,CAACuZ,OAAO3rB,OAAO0Q,MAAI,SAAWyL,GAAG,GAAG,OAAOtU,EAAEmX,KAAK,CAAC,OAAO5M,EAAElO,KAAK,IAAI,OAAO,IAAI,YAAY8X,EAAEsP,MAAM7W,QAAQwX,WAAU,EAAG,MAAM,IAAI,SAAS,IAAI,YAAY,GAAGjQ,EAAEsP,MAAMY,QAAQ,OAAO,IAAI/kB,EAAEyB,SAASib,eAAe9B,EAAE,UAAU3P,EAAElO,KAAKiD,EAAEsuB,eAAetuB,EAAEuuB,WAAW1uB,QAAQ,GAAGoV,EAAEjV,EAAEuuB,WAAWhV,gBAAgB2B,EAAE,GAAGlb,EAAEuuB,WAAWlZ,WAAWrV,EAAEsuB,cAAcrZ,GAAG,GAAGA,EAAEI,UAAUrV,EAAEuuB,WAAWhV,iBAAiB,SAAStO,GAAG,IAAI4J,EAAEpT,SAAS+sB,cAAc,OAAOvjB,EAAEvR,QAAQ,oBAAkB,SAAWuR,GAAG,OAAO4J,EAAEgU,UAAU5d,EAAE4J,EAAE4Z,SAAU,GAAE,CAA7H,CAA+H5Z,EAAE2O,IAAI5D,MAAMiJ,WAAW,IAAI1N,EAAEC,EAAEG,EAAEG,GAAE7G,EAAEsZ,aAAanS,GAAE,IAAIhc,EAAEuuB,WAAW1uB,QAAQG,EAAEuuB,WAAWG,WAAWp8B,OAAOq8B,aAAa,MAAM,GAAG,QAAQjuB,EAAEke,WAAW1D,EAAE,OAAOC,EAAE,GAAGnb,EAAEuuB,WAAWlZ,SAAS,KAAKrV,EAAEuuB,WAAWK,uBAAuBz1B,WAAW0b,EAAE6Q,QAAQ3P,KAAKlB,GAAG,EAAEsG,QAAQlQ,EAAE8M,iBAAiB,GAAG4D,KAAKsP,EAAE/P,EAAE2T,SAAS,OAAOtT,EAAEN,EAAEC,GAAGA,EAAEmT,aAAa,aAAanT,EAAEhZ,SAAS2S,EAAE2O,IAAI5D,MAAMC,aAAa1mB,YAAU,WAAa+jB,EAAE3B,GAAG1G,EAAE2O,IAAI5D,MAAMqM,OAAQ,IAAG,GAAG,MAAMjsB,EAAEuuB,WAAWO,SAAS,OAAO,IAAIlU,GAAGM,IAAI,GAAGlb,EAAEuuB,WAAWlZ,SAAS+F,EAAE,GAAGpb,EAAEsuB,aAAa1T,EAAEc,GAAE,GAAG,KAAKA,GAAE/b,KAAKovB,IAAIrT,GAAE7b,OAAOG,EAAEsuB,cAAc,GAAG1T,EAAEQ,EAAEpb,EAAEuuB,WAAWzV,mBAAmBmS,EAAE/P,EAAE2T,WAAWzT,EAAEF,GAAG,GAAGlb,EAAEuuB,WAAWlZ,WAAWrV,EAAEuuB,WAAWG,WAAW1uB,EAAEuuB,WAAWK,wBAAwB3jB,EAAE8M,kBAAkBmD,GAAGN,KAAKla,EAAEke,UAAU,YAAY3T,EAAE8M,iBAAiB,GAAG,SAAS/X,EAAE3N,OAAO2N,EAAEsuB,cAActuB,EAAEuuB,YAAY1Z,EAAE2O,IAAI5D,OAAO,UAAU3U,EAAElO,IAAI,YAAYkO,EAAE8M,iBAAiB,GAAG,SAAS/X,EAAE3N,MAAM+oB,GAAGA,EAAEiT,aAAa,YAAY,YAAYnR,EAAEjC,EAAEG,IAAI,UAAUnQ,EAAElO,KAAKif,IAAGe,EAAE/c,EAAEuuB,WAAWS,cAAcna,EAAE4Q,WAAWzlB,EAAEuuB,WAAWS,aAAa,OAAM,CAAE,CAAC,IAAI5S,GAAE,UAAU1b,EAAE4f,SAAS0B,SAAS,OAAO/W,EAAElO,KAAK,IAAI,YAAY,UAAU2D,EAAEmX,MAAMnX,EAAE2d,kBAAkBxJ,EAAEpb,MAAMoG,OAAOgV,EAAE4Q,aAAa5Q,EAAEsP,MAAM7D,SAASzP,SAAS,UAAUnQ,EAAE4f,SAAS0B,UAAU,IAAI/W,EAAE/P,OAAO2yB,aAAa,MAAM5T,EAAEuL,WAAW,MAAK,IAAK9kB,EAAEke,UAAU/J,EAAE4Q,aAAa,QAAQ/kB,EAAEke,WAAWzlB,WAAW0b,EAAE6Q,QAAQ3P,KAAKlB,GAAG,IAAI,MAAM,IAAI,MAAM,IAAI,SAAS,GAAGA,EAAEsP,MAAM7D,SAASzP,QAAQ,OAAO5F,EAAE/P,OAAO+zB,OAAO,MAAM,IAAI,OAAO,IAAI,YAAYpa,EAAEsP,MAAM7D,SAASzP,SAASgE,EAAEyL,SAASuH,OAAO,MAAM,IAAI,aAAa,IAAIrL,GAAE3H,EAAEsP,MAAM+K,iBAAiBra,EAAEsP,MAAMoC,WAAW,GAAG/J,IAAG9b,EAAE6e,aAAaE,SAAS,YAAY5K,EAAEwQ,QAAQ,CAAC7I,KAAG,GAAI,MAAM,IAAI,MAAM,IAAIvc,GAAE,UAAUS,EAAEmX,KAAK,IAAIoC,GAAGha,GAAE,OAAM,EAAGgL,EAAE8M,iBAAiB,IAAI,QAAQ,GAAGlD,EAAEsP,MAAM7D,SAASzP,UAAUuL,GAAE,OAAOnR,EAAE8M,iBAAiB5e,YAAU,WAAa0b,EAAEsP,MAAM7D,SAASzP,UAAUuL,IAAGvH,EAAEsP,MAAM7W,QAAQ8X,eAAe1kB,EAAEsd,SAAS3hB,SAAS4O,EAAElO,IAAIhD,gBAAgB8a,EAAEwQ,QAAQpL,GAAE,EAAI,IAAI,IAAGrT,OAAK,SAAWqE,GAAG,OAAOA,CAAE,GAAE,CAAC,EAAEkkB,QAAQ,SAASlkB,GAAGpS,KAAKm1B,aAAa,IAAInZ,EAAEhc,KAAK5I,SAAS,GAAG,OAAO4kB,EAAEgD,KAAK,OAAOhf,KAAKgrB,OAAOhO,UAAUuZ,eAAexY,KAAK/d,KAAKoS,GAAG,IAAIvK,EAAE7H,KAAK+mB,MAAM/D,UAAUjF,KAAK/d,UAAK,EAAO,CAAC8hB,MAAK,IAAKV,EAAEvZ,EAAEb,QAAQgV,EAAEyL,SAASd,QAAQxK,EAAE,CAACvb,MAAMiH,EAAE2uB,SAASx2B,KAAK2qB,IAAI5D,OAAO5f,EAAEnH,KAAKy2B,YAAY,CAAC71B,MAAMiH,IAAI,UAAUmU,EAAEgD,MAAMhf,KAAK02B,sBAAsBvvB,GAAGgV,EAAEwa,QAAQxvB,EAAEnH,KAAKsrB,MAAMmB,WAAW5kB,IAAI7H,KAAK+mB,MAAM1iB,IAAI0Z,KAAK/d,KAAK6H,GAAE,IAAK,GAAGA,EAAE+uB,OAAO5a,EAAE8I,YAAY9kB,KAAKwsB,QAAQ3kB,IAAI7H,KAAK+mB,MAAM1iB,IAAI0Z,KAAK/d,MAAMgc,EAAEyL,SAASd,SAAS,GAAG3mB,KAAKynB,SAASrG,EAAE,OAAO,QAAQvZ,GAAG7H,KAAK2K,QAAQ,QAAQwR,GAAG,EAAEoa,eAAe,SAASnkB,GAAG,IAAI4J,EAAEnU,EAAEuZ,EAAEjF,EAAEhV,EAAE4a,EAAE3F,EAAEgG,EAAEC,EAAEriB,KAAKsiB,EAAEtiB,KAAK5I,SAASsrB,EAAE1iB,KAAKY,MAAMoG,OAAO6b,GAAE7iB,KAAKs1B,aAAanS,GAAEva,SAASiuB,yBAAyBtT,GAAElH,OAAOwH,eAAeC,WAAW,GAAGH,GAAE,GAAGlhB,IAAIsb,KAAK8E,aAAYzQ,GAAG,OAAO8R,EAAE9R,GAAGxR,KAAM,IAAG,GAAG,yBAAyBwR,EAAE/V,WAAWymB,KAAK9iB,KAAKgrB,OAAOhO,UAAUmW,UAAUpV,KAAK/d,KAAK,CAACqC,OAAO+P,EAAE/P,OAAO6B,IAAI,cAAcygB,EAAE3kB,KAAKs1B,cAAct1B,KAAKY,MAAM2G,QAAQmR,SAAS,SAAStG,GAAGA,EAAE+c,WAAWxL,GAAEngB,SAAS4O,EAAExR,QAAQuiB,GAAE2M,YAAYzN,EAAEyU,cAAc1kB,GAAI,IAAG+Q,GAAE7F,WAAWtW,SAASuc,GAAEU,WAAWd,IAAGnjB,KAAK+2B,oBAAmB,EAAG5T,GAAE6T,YAAYnU,GAAE7b,QAAQ0b,EAAE,OAAO1iB,KAAKY,MAAM,GAAG6B,IAAIsb,KAAK/d,KAAKs1B,cAAc,SAASljB,GAAG,OAAO8R,EAAE9R,EAAG,SAAQpS,KAAKmY,OAAO,CAAC8e,oBAAmB,IAAK,GAAGj3B,KAAKqnB,aAAa,OAAM,EAAG,GAAGhL,OAAOwH,eAAe9B,EAAE1F,OAAOwH,gBAAgBS,WAAW,GAAG,GAAGvC,EAAE2T,WAAWlZ,SAAS,CAAC,IAAI+G,GAAExB,EAAE+B,WAAW,GAAGoT,cAAc1S,UAAS,GAAIjB,GAAEsN,SAAS9O,EAAEoV,UAAU,GAAG/V,GAAGpF,EAAEuH,GAAEhC,WAAWha,MAAM,EAAEgc,GAAE6T,YAAYvsB,MAAMyX,EAAEyC,SAAS/d,OAAO,GAAGa,EAAEmU,EAAEqb,MAAM/U,EAAEyC,YAAY5I,EAAEH,EAAEzU,MAAMyU,EAAEsb,YAAYzvB,EAAEA,EAAEb,OAAO,MAAMmV,EAAE,CAAC,GAAGnc,KAAKsrB,MAAM7W,QAAQwX,WAAU,EAAGjsB,KAAKsrB,MAAM5H,IAAI,CAAC6T,OAAOpb,EAAEkb,MAAM/U,EAAEyC,SAAS,GAAGnkB,MAAMub,EAAEtb,QAAQyhB,EAAEyC,QAAQ,KAAK/kB,KAAKsrB,MAAM5H,IAAIgM,WAAW3N,EAAE2N,WAAW1vB,KAAKsrB,MAAM5H,IAAI9iB,MAAMoG,OAAOob,EAAEpiB,KAAKsrB,MAAM5H,IAAI9iB,MAAMy2B,MAAM/U,EAAEwC,YAAY,OAAO9kB,KAAKsrB,MAAM5H,IAAI9iB,MAAMZ,KAAKsrB,MAAM5H,IAAI9iB,MAAMC,QAAQyhB,EAAEwC,WAAW,IAAI9kB,KAAKsrB,MAAM5H,IAAIoB,WAAW1C,EAAE,GAAGpiB,KAAKwsB,QAAQxsB,KAAKsrB,MAAM5H,IAAI9iB,MAAM0hB,EAAEmF,SAASyB,oBAAoBlpB,KAAKynB,SAASuE,OAAO7kB,EAAEnH,KAAKsrB,MAAM5H,IAAI9iB,MAAMoG,QAAQsb,EAAEmF,SAASd,QAAQ,IAAIvK,GAAGA,EAAEpc,KAAKsrB,MAAMmE,YAAYzvB,KAAKsrB,MAAM5H,IAAIgM,aAAa6H,QAAQv3B,KAAKsrB,MAAM5H,IAAI6T,QAAQnb,EAAExb,MAAM,IAAIZ,KAAKsrB,MAAM5H,IAAI9iB,MAAM,GAAGZ,KAAKsrB,MAAMmE,YAAYzvB,KAAKsrB,MAAM5H,IAAIgM,cAAc1vB,KAAKsrB,MAAM5H,IAAI9iB,cAAcZ,KAAKsrB,MAAMmE,YAAYzvB,KAAKsrB,MAAM5H,IAAIgM,WAAW,CAAC,MAAMtd,GAAI,EAACgK,GAAGgF,EAAEphB,KAAKsrB,MAAM9E,QAAQgR,uBAAuBrwB,GAAE,EAAG,MAAMnH,KAAKsrB,MAAMmE,YAAY,GAAGzvB,KAAKsrB,MAAM9E,QAAQgR,oBAAoBpW,CAAC,CAAC9gB,YAAY,WAAW+hB,EAAElK,OAAO,CAAC8e,oBAAmB,IAAK5U,EAAE1X,QAAQ,QAAQ4X,EAAE,CAAA,EAAGF,EAAEiJ,MAAM5H,IAAI,CAACsR,YAAY3S,EAAEsI,IAAI5D,MAAMiO,eAAe3S,EAAEiJ,MAAM5H,KAAKrB,EAAEoF,SAAStgB,EAAE,OAAO,QAAQkb,EAAEiJ,MAAM5H,IAAI9iB,MAAO,GAAE,GAAG,EAAE62B,UAAU,SAASrlB,GAAG,IAAI4J,EAAEhc,KAAKM,YAAU,WAAa0b,EAAEgP,OAAOhO,UAAUsZ,QAAQvY,KAAK/B,EAAE5J,EAAG,GAAE,EAAEmiB,0BAA0B,WAAWv0B,KAAK2qB,IAAIqI,cAAczV,YAAYvd,KAAKkhB,UAAUlhB,KAAK2qB,IAAIqI,cAAcpyB,OAAOZ,KAAK2qB,IAAIqI,cAAc0E,aAAa13B,KAAK23B,oBAAoB,EAAE9C,gBAAgB,SAASziB,GAAGA,EAAE/P,QAAQrC,KAAK2qB,IAAInuB,OAAOwD,KAAK2qB,IAAInuB,MAAMgnB,SAASpR,EAAE/P,UAAUrC,KAAKguB,kBAAiB,GAAIhuB,KAAKsrB,MAAMC,UAAS,EAAGnZ,EAAE/P,OAAOC,QAAQ,sBAAsB8P,EAAE/P,OAAOC,QAAQ,qBAAqBsoB,UAAU5qB,MAAMA,KAAKynB,SAASuE,OAAO,EAAEqH,aAAa,SAASjhB,GAAG,IAAI4J,EAAEhc,KAAK5I,SAASyQ,EAAEuK,EAAE/P,OAAOC,QAAQ,IAAI0Z,EAAEyH,WAAWC,KAAKtC,EAAEhP,EAAE/P,SAASrC,KAAK2qB,IAAInuB,MAAM2f,GAAG,IAAIlM,KAAKjQ,KAAKsrB,MAAMC,SAAS,GAAGnK,GAAG,UAAUpF,EAAEgD,KAAKhf,KAAK2qB,IAAI5D,MAAMC,YAAY,CAAC,IAAI5U,EAAE/P,OAAO+G,UAAUoa,SAASxH,EAAEyH,WAAW0E,MAAM,OAAOtgB,IAAI7H,KAAKsrB,MAAMY,SAASlsB,KAAK2K,QAAQ,QAAQ,CAAC+Y,IAAI7b,EAAE4E,MAAMzM,KAAKwe,aAAa3W,GAAGzI,KAAK8kB,EAAErc,GAAGzF,MAAMgQ,SAAS,IAAI4J,EAAEkK,UAAU,IAAIlK,EAAEkK,SAASC,QAAQ,UAAUnK,EAAEgD,MAAMhf,KAAKgrB,OAAOhO,UAAUuW,mBAAmBxV,KAAK/d,KAAKoS,UAAUA,EAAE/P,QAAQrC,KAAK2qB,IAAI5D,QAAQ,OAAO/K,EAAEgD,MAAMhf,KAAK43B,2BAA2Bzb,EAAE,MAAMH,EAAE0J,WAAW1lB,KAAKsrB,MAAM7D,SAASzP,QAAQhY,KAAKynB,SAASuE,OAAO,IAAIhQ,EAAEyL,SAASd,SAAS,OAAO3K,EAAEgD,MAAMhf,KAAKynB,SAASuH,KAAKhvB,KAAKY,MAAMoG,OAAO,QAAG,GAAQ,UAAUgV,EAAEgD,MAAM,IAAIhD,EAAEyL,SAASd,SAAS3mB,KAAKsrB,MAAM7D,SAASzP,UAAUhY,KAAKgrB,OAAOhO,UAAUuW,mBAAmBxV,KAAK/d,KAAKqyB,EAAE,SAASjgB,GAAG,IAAI,IAAI4J,EAAE,EAAEA,EAAE5R,UAAUpD,OAAOgV,IAAI,CAAC,IAAInU,EAAE,MAAMuC,UAAU4R,GAAG5R,UAAU4R,GAAG,CAAA,EAAGoF,EAAE5Y,OAAOyD,KAAKpE,GAAG,mBAAmBW,OAAOwhB,wBAAwB5I,EAAEA,EAAEQ,OAAOpZ,OAAOwhB,sBAAsBniB,GAAGkJ,iBAAiBqB,GAAG,OAAO5J,OAAOyhB,yBAAyBpiB,EAAEuK,GAAGwX,UAAW,MAAKxI,EAAE1I,kBAAkBsD,GAAGmW,EAAE/f,EAAE4J,EAAEnU,EAAEmU,GAAI,GAAE,CAAC,OAAO5J,CAAC,CAArU,CAAuU,CAAE,EAACA,GAAG,CAAC/P,OAAOrC,KAAKs1B,aAAa,OAAOtZ,EAAEyJ,WAAWzlB,KAAKynB,SAASuH,SAAShvB,KAAK4sB,WAAWxa,EAAE/P,OAAOkb,WAAW,CAAC,EAAEkW,QAAQ,SAASrhB,GAAG,IAAI4J,EAAEhc,KAAKoS,EAAE8M,iBAAiB,IAAIrX,EAAEuZ,EAAEjF,EAAEhV,EAAEnH,KAAK5I,SAAS,GAAG,UAAU+P,EAAE6X,MAAM7X,EAAEqe,mBAAmBre,EAAEse,UAAU,OAAM,EAAGte,EAAEgoB,WAAW/N,EAAEhP,EAAEylB,eAAexb,OAAOwb,cAAc1b,EAAEiF,EAAEzR,QAAQ,QAAQxI,EAAEkiB,MAAME,YAAYnX,EAAE,CAACuZ,OAAO3rB,KAAK83B,WAAW3b,EAAE0b,cAAczW,IAAI1Q,eAAevJ,QAAG,IAASA,IAAIA,EAAEgV,GAAGhV,IAAI6U,EAAE+b,cAAc5wB,EAAEkV,OAAOwH,eAAeC,WAAW,IAAI,OAAO9H,EAAE5kB,SAAS4nB,KAAKhD,EAAEgP,OAAOhO,UAAUuZ,eAAexY,KAAK/B,EAAE5J,GAAG4J,EAAE5kB,SAAS6uB,YAAYpe,EAAEmU,EAAEwQ,QAAQxQ,EAAEsP,MAAMmB,UAAUtlB,GAAE,IAAK6U,EAAEsP,MAAMmB,UAAUtlB,EAAE6U,EAAEyL,SAASuH,KAAK7nB,KAAK6U,EAAErR,QAAQ,QAAQ,CAACvI,MAAMgQ,EAAE0lB,WAAW3b,EAAE0b,cAAczW,EAAE4W,UAAUnwB,GAAI,IAAGkG,OAAK,SAAWqE,GAAG,OAAOA,CAAE,IAAG,EAAEuhB,OAAO,SAASvhB,GAAGA,EAAE8M,gBAAgB,EAAE+Y,eAAe,SAAS7lB,EAAE4J,GAAG,IAAInU,EAAEuZ,EAAEhP,EAAE9P,QAAQ,IAAItC,KAAK5I,SAASqsB,WAAWC,KAAKvH,EAAEnc,KAAKwe,aAAa4C,GAAGja,EAAE+c,EAAE9C,GAAGW,EAAE/hB,KAAK+mB,MAAM/D,UAAUjF,KAAK/d,KAAKoS,GAAGgK,GAAG+V,EAAEtqB,EAAE,CAAA,EAAG7H,KAAK5I,SAAS4tB,YAAYjD,GAAGoQ,EAAEtqB,EAAE,UAAUV,EAAE+wB,SAASrwB,GAAGua,EAAEpiB,KAAKy2B,YAAYra,GAAGpc,KAAKm4B,sBAAsB5V,EAAEpb,EAAEiV,MAAK,IAAKhK,EAAEgmB,kBAAkBhW,GAAE,GAAIhB,EAAEhY,UAAUyW,OAAO7f,KAAK5I,SAASqsB,WAAWyD,YAAW,IAAK9E,GAAGjb,EAAE4mB,UAAU3L,EAAEhB,EAAEzb,OAAM,IAAKyc,EAAEjb,EAAExB,OAAOwB,EAAEvG,MAAMwhB,EAAEL,EAAE/a,QAAQhH,KAAK5I,SAASqwB,SAASd,UAAU3mB,KAAKsrB,MAAMY,UAAUlsB,KAAKsrB,MAAMY,QAAQtrB,MAAMmhB,GAAG/hB,KAAKynB,SAASuH,KAAKjN,IAAI/hB,KAAK2K,QAAQ,aAAa,CAAC+Y,IAAItC,EAAE3U,MAAM0P,EAAE/c,KAAKmjB,EAAE,CAAE,EAACviB,KAAKY,MAAMub,GAAG,CAACkc,SAAStW,IAAI3f,MAAM4Z,GAAG,EAAEsc,eAAe,SAASlmB,EAAE4J,GAAG,IAAInU,GAAGmU,EAAE6b,eAAexb,OAAOwb,eAAeloB,QAAQ,QAAQqM,EAAEkD,iBAAiB,IAAIkC,EAAEha,EAAES,GAAG7H,KAAK+2B,oBAAmB,EAAG3V,EAAE,EAAEmX,eAAe,SAASnmB,EAAE4J,GAAGhc,KAAKgrB,OAAOhO,UAAUqW,aAAatV,KAAK/d,KAAKgc,EAAE,EAAEwc,eAAe,SAASpmB,GAAGpS,KAAKsrB,MAAMY,QAAQ,CAAC1vB,MAAM4V,EAAE2U,MAAM3U,EAAEnJ,cAAc,qBAAqB,EAAEwvB,cAAc,SAASrmB,EAAE4J,GAAG,IAAInU,EAAE0b,EAAExF,KAAK/d,KAAKgc,EAAEiZ,eAAe,GAAG,UAAUj1B,KAAK5I,SAAS4nB,MAAMnX,GAAGmU,EAAEiZ,cAAczR,SAASxH,EAAE3Z,QAAQrC,KAAKynB,SAASuE,YAAY,GAAGhsB,KAAKsrB,MAAMY,UAAUlsB,KAAKsrB,MAAMC,UAAUvrB,KAAKguB,mBAAmBhuB,KAAK2qB,IAAInuB,MAAMgnB,SAASpR,IAAI,CAAC,IAAIgP,EAAEjF,EAAEhV,EAAE4a,EAAE/hB,KAAK5I,SAASglB,EAAEhK,EAAE9P,QAAQ,IAAIyf,EAAE0B,WAAWC,KAAKtB,EAAE8B,EAAE9H,GAAGiG,EAAEriB,KAAK+mB,MAAM/D,UAAUjF,KAAK/d,KAAKoS,GAAGkQ,GAAG6P,EAAE/Q,EAAE,CAAA,EAAGW,EAAEiD,YAAY3C,GAAG8P,EAAE/Q,EAAE,UAAUgB,EAAE8V,SAAS9W,GAAGsB,EAAEN,EAAEsW,eAAe7V,GAAE7iB,KAAKm4B,sBAAsB5V,EAAEH,EAAEE,IAAIQ,GAAE9iB,KAAKy2B,YAAYnU,GAAG,GAAGD,EAAE,GAAGQ,GAAE,CAAC,IAAIM,GAAE,GAAGhH,EAAEnc,KAAKqnB,aAAalgB,EAAEob,EAAE,CAAA,EAAGG,GAAGyP,EAAEhP,GAAE,CAAE,EAACpB,EAAEiD,YAAYhlB,KAAK8hB,KAAKO,IAAI8P,EAAEhP,GAAE,YAAYL,IAAGK,KAAIpB,EAAEsE,aAAatI,KAAK/d,KAAKmH,EAAEub,IAAG,KAAMI,KAAI3G,IAAG,IAAKuG,EAAEqL,YAAY/tB,KAAKy2B,YAAYtvB,IAAI,CAAC,GAAGnH,KAAK2K,QAAQ,UAAU,CAACvL,KAAK+H,EAAEuc,IAAItH,EAAExd,QAAQkkB,KAAIf,EAAEmE,SAASE,YAAY,OAAOrE,EAAE4D,gBAAgBxe,EAAE4mB,UAAUjL,GAAE3b,EAAEub,CAAC,MAAMX,EAAE4D,yBAAyBxe,EAAExB,aAAawB,EAAE,uBAAuBA,EAAEjP,OAAO8H,KAAK8tB,cAAc1R,EAAEjV,EAAE,MAAMnH,KAAK8tB,cAAc1R,EAAEsG,QAAQ1iB,KAAK8tB,cAAc1R,EAAE,CAAC,EAAEuc,iBAAiB,SAASvmB,EAAE4J,GAAG,IAAIhc,KAAKsrB,MAAME,UAAU,OAAOxrB,KAAK2K,QAAQ,eAAe,CAACvI,MAAMgQ,IAAIA,EAAElO,KAAK,IAAI,MAAM,IAAI,SAASlE,KAAKsrB,MAAMY,SAAQ,EAAKlQ,EAAEmI,gBAAgBuU,eAAe93B,MAAMob,EAAEuB,WAAW0S,aAAajU,EAAEmI,gBAAgByU,eAAe5c,GAAGA,EAAE3S,SAAS,MAAM,IAAI,QAAQ,IAAI,MAAM+I,EAAE8M,iBAAiB5e,YAAU,WAAa,OAAO8R,EAAE/P,OAAO+zB,MAAO,GAAE,GAAG,EAAE7C,mBAAmB,SAASnhB,GAAG,IAAI4J,EAAEnU,EAAEuZ,EAAEhP,EAAE/P,OAAOC,QAAQ,IAAItC,KAAK5I,SAASqsB,WAAWC,KAAKvH,EAAE+H,EAAE9C,GAAGja,EAAEnH,KAAK5I,SAASgqB,IAAG,IAAKjF,EAAE0c,WAAW7c,EAAEoF,EAAEhY,UAAUoa,SAASxjB,KAAK5I,SAASqsB,WAAW4E,YAAYxgB,EAAEuZ,EAAEoU,aAAa,YAAYruB,EAAEgoB,UAAUnT,GAAGnU,IAAI7H,KAAK5I,SAAS8uB,WAAW/e,EAAEse,YAAYzlB,KAAKgrB,OAAOhO,UAAUwb,eAAeza,KAAK/d,KAAKohB,GAAGphB,KAAK6sB,QAAQzL,IAAIphB,KAAKguB,kBAAiB,GAAI,UAAU7mB,EAAE6X,MAAMhf,KAAK2K,QAAQ,WAAW,CAAC+Y,IAAItC,EAAE3U,MAAMzM,KAAKwe,aAAa4C,GAAGhiB,KAAK8kB,EAAE9C,KAAK,EAAE6S,iBAAiB,SAAS7hB,GAAG,IAAI4J,EAAEhc,KAAKoS,EAAEsG,SAAO,SAAWtG,GAAGA,EAAE0mB,WAAWpgB,SAAS,SAAStG,GAAG,GAAG,mBAAmBA,EAAE2mB,UAAU3mB,EAAE4mB,YAAYpwB,SAAS+sB,cAAc,YAAY,GAAG,GAAGvjB,EAAEoK,UAAUpK,EAAEnJ,cAAc+S,EAAE5kB,SAASqsB,WAAWG,aAAa,CAAC,IAAI/b,EAAEuZ,EAAExY,SAASmb,eAAe,IAAI,GAAG3R,EAAEkL,WAAW,GAAGd,UAAU,MAAMpK,EAAEsO,gBAAgBuV,WAAW7U,EAAExY,SAASmb,eAAe,QAAQlc,EAAEuK,GAAG4mB,YAAYrX,MAAM9Z,EAAEyqB,EAAE,CAAClR,GAAGQ,OAAO0Q,EAAEA,EAAElgB,EAAEkL,YAAY/V,MAAM,GAAG,OAAO8c,EAAEjD,EAAE,MAAM,GAAGmC,EAAExF,KAAK/B,EAAE5J,GAAG,CAAC,IAAI+J,EAAE,GAAG,IAAI,QAAQA,EAAE/J,EAAEsO,uBAAkB,IAASvE,OAAE,EAAOA,EAAEK,WAAWpK,EAAEsO,gBAAgBsU,aAAa5iB,EAAEsO,gBAAgBrX,SAAS+I,EAAEsO,iBAAiB,MAAMtO,EAAEsO,gBAAgBuV,SAAS,CAAC7jB,EAAEsO,gBAAgBsY,YAAY,OAAO,IAAI,IAAI7xB,EAAEiL,EAAE+jB,YAAYpU,EAAE,GAAG5a,GAAG4a,GAAG5a,EAAE6tB,YAAY7tB,EAAEA,EAAEgvB,YAAYpU,EAAED,QAAQuC,EAAEjS,EAAEsO,gBAAgB,MAAMtO,EAAEsO,kBAAkBwD,EAAE9R,EAAEsO,kBAAkBtO,EAAEwS,OAAO,IAAI,CAAE,IAAGxS,EAAE6mB,aAAavgB,kBAAkBtG,GAAGA,GAAG,MAAMA,EAAE6jB,UAAU1S,EAAExF,KAAK/B,EAAEnU,KAAKmU,EAAE4Q,WAAW/kB,GAAGmU,EAAE4b,2BAA4B,GAAG,IAAG,IAAI/vB,EAAE7H,KAAK2qB,IAAI5D,MAAMiQ,UAAUnvB,GAAG,IAAIA,EAAEguB,WAAWhuB,EAAEwB,SAASxB,GAAG,MAAMA,EAAEouB,UAAUj2B,KAAK2qB,IAAI5D,MAAM+I,YAAYlnB,SAAS+sB,cAAc,MAAM,IAAI,SAASuD,EAAE9mB,EAAE4J,IAAI,MAAMA,GAAGA,EAAE5J,EAAEpL,UAAUgV,EAAE5J,EAAEpL,QAAQ,IAAI,IAAIa,EAAE,EAAEuZ,EAAE,IAAItX,MAAMkS,GAAGnU,EAAEmU,EAAEnU,IAAIuZ,EAAEvZ,GAAGuK,EAAEvK,GAAG,OAAOuZ,CAAC,CAAC,SAAS+X,EAAE/mB,EAAE4J,EAAEnU,GAAG,OAAOmU,KAAK5J,EAAE5J,OAAOmhB,eAAevX,EAAE4J,EAAE,CAACpb,MAAMiH,EAAE+hB,YAAW,EAAGC,cAAa,EAAGC,UAAS,IAAK1X,EAAE4J,GAAGnU,EAAEuK,CAAC,CAAC,SAASgnB,EAAEhnB,EAAE4J,GAAG,OAAO,MAAMA,GAAG,oBAAoBqF,QAAQrF,EAAEqF,OAAOoB,eAAezG,EAAEqF,OAAOoB,aAAarQ,GAAGA,aAAa4J,CAAC,CAAC,SAASqd,EAAEjnB,GAAG,IAAI,IAAI4J,EAAE,EAAEA,EAAE5R,UAAUpD,OAAOgV,IAAI,CAAC,IAAInU,EAAE,MAAMuC,UAAU4R,GAAG5R,UAAU4R,GAAG,CAAE,EAACoF,EAAE5Y,OAAOyD,KAAKpE,GAAG,mBAAmBW,OAAOwhB,wBAAwB5I,EAAEA,EAAEQ,OAAOpZ,OAAOwhB,sBAAsBniB,GAAGkJ,QAAM,SAAWqB,GAAG,OAAO5J,OAAOyhB,yBAAyBpiB,EAAEuK,GAAGwX,UAAW,MAAKxI,EAAE1I,SAAO,SAAWsD,GAAGmd,EAAE/mB,EAAE4J,EAAEnU,EAAEmU,GAAI,GAAE,CAAC,OAAO5J,CAAC,CAAC,SAASknB,EAAElnB,GAAG,OAAO,SAASA,GAAG,GAAGtI,MAAM8B,QAAQwG,GAAG,OAAO8mB,EAAE9mB,EAAE,CAA3C,CAA6CA,IAAI,SAASA,GAAG,GAAG,oBAAoBiP,QAAQ,MAAMjP,EAAEiP,OAAOC,WAAW,MAAMlP,EAAE,cAAc,OAAOtI,MAAMC,KAAKqI,EAAE,CAA/G,CAAiHA,IAAI,SAASA,EAAE4J,GAAG,GAAI5J,EAAJ,CAAa,GAAG,iBAAiBA,EAAE,OAAO8mB,EAAE9mB,EAAE4J,GAAG,IAAInU,EAAEW,OAAO4U,UAAUmE,SAASxD,KAAK3L,GAAG7K,MAAM,GAAG,GAAuD,MAApD,WAAWM,GAAGuK,EAAEtS,cAAc+H,EAAEuK,EAAEtS,YAAYzH,MAAS,QAAQwP,GAAG,QAAQA,EAASiC,MAAMC,KAAKlC,GAAM,cAAcA,GAAG,2CAA2C8Y,KAAK9Y,GAAUqxB,EAAE9mB,EAAE4J,QAAlF,CAAhM,CAAoR,CAAxS,CAA0S5J,IAAI,WAAW,MAAM,IAAIoP,UAAU,wIAAwI,CAAvK,EAA0K,CAAC,SAAS+X,EAAEnnB,EAAE4J,GAAG,IAAI5J,EAAE,CAACgP,GAAES,KAAK,0BAA0BzP,GAAG,IAAIvK,EAAE,IAAI2xB,MAAMx5B,KAAK,CAACkC,IAAI,WAAW,OAAO,WAAW,OAAO2F,CAAC,CAAC,IAAI,OAAOA,CAAC,CAAC,GAAGuK,EAAEwY,SAAS,OAAOxJ,GAAES,KAAK,iEAAiEzP,GAAGA,EAAEwY,SAAS,IAAIzO,EAAEoG,EAAEviB,KAAK,SAASoS,GAAG,IAAI4J,EAAEpT,SAASmb,eAAe,IAAIlc,EAAE,GAAG,SAASsU,EAAE/J,EAAEvK,EAAEuZ,GAAGA,GAAGvZ,EAAEgD,MAAM,QAAQ6N,SAAO,SAAW7Q,GAAG,OAAOmU,EAAE5J,EAAE,iBAAiB2L,KAAK/B,EAAEnU,EAAEuZ,EAAG,GAAE,CAAC,MAAM,CAACqY,yBAAyB,WAAWjxB,OAAOJ,QAAQP,GAAG6Q,SAAO,SAAWtG,GAAG,IAAI4J,EAAEiW,EAAE7f,EAAE,GAAGvK,EAAEmU,EAAE,GAAGA,EAAE,GAAGtD,SAAO,SAAWtG,GAAG,OAAO+J,EAAE,SAAStU,EAAEuK,EAAG,GAAG,IAAGvK,EAAE,CAAA,CAAE,EAAE6xB,IAAI,SAAStnB,EAAE4J,GAAG,OAAO5J,IAAI4J,EAAEG,EAAE,SAAS/J,EAAE4J,GAAG5J,EAAEvH,MAAM,QAAQ6N,SAAS,SAAStG,GAAG,IAAI4J,EAAE,QAAQA,EAAEnU,EAAEuK,UAAK,IAAS4J,GAAGA,EAAEtD,SAAO,SAAWsD,GAAG,OAAOG,EAAE,SAAS/J,EAAE4J,EAAG,WAAUnU,EAAEuK,EAAG,KAAIpS,IAAI,EAAE0yB,GAAG,SAAStgB,EAAE4J,GAAG,OAAOA,GAAG,mBAAmBA,IAAI5J,EAAEvH,MAAM,QAAQ6N,SAAO,SAAWtG,GAAGtI,MAAM8B,QAAQ/D,EAAEuK,IAAIvK,EAAEuK,GAAGhP,KAAK4Y,GAAGnU,EAAEuK,GAAG,CAAC4J,EAAG,IAAGG,EAAE,MAAM/J,EAAE4J,IAAIhc,IAAI,EAAE2K,QAAQ,SAAS9C,EAAEsU,EAAEhV,GAAG,IAAI4a,EAAE,GAAG5a,EAAEA,GAAG,CAACwyB,WAAU,GAAI9xB,EAAE,GAAGuK,EAAEhb,SAAS07B,eAAe,UAAUjrB,IAAIA,EAAE,aAAakrB,OAAO3gB,EAAEuY,IAAIqI,eAAe4G,eAAe/xB,EAAE,CAACsU,QAAQ,CAAC,IAAI,IAAIC,EAAE,iBAAiBD,EAAEA,EAAE,CAACvb,MAAMub,GAAG,IAAIC,EAAEjV,EAAEwyB,UAAUpX,EAAE,GAAGnG,GAAGA,GAAGuP,OAAO3rB,KAAKmc,EAAE/Z,QAAQga,EAAEha,MAAMpC,KAAK65B,WAAW1d,EAAE/Z,QAAQ4vB,EAAE7V,EAAE3T,QAAQ,IAAI,IAAI4Z,KAAKjG,EAAE6V,EAAE7V,EAAEiG,GAAG0X,eAAe1d,EAAEgG,GAAGjG,EAAEiG,IAAIL,EAAE,IAAIgY,YAAYlyB,EAAE,CAACmyB,OAAO5d,GAAG,CAAC,MAAMhK,GAAGgP,GAAES,KAAKzP,EAAE,CAAC4J,EAAEie,cAAclY,EAAE,CAAC,EAAE,CAA3jC,CAA6jC/hB,OAAOA,KAAKk6B,UAAU,iBAAiBvZ,KAAKsC,UAAUC,aAAa,aAAavC,KAAKsC,UAAUC,WAAWljB,KAAKy0B,KAAKpY,OAAOzT,SAASuxB,aAAane,EAAEA,GAAG,CAAA,EAAGhc,KAAKo6B,kBAAkBje,EAAEH,EAAEja,GAAG,SAASqQ,GAAG,IAAI4J,EAAEnU,EAAE,IAAIuK,EAAE,GAAG,GAAGioB,aAAa52B,QAAQ2tB,GAAEjV,EAAE,KAAK,GAAG,IAAIH,EAAE5M,KAAKkrB,MAAMD,aAAajJ,GAAEjV,EAAEtU,GAAG,CAAC,MAAMuK,GAAE,CAAE,OAAO4J,CAAC,GAAGhc,KAAKu6B,iBAAiB,SAASnoB,GAAG,OAAOA,GAAGioB,aAAaG,QAAQpJ,GAAEhf,EAAE,KAAK,GAAG,SAAS4J,EAAEnU,GAAG,IAAIuZ,EAAE,IAAIvZ,EAAEsU,EAAE/M,KAAKC,UAAU2M,GAAGA,GAAGnU,IAAIwyB,aAAaG,QAAQpJ,GAAEhf,EAAEgP,EAAEjF,GAAG8d,cAAc,IAAIQ,MAAM,YAAY,GAAG,YAAY,CAA7L,CAA+Lze,EAAEja,IAAI/B,KAAK06B,mBAAmB,SAAStoB,GAAG,OAAO,SAAS4J,GAAG,IAAInU,EAAEupB,GAAE,IAAIhf,EAAE,IAAI,GAAG4J,EAAEqe,aAAaM,WAAW9yB,EAAEmU,QAAQ,IAAI,IAAIoF,KAAKiZ,aAAajZ,EAAE5d,SAASqE,IAAIwyB,aAAaM,WAAWvZ,EAAE,CAAC,CAA5J,CAA8JpF,EAAEja,IAAI/B,KAAK46B,cAAcxoB,EAAE4J,GAAGhc,KAAKsrB,MAAM,CAACmB,UAAU,GAAGP,SAAQ,EAAGV,WAAU,EAAG/W,QAAQ,GAAG+R,QAAQ,CAAE,EAACiB,SAAS,CAAA,EAAGgI,YAAY,IAAIzvB,KAAKY,MAAM,GAAGZ,KAAKihB,UAAU,GAAGjhB,KAAK2qB,IAAI,GAAG3qB,KAAK66B,MAAMzoB,GAAGoY,EAAEzM,KAAK/d,MAAMA,KAAK86B,aAAa96B,KAAK23B,qBAAqB33B,KAAKgrB,OAAOwH,cAAczU,KAAK/d,MAAMA,KAAKgrB,OAAOjlB,QAAQgY,KAAK/d,MAAMoS,EAAE2oB,WAAW/6B,KAAK2qB,IAAI5D,MAAMC,QAAQ5U,EAAEwY,SAAS5qB,IAAI,CAACu5B,EAAEnc,UAAU,CAACqN,UAAUM,GAAEiQ,oBAAoB3W,EAAE4W,cAAc/W,EAAEgX,QAAQ,CAACC,QAAQhf,EAAEif,qBAAqBj0B,EAAEk0B,KAAKtZ,EAAEuZ,SAAShZ,EAAEiZ,UAAUnf,EAAE2M,WAAW1G,EAAEmZ,OAAOjZ,EAAEkZ,kBAAkB/Y,EAAEgZ,OAAOvY,EAAEwY,UAAUpY,GAAGkP,iBAAiB,CAAC,SAAS,MAAM,SAAS,UAAU,QAAQ,QAAQ,QAAQ,UAAU,QAAQ,OAAO,aAAa,oBAAoB,eAAe,aAAa,eAAe,gBAAgB,gBAAgB,kBAAkB,mBAAmB,mBAAmB,mBAAmBmJ,UAAU,CAAC,YAAY,YAAY,iBAAiB,iBAAiB,WAAW9Z,KAAK,SAAS1P,GAAG,OAAOpS,KAAK5I,SAAS0qB,MAAM1P,GAAG,iBAAiBA,EAAEA,EAAE0P,OAAO1P,CAAC,EAAEmpB,UAAUnf,EAAEsS,UAAU+C,GAAE7C,cAAc,SAASxc,EAAE4J,GAAG,OAAOI,GAAGhK,EAAEpS,KAAK5I,SAASs3B,UAAUtc,IAAIA,GAAGuP,MAAM3hB,KAAKgc,GAAG,EAAE,aAAIsJ,CAAUlT,GAAG,IAAI4J,EAAE5J,GAAGtI,MAAM8B,QAAQwG,GAAGpS,KAAK5I,SAASkuB,UAAUtJ,EAAE5J,EAAE,GAAGpS,KAAKu6B,iBAAiBve,EAAE5J,EAAE,GAAG,YAAY,EAAE,aAAIkT,GAAY,OAAOtlB,KAAK5I,SAASkuB,SAAS,EAAE,aAAIG,CAAUrT,GAAGpS,KAAK5I,SAASquB,YAAYrT,EAAEpS,KAAK67B,qBAAqBzpB,EAAE,EAAE,aAAIqT,GAAY,OAAOzlB,KAAK5I,SAASquB,SAAS,EAAEqW,uBAAuB,SAAS1pB,GAAG,IAAI4J,EAAE,SAASA,GAAG,IAAInU,EAAEmU,EAAExT,OAAOmhB,eAAevX,EAAEvK,EAAE,WAAW,CAAC3F,IAAI,WAAW,MAAM,IAAIlC,KAAK6H,GAAGgD,MAAM,KAAK,EAAE,GAAG,EAAE,IAAI,IAAIhD,KAAKuK,EAAE4J,EAAEnU,EAAE,EAAE+yB,cAAc,SAASxoB,EAAE4J,GAAG,IAAInU,EAAEuZ,EAAEyD,GAAE6J,UAAU1uB,KAAK0uB,UAAU,IAAIvS,EAAEoG,EAAE,CAAA,EAAGsC,GAAE,OAAO7I,EAAEgD,KAAK,CAACyI,SAAS,CAAC0B,SAAS,SAAS,CAAE,GAAEhiB,EAAEnH,KAAK5I,SAASmrB,EAAE,GAAGpG,EAAEH,GAAG,GAAG7U,EAAE4B,SAASqJ,EAAEojB,aAAa,YAAYruB,EAAEgoB,SAAShoB,EAAEgoB,UAAU/c,EAAEojB,aAAa,YAAYruB,EAAE0qB,YAAYxP,EAAEjQ,EAAEyO,aAAa,gBAAgB1Z,EAAE0qB,aAAa,IAAI1qB,EAAEyqB,SAASxf,EAAEojB,aAAa,YAAYx1B,KAAK87B,uBAAuB30B,EAAEsc,iBAAY,IAAStc,EAAEsgB,SAASqB,sBAAsB3hB,EAAEsgB,SAASqB,oBAAoB3hB,EAAEke,YAAYrlB,KAAKy0B,OAAOttB,EAAEuf,cAAa,GAAI,CAAC,YAAY,aAAahO,SAAS,SAASsD,GAAG,IAAInU,EAAEuK,EAAEyO,aAAa,QAAQ7E,GAAGnU,GAAGuxB,EAAEvxB,EAAEA,EAAEgD,MAAM1D,EAAE2d,YAAYhb,SAAS3C,EAAE6U,GAAGnU,EAAG,IAAG,iBAAiBmU,IAAIsG,EAAEtG,EAAE0K,gBAAgBvf,EAAEuf,aAAa7B,GAAE6B,aAAavf,EAAEuf,aAAaC,QAAQ3K,EAAE0K,cAAc,OAAOvf,EAAE6X,OAAO7X,EAAE4d,QAAQ5d,EAAE4d,SAAS,IAAI5d,EAAEuf,aAAaE,UAAS,EAAGzf,EAAE2d,WAAW9I,EAAE8I,YAAY,KAAK3d,EAAE6d,cAAc7d,EAAEsgB,SAASiB,WAAWllB,SAAS2D,EAAE6d,cAAc7d,EAAEsgB,SAASiB,WAAWtlB,KAAK+D,EAAE6d,cAAc5S,EAAE2S,QAAQ,IAAI5d,EAAE4d,QAAQ,IAAIgX,OAAO3pB,EAAE2S,QAAQ,CAAC,MAAM3S,GAAI,CAAA,GAAGjL,EAAE2d,WAAW,CAAC3d,EAAE60B,YAAY70B,EAAE2d,WAAW,IAAI3d,EAAE2d,WAAW,IAAIiX,OAAO/7B,KAAK5I,SAAS0tB,WAAW,IAAI,CAAC,MAAM1S,IAAI,CAACjL,EAAE4B,WAAW5B,EAAEse,WAAU,GAAIzlB,KAAKi8B,MAAM5C,EAAE,CAAA,EAAGhI,GAAElqB,EAAE+0B,OAAO,CAAE,IAAG,UAAU/0B,EAAE6X,OAAO,QAAQnX,EAAEmU,EAAEyL,gBAAW,IAAS5f,OAAE,EAAOA,EAAE8e,WAAWxf,EAAEse,YAAYte,EAAEsgB,SAASd,QAAQ,GAAGxf,EAAEsgB,SAAS2B,cAAc,QAAQhI,EAAEpF,EAAEyL,gBAAW,IAASrG,OAAE,EAAOA,EAAEgI,eAAexgB,SAASuZ,KAAK,IAAIJ,EAAE/hB,KAAKo6B,iBAAiB,aAAatwB,MAAM8B,QAAQmW,KAAK/hB,KAAKslB,UAAUxb,MAAM8B,QAAQzE,EAAEme,WAAW5C,EAAEvb,EAAEme,UAAUvD,GAAGA,EAAE,EAAE+P,cAAc,SAAS1f,GAAG,IAAI4J,EAAEnU,EAAE7H,KAAKm8B,oBAAoB/pB,GAAGgP,EAAE,GAAG,IAAIpF,KAAKnU,EAAEuZ,GAAG,IAAIpF,QAAG,IAAS5J,EAAE4J,GAAG,KAAK4F,OAAO/Z,EAAEmU,GAAG,KAAK,IAAI,OAAOoF,CAAC,EAAE+a,oBAAoB,SAAS/pB,GAAG,IAAIkQ,EAAElQ,GAAG,MAAM,GAAG,IAAI4J,EAAEnU,EAAE,CAAA,EAAG,IAAImU,KAAK5J,EAAE,MAAM4J,EAAEzU,MAAM,EAAE,IAAI,SAASyU,GAAG5J,EAAEoQ,eAAexG,SAAI,IAAS5J,EAAE4J,KAAKnU,EAAEmU,GAAGqG,EAAEjQ,EAAE4J,KAAK,OAAOnU,CAAC,EAAEwnB,kBAAkB,WAAW,IAAIjd,EAAEiK,OAAOwH,eAAe7H,EAAE,CAACyZ,aAAarjB,EAAEqjB,aAAaC,WAAWtjB,EAAEsjB,WAAW0G,MAAMhqB,EAAE0R,YAAY1R,EAAEkS,YAAYlS,EAAE0R,WAAW,IAAI,OAAO9jB,KAAKsrB,MAAMkE,UAAUxT,EAAEA,CAAC,EAAE8e,WAAW,WAAW,IAAI1oB,EAAE4J,EAAEnU,EAAEuZ,EAAEL,iBAAiB/gB,KAAK2qB,IAAInuB,MAAM,MAAMwD,KAAKq8B,QAAQ,CAACC,mBAAmBlqB,EAAE,SAASA,GAAG,IAAIA,EAAE,MAAM,CAAA,EAAG,IAAI4J,GAAG5J,EAAEA,EAAE0P,OAAOjX,MAAM,KAAK,IAAIA,MAAM,QAAQkG,iBAAiBqB,GAAG,OAAOA,CAAE,IAAGpI,MAAM8X,OAAO,MAAM,CAAClhB,OAAOwR,EAAEvH,MAAMmR,GAAGjL,QAAQ,SAASqB,GAAG,OAAOA,CAAE,IAAG,GAAG0P,OAAOya,KAAKvgB,EAAE,CAAjM,EAAoMnU,EAAE,sBAAsBuZ,EAAEob,iBAAiB,KAAK30B,KAAKmU,EAAE5J,EAAExR,MAAM,KAAKwR,EAAEmqB,KAAK,IAAIvgB,EAAEA,GAAG,EAAE6e,MAAM,SAASzoB,GAAG,IAAI4J,EAAEhc,KAAK2qB,IAAI9iB,EAAEuK,EAAE9P,QAAQ,SAAStC,KAAK5I,SAASovB,QAAQiW,YAAYzgB,EAAEgX,cAAc,KAAKhX,EAAExf,MAAM4V,EAAE4J,EAAE+K,MAAM3U,IAAI4J,EAAEgX,cAAc5gB,EAAE4J,EAAE0gB,uBAAuBtqB,EAAEuqB,SAAS3gB,EAAExf,MAAMwD,KAAK4uB,cAAc,UAAU,CAACxc,EAAEpS,KAAK5I,WAAW4kB,EAAE+K,MAAM/K,EAAExf,MAAMyM,cAAcjJ,KAAK5I,SAASqsB,WAAWmZ,eAAexqB,EAAEmL,WAAW2C,aAAalE,EAAExf,MAAM4V,GAAGA,EAAEuqB,UAAU,GAAG90B,GAAGA,EAAE+Y,aAAa,MAAM,GAAG,EAAEM,QAAQ,WAAWlhB,KAAKgrB,OAAO+J,aAAahX,KAAK/d,MAAMA,KAAK2qB,IAAInuB,MAAM+gB,WAAWC,YAAYxd,KAAK2qB,IAAInuB,OAAOwD,KAAK2qB,IAAIqI,cAAc2J,SAAS38B,KAAK2qB,IAAI+R,8BAA8B18B,KAAK2qB,IAAIqI,cAAcpI,SAAS5qB,KAAKynB,SAASuE,MAAK,GAAIhsB,KAAKy5B,2BAA2Bl5B,aAAaP,KAAKovB,iCAAiCgF,cAAcp0B,KAAKihB,UAAU2R,KAAKyB,mCAAmC,EAAEsD,mBAAmB,SAASvlB,GAAG,IAAI4J,EAAEnU,EAAE7H,KAAK5I,SAAS,GAAG4I,KAAKsrB,MAAMuR,kBAAiB,OAAG,IAASzqB,EAAE,CAAC,IAAIgP,EAAEphB,KAAKo6B,iBAAiB,SAAShoB,EAAEgP,IAAIphB,KAAK2qB,IAAIqI,cAAcpyB,MAAMwgB,EAAEvZ,EAAE2e,QAAQiW,WAAWz8B,KAAK2qB,IAAI5D,MAAMiO,YAAYh1B,KAAK2qB,IAAIqI,cAAcpyB,KAAK,CAAC,GAAGZ,KAAKizB,gBAAgB7gB,EAAE,GAAG,OAAOvK,EAAEmX,KAAKhf,KAAK88B,aAAa1qB,IAAI4J,EAAEhc,KAAK2qB,IAAI5D,MAAMiQ,YAAY,MAAMhb,EAAE+gB,SAAS/8B,KAAK2qB,IAAI5D,MAAMiW,mBAAmB,YAAY,YAAY,CAAC,IAAI5D,EAAEhqB,KAAKkrB,MAAMloB,GAAGtI,SAASsI,EAAEhD,KAAKkrB,MAAMloB,GAAG,CAAC,MAAMA,GAAE,CAAEpS,KAAKwsB,QAAQpa,GAAE,GAAIsG,SAAO,SAAWtG,GAAG,OAAOA,GAAGA,EAAEhJ,UAAUE,IAAIzB,EAAE4b,WAAWwD,eAAgB,GAAE,MAAMjnB,KAAKm1B,aAAan1B,KAAKsrB,MAAM2R,0BAA0Bp1B,EAAE2e,QAAQiW,WAAW,GAAGz8B,KAAK2qB,IAAIqI,cAAcpyB,KAAK,EAAEi5B,WAAW,SAASznB,GAAG,IAAI4J,EAAE,CAAE,EAAC,IAAI,IAAInU,KAAKuK,EAAE,QAAQvK,IAAImU,EAAEnU,GAAGuK,EAAEvK,IAAI,OAAOmU,CAAC,EAAEqZ,QAAQ,SAASjjB,GAAG,OAAOpS,KAAKsrB,MAAM4D,UAAU9c,EAAEpS,KAAK2qB,IAAInuB,MAAM4M,UAAUgJ,EAAE,MAAM,UAAUpS,KAAK5I,SAASqsB,WAAW2D,cAAcpnB,IAAI,EAAEooB,WAAW,SAAShW,EAAE4J,GAAG,OAAO5J,GAAGA,EAAEhJ,UAAU4S,EAAE,MAAM,UAAUhc,KAAK5I,SAASqsB,WAAW2E,YAAYpoB,IAAI,EAAEk9B,YAAY,SAAS9qB,EAAE4J,GAAG,iBAAiB5J,GAAGpS,KAAK2qB,IAAInuB,MAAM4M,UAAUyW,OAAOzN,EAAE4J,EAAE,EAAE0a,sBAAsB,SAAStkB,GAAG,IAAI4J,GAAE,IAAK5J,QAAG,IAASA,GAAGpS,KAAK5I,SAASw6B,UAAUxf,GAAGA,IAAIpS,KAAKi8B,MAAM1U,QAAQvL,GAAE,GAAIhc,KAAKk9B,YAAYl9B,KAAK5I,SAASqsB,WAAWyD,YAAYlL,GAAGhc,KAAK2qB,IAAInuB,MAAMmJ,MAAMqW,EAAE,GAAG5J,CAAC,EAAE4b,iBAAiB,SAAS5b,GAAGpS,KAAKk9B,YAAYl9B,KAAK5I,SAASqsB,WAAWuD,QAAQ5U,EAAE,EAAE+qB,eAAe,SAAS/qB,GAAG,IAAI4J,EAAEhc,KAAK,CAAC,OAAO,QAAQ0Y,SAAS,SAAS7Q,GAAG,OAAOmU,EAAE2O,IAAI5D,MAAMnG,aAAa,GAAGgB,OAAO/Z,EAAE,gBAAgBuK,EAAG,GAAE,EAAEgjB,mBAAmB,WAAW,IAAIp1B,KAAK5I,SAASovB,QAAQiW,WAAW,CAAC,IAAIrqB,EAAEpS,KAAK2qB,IAAIqI,cAAchX,EAAEhc,KAAKsrB,MAAM2R,4BAA4B7qB,EAAExR,MAAMiH,EAAE,IAAIkyB,YAAY,SAAS,CAACqD,SAAQ,IAAKphB,IAAIhc,KAAKsrB,MAAM2R,0BAA0B7qB,EAAExR,MAAMiH,EAAEw1B,WAAU,EAAGjrB,EAAEkrB,eAAelrB,EAAEkrB,cAAcC,SAASz2B,KAAK02B,UAAUprB,EAAE6nB,cAAcpyB,GAAG7H,KAAK2K,QAAQ,SAAS3K,KAAKsrB,MAAM2R,2BAA2B7qB,EAAExR,MAAMZ,KAAKsrB,MAAM2R,0BAA0B,CAAC,EAAEjS,OAAOuH,GAAEqF,yBAAyB,WAAU,EAAGb,mBAAmB,SAAS3kB,EAAE4J,GAAG,GAAGA,EAAE,CAAC5J,EAAE,iBAAiBA,EAAEA,IAAIA,EAAE4J,EAAEA,EAAEgb,WAAWhb,EAAE,IAAInU,EAAEe,SAASib,eAAe,GAAGuV,EAAEvxB,EAAEsvB,UAAUnB,WAAWh2B,KAAK2qB,IAAI5D,MAAMvD,SAAS3b,EAAEsvB,WAAW,OAAM,EAAG,IAAItvB,EAAEyc,YAAY,GAAG,CAAC,QAAQ,OAAO5L,SAAO,SAAW0I,GAAG,OAAOvZ,EAAEic,WAAW,GAAG,MAAM1C,GAAGpF,EAAE5J,GAAG4J,EAAEhV,OAAQ,GAAE,CAAC,MAAMoL,GAAGpT,QAAQ6iB,KAAKzP,EAAE,CAAC,CAAC,EAAEqU,eAAe,SAASrU,EAAE4J,GAAG,GAAGA,EAAEA,GAAGhc,KAAK5I,SAASovB,QAAQC,eAAerU,GAAGA,EAAEmL,YAAYvB,EAAE,OAAOA,EAAE,iBAAiBA,EAAEpT,SAASmb,eAAe/H,GAAGA,EAAE5J,EAAEmL,WAAW2C,aAAalE,EAAE5J,EAAE+jB,aAAana,CAAC,EAAEmc,sBAAsB,SAAS/lB,GAAG,IAAI4J,EAAE5J,EAAEsmB,eAAe,IAAI,IAAI7wB,KAAKmU,EAAE,IAAIhc,KAAK47B,UAAUp4B,SAASqE,IAAIuK,EAAEvK,IAAImU,EAAEnU,GAAG,OAAM,EAAG,OAAM,CAAE,EAAE41B,eAAe,SAASrrB,GAAG,OAAOA,EAAEnJ,cAAcjJ,KAAK5I,SAASqsB,WAAWia,gBAAgB,EAAEC,eAAe,SAASvrB,EAAE4J,GAAGhc,KAAKy9B,eAAerrB,GAAG4d,UAAU3N,EAAErG,EAAE,EAAE6Q,QAAQ,SAASza,EAAE4J,GAAG,IAAInU,EAAE7H,KAAKoS,EAAEA,GAAGpS,KAAK49B,aAAa5hB,EAAEA,GAAG,CAAE,EAAC,IAAIG,EAAEnc,KAAK5I,SAAS+P,EAAEnH,KAAKy9B,eAAerrB,GAAG2P,EAAE/hB,KAAKwe,aAAapM,GAAGgK,EAAE8H,EAAE9R,GAAGgQ,EAAEpiB,KAAKgrB,OAAOhO,UAAUqF,GAAE,EAAGC,EAAE,UAAUnG,EAAE6C,KAAK,IAAIsD,GAAGtiB,KAAKynB,SAASuE,OAAO7kB,GAAG,IAAIiyB,EAAEhd,EAAE5T,WAAW,aAAa4T,IAAIA,EAAEyc,SAAS,OAAOzc,EAAE8H,EAAE9R,EAAE,CAACsmB,eAAenW,EAAE,CAAA,EAAGnG,GAAGwc,eAAexmB,EAAEwd,WAAU,KAAM1L,EAAE9H,EAAEwc,eAAexc,EAAEsc,gBAAgBvxB,EAAEyZ,aAAa,mBAAkB,GAAIxO,EAAEhJ,UAAUE,IAAI6S,EAAEsH,WAAW4E,YAAYroB,KAAKgrB,OAAOhO,UAAUwb,eAAeza,KAAK/d,KAAKoS,GAAGjL,EAAEyV,iBAAiB,QAAQwF,EAAEmW,eAAerb,KAAKld,KAAKoS,IAAIjL,EAAEyV,iBAAiB,OAAOwF,EAAEqW,cAAcvb,KAAKld,KAAKA,KAAKy9B,eAAerrB,KAAKjL,EAAEyV,iBAAiB,QAAQwF,EAAE6V,eAAe/a,KAAKld,KAAKmH,IAAIA,EAAEyV,iBAAiB,QAAQwF,EAAEkW,eAAepb,KAAKld,KAAKmH,IAAIA,EAAEyV,iBAAiB,WAAS,SAAWZ,GAAG,OAAOoG,EAAEuW,iBAAiB5a,KAAKlW,EAAEmU,EAAE5J,EAAG,IAAGjL,EAAEyV,iBAAiB,mBAAmBwF,EAAEyR,mBAAmB3W,KAAKld,OAAOmH,EAAEyV,iBAAiB,iBAAiBwF,EAAE2R,iBAAiB7W,KAAKld,OAAOgc,EAAE6hB,iBAAiBxb,EAAEriB,KAAK89B,sBAAsB1rB,IAAIjL,EAAEixB,gBAAgB/V,EAAEriB,KAAK2K,QAAQ,aAAa,CAAC+Y,IAAItR,EAAE3F,MAAMsV,EAAE3iB,KAAKgd,EAAEua,QAAQtU,IAAIlb,EAAE6f,SAAS1E,GAAGtiB,KAAK+2B,oBAAmB,EAAG5vB,GAAG,IAAIgV,EAAEsL,SAASd,UAAUrE,GAAGtiB,KAAKynB,SAASuH,OAAOhvB,KAAKsrB,MAAMC,UAAS,EAAGvrB,UAAUohB,GAAES,KAAK,yCAAyC1F,EAAEsH,WAAWia,gBAAgB,EAAEI,sBAAsB,SAAS1rB,EAAE4J,GAAG,IAAInU,EAAE,GAAGmU,EAAEA,GAAGkI,EAAE9R,GAAG,OAAOvK,IAAI,cAAcmU,KAAI,IAAKA,EAAE+R,YAAY/tB,KAAK+9B,oBAAoB3rB,GAAGpS,KAAKmY,SAAS/F,EAAEhJ,UAAUyW,OAAO7f,KAAK5I,SAASqsB,WAAW0D,eAAetf,GAAGmU,EAAE+R,UAAUlmB,EAAEmU,EAAE+R,UAAU3M,GAAES,KAAK,oBAAoBzP,EAAE4J,EAAE,EAAE8R,cAAc,SAAS1b,EAAE4J,GAAG5J,EAAEA,GAAGpS,KAAKsrB,MAAMY,QAAQ1vB,MAAMwf,EAAEA,GAAG,CAAE,EAAC,IAAInU,EAAEuZ,EAAEjF,EAAE,CAACuH,IAAItR,EAAE3F,MAAMzM,KAAKwe,aAAapM,GAAG4rB,aAAa9Z,EAAE9R,GAAGhT,KAAK4c,GAAG7U,EAAEnH,KAAK5I,SAAS4I,KAAK2K,QAAQ,oBAAoBwR,EAAE,CAACwd,WAAU,IAAK35B,KAAKsrB,MAAMY,SAAQ,SAAUlQ,EAAE0c,sBAAsB1c,EAAE4c,eAAexmB,SAAI,KAAUgP,EAAEpF,EAAE7U,EAAE6d,cAAc,QAAQnd,GAAGuZ,GAAG,IAAIU,YAAO,IAASja,OAAE,EAAOA,EAAEkW,KAAKqD,GAAGja,EAAE6d,eAAehJ,OAAE,EAAOA,EAAEpb,QAAQwR,EAAEpS,KAAKi+B,WAAW7rB,EAAE4J,GAAGhc,KAAK89B,sBAAsB1rB,EAAE4J,GAAG7U,EAAEmf,KAAKC,cAAcnU,EAAE4U,QAAQ,UAAU7f,EAAE6X,MAAMqF,EAAEjS,IAAIA,GAAGpS,KAAK4sB,WAAWxa,GAAGpS,KAAK2K,QAAQ,eAAewR,GAAGnc,KAAKynB,SAASuE,OAAOhsB,KAAK5I,SAASuuB,iBAAiB3lB,KAAKk+B,oBAAoB,EAAED,WAAW,SAAS7rB,EAAE4J,GAAGA,GAAG,KAAKA,EAAEpb,YAAO,IAASob,EAAEpb,QAAQob,EAAE5J,EAAE+R,iBAAiBnI,EAAE+R,WAAW,GAAG/R,EAAE+R,WAAWxL,EAAEvG,EAAEhc,KAAKm+B,mBAAmBniB,EAAEA,EAAE+R,YAAY,IAAIlmB,EAAE7H,KAAK82B,cAAc9a,GAAG,OAAO5J,EAAEmL,WAAW0S,aAAapoB,EAAEuK,GAAGpS,KAAKo+B,uBAAuBv2B,CAAC,EAAEu2B,qBAAqB,WAAW,IAAIhsB,EAAEpS,KAAKA,KAAKY,MAAMoG,OAAO,EAAE,IAAIgV,EAAEhc,KAAK5I,SAASqsB,WAAW5b,EAAE,CAACmU,EAAEmL,cAActc,MAAM,KAAK,GAAGmR,EAAEuM,SAAS,GAAG7P,QAAQqF,KAAK/d,KAAKs1B,uBAAuBtZ,GAAGsd,EAAEtd,EAAE5S,WAAWhE,MAAM,SAASgN,GAAG,OAAOvK,EAAErE,SAAS4O,EAAG,KAAIA,EAAExR,MAAMwC,KAAK8gB,EAAElI,GAAI,IAAGhc,KAAKmY,QAAQ,EAAE4f,cAAc,SAAS3lB,EAAE4J,GAAG,IAAInU,EAAE,GAAGmU,EAAEA,IAAI,QAAQnU,EAAE7H,KAAKsrB,MAAMkE,iBAAY,IAAS3nB,OAAE,EAAOA,EAAEu0B,OAAO,iBAAiBhqB,IAAIA,EAAExJ,SAASmb,eAAe3R,KAAK4J,GAAG5J,EAAE,OAAOpS,KAAKq+B,cAAcjsB,GAAGpS,KAAK,IAAIohB,EAAEha,EAAEgL,EAAE4J,GAAG,OAAOhc,KAAK+2B,oBAAmB,EAAG3V,GAAGphB,KAAKo+B,uBAAuBp+B,KAAKmY,SAASnY,IAAI,EAAE+mB,MAAM,CAAC1iB,IAAI,WAAW,IAAI+N,EAAEhI,UAAUpD,OAAO,QAAG,IAASoD,UAAU,GAAGA,UAAU,GAAG,GAAG4R,IAAI5R,UAAUpD,OAAO,QAAG,IAASoD,UAAU,KAAKA,UAAU,GAAGvC,EAAE7H,KAAK5I,SAASgqB,EAAEvZ,EAAE4f,SAASwB,cAAcjpB,KAAKsrB,MAAMmB,UAAUra,EAAE4J,IAAIhc,KAAK2qB,IAAI5D,MAAMiJ,UAAU3N,EAAE,GAAGjQ,GAAGA,GAAGpS,KAAKk9B,YAAYr1B,EAAE4b,WAAW8D,OAAOvnB,KAAK2qB,IAAI5D,MAAMiJ,aAAa5d,GAAGgP,GAAGphB,KAAKynB,SAASuE,KAAK9O,KAAKld,MAAMA,KAAK+mB,MAAMqF,aAAauB,QAAQ5P,KAAK/d,MAAMA,KAAK+mB,MAAMuX,SAASvgB,KAAK/d,KAAK,EAAE0sB,IAAI,WAAW,OAAO1sB,KAAK2qB,IAAI5D,MAAMiO,WAAW,EAAEsJ,SAAS,WAAW,IAAIlsB,GAAGpS,KAAKsrB,MAAMmB,YAAW,IAAKzsB,KAAKy2B,YAAY,CAAC71B,MAAMZ,KAAKsrB,MAAMmB,YAAY,OAAOzsB,KAAK2qB,IAAI5D,MAAM3d,UAAUyW,OAAO7f,KAAK5I,SAASqsB,WAAW+D,cAAcpV,GAAGA,CAAC,EAAE4Q,UAAU,SAAS5Q,EAAE4J,GAAG,IAAInU,EAAEuK,GAAGpS,KAAK2qB,IAAI5D,MAAM3F,EAAE,GAAGvZ,EAAEyV,WAAW5E,SAAO,SAAWtG,GAAG,OAAO,GAAGA,EAAEoK,UAAU4E,EAAEhe,KAAKgP,EAAEyjB,UAAW,IAAGzU,EAAEA,EAAE1a,KAAK,MAAM,IAAI0a,EAAEA,EAAEvgB,QAAQ,kBAAkBb,KAAK5I,SAAS0tB,WAAW3G,OAAOpd,OAAO,GAAG,CAAC,MAAMqR,GAAE,CAAE,OAAOgP,EAAEA,EAAEvgB,QAAQ,MAAM,MAAM,MAAMmb,OAAE,EAAOA,EAAE8F,MAAM9hB,KAAK8hB,KAAKV,GAAGA,CAAC,EAAEgL,aAAa,CAACuB,QAAQ,SAASvb,GAAG,GAAGpS,KAAK5I,SAASsvB,aAAaC,QAAQ,CAAC,iBAAiBvU,EAAEA,GAAG,CAACxR,MAAM,OAAOwR,EAAE,CAACxR,MAAMwR,IAAI,IAAI4J,EAAEhc,KAAKynB,SAAS0E,eAAe/Z,GAAG,GAAG,iBAAiB4J,EAAE,CAAC,IAAInU,EAAE7H,KAAKsrB,MAAMmB,UAAUvrB,cAAckgB,EAAEpF,EAAEuiB,OAAO,EAAEv+B,KAAKsrB,MAAMmB,UAAUzlB,QAAQ9F,cAAcib,EAAEH,EAAE/a,UAAUjB,KAAKsrB,MAAMmB,UAAUzlB,QAAQgV,GAAGhc,KAAKsrB,MAAMmB,WAAWrL,GAAGvZ,GAAG7H,KAAK2qB,IAAI5D,MAAMnG,aAAa,eAAezE,GAAGnc,KAAKsrB,MAAM+K,gBAAgBjkB,IAAIpS,KAAK2qB,IAAI5D,MAAMjG,gBAAgB,uBAAuB9gB,KAAKsrB,MAAM+K,gBAAgB,CAAC,CAAC,EAAEhyB,IAAI,SAAS+N,GAAG,IAAI4J,EAAEhc,KAAK2qB,IAAI5D,MAAMlG,aAAa,gBAAgBhZ,EAAEuK,IAAI4J,EAAEhc,KAAKsrB,MAAMmB,UAAUzQ,EAAE,MAAM,QAAQnU,IAAI,OAAO7H,KAAK5I,SAAS4nB,KAAKhf,KAAKw+B,oBAAoB51B,SAASmb,eAAe/jB,KAAKsrB,MAAM5H,IAAI6T,OAAO1vB,KAAK7H,KAAK+mB,MAAM1iB,IAAI0Z,KAAK/d,KAAK6H,GAAG7H,KAAK+2B,oBAAmB,EAAG/2B,KAAK2qB,IAAI5D,QAAQ/mB,KAAK+mB,MAAMqF,aAAauB,QAAQ5P,KAAK/d,MAAMA,KAAKynB,SAASuE,QAAO,EAAG,IAAIyS,UAAU,SAASrsB,GAAG,OAAOpS,KAAKY,MAAM4sB,WAAW,SAASxR,GAAG,OAAOA,EAAEkc,UAAU9lB,GAAG,CAAE,GAAE8lB,OAAQ,GAAE,EAAE1Z,aAAa,SAASpM,GAAG,IAAI4J,EAAE,EAAE,GAAG5J,EAAE,KAAKA,EAAEA,EAAE2jB,wBAAwB/Z,IAAI,OAAOA,CAAC,EAAEsZ,WAAW,WAAW,IAAI,IAAIljB,EAAEhI,UAAUpD,OAAOgV,EAAE,IAAIlS,MAAMsI,GAAGvK,EAAE,EAAEA,EAAEuK,EAAEvK,IAAImU,EAAEnU,GAAGuC,UAAUvC,GAAG,IAAIuZ,EAAE,IAAIkY,EAAEt5B,KAAK5I,SAASqsB,WAAWC,IAAI7Y,MAAM,MAAM+W,OAAO0X,EAAEtd,IAAItV,KAAK,KAAK,MAAM,GAAGa,MAAMwW,KAAK/d,KAAK2qB,IAAInuB,MAAMuyB,iBAAiB3N,GAAG,EAAEwc,WAAW,WAAW,IAAIxrB,EAAEpS,KAAK5I,SAASqsB,WAAWzH,EAAEhc,KAAK2qB,IAAInuB,MAAMuyB,iBAAiB,GAAGnN,OAAOxP,EAAEwR,YAAY,UAAUhC,OAAOxP,EAAEmW,QAAQ,sBAAsB,OAAOvM,EAAEA,EAAEhV,OAAO,EAAE,EAAEsnB,eAAe,SAASlc,EAAE4J,EAAEnU,GAAG,IAAIuZ,EAAE,EAAEja,GAAE,EAAG4a,GAAE,EAAG3F,OAAE,EAAO,IAAI,IAAI,IAAIgG,EAAEC,EAAEriB,KAAKY,MAAMygB,OAAOC,cAAcna,GAAGib,EAAEC,EAAEM,QAAQC,MAAMzb,GAAE,EAAG,CAAC,IAAImb,EAAEF,EAAExhB,MAAMub,EAAEnc,KAAK8hB,KAAK,GAAG1P,GAAGkQ,EAAE1hB,MAAMob,IAAInU,GAAGya,EAAE4V,SAAS9W,GAAG,CAAC,CAAC,MAAMhP,GAAG2P,GAAE,EAAG3F,EAAEhK,CAAC,CAAC,QAAQ,IAAIjL,GAAG,MAAMkb,EAAEU,QAAQV,EAAEU,QAAQ,CAAC,QAAQ,GAAGhB,EAAE,MAAM3F,CAAC,CAAC,CAAC,OAAOgF,CAAC,EAAEsd,mBAAmB,SAAStsB,GAAG,IAAI4J,EAAEhc,KAAK6H,EAAE,GAAGuZ,EAAEphB,KAAK5I,SAASqwB,SAASmB,cAAc,OAAO5oB,KAAKs1B,aAAa5c,kBAAkBvR,EAAE4a,GAAG5a,EAAEgd,iBAAiBhI,EAAEH,EAAE8F,KAAK3a,EAAEgd,gBAAgBvjB,OAAOwR,EAAEgP,IAAIvZ,EAAEzE,KAAK2e,EAAG,IAAGla,CAAC,EAAE82B,iBAAiB,SAASvsB,GAAG,IAAI4J,EAAEhc,KAAK0+B,mBAAmBtsB,GAAG,GAAG,OAAOpS,KAAKs1B,aAAatZ,EAAE,EAAE4iB,SAAS,SAASxsB,GAAG,IAAI4J,EAAEhc,KAAKoS,IAAIA,EAAEhJ,UAAUE,IAAItJ,KAAK5I,SAASqsB,WAAW6E,UAAUhoB,YAAY,WAAW8R,EAAEhJ,UAAUC,OAAO2S,EAAE5kB,SAASqsB,WAAW6E,SAAU,GAAE,KAAK,EAAEuW,iBAAiB,SAASzsB,GAAG,OAAOA,EAAEpS,KAAK8hB,KAAK1P,EAAElR,eAAelB,KAAK5I,SAASmuB,UAAUxU,QAAM,SAAWiL,GAAG,OAAO,GAAGA,GAAG9a,eAAekR,CAAE,IAAGpL,MAAM,EAAE83B,iBAAiB,SAAS1sB,GAAG,QAAQpS,KAAK++B,iBAAiB3sB,EAAE,EAAE2sB,iBAAiB,SAAS3sB,EAAE4J,EAAEnU,GAAGmU,EAAEA,GAAG,QAAQ,IAAIoF,EAAEja,EAAEnH,KAAK5I,SAAS,OAAOyQ,EAAEA,GAAGV,EAAEme,WAAWlgB,MAAM,SAASyC,GAAG,IAAIka,EAAE,iBAAiBla,EAAEA,EAAEmU,IAAInU,EAAEjH,MAAMiH,EAAE,GAAGsU,EAAE4F,EAAE3P,EAAEjL,EAAEsgB,SAASmB,cAAczhB,EAAE2a,MAAM,OAAOV,EAAE,iBAAiBvZ,EAAEA,EAAE,CAACjH,MAAMiH,IAAG,CAAG,IAAGuZ,GAAG,SAASpF,GAAG,SAAS7U,EAAE6d,cAAc5D,EAAEphB,KAAK++B,iBAAiB3sB,EAAEjL,EAAE6d,YAAYnd,IAAIuZ,CAAC,EAAEqV,YAAY,SAASrkB,GAAG,IAAI4J,EAAEhc,KAAK5I,SAASyQ,EAAE,UAAUuK,EAAE,QAAQ4J,EAAEgJ,YAAY5D,EAAEphB,KAAK8hB,KAAK1P,EAAEvK,GAAG,IAAI,OAAOuK,EAAEvK,GAAG,IAAIia,OAAO,OAAO9F,EAAEgD,MAAMhD,EAAE+I,SAASqU,EAAEpd,EAAE+I,QAAQgX,UAAU/f,EAAE+I,QAAQpE,KAAKS,GAAGphB,KAAKi8B,MAAMlX,SAAS/I,EAAEqJ,YAAYrlB,KAAKsuB,eAAelN,EAAEpF,EAAEyL,SAASmB,cAAcxW,EAAE8lB,SAASl4B,KAAKi8B,MAAM1K,UAAUvxB,KAAK6+B,iBAAiBzd,IAAIpF,EAAEwJ,mBAAmBxlB,KAAK8+B,iBAAiB1d,GAAGphB,KAAKi8B,MAAMzK,YAAYxV,EAAEsiB,UAAUtiB,EAAEsiB,SAASlsB,GAAGpS,KAAKi8B,MAAM1U,KAAK,EAAE4W,mBAAmB,SAAS/rB,EAAE4J,GAAG,MAAM,CAAC,gBAAe,EAAG9jB,MAAM,GAAG0pB,OAAOxP,EAAEla,OAAO,GAAG,KAAK0pB,OAAO5hB,KAAK5I,SAASqsB,WAAW0D,eAAerF,OAAOnc,MAAMqW,EAAE,EAAEqL,WAAW,WAAW,OAAOrnB,KAAKY,MAAMoG,QAAQhH,KAAK5I,SAAS6tB,SAASjlB,KAAKi8B,MAAM3K,MAAM,EAAE0N,YAAY,SAAS5sB,EAAE4J,GAAG,IAAInU,EAAE7H,KAAK5I,SAAS4I,KAAK2qB,IAAInuB,MAAMgnB,SAAS5a,SAAS2sB,gBAAgB3sB,SAAS2sB,cAAca,OAAOvuB,EAAEmU,GAAG,YAAY5J,EAAEpS,KAAK2qB,IAAInuB,OAAO4V,EAAE,MAAM,UAAU,aAAa4J,GAAG,YAAW,GAAIhc,KAAK5I,SAASquB,WAAU,EAAGzlB,KAAK67B,oBAAoBzpB,EAAE,EAAEypB,mBAAmB,SAASzpB,GAAGpS,KAAK2qB,IAAI5D,MAAMkY,gBAAgB7sB,EAAEpS,KAAK2qB,IAAI5D,MAAM4V,SAASvqB,EAAE,GAAG,CAAC,EAAE8sB,YAAY,SAAS9sB,GAAGpS,KAAKg/B,YAAY5sB,EAAE,WAAW,EAAEyb,cAAc,SAASzb,GAAG,IAAI4J,EAAEhc,KAAK6H,EAAE7H,KAAK5I,SAASgqB,EAAEvZ,EAAEyd,UAAUnJ,EAAEtU,EAAEid,WAAW3d,EAAEU,EAAEmX,KAAK+C,EAAEla,EAAEmd,YAAY5I,EAAE,GAAGgG,IAAIhB,GAAGgY,EAAEhY,EAAE,GAAG5Y,QAAQ6Z,EAAEvY,MAAM8B,QAAQwG,GAAGsQ,EAAEL,GAAGjQ,EAAE,GAAGxR,MAAMiiB,EAAE,SAASzQ,GAAG,OAAOA,EAAE,IAAIvH,MAAMsR,GAAGhW,iBAAiBiM,EAAEvK,GAAG,IAAIuZ,EAAEjF,EAAEH,EAAE8F,KAAKja,GAAG,OAAOsU,GAAG/J,EAAEhP,MAAM+1B,EAAE/X,EAAE,CAAE,EAACW,EAAE5F,GAAGgd,EAAE/X,EAAE,QAAQjF,GAAGiF,IAAIhP,CAAE,GAAE,GAAG,EAAE,GAAG,iBAAiBA,IAAIA,EAAEA,EAAEmP,YAAY,iBAAiBnP,EAAE,CAAC,IAAIA,EAAE0P,OAAO,MAAM,GAAG1P,EAAEyQ,EAAEzQ,EAAE,MAAMiQ,IAAIjQ,EAAEA,EAAEjM,QAAM,SAAWiM,EAAEvK,GAAG,GAAGya,EAAEza,GAAG,CAAC,IAAIuZ,EAAEmB,EAAE,CAAA,EAAG1a,GAAGka,KAAKX,IAAIW,EAAE,SAASX,EAAEW,GAAG/F,EAAE8F,KAAKV,EAAEW,KAAKX,EAAEW,IAAI,IAAIX,EAAEW,KAAK3P,EAAEhP,KAAKge,EAAE,MAAM,GAAGvZ,EAAE,CAAC,IAAIsU,GAAGA,EAAE/J,GAAGhP,KAAKue,MAAMxF,EAAEmd,EAAEzW,EAAEhb,IAAI,CAAC,OAAOuK,CAAE,GAAE,KAAK,OAAOgQ,IAAIM,IAAItQ,EAAEsG,kBAAkBtG,GAAG,IAAIvK,EAAEuU,EAAE3Z,KAAG,SAAW2P,GAAG,OAAOA,EAAExR,KAAM,IAAGwgB,EAAEpF,EAAEyL,SAAS6F,gBAAgBvP,KAAK/B,EAAE5J,EAAE2P,GAAG,CAACsM,OAAM,IAAKrS,EAAE5kB,SAASiuB,aAAajE,EAAEA,EAAErQ,QAAQ,SAASqB,GAAG,OAAOvK,EAAErE,SAAS4O,EAAExR,MAAO,KAAI,IAAIub,EAAEiF,EAAEpa,OAAO,EAAEgV,EAAE+iB,iBAAiB3sB,EAAE2P,GAAGA,EAAEX,GAAGA,EAAE,GAAGjF,GAAGid,EAAEjd,EAAE3T,QAAQ4T,EAAEhZ,KAAK+Y,GAAG,OAAOhV,IAAI,MAAMiL,EAAExR,QAAQwR,EAAExR,MAAMwR,EAAE2P,IAAI3F,EAAEhZ,KAAKgP,GAAI,IAAGgK,EAAEpV,SAASoL,EAAEgK,IAAIhK,CAAC,EAAE0qB,aAAa,SAAS1qB,GAAG,IAAI4J,EAAEhc,KAAK6H,EAAE7H,KAAK5I,SAASgqB,EAAEvZ,EAAEie,oBAAoB3J,EAAEtU,EAAEwd,WAAWle,EAAEU,EAAEwe,aAAatE,EAAEla,EAAE2d,iBAAiBpJ,EAAEvU,EAAEod,QAAQ7C,EAAEva,EAAEmd,YAAY3C,EAAE,GAAGjQ,EAAEA,EAAEvH,MAAMuW,EAAE,IAAI3e,KAAK,SAAS2P,EAAEvK,GAAG,IAAIya,EAAEC,EAAEG,GAAEG,GAAEzQ,EAAEvH,MAAMuW,EAAE,IAAI0B,GAAED,GAAE,GAAGM,GAAEd,EAAErb,QAAQoV,EAAE,IAAI,GAAG0G,KAAIA,GAAE,MAAMqc,MAAM5c,EAAEnT,KAAKkrB,MAAMxX,GAAE,CAAC,MAAM1Q,GAAGmQ,EAAEvG,EAAE6R,cAAc/K,IAAG,IAAI,CAACliB,MAAMkiB,GAAE,CAAC,GAAG3b,EAAE4W,KAAK/B,EAAEuG,GAAGY,MAAKN,GAAE7b,OAAO,IAAI+a,IAAI/F,EAAE8iB,iBAAiBvc,EAAE3hB,SAASub,GAAGH,EAAEsS,eAAe/L,EAAE3hB,QAAQ,GAAGwR,EAAE,OAAOvK,EAAEuZ,EAAE,GAAGhP,EAAEA,OAAOmQ,EAAED,EAAEC,EAAEH,GAAGA,EAAE,SAASpG,EAAE8F,KAAKS,EAAED,IAAII,GAAE1G,EAAE8a,cAAcvU,GAAGF,EAAEjf,KAAKmf,GAAGG,GAAEtZ,UAAUE,IAAI0S,EAAE5kB,SAASqsB,WAAWwD,gBAAgBpE,GAAE,GAAGH,GAAEqW,UAAU/c,EAAEpb,MAAMwC,KAAKmf,GAAG,OAAOM,GAAEnc,KAAK,GAAI,IAAGA,KAAK,IAAI1G,KAAK2qB,IAAI5D,MAAMiJ,UAAU5d,EAAEpS,KAAK2qB,IAAI5D,MAAM+I,YAAYlnB,SAASmb,eAAe,KAAK/jB,KAAK2qB,IAAI5D,MAAM/D,YAAY,IAAIV,EAAEtiB,KAAKs1B,aAAa,OAAOhT,EAAE5J,SAAO,SAAWtG,EAAE4J,GAAG,OAAOkI,EAAE9R,EAAEiQ,EAAErG,GAAI,IAAGhc,KAAKmY,OAAO,CAAC8e,oBAAmB,IAAKtS,EAAErC,EAAEtiB,KAAKsrB,MAAMC,UAAUnZ,CAAC,EAAEosB,oBAAoB,SAASpsB,EAAE4J,GAAG,GAAGhc,KAAKsrB,MAAM5H,KAAK1H,EAAE,CAACA,EAAEA,GAAGhc,KAAKsrB,MAAM5H,IAAI6T,OAAOv3B,KAAKsrB,MAAM5H,IAAI9iB,MAAM,IAAIiH,EAAEuZ,EAAEjF,EAAEnc,KAAKsrB,MAAMkE,WAAWnT,OAAOwH,eAAe1c,EAAEgV,EAAEuZ,WAAW3T,EAAE/hB,KAAKsrB,MAAM5H,IAAIoB,WAAW9kB,KAAKsrB,MAAM5H,IAAIoB,WAAW9d,OAAO,EAAE,OAAOG,EAAEi4B,UAAUjjB,EAAEsZ,aAAa1T,IAAI,IAAIla,EAAEV,EAAE0uB,UAAUyB,YAAYtb,MAAQoF,EAAEja,EAAEi4B,UAAUv3B,GAAGuK,GAAGjL,EAAEoW,WAAW0S,aAAa7d,EAAEgP,KAApD,CAA0D,CAAC,EAAEie,kBAAkB,SAASjtB,EAAE4J,GAAGA,EAAEA,GAAG,CAAA,EAAG,IAAInU,EAAE7H,KAAK5I,SAASgqB,EAAE,GAAGjF,EAAE,CAAA,EAAGhV,EAAEqB,OAAOwD,OAAO,CAAE,EAACoG,EAAE,CAACxR,MAAMwR,EAAExR,MAAM,KAAK,GAAGwR,EAAE5J,OAAOwD,OAAO,CAAE,EAAC7E,GAAGU,EAAEwe,aAAatI,KAAK/d,KAAKoS,GAAGA,EAAE2b,UAAU/tB,KAAKqnB,cAAcrnB,KAAKy2B,YAAYrkB,IAAG,IAAKA,EAAE2b,UAAU,CAAC,GAAG/R,EAAEgK,YAAY,OAAO,GAAGzD,EAAEpG,EAAEnc,KAAKm+B,mBAAmB/rB,EAAEA,EAAE2b,WAAW,CAACuR,iBAAiBn4B,IAAIiL,EAAE2b,WAAW/tB,KAAKi8B,MAAM1K,WAAWvxB,KAAK4+B,SAAS5+B,KAAK2+B,iBAAiBvsB,EAAExR,SAASiH,EAAE+d,kBAAkB,YAAYxE,EAAEhe,KAAKgP,EAAExR,MAAM,CAAC,MAAM,aAAawR,IAAIA,EAAE+c,SAAShT,EAAE,kBAAiB,SAAU/J,EAAE+c,UAAU,CAAC/K,OAAOpkB,KAAK82B,cAAc1kB,EAAE+J,GAAGkQ,QAAQja,EAAEmtB,uBAAuBne,EAAE,EAAEoe,sBAAsB,SAASptB,EAAE4J,GAAG,IAAInU,EAAE7H,KAAKohB,EAAEphB,KAAK5I,SAAS+kB,EAAEH,EAAE+R,UAAU5R,IAAG,IAAKA,EAAEnc,KAAKY,MAAMwC,KAAK4Y,IAAIhc,KAAK2K,QAAQ,UAAU,CAACvL,KAAK4c,EAAEvP,MAAMzM,KAAKY,MAAMoG,OAAO0c,IAAItR,EAAExT,QAAQud,IAAIiF,EAAEuE,iBAAiBrlB,YAAU,WAAa,OAAOuH,EAAE+kB,WAAWxa,GAAE,EAAI,GAAE,MAAMpS,KAAKynB,SAAS0B,UAAU,EAAEsW,UAAU,SAASrtB,EAAE4J,GAAG,IAAInU,EAAE7H,KAAK,IAAIA,KAAK5I,SAASouB,kBAAkBxlB,KAAK8+B,iBAAiB9iB,EAAEpb,OAAO,CAACZ,KAAKsrB,MAAM7W,QAAQ8X,cAAcjsB,YAAY,WAAW,OAAOuH,EAAEkvB,oBAAmB,EAAGlvB,EAAE8iB,IAAI5D,MAAO,IAAG,IAAI3F,EAAEphB,KAAK49B,aAAa,OAAOxc,EAAEphB,KAAKi+B,WAAW7c,EAAEpF,GAAGhc,KAAK0/B,UAAUttB,GAAGpS,KAAKY,MAAM,GAAGob,EAAEhc,KAAKmY,SAASnY,KAAK2K,QAAQ,MAAM,CAAC+Y,IAAItR,EAAEhT,KAAK4c,IAAI,CAAC5J,EAAE,CAAC,EAAEutB,YAAY,SAASvtB,GAAG,IAAI4J,EAAEuG,EAAE,CAAC3hB,MAAM,IAAIwR,GAAG,CAAA,GAAIvK,EAAE7H,KAAK82B,cAAc9a,GAAGkI,EAAErc,EAAEmU,GAAGhc,KAAK0/B,UAAU73B,GAAG7H,KAAK6sB,QAAQhlB,EAAE,CAACg2B,gBAAe,IAAK79B,KAAKguB,kBAAiB,EAAG,EAAExB,QAAQ,SAASpa,EAAE4J,EAAEnU,GAAG,IAAIuZ,EAAEphB,KAAKmc,EAAE,GAAGhV,EAAEnH,KAAK5I,SAAS2qB,EAAE,GAAG3F,EAAExT,SAASiuB,yBAAyBzU,EAAE,GAAG,IAAIhQ,GAAG,GAAGA,EAAEpL,OAAO,OAAOmV,EAAE,OAAO/J,EAAEpS,KAAK6tB,cAAczb,GAAGjL,EAAE6X,MAAM,IAAI,MAAM,OAAOhf,KAAK4/B,WAAWxtB,GAAG,IAAI,SAAS4J,GAAE,EAAGhc,KAAKizB,gBAAgB,OAAOjzB,KAAK2qB,IAAI5D,MAAMjG,gBAAgB,SAAS1O,EAAEsG,kBAAkBtG,GAAG,IAAI4J,EAAEoF,EAAEie,kBAAkBjtB,EAAE,CAAC4T,YAAYne,GAAGV,EAAE6e,cAAc,GAAGhK,EAAE,CAAC,IAAIqG,EAAErG,EAAEoI,OAAO,GAAGhS,EAAE4J,EAAEqQ,QAAQtK,EAAE/F,EAAEujB,uBAAuBpjB,EAAE/Y,KAAKif,GAAG,UAAUlb,EAAE6X,KAAK,OAAOoC,EAAEqe,UAAUpd,EAAEjQ,GAAGgK,EAAE0T,YAAYzN,GAAGjB,EAAEoe,sBAAsBnd,EAAEjQ,GAAGgQ,EAAEhf,KAAK,CAACghB,OAAO/B,EAAEgK,QAAQja,GAAG,CAAE,IAAGpS,KAAK0/B,UAAUtjB,GAAGgG,EAAE1J,SAAO,SAAWtG,GAAG,IAAI4J,EAAE5J,EAAEgS,OAAOvc,EAAEuK,EAAEia,QAAQ,OAAOjL,EAAEzW,QAAQ,MAAM,CAAC+Y,IAAI1H,EAAEvP,MAAM2U,EAAEqd,UAAU52B,GAAGzI,KAAKyI,GAAI,IAAG7H,KAAKmY,SAAS/F,EAAEpL,QAAQgV,IAAIhc,KAAK+mB,MAAM1iB,IAAI0Z,KAAK/d,KAAKmH,EAAEye,kBAAkB,GAAG7D,EAAErb,KAAKS,EAAE60B,cAAch8B,KAAK+2B,oBAAmB,EAAG/2B,KAAK2qB,IAAI5D,QAAQ/mB,KAAKynB,SAAS0F,WAAWhR,CAAC,EAAEyjB,WAAW,SAASxtB,GAAG,IAAI4J,EAAEhc,KAAK,IAAIoS,EAAEpS,KAAK6tB,cAAczb,IAAI,GAAGmlB,QAAQv3B,KAAKsrB,MAAM5H,IAAI,OAAO1jB,KAAK6/B,kBAAkBztB,EAAE,IAAI,IAAIvK,EAAEe,SAASiuB,yBAAyB,OAAOzkB,EAAEsG,SAAO,SAAWtG,GAAG,IAAIgP,EAAEpF,EAAEqjB,kBAAkBjtB,GAAGvK,EAAEioB,YAAY1O,EAAEgD,QAAQpI,EAAEyK,eAAerF,EAAEgD,QAAQpI,EAAEwjB,sBAAsBpe,EAAEgD,OAAOhD,EAAEiL,QAAS,IAAGrsB,KAAKq+B,cAAcx2B,GAAGA,EAAEoJ,QAAQ,EAAEotB,cAAc,SAASjsB,GAAG,IAAI4J,IAAIhc,KAAKsrB,MAAMkE,UAAUxT,EAAEhc,KAAK+3B,cAAc3lB,IAAIpS,KAAK2qB,IAAI5D,MAAMC,SAAShL,EAAEhc,KAAKqvB,qBAAqB+M,MAAMvL,SAAS7wB,KAAK2qB,IAAI5D,MAAM/K,EAAEogB,MAAMhF,WAAWpb,EAAEogB,MAAMtL,OAAO9wB,KAAK2qB,IAAI5D,MAAM/K,EAAEogB,MAAMhF,WAAWp3B,KAAK2qB,IAAI5D,MAAM+I,YAAY1d,GAAGpS,KAAKo+B,uBAAuBp+B,KAAKmY,SAAS,EAAE0nB,kBAAkB,SAASztB,GAAG,IAAI4J,EAAEnU,EAAEuZ,EAAEjF,EAAEnc,KAAKmH,EAAEnH,KAAK5I,SAAS2qB,EAAE,QAAQ/F,EAAEhc,KAAKsrB,MAAM5H,WAAM,IAAS1H,OAAE,EAAOA,EAAE8I,WAAW,GAAG1S,EAAEmlB,OAAOnlB,EAAEmlB,QAAQv3B,KAAKsrB,MAAM5H,IAAI1jB,KAAKsrB,MAAM5H,IAAI6T,QAAQpwB,EAAE4d,QAAQ5G,QAAQhX,EAAE4d,SAAS,GAAG3D,EAAEphB,KAAKq/B,kBAAkBjtB,GAAGvK,EAAEuZ,EAAEgD,OAAOpkB,KAAKw+B,oBAAoB32B,IAAI7H,KAAK2qB,IAAI5D,MAAM+I,YAAYjoB,GAAGvH,uBAAuB,OAAOuH,EAAEuB,UAAUE,IAAI6S,EAAE/kB,SAASqsB,WAAWwD,eAAgB,GAAE,KAAKjnB,KAAKmY,UAAU4J,EAAE,CAAC,IAAI3F,EAAEpc,KAAKymB,eAAe5e,IAAIA,EAAEvH,WAAW+jB,EAAE,EAAEjI,EAAE,CAAC,OAAOpc,KAAKsrB,MAAM5H,IAAI,KAAK1jB,KAAKw/B,sBAAsB33B,EAAEuZ,EAAEiL,SAASxkB,CAAC,EAAE63B,UAAU,SAASttB,GAAG,IAAI4J,EAAEhc,KAAK2qB,IAAI9iB,EAAEmU,EAAE+K,MAAM/K,EAAExf,MAAM0jB,aAAa9N,EAAEvK,EAAE,EAAEivB,cAAc,SAAS1kB,EAAE4J,GAAG5J,EAAE8lB,QAAQ/U,IAAI,IAAItb,EAAEuZ,EAAEmB,EAAE,CAAA,EAAGnQ,EAAEinB,EAAE,CAACz4B,MAAMyhB,EAAEjQ,EAAExR,MAAM,KAAKob,IAAI,OAAO,SAAS5J,GAAG,IAAI,IAAI4J,EAAEnU,EAAEe,SAASk3B,mBAAmB1tB,EAAE2tB,WAAWC,UAAU,MAAK,GAAIhkB,EAAEnU,EAAEo4B,YAAYjkB,EAAEgZ,YAAYlT,QAAQ9F,EAAEuB,WAAWC,YAAYxB,EAAE,CAArJ,CAAuJnU,EAAE7H,KAAK4uB,cAAc,MAAM,CAACxN,EAAEphB,QAAQkkB,EAAErc,EAAEuK,GAAGvK,CAAC,EAAEq2B,mBAAmB,WAAW,IAAI9rB,EAAEpS,KAAKgc,EAAEhc,KAAK5I,SAAS4I,KAAKs1B,WAAWtZ,EAAEyH,WAAW0D,eAAezO,SAAS,SAAS7Q,EAAEuZ,GAAG,IAAIjF,EAAE+H,EAAErc,GAAGV,EAAEiL,EAAEiV,aAAatF,EAAE3P,EAAEqkB,YAAYta,GAAGC,GAAE,IAAK2F,IAAI5a,EAAE,GAAG,UAAU6U,EAAEgD,MAAM5M,EAAEskB,sBAAsB3U,GAAG3F,EAAE,OAAOD,EAAEA,EAAEmjB,iBAAiBnjB,EAAEmjB,iBAAiB,CAAC1+B,MAAMub,EAAEvb,OAAOwR,EAAE6rB,WAAWp2B,EAAEsU,GAAGtU,EAAElC,MAAMwB,GAAG4a,CAAE,GAAE,EAAE6K,WAAW,SAASxa,EAAE4J,EAAEnU,GAAG,IAAIuZ,EAAEjF,EAAEnc,KAAKmH,EAAEnH,KAAK5I,SAAS,GAAGgb,EAAEA,GAAGgnB,EAAEhnB,EAAE0nB,aAAa,CAAC1nB,GAAGgnB,EAAEhnB,EAAEtI,OAAOsI,EAAEA,EAAE,CAACA,GAAG,CAACpS,KAAK49B,cAAc7sB,QAAQ,SAASqB,GAAG,OAAOA,CAAE,IAAGgP,EAAEhP,EAAEjM,QAAQ,SAASiM,EAAE4J,GAAGA,GAAG,iBAAiBA,IAAIA,EAAEG,EAAEwiB,iBAAiB3iB,IAAI,IAAInU,EAAEqc,EAAElI,GAAG,OAAOA,GAAGnU,IAAIA,EAAEsnB,UAAU/c,EAAEhP,KAAK,CAAC88B,KAAKlkB,EAAEuC,IAAIpC,EAAEsiB,UAAU52B,GAAGzI,KAAK8kB,EAAElI,EAAE,CAACmkB,WAAU,MAAO/tB,CAAE,GAAE,IAAIvK,EAAE,iBAAiBA,EAAEA,EAAE7H,KAAKq8B,QAAQC,kBAAkB,UAAUn1B,EAAE6X,OAAOnX,EAAE,EAAE7H,KAAK+mB,MAAM1iB,IAAI0Z,KAAK/d,OAAO,GAAGohB,EAAEpa,QAAQ,UAAUG,EAAE6X,MAAMoC,EAAE,GAAG8e,KAAK92B,UAAUoa,SAASrc,EAAEsc,WAAW0D,iBAAiBnL,GAAE,GAAIoF,EAAEpa,OAAO,OAAOG,EAAEkiB,MAAMC,gBAAgBlI,EAAE,CAACuK,OAAO3rB,OAAO0Q,MAAM,WAAW,IAAI0B,EAAE,SAASA,GAAGA,EAAE8tB,KAAK3iB,aAAanL,EAAE8tB,KAAK3iB,WAAWC,YAAYpL,EAAE8tB,MAAMlkB,EAAE7U,EAAEwe,iBAAiB3lB,KAAK2K,QAAQ,SAAS,CAAC+Y,IAAItR,EAAE8tB,KAAKzzB,MAAM2F,EAAEmM,OAAOve,KAAK2K,QAAQ,SAAS,CAAC+Y,IAAItR,EAAE8tB,KAAKzzB,MAAM2F,EAAEmM,IAAInf,KAAKgT,EAAEhT,OAAOY,KAAKynB,SAAS0F,WAAWntB,KAAKynB,SAAS0B,WAAWnpB,KAAK2qB,IAAI5D,MAAM/D,YAAY7b,EAAEwe,iBAAiB3lB,KAAKk+B,sBAAsB,EAAEr2B,GAAGA,EAAE,IAAI,GAAGuZ,EAAEpa,OAAO,SAASgV,GAAGA,EAAEkkB,KAAK3hC,MAAMmgB,MAAM0hB,WAAW/jB,OAAO0E,iBAAiB/E,EAAEkkB,MAAMxhB,OAAO,KAAK9V,SAASuZ,KAAKke,UAAUrkB,EAAEkkB,KAAK92B,UAAUE,IAAInC,EAAEsc,WAAW8E,SAASjoB,WAAW8R,EAAE8K,KAAKld,MAAM6H,EAAEmU,EAAE,EAAE+B,KAAK5B,EAAEiF,EAAE,IAAIA,EAAE1I,QAAQtG,EAAE8K,KAAKf,IAAIH,IAAIG,EAAE4hB,oBAAoB3c,EAAE3e,KAAK,SAAS2P,GAAG,OAAOA,EAAE8tB,IAAK,KAAI/jB,EAAEhE,SAAS,UAAUhR,EAAE6X,MAAM7X,EAAEse,WAAWtJ,EAAE0f,oBAAmB,GAAK,IAAG9tB,OAAO,SAASqE,GAAI,GAAE,EAAEkuB,kBAAkB,WAAWtgC,KAAKs1B,aAAa5c,kBAAkBtG,GAAG,OAAOA,EAAE/I,QAAS,GAAE,EAAE00B,oBAAoB,SAAS3rB,GAAG,IAAI4J,EAAEhc,MAAMoS,EAAEtI,MAAM8B,QAAQwG,GAAGA,EAAE,CAACA,IAAIsG,SAAO,SAAWtG,GAAG,IAAIvK,EAAEqc,EAAE9R,GAAGgP,EAAEpF,EAAEyiB,UAAU52B,GAAGuZ,GAAG,GAAGpF,EAAEpb,MAAM8L,OAAO0U,EAAE,EAAG,GAAE,EAAE6R,cAAc,SAAS7gB,GAAG,IAAI4J,EAAEhc,KAAKoS,EAAEA,GAAG,GAAGpS,KAAKY,MAAM,GAAG,OAAOZ,KAAK5I,SAAS4nB,KAAKhf,KAAK2qB,IAAI5D,MAAMiJ,UAAU,GAAGhwB,KAAKsgC,oBAAoBtgC,KAAKynB,SAAS0F,WAAWntB,KAAKynB,SAAS0B,WAAWnpB,KAAKsrB,MAAM7D,SAASzP,SAAS1X,YAAU,WAAa0b,EAAE2O,IAAI5D,MAAMC,OAAQ,IAAG,UAAUhnB,KAAK5I,SAAS4nB,OAAOhf,KAAK+mB,MAAM1iB,IAAI0Z,KAAK/d,MAAMA,KAAK5I,SAASquB,WAAWzlB,KAAK67B,oBAAmB,IAAK77B,KAAKmY,OAAO/F,EAAE,EAAE+iB,WAAW,WAAWn1B,KAAKsrB,MAAMuR,kBAAiB,EAAG,IAAIzqB,EAAE4J,EAAEnU,EAAE7H,KAAK5I,SAASgqB,EAAEvZ,EAAE4b,WAAWtH,EAAE,OAAOtU,EAAEmX,KAAKnX,EAAE2e,QAAQiW,WAAWz8B,KAAK2qB,IAAI5D,MAAMiO,YAAYh1B,KAAK2qB,IAAIqI,cAAcpyB,MAAMkhB,OAAO9hB,KAAKY,MAAMoG,OAAOhH,KAAK+mB,MAAM2F,IAAI3O,KAAK/d,MAAMgH,OAAQhH,KAAKk9B,YAAY9b,EAAEiG,WAAWrnB,KAAKY,MAAMoG,QAAQa,EAAEod,SAASjlB,KAAKk9B,YAAY9b,EAAEkG,WAAWtnB,KAAKY,MAAMoG,QAAQhH,KAAKk9B,YAAY9b,EAAEmG,OAAOpL,GAAG,UAAUtU,EAAEmX,MAAOhf,KAAK02B,sBAAsB,QAAQ1a,EAAEhc,KAAKY,aAAQ,IAASob,GAAG,QAAQ5J,EAAE4J,EAAE,UAAK,IAAS5J,OAAE,EAAOA,EAAE2b,UAAU,EAAEwS,sBAAsB,SAASnuB,GAAG,IAAI4J,EAAEhc,KAAK2qB,IAAIqI,cAAchzB,KAAK5I,SAASovB,QAAQiW,aAAazgB,EAAEpb,MAAMwR,EAAE4J,EAAE0b,YAAY1b,EAAEpb,MAAMZ,KAAKu6B,iBAAiBnoB,EAAE,SAAS,EAAE+F,OAAO,SAAS/F,GAAG7R,aAAaP,KAAKwgC,wBAAwBxgC,KAAKwgC,uBAAuBlgC,WAAW,WAAW,IAAI0b,EAAEhc,KAAKygC,gBAAgBzgC,KAAKugC,sBAAsBvkB,GAAGhc,KAAK5I,SAASguB,oBAAoBhT,GAAG,CAAE,GAAE6kB,oBAAoBj3B,KAAKsrB,MAAMuR,kBAAkB78B,KAAKo1B,qBAAqBp1B,KAAKm1B,YAAY,EAAEjY,KAAKld,MAAM,KAAKA,KAAKgrB,OAAOmJ,yBAAyBpW,KAAK/d,KAAK,IAAI,EAAEygC,cAAc,WAAW,IAAIruB,EAAEpS,KAAK0gC,gBAAgB,MAAM,OAAO1gC,KAAK5I,SAAS4nB,KAAKhf,KAAK2gC,qBAAqBvuB,GAAGA,EAAEpL,OAAOhH,KAAK5I,SAASwpC,yBAAyB5gC,KAAK5I,SAASwpC,yBAAyBxuB,GAAGhD,KAAKC,UAAU+C,GAAG,EAAE,EAAEsuB,cAAc,SAAStuB,GAAG,OAAOjL,EAAEiL,GAAGpS,KAAKY,MAAMZ,KAAK47B,UAAU,EAAE+E,qBAAqB,WAAW,IAAIvuB,EAAE,GAAG4J,EAAEhc,KAAK6H,EAAE7H,KAAK5I,SAASgqB,EAAEvZ,EAAE+4B,0BAA0BxxB,KAAKC,UAAU8M,EAAEtU,EAAEie,oBAAoB,OAAO,SAASje,EAAEV,GAAGA,EAAEmW,WAAW5E,kBAAkBvR,GAAG,GAAG,GAAGA,EAAEqV,SAAS,CAAC,IAAIJ,EAAE8H,EAAE/c,GAAG,GAAG,MAAMA,EAAE41B,UAAU3qB,GAAG,QAAQgK,GAAGmH,EAAExF,KAAK/B,EAAE7U,GAAG,CAAC,GAAGiV,EAAE+jB,UAAU,OAAO/tB,GAAG+J,EAAE,GAAGiF,EAAEW,EAAE3F,EAAEJ,EAAE4f,YAAYzf,EAAE,EAAE,MAAMhV,EAAE0Z,aAAa,UAAU,CAAC,IAAI,IAAI,KAAKrd,SAAS2D,EAAE41B,SAAS3qB,GAAGjL,EAAE6tB,YAAY,OAAO7tB,EAAE41B,SAAS,KAAK51B,EAAE41B,UAAU3qB,GAAG,OAAOvK,EAAEV,GAAG,MAAMiL,GAAGjL,EAAE6tB,WAAY,GAAE,CAAhV,CAAkVh1B,KAAK2qB,IAAI5D,OAAO3U,CAAC,GAAGmnB,EAAEnc,UAAUyjB,UAAUtH,EAAEnc,UAAUwP,WCtB54vE,MAAMkU,cAAEA,GAAaC,2BAAEA,IAA+B1/B,QAAQ2/B,aAAaC,IAKpE,MAAMC,kBAAkBH,GAA2BD,KACxD,WAAAhhC,CAAYV,GACV+hC,MAAM/hC,GACNY,KAAK2rB,OAAS,KACd3rB,KAAKohC,SAAW,KAChBphC,KAAKmT,QAAU/T,EAAK+T,QACpBnT,KAAKqhC,OAASjiC,EAAKiiC,OACnBrhC,KAAKshC,WAAa,KAClBthC,KAAKuhC,cAAgB,KACrBvhC,KAAKoB,QAAQib,OAAO1W,MAAQvG,EAAKuG,KAClC,CAID67B,uBAAyB,CACvB/sB,QAAS,CACPgtB,aAAcP,UAAUO,aACxBC,gBAAiBR,UAAUQ,iBAE7BzkC,QAAS,CAAC,GAAGvG,EAAOC,SAAU,aAAc,SAC5CoL,GAAI,0BACJ4/B,KAAM,CACJC,eAAe,EACfC,QAASX,UAAUG,QAErBlY,SAAU,CACRzK,MAAO,IACPC,OAAQ,KAEV+E,IAAK,OACLrH,OAAQ,CACNylB,aAAa,EACbC,WAAW,IAMf,qBAAMC,GACJ,OAAOhiC,KAAKmT,OACb,CAaD,WAAO8uB,CAAKC,EAAYn2B,EAAQo2B,EAAMC,EAAYC,GAChDriC,KAAK+L,OAASA,EACdm1B,WAAUoB,EAAaH,GAEvB,MAAM/iC,EAAO,CACXuG,MAAOy8B,EAAWz8B,MAClBwN,QAASivB,EAAWjvB,QACpBkuB,OAAQgB,GAGV,IAAIE,EACJ,OAAQL,GACN,IAAK,MACHK,EAAS,IAAIC,aAAapjC,GAC1B,MACF,IAAK,gBACHmjC,EAAS,IAAIE,eAAerjC,GAC5B,MACF,IAAK,QACHmjC,EAAS,IAAIG,kBAAkBtjC,GAInCmjC,EAAOjT,QAAO,EACf,CASD,QAAOgT,CAAaH,GAClBQ,MAAMzU,KAAK,mBAAmB,CAAC0U,EAAKC,EAAMzhC,KACxC,MAAM0hC,EAAWD,EAAK55B,cAAc,oCAEpC,GAAI65B,EAAU,CACZ,MAAM1hC,EAAU,CACd0jB,WAAY,IACZG,QAAS,WACTwC,SAAU,CACR0B,SAAU,SACVV,SAAUsa,IACVva,UAAW,2BACX7B,QAAS,GAEX+H,UAAW,CACTO,oBAAmB,IACV,2CAmBb,SAAS+T,YACP9B,UAAUvV,OAAOyS,sBAClB,CAhBG+D,EAAKc,YAAW7hC,EAAQkkB,UAAY6c,EAAKc,WAE7C/B,UAAUvV,OAAS,IAAIuX,EAAOJ,EAAU1hC,GAEpC+gC,EAAKvtB,UAAUssB,UAAUvV,OAAOa,QAAQ2V,EAAKvtB,UAEjDssB,UAAUE,SAAW,IAAIjgB,GAAS+f,UAAUvV,OAAOhB,IAAInuB,MAAO,CAC5DugB,SAAU,IAAImkB,UAAUvV,OAAOv0B,SAASqsB,WAAWC,MACnD1G,UAAW,CAAEmD,QAAS6iB,aAUxB,MAAMG,EAAcN,EAAK55B,cAAc,kBAUvC,GATIk6B,GACFA,EAAYvmB,iBAAiB,WAAWxa,IACpB,UAAdA,EAAM8B,MACR9B,EAAM8c,iBACNgiB,UAAUvV,OAAOa,QAAQ0U,UAAUvV,OAAOL,MAAMmB,WAAW,GAC5D,IAIwB,iBAAzBmW,EAAI9iC,YAAYzH,KAAyB,OAE7C6oC,UAAUvV,OAAOlE,SAASuH,OAC1B,MAAMoU,EAAuBx6B,SAAS+sB,cAAc,OACpDyN,EAAqBh6B,UAAUE,IAAI,oBACnC85B,EAAqBpT,UAAY1wB,KAAKyF,KAAKE,SAAS,0CACpDi8B,UAAUvV,OAAOhB,IAAInuB,MAAM+gB,WAAWuS,YAAYsT,GAClDlC,UAAUvV,OAAOhB,IAAInuB,MAAM+gB,WAAWuS,YAAYoR,UAAUvV,OAAOhB,IAAIlD,SACxE,IAEJ,CASD,yBAAaga,SACLpgC,QAAQ2/B,aAAaC,IAAIoC,SAASC,QAAQ,CAC9CjnB,OAAQ,CACN1W,MAAOrG,KAAKyF,KAAKE,SAAS,6CAE5BkO,QAAS,MAAM7T,KAAKyF,KAAKE,SAAS,oDAClCs+B,OAAO,EACPC,IAAK,CACH7mC,MAAO2C,KAAKyF,KAAKE,SAAS,oCAC1Bw+B,SAAUr3B,gBACF9M,KAAKC,eAAemkC,iBAC1BhlC,GAAOC,KAAK,iBAAiB,EAAK,GAGtCglC,GAAI,CACFhnC,MAAO2C,KAAKyF,KAAKE,SAAS,qCAG/B,CAOD,sBAAOy8B,GACLR,UAAUvV,OAAOsH,eAClB,CAKD,UAAA2Q,CAAWxhC,GAET,GAAkB,WAAdA,EAAM8B,MAAqB9B,EAAMC,OAAOsvB,UAAUnuB,SAAS,UAG7D,OAFApB,EAAM8c,iBACN9c,EAAM+c,kBACCnf,KAAK6jC,QAId,GACgB,UAAdzhC,EAAM8B,KACGlE,KAAKZ,KAAK1F,UACT0I,EAAMC,OAAOsvB,UAAUnuB,SAAS,UAC1C,CACApB,EAAM8c,iBACN9c,EAAM+c,kBACN,MAAM2kB,EAAgB9jC,KAAKZ,KAAK2kC,QAAQ/jC,KAAKZ,KAAK1F,SAClD,OAAOsG,KAAKqhC,OAAOyC,EACpB,CACF,CAUD,mBAAazC,CAAOj/B,EAAOu/B,EAAMqC,GAC/B,MAAMxU,EAAY0R,UAAUvV,OAAO/qB,MAAM6B,KAAI6f,IAC3CA,EAAEvgB,GAAKugB,EAAEvgB,IAAMugB,EAAE1hB,MAAMqjC,QAAQ,CAAEC,YAAa,IAAKC,QAAQ,IACpD,CACLpiC,GAAIugB,EAAEvgB,GACNgU,SAAUuM,EAAE1hB,MACZvI,KAAMiqB,EAAEjqB,MAAQiqB,EAAE1hB,MAClBpH,KAAM8oB,EAAE9oB,eAGNwG,KAAKqhC,OAAO7R,EAAWwU,EAASI,OACvC,EAKI,MAAM5B,qBAAqBtB,UAChCM,aAAe,CACbG,KAAM,CACJ0C,SAAUvtC,EAASQ,eAOlB,MAAMmrC,uBAAuBvB,UAClCM,aAAe,CACbG,KAAM,CACJ0C,SAAUvtC,EAASS,iBAOlB,MAAMmrC,0BAA0BxB,UACrCM,aAAe,CACbG,KAAM,CACJ0C,SAAUvtC,EAASU,oBClQlB,MAAM8sC,gBAMX,2BAAaC,CAAehzB,GAE1B,MAAM4wB,EAAO,CACbA,UAAiB,IACjBA,EAAKvtB,eAAiBrD,EAAa2F,0BACnC,MAAMpZ,QAAa2B,MAAMC,WAAW,QAG9B0iC,EAAa,CACjBz8B,MAAOrG,KAAKyF,KAAKE,SAAS,oCAC1BkO,QAAS,CACPqxB,SAAUllC,KAAKyF,KAAKE,SAAS,qCAC7B4sB,YAAavyB,KAAKyF,KAAKE,SAAS,0CAChC7N,SAAU,CAAE0G,UAKVukC,aAAej2B,MAAOq4B,EAAST,KACnC,MAAMlmC,EAAOkmC,GAAUlmC,WACjByT,EAAa2E,aAAauuB,EAAS,CAAE34B,MAAO,UAC5CyF,EAAakF,WAAW,CAAEC,WAAW,EAAMC,UAAU,UACrDlX,MAAM2E,WAAW,OAAQtG,GAC/B6kC,MAAM+B,QAAQ,4BAA4B,EAI5CxD,UAAUe,KAAK,MAAO,KAAME,EAAMC,EAAYC,aAC/C,CAUD,6BAAasC,CAAiBpzB,EAAcyD,GAC1C,MAAMjJ,OAAEA,EAAM1T,KAAEA,EAAIyT,MAAEA,GAAUkJ,EAG1BmtB,EAAO,CAAA,EAGbA,EAAKc,gBAAkB1xB,EAAa6F,wBAAwB,CAAErL,SAAQD,UAGtEq2B,EAAKvtB,eAAiBrD,EAAa2F,wBAAwB,CAAEnL,SAAQD,UAGrE,MAAMs2B,EAAa,CACjBz8B,MAAO,GAAGrG,KAAKyF,KAAKE,SAAS,0CAA0C5M,IACvE8a,QAAS,CACPqxB,SAAUllC,KAAKyF,KAAKE,SAAS,uCAC7B4sB,YAAavyB,KAAKyF,KAAKE,SAAS,0CAChC7N,eAAgBma,EAAawD,iBAAiBC,KAK5CqtB,aAAej2B,MAAOq4B,EAAST,KACnCS,EAAUA,EAAQhiC,KAAImiC,IACpBA,EAAO7iC,GACC6iC,EAAO7iC,IACJ6iC,EAAOvsC,KAAK4rC,QAAQ,CACrBC,YAAa,IACbC,QAAQ,IAElBS,EAAOprC,KAAOorC,EAAOprC,MAAQ,SACtB,CACLuI,GAAI6iC,EAAO7iC,GACXgU,SAAU6uB,EAAO7uB,SACjB1d,KAAMusC,EAAOvsC,KACbmB,KAAMorC,EAAOprC,SAIjB,MAAMqrC,EAAiBb,GAAUa,eAC3BC,EAAcd,GAAUc,YACxBhnC,EAAOkmC,GAAUlmC,KACjBinC,EAAQf,GAAUe,MAClB1vB,EAAY2uB,GAAU3uB,UACtBnO,EAAO88B,GAAU98B,KACvB8N,EAAU5d,SAAW,CAAEytC,iBAAgBC,cAAahnC,OAAMinC,QAAO1vB,YAAWnO,cAGtEqK,EAAa2E,aAAauuB,EAASzvB,SACnCzD,EAAakF,WAAW,CAAEC,WAAW,EAAMC,UAAU,IAC3DgsB,MAAM+B,QAAQ,4BAA4B,EAG5CxD,UAAUe,KACR,gBACAl2B,EACAo2B,EACAC,EACAC,aAEH,CAWD,gCAAa2C,CAAoBzzB,EAAcC,EAAewD,GAC5D,MAAMjJ,OAAEA,EAAM1T,KAAEA,EAAIyT,MAAEA,GAAUkJ,EAG1BmtB,EAAO,CAAA,EAGPrmB,QAAyBtK,EAAcyzB,0BAA0BjwB,GACjEkwB,QAAwB3zB,EAAa6F,wBAAwB,CAAErL,SAAQD,UAC7Eq2B,EAAKc,UAAY,IAAInnB,KAAqBopB,GAG1C,MAAMC,QAAwB3zB,EAAc4zB,yBAAyBpwB,GAC/DqwB,QAAuB9zB,EAAa2F,wBAAwB,CAAEnL,SAAQD,UAC5Eq2B,EAAKvtB,SAAW,IAAIuwB,KAAoBE,GAGxC,MAAMjD,EAAa,CACjBz8B,MAAO,GAAGrG,KAAKyF,KAAKE,SAAS,0CAA0C5M,KACvE8a,QAAS,CACPqxB,SAAUllC,KAAKyF,KAAKE,SAAS,uCAC7B4sB,YAAavyB,KAAKyF,KAAKE,SAAS,0CAChC7N,eAAgBma,EAAawD,iBAAiBC,KAK5CqtB,aAAej2B,MAAOq4B,EAAST,KACnC,MAAMqB,EAAiB,GACjBF,EAAkB,GACxB,IAAK,MAAMP,KAAUH,EACC,WAAhBG,EAAOprC,KACT2rC,EAAgB/hC,KAAKwhC,GAErBS,EAAejiC,KAAKwhC,GAKxB,MAAMC,EAAiBb,GAAUa,eAC3BrgB,EAAWwf,GAAUxf,SACrBsgB,EAAcd,GAAUc,YACxBhnC,EAAOkmC,GAAUlmC,KACjBinC,EAAQf,GAAUe,MAClB1vB,GAAY2uB,GAAU3uB,UACtBnO,GAAO88B,GAAU98B,KACjB3I,GAAQylC,GAAUsB,OACxBtwB,EAAU5d,SAAW,CAAEytC,iBAAgBrgB,WAAUsgB,cAAahnC,OAAMinC,QAAO1vB,aAAWnO,QAAM3I,gBAGtFgT,EAAa2E,aAAamvB,EAAgBrwB,SAC1CxD,EAAc+zB,cAAcJ,EAAiBnwB,SAC7CzD,EAAakF,WAAW,CAAEC,WAAW,EAAMC,UAAU,IAE3DgsB,MAAM+B,QAAQ,4BAA4B,EAG5CxD,UAAUe,KACR,QACAl2B,EACAo2B,EACAC,EACAC,aAEH,ECxLI,MAAMmD,aACX,WAAA1lC,CAAYP,EAAgB+R,GAC1BtR,KAAKT,eAAiBA,EACtBS,KAAKsR,WAAaA,EAClBtR,KAAKuR,aAAeD,EAAWC,aAC/BvR,KAAKylC,QAAU,EACfzlC,KAAK0lC,eAAgB,EACrB1lC,KAAK5I,SAAW,KAChB4I,KAAK2lC,QAAU,EAChB,CAMD,iBAAMC,CAAYlqB,GACXA,IAEL1b,MAAK6lC,EAAcnqB,GAEd1b,KAAK8lC,mBAEL9lC,KAAKT,eAAe5G,gBACjBqH,MAAK+lC,UAGP/lC,MAAKgmC,KACZ,CASD,OAAMH,CAAcnqB,GAClB1b,MAAKimC,IAELjmC,KAAK0b,aAAeA,QAGd1b,MAAKkmC,IACNlmC,KAAK8lC,mBAGV9lC,MAAKmmC,IAGLnmC,MAAKomC,IACN,CAQD,EAAAH,GACEjmC,KAAKqmC,gBAAkB,KACvBrmC,KAAKsmC,gBAAkB,KACvBtmC,KAAKumC,eAAiB,KACtBvmC,KAAKwmC,UAAY,KACjBxmC,KAAK0b,aAAe,KACpB1b,KAAKymC,mBAAqB,KAC1BzmC,KAAK8lC,iBAAmB,KACxB9lC,KAAK0mC,wBAA0B,KAC/B1mC,KAAK2mC,qBAAuB,KAC5B3mC,KAAK0lC,eAAgB,EACrB1lC,KAAKylC,QAAU,EACfzlC,KAAK5I,SAAW,KAChB4I,KAAK2lC,QAAU,EAChB,CAOD,EAAAQ,GACE,MAAMS,EAAqB5mC,KAAK0b,aAAapZ,QAAQ,uBAC/CukC,EAAiBD,EAAmB7X,iBAAiB,kBACrDxwB,EAAQ,CAAEuoC,UAAW,GAAIC,UAAW,IAC1C/mC,MAAKgnC,EAAUH,EAAgBtoC,EAChC,CAQD,OAAM0oC,GAEJ,MAAMC,EAAa,CAAEC,QAAS,GAAIC,oBAAqB,GAAI1oB,MAAO,UAC5D1e,MAAKgnC,EAAUhnC,KAAKqmC,gBAAiBa,GAE3C,MAAMG,EAAe,GACfC,EAAwB,GAC9B,IAAK,MAAMC,KAAkBvnC,KAAKqmC,gBAAiB,CACjD,MAAMmB,EAAiBD,EAAexY,iBAAiB,4BACvD,IAAK,MAAM0Y,KAAiBD,EAAgB,CAC1C,MAAME,EAAaD,EAAcppB,wBAC3BspB,EAAc7gC,KAAKomB,MAAMkT,WAAWsH,EAAWhpB,OAAS,GAAK,GAC7DkpB,EAAmBH,EAAcx+B,cAAc,2BAC/C4+B,EAAuBD,GAAkBvpB,wBACzCypB,EAAwBhhC,KAAKomB,MAAMkT,WAAWyH,GAAsBnpB,QAAU,GACpF4oB,EAAsBlkC,KAAKukC,GAC3BN,EAAajkC,KAAK,CAAEukC,cAAaG,yBAClC,CACF,CAED,IAAIhgC,EAAuBhB,KAAKW,KAAKhI,MAAM4H,wBAAwBigC,IACnE,MAAMS,EAA2B,GAEjC,IAAK,MAAMJ,KAAeN,EAAc,CACtC,MAAMW,EAAiClgC,GAClC6/B,EAAYA,YAAcA,EAAYG,uBACvCE,EAAiCD,IACnCjgC,EAAwBA,EAAuBkgC,EAAkCD,EAEpF,CAED/nC,KAAKwmC,UAAY1+B,CAClB,CAUD,OAAMmgC,CAAYV,EAAgBW,GAChC,IAAKX,EAAgB,OACrB,MAAML,EAAa,CAAEC,QAAS,GAAIC,oBAAqB,GAAI1oB,MAAO,UAC5D1e,MAAKmoC,EAAWZ,EAAgBL,GAEtC,MAAMzyB,EAAU8yB,EAAexY,iBAAiB,eAC1CqZ,EAActhC,KAAKW,KAAKX,KAAKuhC,KAAK5zB,EAAQzN,SAC1CshC,EAAsBJ,GAAoBloC,KAAKumC,eAC/CgC,EAAgBzhC,KAAKC,MAAMuhC,EAAsBtoC,KAAKwmC,WACtDgC,EAAQJ,EAAcG,GAAiBL,EACzCK,EACC9zB,EAAQzN,QAAUhH,KAAKylC,QAAWhxB,EAAQzN,OAASohC,EAElD7pC,EAAQ,CAAE4oC,QAAS,OAAQC,oBAAqB,UAAUoB,MAASxoC,KAAKwmC,sBACxExmC,MAAKmoC,EAAWZ,EAAgBhpC,EACvC,CAUD,OAAMkqC,CAAQlB,EAAgBW,GAC5B,IAAKX,EAAgB,OAErB,IAAI7oB,EAAQ,IAEZ,GAAI1e,KAAK0lC,cACPhnB,EAAQ1e,KAAKumC,oBACR,GAAI2B,EACTxpB,EAAQwpB,MACH,CACL,MAAMzzB,EAAU8yB,EAAexY,iBAAiB,eAChD,IAAKta,EAAQzN,OAAQ,OACrB,MAAM0hC,EAAc5hC,KAAKW,KAAKX,KAAKuhC,KAAK5zB,EAAQzN,SAGhD,IAAI2hC,EAAa,EACbC,EAAc,EACdC,EAAW,EAEXp0B,EAAQzN,OAAS,GACnByN,EAAQiE,SAAQ,CAAC3hB,EAAQ0V,MAClBA,EAAQ,GAAKi8B,EAAcC,IAC9BE,GAAsB,EACtBD,EAAeC,EAAWD,EAAeC,EAAWD,EACpDC,EAAW,EACXF,KAEF,MAAMjB,EAAa3wC,EAAOsnB,wBACpBspB,EAAc7gC,KAAKW,KAAK24B,WAAWsH,EAAWhpB,OAAS,GAAK,GAClEmqB,GAAYlB,EACRl7B,EAAQ,IAAMgI,EAAQzN,SACxB6hC,GAAsB,EACtBD,EAAeC,EAAWD,EAAeC,EAAWD,EACrD,IAKLA,GAAe5oC,KAAK0mC,wBAGpBhoB,EAASkqB,EAAc5oC,KAAKumC,gBAAkB9xB,EAAQzN,OAAS,EAAK4hC,EAAc5oC,KAAKumC,eACnF7nB,EAAQ,MAAKA,EAAQ,IAC1B,CAED,MAAMngB,EAAQ,CAAEuqC,SAAU,GAAGpqB,aACvB1e,MAAKmoC,EAAWZ,EAAgBhpC,EACvC,CASD,EAAAwqC,GACE,MAAMjE,EAAc9kC,KAAK5I,UAAU0tC,YAEnC,GAAIA,EAEF,OADA9kC,KAAK0lC,eAAgB,EACdZ,EAGT,MAAMkE,EAAcrnC,OAAOsnC,iBAAiB,IAAM5sB,OAAOoU,WACnDyY,EAAclpC,KAAK2mC,qBAAqBlmB,KACxC0oB,EAAUvgC,SAASK,cAAc,aACjCmgC,EAAqBD,EAAQ3Y,YACnC,OAAO1pB,KAAKC,OACVqiC,EAAqB,EACjBJ,EAAcI,EACdJ,GACFhpC,KAAK2lC,QAAUuD,EACpB,CAQD,OAAMhD,GACJlmC,KAAK8lC,iBAAmB9lC,KAAK0b,aAAazS,cAAc,2BACnDjJ,KAAK8lC,mBACV9lC,KAAK2mC,qBAAuB3mC,KAAK8lC,iBAAiBznB,wBAClDre,KAAKqpC,yBAA2BtoB,iBAAiB/gB,KAAK8lC,kBACtD9lC,KAAK0mC,wBACH5/B,KAAKW,KAAK24B,WAAWpgC,KAAKqpC,yBAAyBC,cAAgB,GACjExiC,KAAKW,KAAK24B,WAAWpgC,KAAKqpC,yBAAyBE,eAAiB,GACzE,CAQD,EAAAnD,GACEpmC,KAAKymC,mBAAqBzmC,KAAK0b,aAAaqT,iBAAiB,0BACtB,IAAnC/uB,KAAKymC,mBAAmBz/B,SAAchH,KAAKymC,mBAAqB,CAACzmC,KAAK0b,cAC3E,CAOD,OAAMqqB,GAIJ,GAHA/lC,KAAKqmC,gBAAkBrmC,KAAK0b,aAAaqT,iBAAiB,yBAGtB,IAAhC/uB,KAAKqmC,gBAAgBr/B,OAAc,OAGvC,MAAM+E,EAAS/L,KAAK0b,aAAaC,QAAQ5P,OACzC/L,KAAK5I,eAAiB4I,KAAKuR,aAAawD,iBAAiB,CAAEhJ,SAAQD,MAAO,IAG1E9L,KAAKumC,eAAiBvmC,MAAK+oC,IAG3B,IAAIS,GAAU,EACd,IAAK,MAAMC,KAAmBzpC,KAAKymC,mBAAoB,CACrD,MAAMc,EAAiBkC,EAAgBxgC,cAAc,yBACrD,IAAKs+B,EAAgB,SACrB,MAAMx7B,EAAS09B,EAAgB9tB,QAAQ5P,OACjCuJ,QAAsBtV,KAAKuR,aAAawD,iBAAiB,CAAEhJ,WAC3Dm8B,EAAmB5yB,EAAcwvB,YACjChnC,EAAO2B,MAAMC,WAAW,SAAWM,KAAK5I,UAAU0G,MAAQwX,GAAexX,MAAQypC,EAAehpC,MAAM4oC,QACxGrpC,GACG0rC,UACGxpC,MAAKinC,IACXuC,GAAU,SAENxpC,MAAKioC,EAAYV,EAAgBW,UAEjCloC,MAAKyoC,EAAQlB,EAAgBW,EAEtC,CACF,CAQD,OAAMlC,GACJ0D,uBAAsB,KACpB1pC,KAAKsmC,gBAAkBtmC,MAAK2pC,IAC5B,MAAMprC,EAAQ,CAAEuoC,UAAW,GAAG9mC,KAAKsmC,oBAAqBS,UAAW,QACnEv+B,OAAOwD,OAAOhM,KAAK8lC,iBAAiBvnC,MAAOA,EAAM,GAEpD,CASD,EAAAorC,GACE,MAAMC,EAAejoC,OAAOsnC,iBAAiB,IAAM5sB,OAAOwtB,YACpDC,EAAgB9pC,KAAK2mC,qBAAqB3V,OAC1C+Y,EAAa/pC,KAAK2mC,qBAAqBpmB,IAE7C,GAAIvgB,KAAKT,eAAe5G,SAAU,CAChC,IAAIqxC,EAAiB,EACjBC,EAAUjqC,KAAK0b,aAAauE,mBAEhC,GAAIgqB,EAAS,CACX,MAAMC,EAAW,CAACD,GAClB,KAAOA,GACLA,EAAUA,EAAQhqB,mBACdgqB,GAASC,EAAS9mC,KAAK6mC,GAE7B,IAAK,MAAMA,KAAWC,EAAU,CAC9B,MAAMC,EAAgBF,EAAQ5rB,wBAAwBM,OACtDqrB,GAAkBG,GAAiB,CACpC,CACF,CAED,OAAOrjC,KAAKypB,IAAIqZ,EAAeG,EAAaC,EAAiBhqC,KAAK2lC,QAAS,IACjF,CAAW,CACL,MAAMyE,EAAiD,SAAlCpqC,KAAKT,eAAe/B,UACrCoL,SAASK,cAAc,cACvBL,SAASK,cAAc,WACrBohC,EAA0BD,EAAYE,aACtChE,EAAqD,SAAlCtmC,KAAKT,eAAe/B,UACzCosC,EAAeG,EAAaM,EAA0BrqC,KAAK2lC,QAC3DmE,EAAgBO,EAA0BrqC,KAAK2lC,QACnD,OAAO7+B,KAAKypB,IAAI+V,EAAiB,IAClC,CACF,CAUD,OAAM6B,CAAWoC,EAAShsC,GACnBgsC,GACLb,uBAAsB,KACpBlhC,OAAOwD,OAAOu+B,EAAQhsC,MAAOA,EAAM,GAEtC,CAUD,OAAMyoC,CAAUwD,EAAUjsC,GACxB,IAAK,MAAMgsC,KAAWC,EACpBhiC,OAAOwD,OAAOu+B,EAAQhsC,MAAOA,EAEhC,EC1XH,MAAMuiC,cAAEA,GAAaC,2BAAEA,IAA+B1/B,QAAQ2/B,aAAaC,IAKpE,MAAMwJ,uBAAuB1J,GAA2BD,KAC7D,WAAAhhC,CAAYyS,EAAe7D,EAAa7B,GACtCs0B,QACAnhC,KAAKuS,cAAgBA,EACrBvS,KAAK0O,YAAcA,EACnB1O,KAAKsR,WAAa,IAAIuH,WAAW7Y,KAAMuS,EAAe7D,EAAa7B,GACnE7M,KAAK0qC,aAAe,IAAIlF,aAAaxlC,KAAMA,KAAKsR,YAChDtR,KAAK6M,OAASA,EACd7M,KAAK2qC,WAAa,IAAIC,IACtB5qC,KAAK6qC,mBAAqB,IAAIhrC,MAAM,IACpCG,KAAK8qC,YAAc,IAAIjrC,MAAM,IAC7BG,KAAK+qC,WAAa,KAClB/qC,KAAKgrC,YAAc,IACpB,CAQDxJ,uBAAyB,CACvB/sB,QAAS,CACPw2B,WAAY,CACVlH,QAAS,CAAC,EAAG,GACblC,QAAS4I,eAAeQ,YAE1BC,cAAe,CACbnH,QAAS,CAAC,EAAG,GACblC,QAAS4I,eAAeS,eAE1BC,YAAa,CACXpH,QAAS,CAAC,EAAG,GACblC,QAAS4I,eAAeU,aAE1BC,YAAaX,eAAeW,YAC5BC,UAAWZ,eAAeY,UAC1BC,QAASb,eAAea,QACxBC,UAAWd,eAAec,UAC1BC,QAASf,eAAee,SAE1BC,WAAY,OACZ1pC,GAAI,uBACJonB,SAAU,CACRzK,MAAOljB,EAAIE,cACXijB,OAAQnjB,EAAIC,eACZglB,KAAMjlB,EAAIG,iBACV4kB,IAAK/kB,EAAII,gBACTwC,MAAO5C,EAAIK,cACX6vC,OAAQlwC,EAAIM,gBAEdugB,OAAQ,CACNsvB,OAAO,EACPhmC,MAAO,qBASX67B,aAAe,CACbG,KAAM,CACJ0C,SAAUvtC,EAASI,MAUvB,qBAAM8qC,GACJ,MAAM4J,EAAY5rC,KAAKuS,cAAcs5B,OAAOpsC,MAAMC,WAAW,UACvDosC,EAAU,CACd50C,IAAK8I,KAAKsR,WAAWpa,IACrB6K,GAAI,mBACJxD,MAAOqtC,EAAU1zC,OAAS,GAC1BkG,MAAO4B,KAAK5B,MACZqtC,WAAY,YACZ3yC,aAAc8yC,EAAU9yC,cAAgB,gBACxCC,WAAY6yC,EAAU7yC,YAAc,iBACpCgzC,qBAAsBtsC,MAAMC,WAAW,yBAIzC,OADAhB,GAAOnB,MAAM,sBAAuB,CAAEuuC,YAC/BA,CACR,CAUD,UAAMh/B,GACJ9M,MAAKgsC,GACN,CAOD,EAAAA,GACE,MAAM50C,EAAW,CACf,kBAAmB,QAAS,gBAAiB,oBAAqB,YAClE,QAAS,eAAgB,OAAQ,SAAU,OAC3C,QAAS,SAGXA,EAASshB,SAAQ1P,IACfhJ,KAAK,GAAGgJ,YAAoBvJ,MAAMC,WAAWsJ,EAAQ,GAExD,CAUD,0BAAMijC,CAAqB/nC,EAAKtD,EAAQ,MAMtC,GALKZ,KAAKksC,wBACRlsC,KAAKksC,uBAAwB,EAC7BxtC,GAAOnB,MAAM,0BAGVR,GAAQmH,GAAM,OAEnB,MAAMjH,QAAEA,EAAOC,SAAEA,GAAaH,GAAQmH,GAKtC,OAJIhH,GACED,EAAQuG,SAAS,oBAAmBxD,KAAK9C,GAAY0D,GAGnDsD,GACN,IAAK,eACL,IAAK,mBACHlE,KAAKsR,WAAW+B,cAAclX,aAAe,KAC7C,MACF,IAAK,cACH6D,KAAKsR,WAAWnT,YAAc6B,KAAKuS,cAAcwG,mBAAmB/Y,KAAKsR,WAAWE,eACpF,MACF,IAAK,QACHxR,KAAKmsC,cAEV,CAWD,SAAAC,CAAUN,EAAS1qC,GACjB+/B,MAAMiL,UAAUN,EAAS1qC,GACzBpB,KAAKuqC,QAAQnhC,UAAUC,OAAO,cAC9B9I,aAAaP,KAAK+qC,YAClBxqC,aAAaP,KAAKgrC,aAClBhrC,MAAKqsC,IACLrsC,MAAKssC,IACLtsC,MAAKusC,EAAgBvsC,KAAKwqC,SAC3B,CAOD,EAAA6B,GACErsC,KAAKwqC,SAAW,CACdt4B,cAAelS,KAAKuqC,QAAQthC,cAAc,+BAC1CujC,UAAWxsC,KAAKuqC,QAAQxb,iBAAiB,wBACzCgV,QAAS/jC,KAAKuqC,QAAQthC,cAAc,yBACpCwjC,eAAgBzsC,KAAKuqC,QAAQxb,iBAAiB,2BAC9CvjB,OAAQxL,KAAKuqC,QAAQthC,cAAc,wBACnCyjC,cAAe1sC,KAAKuqC,QAAQthC,cAAc,+BAC1C0jC,iBAAkB3sC,KAAKuqC,QAAQxb,iBAAiB,+BAChD6d,sBAAuB5sC,KAAKuqC,QAAQxb,iBAAiB,oCACrD8d,YAAa7sC,KAAKuqC,QAAQxb,iBAAiB,0BAC3C+d,qBAAsB9sC,KAAKuqC,QAAQxb,iBAAiB,mCACpDge,eAAgB/sC,KAAKuqC,QAAQxb,iBAAiB,6BAC9Cie,wBAAyBhtC,KAAKuqC,QAAQthC,cAAc,yCACpDgkC,kBAAmBjtC,KAAKuqC,QAAQthC,cAAc,mCAC9CikC,gBAAiBltC,KAAKuqC,QAAQthC,cAAc,iCAC5CkkC,aAAcntC,KAAKuqC,QAAQthC,cAAc,iCACzCmkC,WAAYptC,KAAKuqC,QAAQthC,cAAc,+BAE1C,CAQD,EAAAqjC,GACMtsC,KAAKqtC,aAAe5C,eAAeW,YAAYrtB,KAAK/d,MAEpDP,MAAMC,WAAW,uBACfM,KAAKstC,WACP7C,eAAec,UAAUxtB,KAAK/d,MAE9ByqC,eAAea,QAAQvtB,KAAK/d,MAG9BA,KAAKwqC,SAAS2C,aAAa/jC,UAAUE,IAAI,aAE5C,CAQD,EAAAijC,CAAgB/B,GACT/qC,MAAMC,WAAW,sBAEpB8qC,EAASiC,eAAe/zB,SAAQ6xB,IAC9BA,EAAQ3tB,iBAAiB,aAAc5c,KAAKutC,YAAYrwB,KAAKld,MAAO,CAAEwtC,SAAS,IAC/EjD,EAAQ3tB,iBAAiB,eAAgB5c,KAAKutC,YAAYrwB,KAAKld,OAC/DuqC,EAAQ3tB,iBAAiB,eAAgB5c,KAAKutC,YAAYrwB,KAAKld,MAAM,IAKpEA,KAAKrH,UACR6xC,EAASuC,eAAer0B,SAAQ6xB,IAC9BA,EAAQ3tB,iBAAiB,YAAa5c,MAAKytC,EAAWvwB,KAAKld,OAC3DuqC,EAAQ3tB,iBAAiB,aAAc5c,MAAKytC,EAAWvwB,KAAKld,MAAO,CAAEwtC,SAAS,GAAO,IAKzFhD,EAASgC,UAAU9zB,SAAQ6xB,IACzBA,EAAQ3tB,iBAAiB,eAAgB5c,KAAK0tC,kBAAkBxwB,KAAKld,OACrEuqC,EAAQ3tB,iBAAiB,eAAgB5c,KAAK0tC,kBAAkBxwB,KAAKld,MAAM,GAE9E,CASD,UAAA2tC,GACE3tC,KAAK4tC,WAAY,EACjB5tC,MAAK6tC,IACL7tC,MAAK8tC,IACA9tC,KAAKqtC,cACRrtC,KAAKgrC,YAAc1qC,YAAW,KAC5BopC,uBAAsB,KACpB1pC,KAAKuqC,SAASnhC,WAAWE,IAAI,eAAe,GAC5C,GACD,IAEN,CAQD,EAAAukC,GACE,GAAI7tC,KAAKrH,SAAU,OAEnB,MAAMuZ,cAAEA,EAAa06B,sBAAEA,GAA0B5sC,KAAKwqC,SAE/B,OAAnBxqC,KAAKxC,WACP0U,EAAc9I,UAAUE,IAAI,cAE5BsjC,EAAsBl0B,SAAQ6xB,IAC5BA,EAAQnhC,UAAUC,OAAO,eACzBkhC,EAAQnhC,UAAUE,IAAI,YAAY,MAG/BtJ,KAAKqtC,aACRn7B,EAAc9I,UAAUC,OAAO,cAGjCujC,EAAsBl0B,SAAQ6xB,IAC5BA,EAAQnhC,UAAUE,IAAI,eACtBihC,EAAQnhC,UAAUC,OAAO,YAAY,IAG1C,CAQD,EAAAykC,GACO9tC,KAAK2qC,WAAWlsB,MAErBze,KAAK2qC,WAAWjyB,SAAQhN,IACtB,MAAMzU,EAAQ+I,KAAKuqC,QAAQthC,cAAc,IAAIyC,KACzCzU,GACF+I,KAAKutC,YAAY,KAAMt2C,EACxB,GAEJ,CASD,cAAOu0C,GACLlH,gBAAgBC,eAAevkC,KAAKsR,WAAWC,aAChD,CASD,qBAAMw8B,GACJ,MAAMhoC,EAAUtG,MAAMqG,gBAAgB,oBAChCwlB,EAAStrB,KAAc,UAAI,WAAa,UAC1CA,KAAKyhB,UACPzhB,MAAK6jC,IAELlB,MAAM+B,QAAQ,mCAEVjlC,MAAM2E,WAAW,UAAWpE,KAAKyhB,WACvC/iB,GAAOC,KAAKW,KAAKyF,KAAKipC,OAAO,uCAAuC1iB,IAAS,CAAEvlB,aAAY,EAC5F,CASD,kBAAOqlC,GACLprC,KAAKiuC,kBAAkB,WACxB,CAOD,gBAAO5C,GACLrrC,KAAKiuC,kBAAkB,SACxB,CAQD,iBAAAA,CAAkB3iB,GAChBA,EAAQA,IAAWtrB,KAAgB,YAAI,SAAW,YAClD,MAAMkuC,EAAyB,aAAV5iB,GACfpZ,cAAEA,EAAa+6B,kBAAEA,EAAiBC,gBAAEA,EAAe1hC,OAAEA,EAAMu4B,QAAEA,GAAY/jC,KAAKwqC,SAEpFyC,EAAkB7jC,UAAUyW,OAAO,aAAcquB,GACjDhB,EAAgB9jC,UAAUyW,OAAO,cAAequB,GAE5CluC,KAAKrH,SACPqH,KAAKuqC,QAAQnhC,UAAUyW,OAAO,gBAAiBquB,IAExB,SAAnBluC,KAAKxC,WAAwB0U,EAAc9I,UAAUyW,OAAO,aAAcquB,GAC9E1iC,EAAOpC,UAAUyW,OAAO,aAAcquB,GACtCnK,EAAQ36B,UAAUyW,OAAO,aAAcquB,IAGzCluC,KAAKqtC,YAAca,CACpB,CAUD,sBAAa3C,CAAUnpC,EAAQ,MAC7BpC,KAAKmuC,cAAc,SAAU/rC,EAC9B,CAQD,oBAAakpC,CAAQlpC,EAAQ,MAC3BpC,KAAKmuC,cAAc,OAAQ/rC,EAC5B,CASD,aAAA+rC,CAAc7iB,EAAOlpB,EAAQ,MACvBA,GAAOA,EAAM8c,iBAEjB,MAAMkvB,EAAwB,WAAV9iB,GACd6hB,aAAEA,EAAYC,WAAEA,EAAUV,cAAEA,EAAaG,YAAEA,EAAWE,eAAEA,EAAcvhC,OAC1EA,EAAMmhC,iBAAEA,EAAgBF,eAAEA,EAAcK,qBAAEA,GAAyB9sC,KAAKwqC,SAG1E2C,EAAa/jC,UAAUyW,OAAO,aAAcuuB,GAC5ChB,EAAWhkC,UAAUyW,OAAO,cAAeuuB,GAC3C1B,EAActjC,UAAUyW,OAAO,cAAeuuB,GAG9C5iC,EAAOpC,UAAUyW,OAAO,eAAgBuuB,GAGxC,MAAMC,eAAiB,CAAC7D,EAAU7Y,EAAW9R,KAC3C2qB,EAAS9xB,SAAQ6xB,GAAWA,EAAQnhC,UAAUyW,OAAO8R,EAAW9R,IAAQ,EAM1E,GAHAwuB,eAAetB,EAAgB,gBAAiBqB,GAChDC,eAAevB,EAAsB,gBAAiBsB,GAElDA,EAEFC,eAAexB,EAAa,cAAeuB,GAC3CC,eAAe1B,EAAkB,cAAeyB,GAChDC,eAAe5B,EAAgB,cAAe2B,GAC9CC,eAAevB,EAAsB,cAAesB,OAC/C,CAEL,MAAME,YAAc9D,IAClBA,EAAS9xB,SAAQ6xB,IACf,MAAM3xB,EAAa2xB,EAAQxb,iBAAiB,eAAe/nB,OAAS,EAC/D4R,GAAY2xB,EAAQnhC,UAAUE,IAAI,aAAa,GACpD,EAGJglC,YAAY7B,GACZ6B,YAAYzB,GACZyB,YAAY3B,GAEZG,EAAqBp0B,SAAQ6xB,IAC3B,MAAM7uB,EAAe6uB,EAAQjoC,QAAQ,iBACG,UAApCoZ,EAAaC,SAAStG,WACxBk1B,EAAQnhC,UAAUE,IAAI,aACvB,GAEJ,CAEDtJ,KAAKstC,WAAac,CACnB,CAUD,iBAAOnD,CAAW7oC,GAChBpC,KAAKuuC,eAGLnsC,EAAMosC,cAAcpY,OAED,gBAAfh0B,EAAM5I,KACJwG,KAAKstC,WACPttC,KAAK2kC,iBAAiBviC,GAEtBpC,KAAKyuC,iBAAiBrsC,GAEf3C,MAAMC,WAAW,sBAC1BM,KAAKutC,YAAYnrC,EAEpB,CAQD,oBAAO8oC,CAAc9oC,GACnB,GAAmB,gBAAfA,EAAM5I,KACJwG,KAAKstC,WACPttC,KAAK2kC,iBAAiBviC,GAEtBpC,KAAKyuC,iBAAiBrsC,OAEnB,CACL,MAAMnL,EAAQwI,MAAM0C,uBAAuBC,GACV,QAA7BnL,EAAM0kB,SAAShQ,UACjB3L,KAAKutC,YAAYnrC,EAAOnL,GAExB+I,KAAK0uC,uBAAuBtsC,EAE/B,CACF,CASD,WAAAmrC,CAAYnrC,EAAQ,KAAMnL,EAAQ,MAChCA,EAAQA,GAASwI,MAAM0C,uBAAuBC,GAC9C,MAAMusC,EAAS13C,EAAMmS,UAAUoa,SAAS,SAClCorB,GAAcD,EACfA,GAA0B,iBAAhBvsC,GAAO5I,OAA8Bm1C,GAA0B,iBAAhBvsC,GAAO5I,OACrEvC,EAAMmS,UAAUyW,OAAO,QAAS+uB,GAC5BA,GACF5uC,MAAK6uC,EAAmB53C,GACxB+I,KAAK0qC,aAAa9E,YAAY3uC,GAE9B+I,KAAK2qC,WAAWrhC,IAAIrS,EAAM8K,KAE1B/B,KAAK2qC,WAAWmE,OAAO73C,EAAM8K,IAG3BK,GAAOA,EAAMosC,cAAcpY,OAChC,CASD,EAAAyY,CAAmBE,GACZ/uC,KAAK2qC,WAAWlsB,MAErBze,KAAK2qC,WAAWjyB,SAAQhN,IACtB,GAAIA,IAAYqjC,EAAchtC,GAAI,OAClC,MAAM9K,EAAQ+I,KAAKuqC,QAAQthC,cAAc,IAAIyC,KAExCzU,GACH+I,KAAK2qC,WAAWmE,OAAOpjC,GAEzB,MAAMsjC,EAAmB/3C,EAAMgS,cAAc,IAAI8lC,EAAchtC,MAC3D9K,IAAU+3C,GACZhvC,KAAKutC,YAAY,KAAMt2C,EACxB,GAEJ,CAQD,sBAAAy3C,CAAuBtsC,GACrB,IAAK3C,MAAMC,WAAW,wBAAyB,OAE/C,MAAM2C,EAASD,EAAMC,OAAOC,QAAQ,mCAE9BoZ,EAAejc,MAAM0C,uBAAuBC,GAC5C2J,EAAS2P,GAAcC,SAAS5P,OAChC1U,EAAcgL,EAAOC,QAAQ,2BAC7B2sC,EAAgBvzB,GAAczS,cAAc,2BAC5CnQ,EAAeuJ,EAAO4G,cAAc,sBACpClQ,EAAasJ,EAAO4G,cAAc,oBAClCimC,EAAexzB,EAAazS,cAAc,mBAE1CkmC,sBAAwB,KAC5BF,GAAe7lC,UAAUyW,OAAO,cAChC/mB,GAAcsQ,UAAUyW,OAAO,cAC/B9mB,GAAYqQ,UAAUyW,OAAO,cAC7BqvB,GAAc9lC,UAAUyW,OAAO,aAAa,EAGxCrJ,kBAAoBgO,IACpB/kB,MAAMC,WAAW,wBACnBM,KAAKsR,WAAWC,aAAaiF,kBAAkB,CAAEzK,SAAQ3U,SAAU,CAAEotB,aACtE,EAGCyqB,GAAe7lC,UAAUoa,SAAS,eACpC2rB,wBACA34B,mBAAkB,GAClBxW,KAAK0qC,aAAa9E,YAAYvuC,KAE9B83C,wBACA34B,mBAAkB,GAErB,CAQD,gBAAAi4B,CAAiBrsC,GACfpC,KAAKsR,WAAWoI,eAAe,aAActX,EAC9C,CAQD,gBAAAuiC,CAAiBviC,GACf,MAAMnL,EAAQwI,MAAM0C,uBAAuBC,IACrC2J,OAAEA,EAAMD,MAAEA,EAAKtS,KAAEA,GAASvC,EAAM0kB,QACtC,IAAK5P,EAAQ,OACb,MAAM1T,EAAO2H,KAAKsR,WAAWC,aAAa/F,OAAOO,GAAQ1T,KACnD+2C,EAAcpuB,SAASlV,EAAO,KAAO,KAEvB,IAAhBsjC,EACF9K,gBAAgBK,iBACd3kC,KAAKsR,WAAWC,aAChB,CAAExF,SAAQ1T,OAAMyT,MAAOsjC,EAAa51C,SAGtC8qC,gBAAgBU,oBACdhlC,KAAKsR,WAAWC,aAChBvR,KAAKsR,WAAWE,cAChB,CAAEzF,SAAQ1T,OAAMyT,MAAOsjC,EAAa51C,QAIzC,CAUD,kBAAO2xC,CAAY/oC,GACjBA,EAAM8c,iBACNlf,KAAKsR,WAAWoI,eAAe,cAAetX,GAC9CA,EAAMosC,cAAcpY,MACrB,CAQD,iBAAAsX,CAAkBtrC,GAChBpC,KAAKsR,WAAWoI,eAAe,cAAetX,EAC/C,CASD,EAAAqrC,CAAWrrC,GACT,IAAKpC,KAAKqvC,YAAa,OAGvB,MAAM9E,EAAUvqC,KAAKuqC,QAEf+E,EAAUltC,EAAMktC,SAAWltC,EAAMmtC,eAAe,GAAGD,QACnDE,EAAUptC,EAAMotC,SAAWptC,EAAMmtC,eAAe,GAAGC,QAGzD,IAAIC,EAAO,EACPC,EAAO,EACPC,EAAOL,EACPM,EAAOJ,EACX,MAAMK,EAAqBtF,EAAQ3c,UAC7BkiB,EAAsBvF,EAAQtZ,WACpC,IAAI8e,EAAgBF,EAChBG,EAAiBF,EAMrB,MAAMG,eAAiB7tC,IACrB,MAAMktC,EAAUltC,EAAMktC,SAAWltC,EAAMmtC,eAAe,GAAGD,QACnDE,EAAUptC,EAAMotC,SAAWptC,EAAMmtC,eAAe,GAAGC,QACzDC,EAAOE,EAAOL,EACdI,EAAOE,EAAOJ,EACdG,EAAOL,EACPM,EAAOJ,EAGHC,IAASE,GAAQD,IAASE,IAE9BG,GAAgCL,EAChCM,GAAkCP,EAElCzvC,KAAKkwC,OAASH,EAGdrG,uBAAsB,KACpBlhC,OAAOwD,OAAOu+B,EAAQhsC,MAAO,CAAEkiB,KAAM,GAAGuvB,MAAoBzvB,IAAK,GAAGwvB,OAAoB,IACxF,EAQEI,aAAe,KAEnBvnC,SAASwnC,YAAc,KACvB7F,EAAQ8F,YAAc,KAGtBznC,SAAS0nC,UAAY,KACrB/F,EAAQgG,WAAa,KAGjBR,IAAkBF,GAAsBG,IAAmBF,IAE/D9vC,KAAKkwC,OAASH,EAEd/vC,MAAK6tC,IAGL7tC,KAAKwwC,YAAc,CAAEjwB,IAAKwvB,EAAetvB,KAAMuvB,GAAgB,EAIjEpnC,SAASwnC,YAAcH,eACvB1F,EAAQ8F,YAAcJ,eAGtBrnC,SAAS0nC,UAAYH,aACrB5F,EAAQgG,WAAaJ,YACtB,CAQD,WAAAhE,GACOnsC,KAAKsR,WAAWpa,MACjB8I,KAAKrH,SACPqH,MAAKywC,IAELzwC,MAAK0wC,IAER,CAOD,EAAAD,GACEzwC,KAAKuqC,QAAQhsC,MAAMgiB,IAAM,EACzBvgB,KAAKuqC,QAAQhsC,MAAMkiB,KAAO,EAE1B,MAAMkwB,EAAmB/nC,SAASK,cAAc,cAC1CrQ,EAAeoH,KAAKuS,cAAcs5B,OAAO7rC,KAAK4wC,eAAeh4C,aAEnE,OAAQA,GACN,IAAK,QACH+3C,EAAiB7gB,YAAY9vB,KAAKuqC,SAClC,MACF,IAAK,eACH,MAAMsG,EAAiBF,EAAiB1nC,cAAc,aACtD0nC,EAAiBzwB,aAAalgB,KAAKuqC,QAASsG,GAC5C,MACF,IAAK,OACH,MAAMC,EAAgBH,EAAiB1nC,cAAc,YACrD0nC,EAAiBzwB,aAAalgB,KAAKuqC,QAASuG,GAGjD,CAOD,EAAAJ,GACE9nC,SAASuZ,KAAK2N,YAAY9vB,KAAKuqC,SAC/BvqC,MAAK+wC,IACL/wC,MAAK6tC,GACN,CAQD,EAAAkD,GACE,OAAK/wC,KAAKwwC,YAMH,IAAIpwC,SAAQC,IACjB,MAAM2wC,MAAQ,KACRhxC,KAAKuqC,SACPvqC,KAAKuqC,QAAQhsC,MAAMyyB,OAAS,KAC5BhxB,KAAKkwC,OAASlwC,KAAKwwC,YAAYjwB,IAAM,GAAKvgB,KAAKwwC,YAAYjwB,IAAMlE,OAAOwtB,YAAc,EAClFruC,EAAII,gBACJoE,KAAKwwC,YAAYjwB,KAAO/kB,EAAII,gBAChCoE,KAAKixC,QAAUjxC,KAAKwwC,YAAY/vB,KAAO,GAAKzgB,KAAKwwC,YAAY/vB,KAAOpE,OAAOoU,WAAa,EACpFj1B,EAAIG,iBACJqE,KAAKwwC,YAAY/vB,MAAQjlB,EAAIG,iBACjCqE,KAAKuqC,QAAQhsC,MAAMgiB,IAAM,GAAGvgB,KAAKkwC,WACjClwC,KAAKuqC,QAAQhsC,MAAMkiB,KAAO,GAAGzgB,KAAKixC,YAClC5wC,KAEAC,WAAW0wC,MAAO,GACnB,EAGHA,OAAO,KAvBPhxC,KAAKuqC,QAAQhsC,MAAMgiB,IAAM,GAAG/kB,EAAII,yBAChCoE,KAAKuqC,QAAQhsC,MAAMkiB,KAAO,GAAGjlB,EAAIG,sBAwBpC,CASD,aAAI6B,GACF,MAAMA,EAAYiC,MAAMC,WAAW,aACnC,MAAkB,OAAdlC,GAAqC,SAAdA,GAAwBwC,KAAKkwC,OAAS7zB,OAAOwtB,YAAc,EAAW,KAC1F,MACR,CAQD,eAAI2G,GACF,OAAO/wC,MAAMmF,YAAY,WAC1B,CAED,eAAI4rC,CAAYU,GACdzxC,MAAMoF,YAAY,WAAYqsC,GAC9BxyC,GAAOnB,MAAM,sBAAsB2zC,EAAI3wB,aAAa2wB,EAAIzwB,SACzD,CAQD,aAAIgB,GACF,OAAOhiB,MAAMC,WAAW,SACzB,CAED,aAAI+hB,CAAU0vB,GACZ1xC,MAAM2E,WAAW,SAAU+sC,EAC5B,CAQD,eAAI9D,GACF,OAAO5tC,MAAMmF,YAAY,cAC1B,CAED,eAAIyoC,CAAY8D,GACd1xC,MAAMoF,YAAY,cAAessC,EAClC,CAQD,YAAIx4C,GACF,MAAM4F,EAAQyB,KAAKuS,cAAcs5B,OAAO7rC,KAAK4wC,cAC7C,OAAOryC,EAAM5F,UAAY4F,EAAM3F,YAChC,CAQD,cAAI00C,GACF,OAAO7tC,MAAMmF,YAAY,aAC1B,CAED,cAAI0oC,CAAW6D,GACb1xC,MAAMoF,YAAY,aAAcssC,EACjC,CAQD,eAAI9B,GACF,MAAM1xC,EAAO8B,MAAMC,WAAW,QAC9B,MAAkB,WAAT/B,GAAgC,iBAATA,GAA2BqC,KAAKstC,UACjE,CASD,SAAIlvC,GACF,GAAI4B,KAAKrH,SAAU,OAAO,EAC1B,MAAMyF,EAAQgiC,WAAW3gC,MAAMC,WAAW,WAAa,EACvD,OAAOoH,KAAKovB,IAAIpvB,KAAKypB,IAAInyB,EAAO,IAAM,EACvC,CAMD,mBAAMgzC,GACJ1yC,GAAOnB,MAAM,yBACbyC,KAAKwwC,YAAc,CAAEjwB,IAAK/kB,EAAII,gBAAiB6kB,KAAMjlB,EAAIG,iBAC1D,CAUD,UAAM01C,CAAKC,EAAYC,SACfvxC,MAAKwxC,EAAcF,EAAYC,EACtC,CAUD,OAAMC,CAAcF,EAAYC,GAC9B,IAAKjyC,KAAK2E,KAAKoB,KAEb,YADA3G,GAAOC,KAAK,iCAAiC,GAI/C,IAAK2yC,IAAeC,EAAUvqC,OAE5B,YADAtI,GAAOC,KAAK,mCAAmC,GAIjDD,GAAOnB,MAAM,iCAEb,MAAMk0C,QAAkBzxC,KAAK0O,YAAYgB,YAAY,CAAElW,KAAM,OAAQuI,GAAIuvC,IAEzE,GAAyB,iBAAdC,QACHvxC,KAAK0O,YAAYI,aAAa,OAAQyiC,EAAWE,QAClD,GAAI3nC,MAAM8B,QAAQ2lC,GACvB,IAAK,MAAMx+B,KAAUw+B,QACbvxC,KAAK0O,YAAYI,aAAa,OAAQiE,EAAQ0+B,GAIxD/yC,GAAOnB,MAAM,4BACd,CAOD,kCAAam0C,GACXpyC,MAAMC,gBAAgB1C,aACvB,CAOD,iBAAMA,GACJ6B,GAAOnB,MAAM,6BACPyC,KAAK2xC,wBACX3xC,KAAKoxC,gBACL1yC,GAAOnB,MAAM,eACd,CAOD,oBAAMmmC,GACJhlC,GAAOnB,MAAM,iCAEPyC,KAAK0O,YAAYI,aAAa,QAAS9O,KAAKsR,WAAWtP,MAAMD,GAAI,CAAA,GAEvErD,GAAOnB,MAAM,oBAEbyC,KAAKsR,WAAW8H,eAChB,MAAMzO,EAAU,CAAEA,QAAS,CAAEnR,KAAM,SAAUnB,KAAM,kCACnD2H,KAAKmY,OAAOxN,EACb,CAQD,uBAAMinC,GACJlzC,GAAOnB,MAAM,+BAEb,IAAK,MAAMyE,KAAS1C,KAAK2C,OACvBvD,GAAOnB,MAAM,8BAA8ByE,EAAMD,MAAO,CAAEC,gBACpDhC,KAAK0O,YAAYI,aAAa,QAAS9M,EAAMD,GAAI,CAAA,GAGzDrD,GAAOnB,MAAM,wBACbyC,KAAKsR,WAAW8H,eAChB,MAAMzO,EAAU,CAAEA,QAAS,CAAEnR,KAAM,SAAUnB,KAAM,qCACnD2H,KAAKmY,OAAOxN,EACb,CAQD,mBAAMknC,GACJnzC,GAAOnB,MAAM,gCACPyC,KAAK0O,YAAYI,aAAa,OAAQxP,KAAKyT,OAAQ,CAAA,GACzDrU,GAAOnB,MAAM,mBACbyC,KAAKsR,WAAW8H,eAChB,MAAMzO,EAAU,CAAEA,QAAS,CAAEnR,KAAM,SAAUnB,KAAM,iCACnD2H,KAAKmY,OAAOxN,EACb,CAQD,sBAAMmnC,GACJpzC,GAAOnB,MAAM,8BACb,IAAK,MAAM0G,KAAQ3E,KAAK6F,YAChBnF,KAAK0O,YAAYI,aAAa,OAAQ7K,EAAKlC,GAAI,CAAA,GAEvDrD,GAAOnB,MAAM,uBACbyC,KAAKsR,WAAW8H,eAChB,MAAMzO,EAAU,CAAEA,QAAS,CAAEnR,KAAM,SAAUnB,KAAM,oCACnD2H,KAAKmY,OAAOxN,EACb,CAOD,2BAAMgnC,GACJjzC,GAAOnB,MAAM,gCACPyC,KAAK0O,YAAYI,aAAa,OAAQxP,KAAKyT,OAAQ,CAAA,GACzDrU,GAAOnB,MAAM,mBAEbmB,GAAOnB,MAAM,iCACPyC,KAAK0O,YAAYI,aAAa,QAAS9O,KAAKsR,WAAWtP,MAAMD,GAAI,CAAA,GACvErD,GAAOnB,MAAM,oBAEbyC,KAAKsR,WAAW8H,eAChB,MAAMzO,EAAU,CAAEA,QAAS,CAAEnR,KAAM,SAAUnB,KAAM,yCACnD2H,KAAKmY,OAAOxN,EACb,CASD,YAAMwN,CAAOxN,EAAU,MAGrB,GAAsB,wBAAlBA,GAAStS,KAAgC,CAC3C,IAAK2H,KAAKksC,sBAAuB,OACjClsC,KAAKksC,uBAAwB,EAC7BxtC,GAAOnB,MAAM,mBACd,OAEKyC,MAAK+xC,UACL/xC,MAAKgyC,GAAernC,EAC3B,CAOD,OAAMonC,GAEA/xC,KAAKiyC,iBAAiBjyC,KAAK6qC,mBAAmB1qC,QAElDH,KAAKiyC,iBAAkB,QACjBjyC,KAAK6qC,mBAAmB3qC,QAC9BF,KAAKiyC,iBAAkB,EAIvB,MAAMC,wBAA0B9lC,UAC9B,MAAM+lC,EAAc,IACdC,EAAW,GACXC,EAAaF,EAAcC,EAEjC,IAAIvqC,EAAI,EACR,KAAOA,EAAIwqC,GAAcryC,KAAKsyC,kBACtBtyC,KAAK8qC,YAAY5qC,QACvB2H,IAGF,OAAQ7H,KAAKsyC,UAAU,EAGzB,GAAItyC,KAAKsyC,WAAY,CACnB,MAAMC,QAAqBL,0BACtBK,GACH7zC,GAAOnB,MAAM,oCAEhB,CACF,CAQD,QAAMy0C,CAAernC,GACnB3K,KAAKsyC,YAAa,EAClB5zC,GAAOnB,MAAM,kBAAmBoN,GAGhC,MAAM6nC,QAAoBxyC,KAAKsR,WAAWxE,KAAKnC,GAC1C6nC,GAKLxyC,KAAK4tC,WAAY,EACjB5tC,KAAKsvB,OAAO,CAAEtU,OAAO,EAAMmO,SAAU,CAAE,IAElCrqB,GAAG2zC,QAAQzyC,KAAK0yC,SACnB5zC,GAAG2zC,QAAQzyC,KAAK0yC,OAAS1yC,MAG3BA,KAAKsyC,YAAa,EAElB3P,MAAM+B,QAAQ,+BAAgChuC,GAC9CgI,GAAOnB,MAAM,gBAdXyC,MAAK2yC,IAeR,CAQD,GAAAA,GACE3yC,MAAK6jC,IACLnlC,GAAOnB,MAAM,kEACbyC,KAAKsyC,YAAa,CACnB,CAQD,QAAAM,GACE5yC,MAAK6jC,GACN,CAQD,EAAAA,GACE6F,uBAAsB,KACpB1pC,KAAKuqC,SAASnhC,WAAWC,OAAO,gBAChCrJ,KAAKuqC,SAASnhC,WAAWE,IAAI,aAAa,IAG5CtJ,KAAK2qC,WAAa,IAAIC,IACtB5qC,KAAK+qC,WAAazqC,YAAW,KAC3BN,KAAK6jC,MAAM,CAAEgP,SAAS,GAAQ,GAC7B,IACJ,CAWD,kBAAAC,CAAmBpxC,EAAOtC,EAAO,MAC/B,OAAIA,EAAK2zC,QACF/yC,MAAKgzC,GAAiBtxC,IAAWjC,MAAMC,WAAW,kBAAoBgC,EAAMF,UAAYlC,KAAK2E,KAAKD,WAAWjC,GACrH,CAUD,GAAAixC,CAAiBtxC,GACf,MAAMmQ,EAAmBpS,MAAMoE,sBAC/B,OACEgO,GAAkBzM,MAAKrB,GAAmBA,EAAgBhC,KAAOL,EAAMK,OAChE8P,GAAkB7K,QAClBrF,QAAQC,QAAQC,YAAYuD,MAAK1D,GAASA,EAAMK,KAAO/B,KAAKsR,WAAW5P,OAAOK,IAExF,CASD,iBAAAkxC,CAAkBjxC,GAChB,OAAOA,GAAOD,KAAO/B,KAAKsR,WAAWtP,OAAOD,EAC7C,CAUD,wBAAAmxC,CAAyBlxC,EAAO5C,GAC9B,OAAK4C,EAKDhC,KAAKizC,kBAAkBjxC,IACzBtD,GAAOnB,MAAM,2BAA4B,CAAEyE,QAAO5C,UAC3C,IAEPV,GAAOnB,MAAM,uCAAwC,CAAEyE,QAAO5C,UACvD,IATPV,GAAOnB,MAAM,yBAA0B,CAAE6B,UAClC,EAUV,ECnyCH,IAAIyN,GAKG,SAASsmC,iBACdtmC,GAASumC,UAAUC,eAAe38C,EAAOC,IACzCkW,GAAOymC,SAAS,eAAgB1mC,YAAY6B,wBAC5C5B,GAAOymC,SAAS,UAAW1mC,YAAYgD,mBACvC/C,GAAOymC,SAAS,WAAY1mC,YAAYoC,oBACxCnC,GAAOymC,SAAS,QAAS7I,eAAeiH,sBAC1C,CAMO,SAAS6B,oBACd,QAAIj0C,KAAKmG,QAAQvD,IAAI,cAAcoD,SAEnC5G,OAAOQ,MAAM,4EAA4E,IAClF,EACT,CAOO,SAASs0C,YACd,OAAO3mC,EACT,CC7BO,MAAM4mC,qBACX,WAAA3zC,CAAY0R,GACVxR,KAAKwR,cAAgBA,EACrBxR,KAAKgC,MAAQwP,EAAcxP,MAC3BhC,KAAK0B,MAAQ8P,EAAc9P,KAC5B,CAQD,YAAAgyC,GACE1zC,MAAK2zC,IACN,CAQD,GAAAA,GACM3zC,KAAKgC,MACPhC,MAAK4zC,KAEL5zC,MAAK6zC,IAER,CAQD,GAAAD,GACE,IAAK5zC,KAAK0B,MAAO,OACjB,MAAMoyC,EAAc,GAGdC,EAAiB,eACjBC,EAAmBh0C,KAAK0B,OAAOuyC,SACjC30C,KAAKyF,KAAKE,SAAS,mCACnB3F,KAAKyF,KAAKE,SAAS,8BACjBivC,EAAqB,CACzBnyC,GAAIgyC,EACJ17C,KAAM27C,EACN5oB,QAAShf,UACP,MAAM1K,EAAQjC,MAAMqE,0BACpBpC,EAAMkH,SAASurC,iBAAiB,GAOpC,GAHAL,EAAY1wC,KAAK8wC,GAGb50C,KAAK2E,KAAKoB,KAAM,CAClB,MAAM+uC,EAAqB,mBACrBC,EAAuBr0C,KAAK0B,OAAOkH,UAAU0rC,OAC/Ch1C,KAAKyF,KAAKE,SAAS,8BACnB3F,KAAKyF,KAAKE,SAAS,gCACjBsvC,EAAyB,CAC7BxyC,GAAIqyC,EACJ/7C,KAAMg8C,EACNjpB,QAAShf,UACP,MAAM1K,EAAQjC,MAAMqE,0BACd0wC,EAAW9yC,EAAMkH,SAAS0rC,aAC1B5yC,EAAMkH,SAASuP,OAAO,CAAEm8B,QAASE,GAAW,GAGtDV,EAAY1wC,KAAKmxC,EAClB,CAED,MAAMv/B,EAAY,CAAEjT,GAAI,QAASvI,KAAM2B,EAAWG,QAGlD0E,KAAKwR,cAAcijC,WAAWX,EAAa9+B,EAC5C,CAQD,GAAA6+B,GACE,MAAMjyC,EAASnC,MAAMoE,sBACfiwC,EAAc,GAGdC,EAAiB,eACjBC,EAAmBpyC,EAAOmB,OAAMrB,GAASA,EAAMuyC,WACjD30C,KAAKyF,KAAKE,SAAS,mCACnB3F,KAAKyF,KAAKE,SAAS,8BACjBivC,EAAqB,CACzBnyC,GAAIgyC,EACJ17C,KAAM27C,EACN5oB,QAAShf,UACP,MAAMyF,EAAmBpS,MAAMoE,sBAC/B,IAAK,MAAMnC,KAASmQ,QACZnQ,EAAMkH,SAASurC,iBACtB,GAML,GAHAL,EAAY1wC,KAAK8wC,GAGb50C,KAAK2E,KAAKoB,KAAM,CAClB,MAAM+uC,EAAqB,mBACrBM,EAAuB9yC,EAAOmB,OAAMrB,GAASA,EAAMkH,UAAU0rC,SAC/Dh1C,KAAKyF,KAAKE,SAAS,8BACnB3F,KAAKyF,KAAKE,SAAS,gCACjBsvC,EAAyB,CAC7BxyC,GAAIqyC,EACJ/7C,KAAMq8C,EACNtpB,QAAShf,UACP,MAAMyF,EAAmBpS,MAAMoE,sBAC/B,IAAK,MAAMnC,KAASmQ,EAAkB,CACpC,MAAM2iC,EAAW9yC,EAAMkH,SAAS0rC,aAC1B5yC,EAAMkH,SAASuP,OAAO,CAAEm8B,QAASE,GACxC,IAGLV,EAAY1wC,KAAKmxC,EAClB,CAED,MAAMv/B,EAAY,CAAEjT,GAAI,QAASvI,KAAM2B,EAAWG,QAGlD0E,KAAKwR,cAAcijC,WAAWX,EAAa9+B,EAC5C,ECpII,MAAM2/B,wBACXnjC,cAEAojC,kBAEAC,QAEA,WAAA/0C,CAAY0R,GACVxR,KAAKwR,cAAgBA,EACrBxR,KAAK40C,kBAAoB,IAAIzsC,IAC7BnI,KAAK60C,QAAU,EAChB,CAOD,kBAAMnB,GACJ,GAAoC,IAAhC1zC,KAAK40C,kBAAkBn2B,KAAY,CASrC,GARAze,KAAK60C,QAAUv1C,KAAKuY,MACjB9G,QACC+G,GACE/f,EAAsByL,SAASsU,EAAKC,gBAC9B1W,QAAQC,MAAMgM,eAAehO,KAAKuG,QAAS,MAAQiS,EAAKE,SAAWF,EAAK7K,SAAW3N,KAAK2E,KAAKoB,QAEtG5C,KAAIqV,GAAQA,EAAKG,SAASlW,KAED,IAAxB/B,KAAK60C,QAAQ7tC,OAAc,aAEzB5G,QAAQ4M,IAAIhN,KAAK60C,QAAQpyC,KAAIqyC,GAAU90C,MAAK+0C,GAAYD,KAC/D,CAED,IAAK,MAAMh9B,KAAQ9X,KAAK40C,kBAAkBjsC,SACxC3I,KAAKwR,cAAcijC,WAAW38B,EAAKg8B,YAAah8B,EAAK9C,UAExD,CAQD,QAAM+/B,CAAYD,GAChB,MAAMh9B,EAAOxY,KAAKuY,MAAM3V,IAAI4yC,GACtB1sC,EAAU0P,EAAOA,EAAKrL,MAAMgS,KAAO,EAAI3G,EAAKrL,YAAcqL,EAAKk9B,WAAa,KAClF,IAAK5sC,EAAS,OACd,MAAM6sC,EAAaj1C,MAAKk1C,GAAyBp9B,GAAMC,cACvD,IAAKk9B,EAAY,OACjB,MAAMnB,EAAc1rC,EAAQ3F,KAAI0yC,IAAU,CACxCpzC,GAAIozC,EAAMC,IACV/8C,KAAM88C,EAAM98C,KACZ0d,SAAU,GAAGzW,KAAKyF,KAAKE,SAASvN,EAAYu9C,QAAiBE,EAAM98C,OACnEkL,IAAK9D,MAAMwD,SAASkyC,GACpBE,SAAUr1C,MAAKs1C,GAAYL,EAAYn9B,EAAMq9B,EAAMC,SAE/CpgC,EAAY,CAAEjT,GAAI/B,MAAKu1C,GAAYT,GAASt7C,KAAM,QACxDwG,KAAK40C,kBAAkBvwC,IAAIywC,EAAQ,CAAEhB,cAAa9+B,aACnD,CASD,GAAAkgC,CAAyBn9B,GACvB,MACO,UADCA,EAEG,kBAEA,iBAEZ,CAWD,GAAAu9B,CAAYL,EAAYn9B,EAAM09B,GAC5B,MACO,oBADCP,EAEGj1C,MAAKy1C,GAAoB39B,EAAM09B,GAE/Bx1C,MAAK01C,GAAiB59B,EAAM09B,EAExC,CAUD,GAAAE,CAAiB59B,EAAM09B,GACrB,OAAOppC,UACL,MAAMupC,QAAqB79B,EAAK89B,YAAYJ,GAC5CG,EAAaE,MAAMvmB,QAAO,EAAK,CAClC,CAUD,GAAAmmB,CAAoB39B,EAAM09B,GACxB,OAAOppC,gBACC0L,EAAK89B,YAAYJ,GAAY9kC,MAAK5Y,GAASA,EAAMg+C,WAAU,CAEpE,CASD,GAAAP,CAAYT,GACV,OAAOA,EAAOj0C,QAAQ,IAAK,IAC5B,CAUD,kBAAAk1C,CAAmBjB,GACjB,QAAQ90C,KAAK60C,QAAc,QACvB70C,KAAK60C,SAASrxC,SAASsxC,EAE5B,EClJI,MAAMkB,mBACX,WAAAl2C,CAAY0R,GACVxR,KAAKwR,cAAgBA,CACtB,CAQD,kBAAMkiC,GACC1zC,KAAKi2C,eACRj2C,KAAKi2C,aAAe,CAClBnC,kBAAmB9zC,MAAKk2C,KACxBlhC,UAAW,CAAEjT,GAAI,SAAUvI,KAAM,UAIrCwG,KAAKwR,cAAcijC,WAAWz0C,KAAKi2C,aAAanC,YAAa9zC,KAAKi2C,aAAajhC,UAChF,CASD,QAAMkhC,GACJ,MAAMjB,EAAa,QACbkB,EAAS72C,KAAK62C,OAAOplC,QAAOjZ,GAASkI,MAAKqO,GAAevW,KAE/D,OAAOq+C,EAAO1zC,KAAI3K,IACT,CACLiK,GAAIjK,EAAMiK,GACV1J,KAAMP,EAAMO,KACZ0d,SAAU/V,MAAKo2C,GAAanB,EAAYn9C,EAAMO,MAC9CkL,IAAK9D,MAAMwD,SAASnL,GACpBszB,QAAS,KACP9rB,KAAK62C,OAAOj0C,IAAIpK,EAAMiK,IAAI+zC,SAAS,KAI1C,CAUD,GAAAznC,CAAevW,GACb,MAAMu+C,UAAEA,GAAcv+C,EACtB,OAAOu+C,EAAU/2C,KAAKyT,QAAUsjC,EAAU/2C,KAAKyT,QAAU,EAAIsjC,EAAU38C,QAAU,CAClF,CAUD,GAAA08C,CAAanB,EAAY58C,GACvB,MAAMi+C,EAAiB,GAAGh3C,KAAKyF,KAAKE,SAASvN,EAAYu9C,SAAoB,GAC7E,MAAO,GAAGqB,IAAiBj+C,GAC5B,EClEI,MAAMk+C,cACX,WAAAz2C,GACEE,KAAKsR,WAAa,GAClBtR,KAAKuR,aAAe,GACpBvR,KAAKw2C,qBAAuB,IAAI/C,qBAAqBzzC,MACrDA,KAAKy2C,wBAA0B,IAAI9B,wBAAwB30C,MAC3DA,KAAK02C,mBAAqB,IAAIV,mBAAmBh2C,MACjDA,KAAKyU,QAAU,GACfzU,KAAK8b,iBAAmB,IAAI3T,IAC5BnI,KAAK22C,UAAYl/C,EACjBuI,KAAK42C,uBAAyB,EAC/B,CAOD,SAAAjkC,GACE3S,KAAKw2C,qBAAuB,IAAI/C,qBAAqBzzC,MACrDA,KAAKyU,QAAU,GACfzU,KAAK8b,iBAAmB,IAAI3T,GAC7B,CAQD,cAAAsR,CAAejO,GACb,IAAK,MAAMvU,KAASuR,OAAOG,OAAO6C,GAChC,GAAIvU,EAAMwd,SAASzN,OAAQ,CACzBhH,KAAKyU,QAAQrR,QAAQnM,EAAMwd,SAC3B,IAAK,MAAM1d,KAAUE,EAAMwd,QACzB1d,EAAO6d,UAAW,CAErB,CAEJ,CAOD,sBAAM4E,SACEpZ,QAAQ4M,IAAI,CAChBhN,MAAK62C,KACL72C,MAAK82C,KACL92C,MAAK+2C,KACL/2C,MAAKg3C,aAEDh3C,MAAKi3C,KACXj3C,MAAKk3C,KACLl3C,MAAKm3C,IACN,CAQD,QAAMN,GACJn4C,GAAOnB,MAAM,6BAA8B,CAAEyE,MAAOhC,KAAKgC,MAAON,MAAO1B,KAAK0B,QAC5E,MAAM01C,EAAWp3C,KAAKuR,aAAauD,oBAC7B9U,KAAKq3C,mBAAmBD,GAC9B14C,GAAOnB,MAAM,uBAAwB,CAAErG,IAAK8I,KAAK9I,IAAK8K,MAAOhC,KAAKgC,MAAON,MAAO1B,KAAK0B,OACtF,CASD,wBAAM21C,CAAmBD,GAAY,CAQrC,QAAML,GACJr4C,GAAOnB,MAAM,wCACPyC,KAAKy2C,wBAAwB/C,eACnCh1C,GAAOnB,MAAM,2BAA4B,CAAErG,IAAK8I,KAAK9I,KACtD,CAQD,GAAA4/C,GACEp4C,GAAOnB,MAAM,8BAA+B,CAAEyE,MAAOhC,KAAKgC,MAAON,MAAO1B,KAAK0B,QAC7E1B,KAAKw2C,qBAAqB9C,eAC1Bh1C,GAAOnB,MAAM,wBAAyB,CAAErG,IAAK8I,KAAK9I,IAAK8K,MAAOhC,KAAKgC,MAAON,MAAO1B,KAAK0B,OACvF,CAQD,QAAMs1C,GACJt4C,GAAOnB,MAAM,mCACPyC,KAAK02C,mBAAmBhD,eAC9Bh1C,GAAOnB,MAAM,sBAAuB,CAAErG,IAAK8I,KAAK9I,KACjD,CAQD,QAAM+/C,SACE72C,QAAQ4M,IAAIhN,KAAK42C,uBAAuBn0C,KAC5C2J,eAAwBkrC,EAASC,wBAEpC,CAQD,GAAAL,GACE,MAAMM,EAAmBx3C,KAAKyU,QAAQ1D,QAAOha,IAAWA,GAAQigB,WAEhE,IAAK,MAAMygC,KAAmBD,EAAkB,CAC9C,MAAME,EAAkB13C,KAAK8b,iBAAiB5Z,IAAIu1C,EAAgB11C,IAElE,GAAI21C,EAAiB,CACnB,MAAMC,EAAiBD,EAAgBC,gBAAkBF,EAAgBE,eACnE1gC,EAAewgC,EAAgBxgC,cAAgBygC,EAAgBzgC,aACrEzO,OAAOwD,OAAOyrC,EAAiBz3C,MAAK43C,GAAc,IAAKF,EAAiBC,iBAAgB1gC,iBACzF,CACF,CACF,CAQD,GAAAkgC,GACE,MAAM3rC,EAASxL,KAAKuR,aAAaoD,UAAU,CAAE7I,MAAO,IAEpD,IAAK,MAAM7U,KAASuU,EAAQ,CAC1B,MAAMqsC,EAAsB5gD,GAAOG,UAAUytC,eAEvCiT,EAAY93C,KAAKuR,aAAaoD,UAAU,CAAE5I,OAAQ9U,EAAM8U,SAE9D,IAAK,MAAMgsC,KAAYD,EAAW,CAChC,MAAMrjC,EAAUsjC,EAAStjC,QACzB,IAAKA,GAASzN,OAAQ,SAEtB,MAAMgxC,EAAyBD,GAAU3gD,UAAUytC,eAC7CA,EAAkBmT,GAA0B,EAC9CH,EACAG,EAGJ,MAAMnT,GAAqC,IAAnBA,GAAyBA,EAAiB,GAElE,IAAK,MAAM9tC,KAAU0d,EACf1d,EAAOsB,KAAK2O,QAAU69B,IAM1B9tC,EAAOsB,KALgB,IAAnBwsC,EAKU9tC,EAAOsB,KAClBwS,MAAM,KACNpI,KAAIw1C,GAAQA,EAAK1wC,MAAM,EAAGs9B,KAC1Bn+B,KAAK,KAPQ,GASnB,CACF,CACF,CAUD,UAAAwvC,CAAWgC,GACT,OAAOl4C,KAAKyU,QAAQ1D,QAAOha,GAAUA,EAAOgL,KAAOm2C,EAAWn2C,IAC/D,CAUD,GAAA61C,CAAcM,GACZ,MAAMC,EAAWD,EAAWC,UAAYD,EAAW7/C,KAC7C6a,EAAUD,WAAWilC,EAAWhlC,QAASilC,GAEzCC,UAAYz5C,GACXA,EACE,IACDA,EAAKzG,OAAS,CAAEA,MAAOyG,EAAKzG,UAC5ByG,EAAK/B,MAAQ,CAAEA,KAAM+B,EAAK/B,SAC1B+B,EAAKmC,MAAQ,CAAEA,KAAMnC,EAAKmC,SAC1BnC,EAAKgH,OAAS,CAAEA,MAAOhH,EAAKgH,QALhB,GASpB,MAAO,CACL5D,GAAIm2C,EAAWn2C,GACf1J,KAAM6/C,EAAW7/C,KACjB8/C,WACApiC,SAAUmiC,EAAWniC,UAAYmiC,EAAW7/C,QACxC6/C,EAAW9sB,SAAW,CAAEA,QAAS8sB,EAAW9sB,YAC5C8sB,EAAWG,SAAW,CAAEjtB,QAAS8sB,EAAWG,YAC5CH,EAAWI,cAAgB,CAAEA,aAAcJ,EAAWI,iBACtDJ,EAAWviC,UAAY,CAAEA,SAAUuiC,EAAWviC,UAClD4iC,MAAOL,EAAWK,OAAS,CAAE,KACzBL,EAAWM,OAAS,CAAEA,MAAON,EAAWM,UACxCN,EAAWO,OAAS,CAAEA,MAAOP,EAAWO,UACxCP,EAAWQ,OAAS,CAAEA,MAAOR,EAAWQ,UACxCR,EAAW30C,KAAO,CAAEA,IAAK20C,EAAW30C,KACxCqS,MAAOwiC,UAAUF,EAAWtiC,OAC5BC,MAAOuiC,UAAUF,EAAWriC,OAC5BC,MAAOsiC,UAAUF,EAAWpiC,OAC5BL,OAAQyiC,EAAWziC,QAAU,CAAE,EAC/BkjC,UAAU,KACNT,EAAWU,QAAU,CAAEA,OAAQV,EAAWU,WAC1CV,EAAWlhC,UAAY,CAAEA,SAAUkhC,EAAWlhC,UAClDC,aAAcihC,EAAWjhC,eAAgB,EACzC0gC,eAAgBO,EAAWP,iBAAkB,EAC7C/iC,WAAUsjC,EAAWP,iBACjBO,EAAWjhC,cAAgBihC,EAAWP,iBAAkB,GAE5DzkC,aACIglC,EAAWW,gBAAkB,CAAEA,eAAgBX,EAAWW,gBAEjE,CAUD,UAAApE,CAAWX,EAAa9+B,GACtB,IAAK8+B,EAAY9sC,OAAQ,OAGzB,MAAMyN,EAAU,IAAItM,IAAI2rC,EAAYrxC,KAAIy1C,GAAc,CAACA,EAAWn2C,GAAI/B,MAAK43C,GAAcM,OAGzF,GAFAl4C,MAAK84C,GAAuBrkC,IAEvBO,GAAWjT,GAAI,OAEfiT,GAAWxb,OAAQwb,EAAUxb,KAAO,UAEzC,MAAMgS,EAASxL,KAAKuR,aAAaoD,UAAUK,GAE3C,GAAKxJ,EAEL,IAAK,MAAMvU,KAASuU,EAAQ,CAE1B,MAAMutC,EAAkB,IAAI5wC,IAAIlR,EAAMwd,QAAQhS,KAAI1L,GAAU,CAACA,EAAOgL,GAAIhL,MAElEiiD,EAAmB,GAGzBD,EAAgBrgC,SAAQ,CAACugC,EAAgBC,KACvC,MAAMniD,EAAS0d,EAAQvS,IAAIg3C,GAC3B,GAAIniD,EAAQ,CACV,MAAM4gD,EAAiB5gD,EAAO4gD,gBAAkBsB,EAAetB,eACzD1gC,EAAegiC,EAAehiC,cAAgBlgB,EAAOkgB,aACrDrC,IAAa+iC,IAEf1gC,GAAgB0gC,IAAkB,GACtCnvC,OAAOwD,OAAOitC,EAAgB,IAAKliD,EAAQigB,UAAU,EAAMpC,WAAU+iC,iBAAgB1gC,gBACtF,MAAM,IAAKgiC,EAAerkC,UAAYqkC,EAAejiC,SAAU,CAC9D,MAAM2gC,GAAiB,EACvBnvC,OAAOwD,OAAOitC,EAAgBj5C,MAAK43C,GAAc,IAAKqB,EAAgBtB,mBACvE,KAIHljC,EAAQiE,SAAQ,CAAC3hB,EAAQ8kB,KACvB,MAAMo9B,EAAiBF,EAAgB72C,IAAI2Z,GACtCo9B,GAAgBD,EAAiB51C,KAAKpD,MAAK43C,GAAc,IAAK7gD,EAAQigB,UAAU,IAAQ,KAK7FhC,GAAW5d,UAAU8P,WACoB,IAA9B8N,GAAW5d,UAAU8P,MAAwBzH,MAAMC,WAAW,iBAEzEs5C,EAAiB9xC,MAAK,CAACC,EAAGC,IAAMD,EAAE9O,KAAKgQ,cAAcjB,EAAE/O,QAIzDpB,EAAMwd,QAAQrR,QAAQ41C,EACvB,CACF,CAUD,aAAAzT,CAAcuO,EAAa9+B,GACzB,MAAM/d,EAAQ+I,KAAKuR,aAAamD,SAASM,GACnCP,EAAUxd,EAAMwd,QAEhBukC,EAAmB,GAIzB,IAAK,MAAMd,KAAcpE,EAAa,CACpC,GAAIoE,EAAWn2C,GAAGyB,SAAS,aAAc,SACzC,MAAMy1C,EAAiBhiD,EAAMwd,QAAQ3S,MAAK/K,GAAUA,EAAOgL,KAAOm2C,EAAWn2C,KAC7E,GAAIk3C,EAAgB,CAClB,MAAME,EAAc,IAAKF,EAAgBhiC,cAAc,GACvD+hC,EAAiB51C,KAAK+1C,EAC9B,KAAa,CACL,MAAMzB,EAAkB13C,KAAK8b,iBAAiB5Z,IAAIg2C,EAAWn2C,IAC7D,GAAI21C,EAAiB,CACnB,MAAMyB,EAAc,IAAKzB,EAAiBzgC,cAAc,GACxD+hC,EAAiB51C,KAAK+1C,EACvB,CACF,CACF,CAED,IAAK,MAAMpiD,KAAU0d,EAAS,CAC5B,IAAK1d,EAAOgL,IAAMhL,GAAQgL,GAAGyB,SAAS,aAAc,SAEpD,MAAM00C,EAAapE,EAAYhyC,MAAKo2C,GAAcA,EAAWn2C,KAAOhL,EAAOgL,KAC3E,IAAKm2C,GAAcnhD,EAAOigB,SAAU,CAClC,MAAMmiC,EAAc,IAAKpiD,EAAQkgB,cAAc,GAC/C+hC,EAAiB51C,KAAK+1C,EACvB,CACF,EAGGnkC,GAAW5d,UAAU8P,WACkB,IAA9B8N,GAAW5d,UAAU8P,MAAwBzH,MAAMC,WAAW,iBACzEs5C,EAAiB9xC,MAAK,CAACC,EAAGC,IAAMD,EAAE9O,KAAKgQ,cAAcjB,EAAE/O,QAIzDpB,EAAMwd,QAAUukC,CACjB,CASD,GAAAF,CAAuBrkC,GACrBA,EAAQiE,SAAQ,CAAC3hB,EAAQ8kB,KAClB7b,KAAK8b,iBAAiBtM,IAAIqM,IAAW7b,KAAK8b,iBAAiBzX,IAAIwX,EAAU9kB,EAAO,GAExF,CASD,yBAAAkuC,GACE,MAAO,IAAIjlC,KAAK8b,iBAAiBnT,UAC9BlG,KAAI1L,GAAUiJ,MAAKmX,EAAUpgB,KAC7BmQ,MAAK,CAACC,EAAGC,IAAMD,EAAEvG,MAAMyH,cAAcjB,EAAExG,QAC3C,CAUD,wBAAAwkC,CAAyBpwB,GACvB,MAAM/d,EAAQ+I,KAAKuR,aAAamD,SAASM,GACzC,OAAK/d,EACEA,EAAMwd,QACV1D,QAAOha,IAA8B,IAApBA,EAAO6d,WACxBnS,KAAI1L,GAAUiJ,MAAKmX,EAAUpgB,KAHb,EAIpB,CASD,wBAAAqiD,CAAyBC,GACvB36C,GAAOnB,MAAM,oCAAqC,CAAE87C,0BACpDA,EAAsB/nC,WAAatR,KAAKsR,WACxC+nC,EAAsB9nC,aAAevR,KAAKuR,aAC1C8nC,EAAsB7nC,cAAgBxR,KACtCA,KAAK42C,uBAAuBxzC,KAAKi2C,EAClC,CAUD,EAAAliC,CAAU+gC,GACR,MAAMn2C,GAAEA,EAAE1J,KAAEA,EAAI0d,SAAEA,GAAamiC,EAC/B,MAAO,CAAEn2C,KAAI1J,OAAMmB,KAAM,SAAUoH,MAAOmV,GAAY1d,EACvD,CAUD,iBAAI6Z,GACF,OAAOlS,KAAKsR,YAAYY,aACzB,CAQD,SAAIlQ,GACF,OAAOhC,KAAKsR,YAAYtP,KACzB,CAOD,SAAIA,CAAMA,GACRhC,KAAKsR,WAAWtP,MAAQA,CACzB,CAQD,UAAIC,GACF,OAAOjC,KAAKsR,YAAYrP,MACzB,CAQD,UAAIA,CAAOA,GACTjC,KAAKsR,WAAWrP,OAASA,CAC1B,CAQD,SAAIP,GACF,OAAO1B,KAAKsR,YAAY5P,KACzB,CAOD,SAAIA,CAAMA,GACR1B,KAAKsR,WAAW5P,MAAQA,CACzB,CAQD,UAAIE,GACF,OAAO5B,KAAKsR,YAAY1P,MACzB,CAQD,UAAIA,CAAOA,GACT5B,KAAKsR,WAAW1P,OAASA,CAC1B,CAQD,gBAAI4Y,GACF,OAAOxa,KAAKsR,YAAYkJ,YACzB,CAQD,SAAIU,GACF,OAAOlb,KAAKsR,YAAY4J,KACzB,CAQD,UAAIG,GACF,OAAOrb,KAAKsR,YAAY+J,MACzB,CAQD,WAAIG,GACF,OAAOxb,KAAKsR,YAAYkK,OACzB,CAQD,WAAIC,GACF,OAAOzb,KAAKsR,YAAYmK,OACzB,ECvkBI,MAAM69B,8BAA8B/C,cACzC,WAAAz2C,GACEqhC,OACD,CAMD,mBAAAoW,GAAwB,ECRnB,MAAMgC,YACX,WAAAz5C,GACEE,KAAKsR,WAAa,KAClBtR,KAAK22C,UAAYl/C,EACjBuI,KAAKw5C,gBAAkB,GACvBx5C,KAAKy5C,qBAAuB,EAC7B,CAOD,oBAAAC,CAAqBtoC,GACnB,MAAM,IAAI+tB,MACR,gCAAgC/tB,IAEnC,CAOD,sBAAAuoC,CAAuBC,GACrBl7C,GAAOnB,MAAM,kCAAmC,CAAEq8C,wBAClD55C,KAAKy5C,qBAAqBr2C,KAAKw2C,EAChC,CASD,2BAAM5/B,CAAsB5X,EAAOrL,EAAQya,GACzC,IAOE,GANA9S,GAAOnB,MAAM,8BAA+B,CAAE6E,UAG9CpC,KAAKjJ,OAASA,EAGiB,mBAApBA,GAAQq0B,QAGjB,OAFAr0B,EAAOq0B,eACPuX,MAAM+B,QAAQ,6BAKhB,MAAMmV,EAAc75C,MAAK85C,GAAgB13C,GAGzC,IAAK,IAAIy/B,KAAW7hC,KAAKy5C,qBAEvB,GADA5X,EAAQ9qC,OAASiJ,KAAKjJ,OAClB8qC,EAAQkY,qBAAqB33C,EAAOy3C,EAAaroC,GACnD,OAKJ,IAAK,IAAIqwB,KAAW7hC,KAAKw5C,gBAEvB,GADA3X,EAAQ9qC,OAASiJ,KAAKjJ,OAClB8qC,EAAQkY,qBAAqB33C,EAAOy3C,EAAaroC,GACnD,OAKJ,IAAK,IAAIqwB,KAAW7hC,KAAKy5C,qBAEvB,GADA5X,EAAQ9qC,OAASiJ,KAAKjJ,OAClB8qC,EAAQmY,kBAAkB53C,EAAOy3C,EAAaroC,GAChD,OAKJxR,KAAKg6C,kBAAkB53C,EAAOy3C,EAC/B,CAAC,MAAM36C,GACNR,GAAOQ,MAAM,oCAAqC,CAAEA,QAAOkD,QAAOrL,UACnE,CACF,CAUD,iBAAAijD,CAAkB53C,EAAOy3C,GAAe,CASxC,2BAAM5/B,CAAsB7X,EAAOrL,GAOjC,GANA2H,GAAOnB,MAAM,8BAA+B,CAAE6E,UAG9CpC,KAAKjJ,OAASA,EAGiB,mBAApBA,GAAQshD,QAEjB,YADAthD,EAAOshD,UAKT,MAAMwB,EAAc75C,MAAK85C,GAAgB13C,GAEzCpC,KAAK0tC,kBAAkBtrC,EAAOy3C,EAC/B,CAUD,iBAAAnM,CAAkBtrC,EAAOy3C,GAAe,CASxC,0BAAM9/B,CAAqB3X,EAAOnL,GAChCyH,GAAOnB,MAAM,mCAAmCtG,EAAMoB,QAAS,CAAE+J,UAEjEpC,KAAKyuC,iBAAiBrsC,EAAOnL,EAC9B,CAUD,gBAAAw3C,CAAiBrsC,EAAOnL,GAAS,CASjC,iBAAAgjD,CAAkBpY,GAChBnjC,GAAOnB,MAAM,2BAA2BskC,EAAQ/hC,YAAYzH,QAC5D2H,KAAKw5C,gBAAgBp2C,KAAKy+B,EAC3B,CAUD,GAAAiY,CAAgB13C,GACd,IAAKA,EAAO,OAAO,KACnB,MAAM83C,EAAgB93C,EAAMC,OAAO4G,cAAc,uBAAyB7G,EAAMC,OAAOC,QAAQ,sBAC/F,OAAO43C,GAAet5C,OAAS,IAChC,CAWD,UAAAu5C,CAAWn4C,EAAO0B,GAEX1B,IACHA,EAAQhC,KAAKgC,OAIf,MAAMo4C,EAAO36C,MAAMgE,QAAQzB,EAAO0B,GAGlC,QAAK02C,IAGLA,EAAKvE,MAAMvmB,QAAO,IACX,EACR,CASD,YAAA+qB,GACE,OAAQr6C,KAAKwa,gBAAkBxa,KAAKkb,OAASlb,KAAKqb,QAAUrb,KAAKwb,QAClE,CAUD,SAAIxZ,GACF,OAAOhC,KAAKsR,YAAYtP,KACzB,CAQD,UAAIC,GACF,OAAOjC,KAAKsR,YAAYrP,MACzB,CAQD,SAAIP,GACF,OAAO1B,KAAKsR,YAAY5P,KACzB,CAQD,UAAIE,GACF,OAAO5B,KAAKsR,YAAY1P,MACzB,CAQD,gBAAI4Y,GACF,OAAOxa,KAAKsR,WAAWkJ,YACxB,CAQD,SAAIU,GACF,OAAOlb,KAAKsR,WAAW4J,KACxB,CAQD,UAAIG,GACF,OAAOrb,KAAKsR,WAAW+J,MACxB,CAQD,WAAIG,GACF,OAAOxb,KAAKsR,WAAWkK,OACxB,CAQD,WAAIC,GACF,OAAOzb,KAAKsR,YAAYmK,OACzB,EChTI,MAAM6+B,uBAAuBf,YAQlC,oBAAAQ,CAAqB33C,EAAOy3C,EAAaroC,GACvC,OAAO,CACR,ECZI,MAAM+oC,4BAA4BhB,YACvC,WAAAz5C,GACEqhC,OACD,CASD,oBAAA4Y,CAAqB33C,EAAOy3C,EAAaroC,GACvC,OAAO,CACR,CAYD,iBAAAwoC,CAAkB53C,EAAOy3C,EAAaroC,GACpC,OAAO,CACR,EC9BH,MAAMsvB,cAAEA,GAAaC,2BAAEA,IAA+B1/B,QAAQ2/B,aAAaC,IAEpE,MAAMuZ,wBAAwBzZ,GAA2BD,KAC9D,WAAAhhC,IAAe8J,GACbu3B,MAAMv3B,EACP,CAID43B,uBAAyB,CACvB/sB,QAAS,CACPxW,MAAOu8C,gBAAgBv8C,OAEzBhB,QAAS,CAAC,GAAGvG,EAAOC,SAAU,SAC9BoL,GAAI,iCACJ4/B,KAAM,CACJC,eAAe,EACfC,QAAS2Y,gBAAgBnZ,QAE3BlY,SAAU,CACRzK,MAAO,IACPC,OAAQ,KAEV+E,IAAK,OACLrH,OAAQ,CACNylB,aAAa,EACbC,WAAW,EACXp8B,MAAO,mDAMX67B,aAAe,CACbG,KAAM,CACJ0C,SAAUvtC,EAASE,kBAMvB,qBAAMgrC,GA2BJ,OA1BAhiC,KAAK8rC,QAAU,CACbxyC,gBAAiBmG,MAAMC,WAAW,kBAAmBrG,EAAaC,gBAAgBI,SAClFC,aAAc8F,MAAMC,WAAW,eAAgBrG,EAAaM,aAAaD,SACzEG,sBAAuB4F,MAAMC,WAAW,wBAAyBrG,EAAaQ,sBAAsBH,SACpGS,2BAA4BsF,MAAMC,WAAW,6BAA8BrG,EAAac,2BAA2BT,SACnHW,kCAAmCoF,MAAMC,WAAW,oCAAqCrG,EAAagB,kCAAkCX,SACxIe,iCAAkCgF,MAAMC,WAAW,mCAAoCrG,EAAaoB,iCAAiCf,SACrIM,gBAAiByF,MAAMC,WAAW,kBAAmBrG,EAAaW,gBAAgBN,SAClFU,qBAAsBqF,MAAMC,WAAW,uBAAwBrG,EAAae,qBAAqBV,SACjGc,4BAA6BiF,MAAMC,WAAW,8BAA+BrG,EAAamB,4BAA4Bd,SACtHkB,2BAA4B6E,MAAMC,WAAW,6BAA8BrG,EAAauB,2BAA2BlB,SACnHI,yBAA0B2F,MAAMC,WAAW,2BAA4BrG,EAAaS,yBAAyBJ,SAC7GK,2BAA4B0F,MAAMC,WAAW,6BAA8BrG,EAAaU,2BAA2BL,SACnHO,8BAA+BwF,MAAMC,WAAW,gCAAiCrG,EAAaY,8BAA8BP,SAC5HQ,gCAAiCuF,MAAMC,WAAW,kCAAmCrG,EAAaa,gCAAgCR,SAClIY,qCAAsCmF,MAAMC,WAAW,uCAAwCrG,EAAaiB,qCAAqCZ,SACjJa,uCAAwCkF,MAAMC,WAAW,yCAA0CrG,EAAakB,uCAAuCb,SACvJgB,oCAAqC+E,MAAMC,WAAW,sCAAuCrG,EAAaqB,oCAAoChB,SAC9IiB,sCAAuC8E,MAAMC,WAAW,wCAAyCrG,EAAasB,sCAAsCjB,SACpJmB,iBAAkB4E,MAAMC,WAAW,mBAAoBrG,EAAawB,iBAAiBnB,SACrFoB,mBAAoB2E,MAAMC,WAAW,qBAAsBrG,EAAayB,mBAAmBpB,SAC3FqB,kBAAmB0E,MAAMC,WAAW,oBAAqBrG,EAAa0B,kBAAkBrB,SACxFsB,sBAAuByE,MAAMC,WAAW,wBAAyBrG,EAAa2B,sBAAsBtB,SACpGuB,wBAAyBwE,MAAMC,WAAW,0BAA2BrG,EAAa4B,wBAAwBvB,SAC1GwB,uBAAwBuE,MAAMC,WAAW,yBAA0BrG,EAAa6B,uBAAuBxB,UAElGsG,KAAK8rC,OACb,CAID,SAAAM,CAAUN,EAAS1qC,GACjB+/B,MAAMiL,UAAUN,EAAS1qC,GACE,oBAAhBq5C,aAA+BA,YAAYC,SACvD,CAID,kBAAaz8C,GACX,IAAK,MAAOiG,EAAKtD,KAAU4H,OAAOJ,QAAQ/O,GACxCoG,MAAM2E,WAAWF,EAAKtD,EAAMlH,SAC5BkP,SAASK,cAAc,SAAS1K,MAAM2K,YAAYtI,EAAMrH,YAAaqH,EAAMlH,SAE7EsG,KAAKsvB,QAAO,EACb,CAID,mBAAa+R,CAAOj/B,EAAOu/B,EAAMqC,GAC/B,MAAM2W,EAAyC,WAA9Bl7C,MAAMC,WAAW,SAClC,IAAK,MAAOwE,EAAKtD,KAAU4H,OAAOJ,QAAQ47B,EAASI,QAAS,CAC1D,MAAM9mC,EAAcjE,EAAa6K,GAC7BtD,IAAUZ,KAAK8rC,QAAQ5nC,KACzBzE,MAAM2E,WAAWF,EAAKtD,GAClB+5C,GACF/xC,SAASK,cAAc,SAAS1K,MAAM2K,YAAY5L,EAAY/D,YAAaqH,GAGhF,CACF,EClGIwL,eAAewuC,0BACdv5C,QAAQ2/B,aAAaC,IAAIoC,SAASC,QAAQ,CAC9CjnB,OAAQ,CACN1W,MAAOrG,KAAKyF,KAAKE,SAAS,4CAE5BkO,QAAS,MAAM7T,KAAKyF,KAAKE,SAAS,mDAClCs+B,OAAO,EACPC,IAAK,CACH7mC,MAAO2C,KAAKyF,KAAKE,SAAS,oCAC1Bw+B,SAAUr3B,SAAYvP,eAExB8mC,GAAI,CACFhnC,MAAO2C,KAAKyF,KAAKE,SAAS,qCAGhC,CAOAmH,eAAevP,cACb,IAAKyC,MAAMC,eAAgB,OAE3B,MAAMs7C,EAAsBjyC,SAASK,cAAc,4DAC/C4xC,UACIv7C,KAAKC,eAAe0sC,qBAAqB,eAAgB4O,GAAqBj6C,OAAS,UACvFnB,MAAM2E,WAAW,eAAgBy2C,GAAqBj6C,OAAS,KAGvE,MAAMk6C,EAA0BlyC,SAASK,cAAc,gEACnD6xC,UACIx7C,KAAKC,eAAe0sC,qBAAqB,mBAAoB6O,GAAyBl6C,OAAS,UAC/FnB,MAAMoF,YAAY,mBAAoBi2C,GAAyBl6C,OAAS,WAG1EtB,KAAKC,eAAe1C,cAC1B6B,GAAOC,KAAK,gBAAgB,EAC9B,CCvCOyN,eAAe2uC,8BACd15C,QAAQ2/B,aAAaC,IAAIoC,SAASC,QAAQ,CAC9CjnB,OAAQ,CACN1W,MAAOrG,KAAKyF,KAAKE,SAAS,gDAE5BkO,QAAS,MAAM7T,KAAKyF,KAAKE,SAAS,uDAClCs+B,OAAO,EACPC,IAAK,CACH7mC,MAAO2C,KAAKyF,KAAKE,SAAS,oCAC1Bw+B,SAAUr3B,SAAYtP,mBAExB6mC,GAAI,CACFhnC,MAAO2C,KAAKyF,KAAKE,SAAS,qCAGhC,CAQAmH,eAAetP,kBACb,IAAKwC,KAAKC,eAAgB,OAE1B,MAAMs7C,EAAsBjyC,SAASK,cAAc,4DAC/C4xC,SACIp7C,MAAM2E,WAAW,eAAgBy2C,GAAqBj6C,OAAS,IAGvE,MAAMk6C,EAA0BlyC,SAASK,cAAc,gEACnD6xC,SACIr7C,MAAMoF,YAAY,mBAAoBi2C,GAAyBl6C,OAAS,UAG1EtB,KAAKC,eAAesN,OAAOmuC,mBAAmB,SACpDt8C,GAAOC,KAAK,qBAAqB,EACnC,CCvCA,MAAMmiC,cAAEA,GAAaC,2BAAEA,IAA+B1/B,QAAQ2/B,aAAaC,IAEpE,MAAMga,wBAAwBla,GAA2BD,KAC9D,WAAAhhC,IAAe8J,GACbu3B,MAAMv3B,GAEN5J,KAAK5I,SAAW,EACjB,CAIDoqC,uBAAyB,CACvB/sB,QAAS,CACP/X,aAAcu+C,gBAAgBv+C,aAC9BG,YAAa+9C,kBACb99C,gBAAiBi+C,sBACjB98C,MAAOg9C,gBAAgBh9C,OAEzBhB,QAAS,CAAC,GAAGvG,EAAOC,SAAU,SAC9BoL,GAAI,iCACJ4/B,KAAM,CACJC,eAAe,EACfC,QAASoZ,gBAAgB5Z,QAE3BlY,SAAU,CACRzK,MAAO,IACPC,OAAQ,KAEV+E,IAAK,OACLrH,OAAQ,CACNylB,aAAa,EACbC,WAAW,IAMfP,aAAe,CACbG,KAAM,CACJ0C,SAAUvtC,EAASM,WAMvB,qBAAM4qC,GACJ,MAAM5qC,EAAW,GACX00C,EAAU,CAAE10C,YAElB,IAAK,MAAO8M,EAAK8E,KAAYR,OAAOJ,QAAQpI,KAAK5I,UAAW,CAC1D,MAAMoF,MAAEA,EAAKJ,KAAEA,EAAIQ,KAAEA,EAAID,MAAEA,EAAKtE,KAAEA,EAAImB,KAAEA,EAAI6C,UAAEA,EAAS+/B,MAAEA,EAAKqI,QAAEA,EAAO1tC,OAAEA,IAAWiS,EAEpF,GAAc,UAAVxM,IAAsB8C,KAAK2E,KAAKoB,KAAM,SAE1C,MAAMzE,GAASoI,GAASxM,MACT,SAAVA,QACOiD,MAAMmF,YAAYV,SAClBzE,MAAMC,WAAWwE,GACzB,GACEg3C,GAAc1hD,aAAgB2hD,SAAW3hD,EAAKnB,KAAO,SACrD+iD,GAAyB,WAAd/+C,EACXg/C,GAA2B,aAAdh/C,EACbi/C,GAA6B,eAAdj/C,EACfC,GAAgC,eAAdD,EAA8B6+C,IAAe,MAAQ,GACvEK,GAAyB,WAAdl/C,EACXm/C,GAAyB,UAAdn/C,GAA0B+/B,EACrCqf,QAAuBC,IAAZjX,EACjBrtC,EAASgM,KAAK,CACZrB,GAAImC,EACJ9H,KAAMkD,KAAKyF,KAAKE,SAAS7I,GACzBQ,OACAD,MAAO2C,KAAKyF,KAAKE,SAAStI,GAC1BtE,KAAMiH,KAAKyF,KAAKE,SAAS5M,GACzBuI,SACApH,OACA4hD,YACArkD,UACAskD,cACAC,gBACAh/C,kBACAi/C,YACAC,WACAC,aAEH,CACD,OAAO3P,CACR,CAID,mBAAOpvC,GACA4C,KAAKC,gBACVD,KAAKC,eAAe+R,WAAW+B,cAAc3W,cAC9C,CAED,mBAAa2kC,CAAOj/B,EAAOu/B,EAAMqC,GAC/B,IAAK,MAAO9/B,EAAKtD,KAAU4H,OAAOJ,QAAQ47B,EAASI,QAAS,CAC1D,OAAQpkC,KAAK5I,SAAS8M,GAAK1H,OACzB,IAAK,SACL,IAAK,cACGiD,MAAM2E,WAAWF,EAAKtD,GAAQ,MACtC,IAAK,aACGnB,MAAMoF,YAAYX,EAAKtD,SAG3BtB,KAAKC,eAAe0sC,qBAAqB/nC,EAAKtD,EACrD,CAEDtB,KAAKC,eAAe4Y,QACrB,EAKI,MAAMwjC,8BAA8BV,gBACzC,WAAAn7C,GACEqhC,QACAnhC,KAAK5I,SAAW8E,CACjB,CAIDslC,uBAAyB,CACvBnlB,OAAQ,CACN1W,MAAO,8CCvHb,SAASi2C,iBAAiB13C,EAAKtD,GACzBtB,KAAKC,gBAAgBD,KAAKC,eAAe0sC,qBAAqB/nC,EAAKtD,EACzE,CAKA+hC,MAAMjQ,GAAG,QAAQtmB,UACf9M,KAAK0G,YAAYstC,SAAS58C,EAAOC,GAAI,mBAAoB,CACvD0B,KAAMiH,KAAKyF,KAAKE,SAAS,mCACzB4zB,SAAU,GACVgjB,OAAQ,KAAYv8C,KAAKC,gBAAgBD,KAAKC,eAAewuC,iBAAiB,IAGhFzuC,KAAK0G,YAAYstC,SAAS58C,EAAOC,GAAI,oBAAqB,CACxD0B,KAAMiH,KAAKyF,KAAKE,SAAS,oCACzB4zB,SAAU,GACVgjB,OAAQ,KAAYv8C,KAAKC,gBAAgBD,KAAKC,eAAe0uC,mBAAmB,GAChF,IAWG,MAAM6N,qBAAuB,SAASvpC,EAAewpC,EAAclQ,GACxEvsC,KAAKlI,SAAS4kD,aAAatlD,EAAOC,GAAI,cAAe,CACnDyF,KAAMkD,KAAKyF,KAAKE,SAAS,4CACzBtI,MAAO2C,KAAKyF,KAAKE,SAAS,6CAC1B5M,KAAMiH,KAAKyF,KAAKE,SAAS,4CACzBrI,KAAM,iBACNpD,KAAMghD,gBACNyB,YAAY,EACZz/C,MAAO,WAKT8C,KAAKlI,SAAS4kD,aAAatlD,EAAOC,GAAI,SAAU,CAC9CyF,KAAMkD,KAAKyF,KAAKE,SAAS,uCACzBtI,MAAO2C,KAAKyF,KAAKE,SAAS,wCAC1B5M,KAAMiH,KAAKyF,KAAKE,SAAS,uCACzBrI,KAAM,sBACNpD,KAAMmiD,sBACNM,YAAY,EACZz/C,MAAO,WAKT8C,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,UAAW,CAC3C0B,KAAM,0BACNmE,MAAO,QACP0/C,QAAQ,EACR1iD,KAAM2iD,QACNziD,SAAS,IAKX4F,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,mBAAoB,CACpD0B,KAAM,oBACNmE,MAAO,QACP0/C,QAAQ,EACR1iD,KAAMC,OACNC,QAAS,QAKX,MAAM0iD,EAAe5zC,OAAO6zC,YAAY7zC,OAAOJ,QAAQyjC,GAAQppC,KAAI,EAAEyB,EAAKtD,KAAW,CAACsD,EAAKtD,EAAMvI,SAEjGiH,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,QAAS,CACzC0B,KAAMiH,KAAKyF,KAAKE,SAAS,sCACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,sCACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAMC,OACNC,QAAS,aACT+qC,QAAS2X,EACTE,SAAU17C,IACRnB,MAAM8I,UAAU3H,GAChBg7C,iBAAiB,QAASh7C,EAAM,IAMpCtB,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,eAAgB,CAChD0B,KAAMiH,KAAKyF,KAAKE,SAAS,6CACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,6CACzBzI,MAAO,QACP0/C,QAAQ,EACR1iD,KAAMC,SAKR6F,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,mBAAoB,CACpD0B,KAAMiH,KAAKyF,KAAKE,SAAS,iDACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,iDACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAMC,SAKR6F,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,YAAa,CAC7C0B,KAAMiH,KAAKyF,KAAKE,SAAS,0CACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,0CACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAMC,OACNC,QAAS,OACT+qC,QAAS,CACP8X,KAAMj9C,KAAKyF,KAAKE,SAAS,iDACzBu3C,GAAIl9C,KAAKyF,KAAKE,SAAS,+CACvBw3C,KAAMn9C,KAAKyF,KAAKE,SAAS,kDAE3Bq3C,SAAU17C,IACRg7C,iBAAiB,YAAah7C,EAAM,IAMxCtB,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,OAAQ,CACxC0B,KAAMiH,KAAKyF,KAAKE,SAAS,qCACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,qCACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAM2iD,QACNziD,SAAS,EACT4iD,SAAU17C,IACRg7C,iBAAiB,OAAQh7C,EAAM,IAMnCtB,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,QAAS,CACzC0B,KAAMiH,KAAKyF,KAAKE,SAAS,sCACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,sCACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAMI,OACNwiC,MAAO,CACLlG,IAAK,GACL3F,IAAK,EACLmsB,KAAM,KAERhjD,QAAS,EACT4iD,SAAU17C,IACRg7C,iBAAiB,QAASh7C,EAAM,IAMpCtB,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,OAAQ,CACxC0B,KAAMiH,KAAKyF,KAAKE,SAAS,qCACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,qCACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAMC,OACNC,QAAS,eACT+qC,QAAS,CACPkY,OAAQr9C,KAAKyF,KAAKE,SAAS,+CAC3B23C,aAAct9C,KAAKyF,KAAKE,SAAS,qDACjC43C,MAAOv9C,KAAKyF,KAAKE,SAAS,+CAE5Bq3C,SAAU17C,IACRg7C,iBAAiB,OAAQh7C,EAAM,IAMnCtB,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,SAAU,CAC1C0B,KAAMiH,KAAKyF,KAAKE,SAAS,uCACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,uCACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAM2iD,QACNziD,SAAS,EACT4iD,SAAU17C,IACRg7C,iBAAiB,SAAUh7C,EAAM,IAMrCtB,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,cAAe,CAC/C0B,KAAMiH,KAAKyF,KAAKE,SAAS,4CACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,4CACzBzI,MAAO,QACP0/C,QAAQ,EACR1iD,KAAMC,OACNgrC,QAASsX,EACTriD,QAAS,OACT4iD,SAAU17C,IACRg7C,iBAAiB,cAAeh7C,EAAM,IAM1CtB,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,QAAS,CACzC0B,KAAMiH,KAAKyF,KAAKE,SAAS,sCACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,sCACzBzI,MAAO,QACP0/C,QAAQ,EACR1iD,KAAMC,OACNgrC,QAAS,CACP,EAAGnlC,KAAKyF,KAAKE,SAAS,0CACtB,EAAG3F,KAAKyF,KAAKE,SAAS,0CACtB,EAAG3F,KAAKyF,KAAKE,SAAS,0CACtB,EAAG3F,KAAKyF,KAAKE,SAAS,2CAExBvL,QAAS,EACTojD,gBAAgB,IAKlBx9C,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,sBAAuB,CACvD0B,KAAMiH,KAAKyF,KAAKE,SAAS,oDACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,oDACzBzI,MAAO,QACP0/C,QAAQ,EACR1iD,KAAM2iD,QACNziD,SAAS,EACT4iD,SAAU17C,IACRg7C,iBAAiB,sBAAuBh7C,EAAM,IAMlDtB,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,gBAAiB,CACjD0B,KAAMiH,KAAKyF,KAAKE,SAAS,8CACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,8CACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAM2iD,QACNziD,SAAS,EACT4iD,SAAU17C,IACRg7C,iBAAiB,gBAAiBh7C,EAAM,IAM5CtB,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,uBAAwB,CACxD0B,KAAMiH,KAAKyF,KAAKE,SAAS,qDACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,qDACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAM2iD,QACNziD,SAAS,EACT4iD,SAAU17C,IACRg7C,iBAAiB,uBAAwBh7C,EAAM,IAMnDtB,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,cAAe,CAC/C0B,KAAMiH,KAAKyF,KAAKE,SAAS,4CACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,4CACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAM2iD,QACNziD,SAAS,EACT4iD,SAAU17C,IACRg7C,iBAAiB,cAAeh7C,EAAM,IAM1CtB,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,eAAgB,CAChD0B,KAAMiH,KAAKyF,KAAKE,SAAS,6CACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,6CACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAM2iD,QACNziD,SAAS,EACT4iD,SAAU17C,IACRg7C,iBAAiB,eAAgBh7C,EAAM,IAM3CtB,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,WAAY,CAC5C0B,KAAMiH,KAAKyF,KAAKE,SAAS,yCACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,yCACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAMC,OACNC,QAAS,OACT+qC,QAAS,CACPsY,KAAMz9C,KAAKyF,KAAKE,SAAS,iDACzB+3C,SAAU19C,KAAKyF,KAAKE,SAAS,qDAC7Bg4C,KAAM39C,KAAKyF,KAAKE,SAAS,kDAE3Bq3C,SAAU17C,IACRg7C,iBAAiB,WAAYh7C,EAAM,IAMvCtB,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,eAAgB,CAChD0B,KAAMiH,KAAKyF,KAAKE,SAAS,6CACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,6CACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAMI,OACNF,QAAS,KACT4iD,SAAU17C,IACRs8C,gBAAgBt8C,EAAM,IAM1B,MAAMu8C,EAAe19C,MAAMC,WAAW,iBAAmB,KAOzD,SAASw9C,gBAAgBltC,GACvB,MAAMotC,EAAOx0C,SAASK,cAAc,SACpCm0C,EAAK7+C,MAAM2K,YAAY,sBAAuB,GAAG8G,MAClD,CATDktC,gBAAgBC,GAahB79C,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,oBAAqB,CACrD0B,KAAMiH,KAAKyF,KAAKE,SAAS,kDACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,kDACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAM2iD,QACNziD,SAAS,EACT4iD,SAAU17C,IACRg7C,iBAAiB,oBAAqBh7C,EAAM,IAM5CnB,MAAM8F,eAAe,cAAgB9F,MAAM8F,eAAe,aAC5DjG,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,YAAa,CAC7C0B,KAAMiH,KAAKyF,KAAKE,SAAS,0CACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,0CACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAMC,OACNgrC,QAAS,CACP4Y,KAAM/9C,KAAKyF,KAAKE,SAAS,kDACzBlH,UAAWuB,KAAKyF,KAAKE,SAAS,uDAC9B9D,SAAU7B,KAAKyF,KAAKE,SAAS,uDAE/BvL,QAAS,OACT4iD,SAAU17C,IACRg7C,iBAAiB,YAAah7C,EAAM,IAO1CtB,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,kBAAmB,CACnD0B,KAAMiH,KAAKyF,KAAKE,SAAS,gDACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,gDACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAM2iD,QACNziD,SAAS,EACT4iD,SAAU17C,IACRg7C,iBAAiB,kBAAmBh7C,EAAM,IAM9CtB,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,uBAAwB,CACxD0B,KAAMiH,KAAKyF,KAAKE,SAAS,qDACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,qDACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAM2iD,QACNziD,SAAS,EACT4iD,SAAU17C,IACRg7C,iBAAiB,uBAAwBh7C,EAAM,IAMnDtB,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAI,QAAS,CACzC0B,KAAMiH,KAAKyF,KAAKE,SAAS,sCACzB7I,KAAMkD,KAAKyF,KAAKE,SAAS,sCACzBzI,MAAO,SACP0/C,QAAQ,EACR1iD,KAAM2iD,QACNziD,SAAS,EACT4iD,SAAU17C,IACRg7C,iBAAiB,QAASh7C,EAAM,IAMpC08C,8BAEA/qC,EAAcgrC,iBAAiB3B,kBAE/Bl9C,GAAOnB,MAAM,0BAA2B,CAAEw+C,gBAC5C,EAOA,SAASuB,8BACP,IAAK,MAAOp5C,EAAKtD,KAAU4H,OAAOJ,QAAQ/O,GACxCiG,KAAKlI,SAASk8C,SAAS58C,EAAOC,GAAIuN,EAAK,CACrC1H,MAAO,SACP0/C,QAAQ,EACR1iD,KAAMoH,EAAMpH,KACZE,QAASkH,EAAMlH,SAGrB,CChcO,MAAM8jD,uCAAuClE,sBAClD,WAAAx5C,GACEqhC,OACD,CAQD,mBAAAoW,GACE,IAAKv3C,KAAKgC,MAAO,OAEjB,MAAM2B,EAAQ3D,KAAKgC,MAAM2B,MAAMoN,QAAOqpC,GAAQA,EAAKrH,OAAO0K,UAAU3lD,OAAO4lD,UAC3E,IAAK/5C,GAAOqD,OAAQ,OAEpB,MAAM22C,EAAmBl+C,MAAMC,WAAW,aAC1C,GAAyB,aAArBi+C,EAAiC,OAErC,MAAMC,EAAuC,cAArBD,EAExBn1C,OAAOG,OAAO3I,KAAKuR,aAAa/F,QAAQkN,SAAQzhB,IAC9C+I,MAAK69C,GAAiBl6C,EAAO1M,EAAO2mD,EAAgB,GAEvD,CAWD,GAAAC,CAAiBl6C,EAAO1M,EAAO4J,GAE7B,IAAK5J,GAAOwd,SAASzN,OAAQ,OAE7B,MAAMyN,EAAU,GAChB,IAAK,MAAMwkC,KAAkBhiD,EAAMwd,QAAS,CAC1C,MAAM2lC,EAAOz2C,EAAM7B,MAAKs4C,GAAQA,EAAKr4C,KAAOk3C,EAAel3C,KAC3D,IAAKq4C,EAAM,SAEX,MAAM0D,EAA0B7mD,EAAMwd,QAAQ3S,MAAK/K,GAAUA,EAAOgL,KAAO,aAAak3C,EAAel3C,OACjGg8C,EAAkBD,GAA2B7E,EAE/C6E,IAAyBj9C,GAAU,GAEvC,MAAMm9C,EAAch+C,MAAKi+C,GAAuB7D,EAAMnB,EAAgB8E,EAAiBl9C,GAElFA,GACH4T,EAAQrR,KAAK46C,GAGVh+C,KAAKwR,cAAcsK,iBAAiBtM,IAAIwuC,EAAYj8C,KACvD/B,KAAKwR,cAAcsK,iBAAiBzX,IAAI25C,EAAYj8C,GAAIi8C,EAE3D,CAEDh+C,MAAKy0C,GAAYhgC,EAASxd,EAC3B,CAaD,GAAAgnD,CAAuB7D,EAAMnB,EAAgB8E,EAAiBl9C,GAC5D,MAAM9J,EAAS,EAAYgnD,EAAkBt+C,MAAMG,UAAUq5C,GAmB7D,OAlBAliD,EAAOuhD,aAAe,YAAYW,EAAeX,cAAc/Z,OAAO0a,EAAeX,aAAat2B,QAAQvqB,MAC1GV,EAAOgL,GAAK,aAAak3C,EAAel3C,KACxChL,EAAOohD,SAAWc,EAAed,SACjCphD,EAAOgf,SAAW,eAAekjC,EAAed,WAChDphD,EAAOsB,KAAO4gD,EAAe5gD,KAC7BtB,EAAOwM,IAAM01C,EAAe11C,IAC5BxM,EAAOmnD,cAAgB,aAAaniD,EAAgBC,uBAAuBD,EAAgBE,gBAC3FlF,EAAO6d,SAAWqkC,EAAehiC,cAAgBgiC,EAAetB,eAEhE5gD,EAAOq0B,QAAU,KACf,IACEgvB,EAAK+D,cACN,CAAC,MAAM/sC,GAEN,OADA1S,OAAOnB,MAAM,kBAAmB6T,IACzB,CACR,GAGIra,CACR,CAUD,GAAA09C,CAAYhgC,EAASxd,GACnBwd,EAAQiE,SAAQslC,IACd,MAAMvxC,EAAQxV,EAAMwd,QAAQ+Y,WAAUz2B,GAAUA,EAAOgL,KAAOi8C,EAAYj8C,KAAM,EAChF9K,EAAMwd,QAAQ/H,OAAOD,EAAO,EAAGuxC,EAAY,GAE9C,EChHI,MAAMI,cACX,WAAAt+C,GACEE,KAAKq+C,aAAe3nD,EAAOC,GAC3BqJ,KAAK6S,SAAW,GAChB7S,KAAK6rC,OAAS,IACf,CAMD,gBAAAyS,GAAqB,CAErB,cAAAC,CAAeC,GACb,OAAO,CACR,CAED,wBAAAC,GAA6B,CAE7B,gBAAAlB,CAAiB3B,GAAoB,CAErC,sBAAM8C,GAAqB,CAE3B,cAAAC,GAAmB,CAOnB,UAAM7xC,SACE9M,MAAK4+C,KACX5+C,MAAK6+C,KACL7+C,MAAK87C,IACN,CAUD,QAAM8C,GACJ,MAAM/rC,QAAiB7S,KAAK0+C,oBAAsB,GAElD/b,MAAM+B,QAAQ,qCAAsC7xB,GAEhDA,IACF7S,KAAK6S,SAAWA,EAEnB,CAQD,GAAAgsC,GACE,MAAMC,EAAe9+C,KAAK2+C,kBAAoB,CAAA,EAC9C3+C,KAAK6rC,OAASxqC,QAAQC,MAAMy9C,YAAY/mD,EAAW8mD,GAEnDnc,MAAM+B,QAAQ,mCAAoC1kC,KAAK6rC,OACxD,CAQD,GAAAiQ,GACE,MAAMC,EAAe/7C,KAAKy+C,2BAC1B3C,qBAAqB97C,KAAM+7C,EAAc/7C,KAAK6rC,OAC/C,CAUD,oBAAA/yB,CAAqBxH,GACnB,MAAME,EAAgBxR,KAAKs+C,mBAC3B9sC,EAAce,cAAgBvS,KAE9B,MAAM0O,YAAEA,EAAW6C,aAAEA,GAAiBD,EAUtC,OATAE,EAAcF,WAAaA,EAC3BE,EAAc9C,YAAcA,EAC5B8C,EAAcD,aAAeA,EAC7BC,EAAc0G,SAAW3G,EAAa2G,SAASgF,KAAK3L,GACpDC,EAAcgH,aAAejH,EAAaiH,aAAa0E,KAAK3L,GAC5DvR,MAAKg/C,GAA2BztC,EAAcC,GAE9CmxB,MAAM+B,QAAQ,qCAAsClzB,GAE7CA,CACR,CAUD,GAAAwtC,CAA2BztC,EAAcC,GACnC/R,MAAM8F,eAAe,cAAgB9F,MAAM8F,eAAe,aAC5DiM,EAAc4nC,yBAAyB,IAAIoE,+BAA+BjsC,EAAcC,IAG1FmxB,MAAM+B,QAAQ,8CAA+ClzB,EAC9D,CAUD,kBAAAuH,CAAmBzH,GACjB,IAAIktC,EAAgB/+C,MAAMC,WAAW,eAEb,SAAlB8+C,GAA4B/+C,MAAM8F,eAAei5C,KACrD9/C,GAAOQ,MAAMs/C,EAAel/C,KAAKyF,KAAKE,SAAS,mCAC/Cu5C,EAAgB,OAChB/+C,MAAM2E,WAAW,cAAeo6C,IAIlC,MAAMrgD,EAAc6B,KAAKu+C,eAAeC,IAAkB,IAAIjF,YAO9D,OANAp7C,EAAYmT,WAAaA,EAEzBtR,MAAKi/C,GAAyB9gD,GAE9BwkC,MAAM+B,QAAQ,mCAAoCvmC,GAE3CA,CACR,CASD,GAAA8gD,CAAyB9gD,GACvBwkC,MAAM+B,QAAQ,4CAA6CvmC,EAC5D,CASD,iBAAO+gD,CAAWza,EAAS1iC,GACzB,GAAItC,MAAM8F,eAAexD,GAAK,CAC5B,MAAM4D,EAAQlG,MAAMiG,eAAe3D,GACnCV,QAAQC,MAAMy9C,YAAYta,EAAS,CAAE1iC,CAACA,GAAK4D,GAC5C,CACF,ECnKI,SAASw5C,cACd,MAAM35C,EAASlG,KAAKmG,QAAQvD,IAAIxL,EAAOC,IACvC6O,EAAOy7B,IAAM,CACXqY,4CACA/C,4BACA3pC,wBACJlO,OAAIA,GACA47C,8BACAf,wBACAgB,wCACA6D,4BACAv+C,YACAJ,aAGFkjC,MAAM+B,QAAQ,6BAA8Bl/B,EAC9C,CCrBA,IAAI+M,GAkBJnG,eAAegzC,mBAAmBC,GAE3B5/C,MAAMwL,yBAAyBo0C,EAAape,KAAK/1B,4BAGjDqoC,sBAGLhhC,GAAgB,IAAI8sC,EAAape,IAAImd,cAAc1nD,EAAOC,UACpD4b,GAAczF,OAGpBrN,MAAM8I,UAAU9I,MAAMC,WAAW,UAGjCD,MAAM8J,qBAGN+1C,cAAc92C,OAAOG,OAAO7R,IAE5B6rC,MAAM+B,QAAQ,2BAChB,CAOAt4B,eAAemzC,cAEb,MAAM1yC,EAAS2mC,YAGT9kC,EAAc,IAAI9B,YAAYC,SAC9B6B,EAAY5B,OAGlB,MAAM0yC,EAAmB,IAAI7uC,iBAAiBjC,EAAa7B,SACrD2yC,EAAiB1yC,OAEvB2yC,mBACAC,mBAEApgD,KAAKC,eAAiB,IAAIkrC,eAAel4B,GAAe7D,EAAa7B,SAC/DvN,KAAKC,eAAeuN,OAE1B61B,MAAM+B,QAAQ,uBAEdplC,KAAKC,eAAe4Y,OAAO,CAAE3e,KAAM,OAAQnB,KAAM,2BACnD,CAOA,SAASonD,mBACHngD,KAAK2E,KAAKoB,OAAS/F,KAAKmG,QAAQvD,IAAI,iBAAiBoD,SAA0C,IAAhC7F,MAAMC,WAAW,aAClFhB,GAAOC,KAAK,+DAA+D,GAC3Ec,MAAM2E,WAAW,WAAW,GAEhC,CAOA,SAASs7C,mBACP/c,MAAMjQ,GAAG,wBAAwB,IAAMpzB,KAAKC,eAAeouC,eAC3D,MAAMtkB,EAAQ,CACZ,cAAe,cAAe,qBAAsB,qBACpD,eAAgB,eAAgB,eAAgB,kBAChD,mBAAoB,mBAAoB,aAAc,aACtD,aAAc,cAAe,cAAe,eAAgB,cAC5D,cAAe,sBAAuB,6BAGxCA,EAAM3Q,SAAQinC,GAAQhd,MAAMjQ,GAAGitB,GAAM,IAAI/1C,IAASg2C,gBAAgB,IAAKh2C,GAAQ+1C,MACjF,CASA,SAASC,gBAAgBC,EAAUC,GAC5BC,iBAAiBF,EAAUC,IAChCxgD,KAAKC,eAAe4Y,OAAO,CAAE3e,KAAM,OAAQnB,KAAMynD,EAAU1gD,KAAMygD,GACnE,CAUA,SAASE,iBAAiBF,EAAUC,GAClC,OAAQA,GACN,IAAK,cACL,IAAK,cACH,OAAOxgD,KAAKC,eAAe2zC,yBAAyB2M,EAAS,GAAIA,EAAS,IAC5E,IAAK,qBACL,IAAK,qBACH,OAAOvgD,KAAKC,eAAe0zC,kBAAkB4M,EAAS,IAAIG,QAC5D,IAAK,kBACL,IAAK,kBACH,OAAO1gD,KAAKC,eAAe0zC,kBAAkB4M,EAAS,IAAI79C,OAC5D,IAAK,mBACL,IAAK,mBACH,OAAOi+C,mBAAmBJ,EAAS1hC,QAAQlG,UAAUlW,IACvD,IAAK,aACL,IAAK,aACL,IAAK,aACH,OAAOzC,KAAKC,eAAe2zC,yBAAyB2M,EAAS,IAAI79C,OACnE,IAAK,cACL,IAAK,cAEH,OADA1C,KAAKC,eAAeiS,cAAcklC,mBAAmBT,aAAe,MAC7D,EACT,IAAK,cACH,OAAOztC,OAAO03C,OAAOL,EAAS,GAAI,WAAavgD,KAAKC,eAAeuzC,mBAAmB+M,EAAS,GAAIA,EAAS,IAC9G,QACE,OAAO,EAEb,CASA,SAASI,mBAAmBl+C,GAC1B,MAAMo+C,EAAoB7gD,KAAKC,eAAeiS,cAAcilC,wBAC5D,QAAK0J,EAAkBpK,mBAAmBh0C,KAC1Co+C,EAAkBvL,kBAAoB,IAAIzsC,KACnC,EACT,CASA,SAASi4C,uBAAuBvd,EAAM9lB,GACpC,MAAMwtB,EAAU1H,EAAK,GAAG55B,cAAc8T,GAClCwtB,GAASA,EAAQ3tB,iBAAiB,cAAeyjC,gBACvD,CAOA,SAASA,kBACH/gD,KAAKC,gBAAgBgrC,UACvBjrC,KAAKC,eAAegrC,QAAQhsC,MAAMmtC,OAAS,GAE/C,CAlLA/I,MAAMzU,KAAK,kBAAmBilB,gBAC9BxQ,MAAMjQ,GAAG,QAASysB,aAClBxc,MAAMjQ,GAAG,4BAA6B0sB,oBACtCzc,MAAMjQ,GAAG,0BAA2B6sB,aACpC5c,MAAMjQ,GAAG,gBAAgB,CAAC7H,EAAGgY,IAASud,uBAAuBvd,EAAM,cACnEF,MAAMjQ,GAAG,yBAAyB,CAAC7H,EAAGgY,IAASud,uBAAuBvd,EAAM","x_google_ignoreList":[9,10]}